<!DOCTYPE html>
<!-- saved from url=(0028)https://phpdelusions.net/pdo -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries--><!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
    <!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
    <!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
    <!--[if (gte IE 9)|!(IE)]><!--> <!--<![endif]-->
    <!--[if lt IE 9]>
    <script src="js/html5shiv.js"></script>
    <script src="js/respond.js"></script>
    <![endif]-->
    <!-- Mobile Devices Scale Trick-->
    <meta name="google-site-verification" content="rXSCgsT7Ek0Ybsq0OoRen2NsI91_GOHSCXWmGQ3K8OM">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Seo Tags-->
    <meta property="og:type" content="article">
    <meta property="og:title" content="(The only proper) PDO tutorial">
    <meta property="og:site_name" content="Treating PHP delusions">
    <meta property="og:description" content="There are many tutorials on PDO already, but unfortunately, most of them fail to explain the real benefits of PDO, or even promote rather bad practices. The only two exceptions are [phptherightway.com](http://www.phptherightway.com/#pdo_extension) and [hashphp.org](http://wiki.hashphp.org/PDO_Tutorial_for_MySQL_Developers), but they miss a lot of important information. As a result, half of PDO&#39;s features remain in obscurity and are almost never used by PHP developers, who, as a result, are constantly trying to reinvent the wheel which *already exists in PDO.*
">
    <meta property="og:url" content="https://phpdelusions.net/pdo">
    <meta property="og:image" content="https://phpdelusions.net/img/phpdelusion-big.png">

    <meta name="description" content="There are many tutorials on PDO already, but unfortunately, most of them fail to explain the real benefits of PDO, or even promote rather bad practices. The only two exceptions are [phptherightway.com](http://www.phptherightway.com/#pdo_extension) and [hashphp.org](http://wiki.hashphp.org/PDO_Tutorial_for_MySQL_Developers), but they miss a lot of important information. As a result, half of PDO&#39;s features remain in obscurity and are almost never used by PHP developers, who, as a result, are constantly trying to reinvent the wheel which *already exists in PDO.*
">

    <title>(The only proper) PDO tutorial - Treating PHP Delusions</title>
    <!-- Favicon-->
<link rel="apple-touch-icon" sizes="57x57" href="https://phpdelusions.net/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="https://phpdelusions.net/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="https://phpdelusions.net/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="https://phpdelusions.net/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="https://phpdelusions.net/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="https://phpdelusions.net/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="https://phpdelusions.net/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="https://phpdelusions.net/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="https://phpdelusions.net/apple-touch-icon-180x180.png">
<link rel="icon" type="image/png" href="https://phpdelusions.net/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="https://phpdelusions.net/android-chrome-192x192.png" sizes="192x192">
<link rel="icon" type="image/png" href="https://phpdelusions.net/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="https://phpdelusions.net/favicon-16x16.png" sizes="16x16">
<link rel="manifest" href="https://phpdelusions.net/manifest.json">
<link rel="mask-icon" href="https://phpdelusions.net/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-TileImage" content="/mstile-144x144.png">
<meta name="theme-color" content="#ffffff">
   
    <!-- StyleSheet-->
    <link rel="stylesheet" href="./(The only proper) PDO tutorial - Treating PHP Delusions_files/bootstrap.min.css" type="text/css">
    <link rel="stylesheet" href="./(The only proper) PDO tutorial - Treating PHP Delusions_files/phpdelusions.css" type="text/css">
    <!-- Loading Fira Sans From Google-->
  <style type="text/css">
button.btn[data-v-a4d9f4e4]{display:inline-block;font-weight:300;line-height:1.25;text-align:center;white-space:nowrap;vertical-align:middle;user-select:none;border:1px solid transparent;cursor:pointer;letter-spacing:1px;transition:all .15s ease
}
button.btn.btn-sm[data-v-a4d9f4e4]{padding:.4rem .8rem;font-size:.8rem;border-radius:.2rem
}
button.btn.btn-primary[data-v-a4d9f4e4]{color:#fff;background-color:#45C8F1;border-color:#45C8F1
}
button.btn.btn-outline-primary[data-v-a4d9f4e4]{color:#45C8F1;background-color:transparent;border-color:#45C8F1
}
button.btn.btn-danger[data-v-a4d9f4e4]{color:#fff;background-color:#FF4949;border-color:#FF4949
}
.text-muted[data-v-a4d9f4e4]{color:#8492A6
}
.text-center[data-v-a4d9f4e4]{text-align:center
}
.drop-down-enter[data-v-a4d9f4e4],.drop-down-leave-to[data-v-a4d9f4e4]{transform:translateX(0) translateY(-20px);transition-timing-function:cubic-bezier(0.74, 0.04, 0.26, 1.05);opacity:0
}
.drop-down-enter-active[data-v-a4d9f4e4],.drop-down-leave-active[data-v-a4d9f4e4]{transition:all .15s
}
.move-left-enter[data-v-a4d9f4e4],.move-left-leave-to[data-v-a4d9f4e4]{transform:translateY(0) translateX(-80px);transition-timing-function:cubic-bezier(0.74, 0.04, 0.26, 1.05);opacity:0
}
.move-left-enter-active[data-v-a4d9f4e4],.move-left-leave-active[data-v-a4d9f4e4]{transition:all .15s
}
.overlay[data-v-a4d9f4e4]{position:fixed;background:rgba(220,220,220,0.8);display:flex;align-items:center;justify-content:center;top:0;left:0;right:0;bottom:0;transition:all 0.2s ease;opacity:0;visibility:hidden
}
.overlay .modal[data-v-a4d9f4e4]{transition:all 0.2s ease;opacity:0;transform:scale(0.6);overflow:hidden
}
.overlay.show[data-v-a4d9f4e4]{opacity:1;visibility:visible
}
.overlay.show .modal[data-v-a4d9f4e4]{opacity:1;transform:scale(1)
}
.shake[data-v-a4d9f4e4]{animation:shake-data-v-a4d9f4e4 0.82s cubic-bezier(0.36, 0.07, 0.19, 0.97) both;transform:translate3d(0, 0, 0)
}
@keyframes shake-data-v-a4d9f4e4{
10%,90%{transform:translate3d(-1px, 0, 0)
}
20%,80%{transform:translate3d(2px, 0, 0)
}
30%,50%,70%{transform:translate3d(-4px, 0, 0)
}
40%,60%{transform:translate3d(4px, 0, 0)
}
}
.pulse[data-v-a4d9f4e4]{animation:pulse-data-v-a4d9f4e4 2s ease infinite
}
@keyframes pulse-data-v-a4d9f4e4{
0%{opacity:.7
}
50%{opacity:.4
}
100%{opacity:.7
}
}
.flash-once[data-v-a4d9f4e4]{animation:flash-once 3.5s ease 1
}
@keyframes fade-up-data-v-a4d9f4e4{
0%{transform:translate3d(0, 10px, 0);opacity:0
}
100%{transform:translate3d(0, 0, 0);opacity:1
}
}
.fade-in[data-v-a4d9f4e4]{animation:fade-in-data-v-a4d9f4e4 .3s ease-in-out
}
@keyframes fade-in-data-v-a4d9f4e4{
0%{opacity:0
}
100%{opacity:1
}
}
.spin[data-v-a4d9f4e4]{animation-name:spin-data-v-a4d9f4e4;animation-duration:2000ms;animation-iteration-count:infinite;animation-timing-function:linear
}
@keyframes spin-data-v-a4d9f4e4{
from{transform:rotate(0deg)
}
to{transform:rotate(360deg)
}
}
.bounceIn[data-v-a4d9f4e4]{animation-name:bounceIn-data-v-a4d9f4e4;transform-origin:center bottom;animation-duration:1s;animation-fill-mode:both;animation-iteration-count:1
}
@keyframes bounceIn-data-v-a4d9f4e4{
0%,20%,40%,60%,80%,100%{-webkit-transition-timing-function:cubic-bezier(0.215, 0.61, 0.355, 1);transition-timing-function:cubic-bezier(0.215, 0.61, 0.355, 1)
}
0%{opacity:1;-webkit-transform:scale3d(0.8, 0.8, 0.8);transform:scale3d(0.8, 0.8, 0.8)
}
20%{-webkit-transform:scale3d(1.1, 1.1, 1.1);transform:scale3d(1.1, 1.1, 1.1)
}
40%{-webkit-transform:scale3d(0.9, 0.9, 0.9);transform:scale3d(0.9, 0.9, 0.9)
}
60%{opacity:1;-webkit-transform:scale3d(1.03, 1.03, 1.03);transform:scale3d(1.03, 1.03, 1.03)
}
80%{-webkit-transform:scale3d(0.97, 0.97, 0.97);transform:scale3d(0.97, 0.97, 0.97)
}
100%{opacity:1;-webkit-transform:scale3d(1, 1, 1);transform:scale3d(1, 1, 1)
}
}
@keyframes dots-data-v-a4d9f4e4{
0%,20%{color:rgba(0,0,0,0);text-shadow:0.25em 0 0 rgba(0,0,0,0),0.5em 0 0 rgba(0,0,0,0)
}
40%{color:#8492A6;text-shadow:0.25em 0 0 rgba(0,0,0,0),0.5em 0 0 rgba(0,0,0,0)
}
60%{text-shadow:0.25em 0 0 #8492A6,0.5em 0 0 rgba(0,0,0,0)
}
80%,100%{text-shadow:.25em 0 0 #8492A6, .5em 0 0 #8492A6
}
}
@keyframes recording-data-v-a4d9f4e4{
0%{box-shadow:0px 0px 5px 0px rgba(173,0,0,0.3)
}
65%{box-shadow:0px 0px 5px 5px rgba(173,0,0,0.3)
}
90%{box-shadow:0px 0px 5px 5px rgba(173,0,0,0)
}
}
html[data-v-a4d9f4e4]{max-height:500px
}
body[data-v-a4d9f4e4]{margin:0;font-size:100%;color:#3C4858;width:350px;max-height:500px
}
a[data-v-a4d9f4e4]{text-decoration:none;color:#45C8F1
}
h1[data-v-a4d9f4e4],h2[data-v-a4d9f4e4],h3[data-v-a4d9f4e4],h4[data-v-a4d9f4e4]{margin-top:0
}
.container_selected_area[data-v-a4d9f4e4]{display:none;visibility:hidden;padding:0;position:fixed;top:0;left:0;right:0;bottom:0;z-index:2147483647
}
.container_selected_area.active[data-v-a4d9f4e4]{visibility:visible;display:block
}
.container_selected_area .label[data-v-a4d9f4e4]{font-family:"Didact Gothic Regular",sans-serif;font-size:22px;text-align:center;padding-top:15px
}
.container_selected_area .area[data-v-a4d9f4e4]{display:none;position:fixed;z-index:2147483647;border:1px solid #1e83ff;background:rgba(30,131,255,0.1);box-sizing:border-box
}
.container_selected_area .area.active[data-v-a4d9f4e4]{display:block;top:0;left:0
}
.hide[data-v-a4d9f4e4]{display:none
}
</style></head>
  <body>
    <nav role="navigation" class="navbar navbar-phpfaq">
      <div class="container">
        <div class="col-xs-12">
          <div class="navbar-header">
            <button type="button" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" class="navbar-toggle collapsed">
                <i class="fa fa-bars icon-baton"></i>
                <span class="sr-only">Menu</span>
            </button>
                      </div>
          <div id="bs-example-navbar-collapse-1" class="collapse navbar-collapse">
            <ul class="nav navbar-nav navbar-left">

              <li class="active"><a href="https://phpdelusions.net/pdo">PDO</a></li>
              <li><a href="https://phpdelusions.net/mysqli">Mysqli</a></li>
              <li><a href="https://phpdelusions.net/sql_injection">SQL Injection</a></li>
              <li><a href="https://phpdelusions.net/articles">Articles</a></li>
              <li><a href="https://phpdelusions.net/safemysql">SafeMySQL</a></li>
              <li><a href="https://phpdelusions.net/fun">Fun</a></li>

            </ul>
          </div>
        </div>
      </div>
    </nav>

    <div class="crumbs">
      <div class="container">
        <div class="col-xs-12">
          <ol class="breadcrumb">
            <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li>

            <li class="active">PDO</li>

          </ol>
        </div>
      </div>
    </div>

    <div class="container main-content">
        <div style="float:right;margin: 0 15px 20px 0;">
<div id="fb-root" sryle="margin: 5px 5px;"></div>
<script async="" src="./(The only proper) PDO tutorial - Treating PHP Delusions_files/analytics.js"></script><script id="twitter-wjs" src="https://platform.twitter.com/widgets.js"></script><script id="facebook-jssdk" src="https://connect.facebook.net/en_US/sdk.js#xfbml=1&amp;version=v2.5"></script><script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.5";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
            <span style="vertical-align:sub;"><a class="twitter-share-button" data-url="http://phpdelusions.net/pdo" href="https://twitter.com/share">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script></span>
            <div class="fb-like" data-href="http://phpdelusions.net//pdo" data-layout="button_count" data-action="like" data-show-faces="false" data-share="true"></div>
        </div>
      <div class="col-xs-12 col-sm-7 col-md-8 mb-4">
      <h1>(The only proper) PDO tutorial</h1>
<ol><li><a href="https://phpdelusions.net/pdo#why">Why PDO?</a></li>
<li><a href="https://phpdelusions.net/pdo#dsn">Connecting. DSN</a></li>
<li><a href="https://phpdelusions.net/pdo#query">Running queries. PDO::query()</a></li>
<li><a href="https://phpdelusions.net/pdo#prepared">Prepared statements. Protection from SQL injections</a></li>
<ul>
<li><a href="https://phpdelusions.net/pdo#methods">Binding methods</a></li>
<li><a href="https://phpdelusions.net/pdo#bindable">Query parts you can bind</a></li>
</ul>
<li><a href="https://phpdelusions.net/pdo#multiexec">Prepared statements. Multiple execution</a></li>
<li><a href="https://phpdelusions.net/pdo#dml">Running SELECT INSERT, UPDATE, or DELETE statements</a></li>
<li><a href="https://phpdelusions.net/pdo#foreach">Getting data out of statement. foreach()</a></li>
<li><a href="https://phpdelusions.net/pdo#fetch">Getting data out of statement. fetch()</a></li>
<ul>
<li><a href="https://phpdelusions.net/pdo#returntypes">Return types.</a></li>
</ul>
<li><a href="https://phpdelusions.net/pdo#fetchcolumn">Getting data out of statement. fetchColumn()</a></li>
<li><a href="https://phpdelusions.net/pdo#fetchall">Getting data out of statement in dozens different formats. fetchAll()</a></li>
<ul>
<li><a href="https://phpdelusions.net/pdo#array">Getting a plain array.</a></li>
<li><a href="https://phpdelusions.net/pdo#column">Getting a column.</a></li>
<li><a href="https://phpdelusions.net/pdo#pairs">Getting key-value pairs.</a></li>
<li><a href="https://phpdelusions.net/pdo#unique">Getting rows indexed by unique field</a></li>
<li><a href="https://phpdelusions.net/pdo#group">Getting rows grouped by some field</a></li>
</ul>
<li><a href="https://phpdelusions.net/pdo#errors">Error handling. Exceptions</a></li>
<ul>
<li><a href="https://phpdelusions.net/pdo#reporting_errors">Reporting PDO errors</a></li>
<li><a href="https://phpdelusions.net/pdo#catch">Catching PDO exceptions</a></li>
</ul>
<li><a href="https://phpdelusions.net/pdo#count">Getting row count with PDO</a></li>
<li><a href="https://phpdelusions.net/pdo#affected">Affected rows and insert id</a></li>
<li><a href="https://phpdelusions.net/pdo#like">Prepared statements and LIKE clause</a></li>
<li><a href="https://phpdelusions.net/pdo#in">Prepared statements and IN clause</a></li>
<li><a href="https://phpdelusions.net/pdo#identifiers">Protecting table and field names</a></li>
<li><a href="https://phpdelusions.net/pdo#limit">A problem with LIMIT clause</a></li>
<li><a href="https://phpdelusions.net/pdo#transactions">Transactions</a></li>
<li><a href="https://phpdelusions.net/pdo#call">Calling stored procedures in PDO</a></li>
<li><a href="https://phpdelusions.net/pdo#multiquery">Running multiple queries with PDO</a></li>
<li><a href="https://phpdelusions.net/pdo#emulation">Emulation mode. PDO::ATTR_EMULATE_PREPARES</a></li>
<ul>
<li><a href="https://phpdelusions.net/pdo#emulation_on">When emulation mode is turned ON</a></li>
<li><a href="https://phpdelusions.net/pdo#emulation_off">When emulation mode is turned OFF</a></li>
</ul>
<li><a href="https://phpdelusions.net/pdo#mysqlnd">Mysqlnd and buffered queries. Huge datasets. </a></li>
<li style="list-style-type: &#39;&#9998;&#39;;"><a href="https://phpdelusions.net/pdo#comments">Comments (283)</a></li></ol><br>
<p>There are many tutorials on PDO already, but unfortunately, most of them fail to explain the real benefits of PDO, or even promote rather bad practices. The only two exceptions are <a href="http://www.phptherightway.com/#pdo_extension">phptherightway.com</a> and <a href="http://wiki.hashphp.org/PDO_Tutorial_for_MySQL_Developers">hashphp.org</a>, but they miss a lot of important information. As a result, half of PDO's features remain in obscurity and are almost never used by PHP developers, who, as a result, are constantly trying to reinvent the wheel which <em>already exists in PDO.</em></p>
<p>Unlike those, this tutorial is written by someone who has used PDO for many years, dug through it, and answered thousands questions on Stack Overflow (the <a href="http://stackoverflow.com/help/badges/4220/pdo">sole gold PDO badge bearer</a>). Following <a href="https://phpdelusions.net/">the mission of this site</a>, this article will disprove various delusions and bad practices, while showing the right way instead.</p>
<p>Although this tutorial is based on <strong>mysql</strong> driver, the information, in general, is applicable for any driver supported.</p>
<h3 id="why" class="title-h3">Why PDO?</h3>
<p>First things first. Why <abbr title="PHP Data Objects">PDO</abbr> at all?</p>
<p>PDO is a <a href="https://en.wikipedia.org/wiki/Database_abstraction_layer">Database Access Abstraction Layer</a>. The abstraction, however, is two-fold: one is widely known but less significant, while another is obscure but of most importance.</p>
<p>Everyone knows that PDO offers unified interface to access <a href="http://php.net/manual/en/pdo.drivers.php">many different databases</a>. Although this feature is magnificent by itself, it doesn't make a big deal for the particular application, where only one database backend is used anyway. And, despite some rumors, it is impossible to switch database backends by changing a single line in PDO config - due to different SQL flavors (to do so, one needs to use an averaged query language like <a href="http://doctrine-orm.readthedocs.org/projects/doctrine-orm/en/latest/reference/dql-doctrine-query-language.html">DQL</a>). Thus, for the average LAMP developer, this point is rather insignificant, and to him, PDO is just a more complicated version of familiar <code>mysql(i)_query()</code> function. However, it is not; it is much, much more.</p>
<p>PDO abstracts not only a database API, but also basic operations that otherwise have to be repeated hundreds of times in every application, making your code extremely <abbr title="Write Everything Twice">WET</abbr>. <a href="https://phpdelusions.net/pdo/mysqli_comparison">Unlike <em>mysql</em> and <em>mysqli</em></a>, both of which are low level bare APIs not intended to be used directly (but only as a building material for some higher level abstraction layer), <code>PDO</code> <em>is</em> such an abstraction already. Still incomplete though, but at least usable.</p>
<p>The real PDO benefits are:</p>
<ul>
<li><strong>security</strong> (<em>usable</em> prepared statements)</li>
<li><strong>usability</strong> (many helper functions to automate routine operations)</li>
<li><strong>reusability</strong> (unified API to access multitude of databases, from SQLite to Oracle)</li>
</ul>
<p>Note that although PDO is the best out of native db drivers, for a modern web-application consider to use an ORM with a Query Builder, or any other higher level abstraction library, with only occasional fallback to vanilla PDO. Good ORMs are Doctrine, Eloquent, RedBean, and Yii::AR. Aura.SQL is a good example of a PDO wrapper with many additional features.</p>
<p>Either way, it's good to know the basic tools first. So, let's begin:</p>
<h3 id="dsn" class="title-h3">Connecting. DSN</h3>
<p>PDO has a fancy connection method called <a href="https://en.wikipedia.org/wiki/Data_source_name">DSN</a>. It's nothing complicated though - instead of one plain and simple list of options, PDO asks you to input different configuration directives in three different places:</p>
<ul>
<li><code>database driver</code>, <code>host</code>, <code>db (schema) name</code> and <code>charset</code>, as well as less frequently used <code>port</code> and <code>unix_socket</code> go into DSN;</li>
<li><code>username</code> and <code>password</code> go to constructor;</li>
<li>all other options go into options array.</li>
</ul>
<p>where DSN is a semicolon-delimited string, consists of <code>param=value</code> pairs, that begins from the driver name and a colon:</p>
<pre><code><code><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mysql</span><span style="color: #007700">:</span><span style="color: #0000BB">host</span><span style="color: #007700">=</span><span style="color: #0000BB">localhost</span><span style="color: #007700">;</span><span style="color: #0000BB">dbname</span><span style="color: #007700">=</span><span style="color: #0000BB">test</span><span style="color: #007700">;</span><span style="color: #0000BB">port</span><span style="color: #007700">=</span><span style="color: #0000BB">3306</span><span style="color: #007700">;</span><span style="color: #0000BB">charset</span><span style="color: #007700">=</span><span style="color: #0000BB">utf8mb4<br>driver</span><span style="color: #007700">^&nbsp;&nbsp;&nbsp;&nbsp;^&nbsp;</span><span style="color: #0000BB">colon&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">^</span><span style="color: #0000BB">param</span><span style="color: #007700">=</span><span style="color: #0000BB">value&nbsp;pair&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">^</span><span style="color: #0000BB">semicolon&nbsp;&nbsp;</span></code></code></pre>
<p>Note that it's important to follow the proper format - <strong>no spaces or quotes or other decorations have to be used in DSN,</strong> but only parameters, values and delimiters, as shown in the <a href="http://php.net/manual/en/pdo.construct.php">manual</a>.</p>
<p>Here goes an example for mysql:</p>
<pre><code><code><span style="color: #0000BB">$host&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'127.0.0.1'</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$db&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'test'</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$user&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'root'</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$pass&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">''</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$charset&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'utf8mb4'</span><span style="color: #007700">;<br><br></span><span style="color: #0000BB">$dsn&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"mysql:host=</span><span style="color: #0000BB">$host</span><span style="color: #DD0000">;dbname=</span><span style="color: #0000BB">$db</span><span style="color: #DD0000">;charset=</span><span style="color: #0000BB">$charset</span><span style="color: #DD0000">"</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$options&nbsp;</span><span style="color: #007700">=&nbsp;[<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">ATTR_ERRMODE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">ERRMODE_EXCEPTION</span><span style="color: #007700">,<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">ATTR_DEFAULT_FETCH_MODE&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">FETCH_ASSOC</span><span style="color: #007700">,<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">ATTR_EMULATE_PREPARES&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">,<br>];<br>try&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$pdo&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">(</span><span style="color: #0000BB">$dsn</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$user</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$pass</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$options</span><span style="color: #007700">);<br>}&nbsp;catch&nbsp;(\</span><span style="color: #0000BB">PDOException&nbsp;$e</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;\</span><span style="color: #0000BB">PDOException</span><span style="color: #007700">(</span><span style="color: #0000BB">$e</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getMessage</span><span style="color: #007700">(),&nbsp;(int)</span><span style="color: #0000BB">$e</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getCode</span><span style="color: #007700">());<br>}</span><span style="color: #0000BB"></span></code></code></pre>
<p>With all aforementioned variables properly set, we will have proper PDO instance in <code>$pdo</code> variable.</p>
<p>Important notes for the late mysql extension users:</p>
<ol>
<li>Unlike old <code>mysql_*</code> functions, which can be used anywhere in the code, <code>PDO</code> instance is stored in a regular variable, which means it can be inaccessible inside functions - so, one has to make it accessible, by means of passing it via function parameters or using more advanced techniques, such as IoC container.</li>
<li>The connection has to be made only once! No connects in every function. No connects in every class constructor. Otherwise, multiple connections will be created, which will eventually kill your database server. Thus, a sole PDO instance has to be created and then used through whole script execution.</li>
<li>It is very important to <strong>set charset through DSN</strong> - that's the only proper way because it tells PDO which charset is going to be used. Therefore forget about running <code>SET NAMES</code> query manually, either via <code>query()</code> or <code>PDO::MYSQL_ATTR_INIT_COMMAND</code>. Only if your PHP version is unacceptably outdated (namely below 5.3.6), you have to use <code>SET NAMES</code> query and always turn <a href="https://phpdelusions.net/pdo#emulation">emulation mode</a> off. </li>
</ol>
<p>More details regarding Mysql can be found in the corresponding chapter, <a href="https://phpdelusions.net/pdo_examples/connect_to_mysql">Connecting to MySQL</a></p>
<h3 id="query" class="title-h3">Running queries. PDO::query()</h3>
<p>There are two ways to run a query in PDO.
If no variables are going to be used in the query, you can use the <a href="http://php.net/manual/en/pdo.query.php">PDO::query()</a> method. It will run your query and return special object of <a href="http://php.net/manual/en/class.pdostatement.php">PDOStatement class</a> which can be roughly compared to a resource, returned by <code>mysql_query()</code>, especially in the way you can get actual rows out of it:</p>
<pre><code><code><span style="color: #0000BB">$stmt&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">'SELECT&nbsp;name&nbsp;FROM&nbsp;users'</span><span style="color: #007700">);<br>while&nbsp;(</span><span style="color: #0000BB">$row&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetch</span><span style="color: #007700">())<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">'name'</span><span style="color: #007700">]&nbsp;.&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br>}</span><span style="color: #0000BB"></span></code></code></pre>
<p>Also, the <code>query()</code> method allows us to use a neat method chaining for SELECT queries, which will be shown below.</p>
<h3 id="prepared" class="title-h3">Prepared statements. Protection from SQL injections</h3>
<p>This is the main and the only important reason why you were deprived from your beloved <code>mysql_query()</code> function and thrown into the harsh world of Data Objects: PDO has prepared statements support out of the box. Prepared statement is <strong>the only proper way to run a query</strong>, if any variable is going to be used in it. The reason why it is so important is explained in detail in <a href="https://phpdelusions.net/sql_injection">The Hitchhiker's Guide to SQL Injection prevention</a>.</p>
<p>So, for every query you run, if at least one variable is going to be used, you have to substitute it with a <strong>placeholder</strong>, then prepare your query, and then execute it, passing variables separately.</p>
<p>Long story short, it is not as hard as it seems. In most cases, you need only two functions - <a href="http://php.net/manual/en/pdo.prepare.php">prepare()</a> and <a href="http://php.net/manual/en/pdostatement.execute.php">execute()</a>.</p>
<p>First of all, you have to alter your query, adding placeholders in place of variables. Say, a code like this</p>
<pre><code><code><span style="color: #0000BB">$sql&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"SELECT&nbsp;*&nbsp;FROM&nbsp;users&nbsp;WHERE&nbsp;email&nbsp;=&nbsp;'</span><span style="color: #0000BB">$email</span><span style="color: #DD0000">'&nbsp;AND&nbsp;status='</span><span style="color: #0000BB">$status</span><span style="color: #DD0000">'"</span><span style="color: #007700">;</span><span style="color: #0000BB"></span></code></code></pre>
<p>will become</p>
<pre><code><code><span style="color: #0000BB">$sql&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'SELECT&nbsp;*&nbsp;FROM&nbsp;users&nbsp;WHERE&nbsp;email&nbsp;=&nbsp;?&nbsp;AND&nbsp;status=?'</span><span style="color: #007700">;</span><span style="color: #0000BB"></span></code></code></pre>
<p>or</p>
<pre><code><code><span style="color: #0000BB">$sql&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'SELECT&nbsp;*&nbsp;FROM&nbsp;users&nbsp;WHERE&nbsp;email&nbsp;=&nbsp;:email&nbsp;AND&nbsp;status=:status'</span><span style="color: #007700">;</span><span style="color: #0000BB"></span></code></code></pre>
<p>Note that PDO supports positional (<code>?</code>) and named (<code>:email</code>) placeholders, the latter always begins from a colon and can be written using letters, digits and underscores only.
Also note that <strong>no quotes</strong> have to be ever used around placeholders.</p>
<p>Having a query with placeholders, you have to prepare it, using the <code>PDO::prepare()</code> method. This function will return the same <code>PDOStatement</code> object we were talking about above, but <em>without any data attached to it</em>.</p>
<p>Finally, to get the query executed, you must run <code>execute()</code> method of this object, passing variables in it, in the form of array. And after that, you will be able to get the resulting data out of statement (if applicable):</p>
<pre><code><code><span style="color: #0000BB">$stmt&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #DD0000">'SELECT&nbsp;*&nbsp;FROM&nbsp;users&nbsp;WHERE&nbsp;email&nbsp;=&nbsp;?&nbsp;AND&nbsp;status=?'</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">([</span><span style="color: #0000BB">$email</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$status</span><span style="color: #007700">]);<br></span><span style="color: #0000BB">$user&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetch</span><span style="color: #007700">();<br></span><span style="color: #FF8000">//&nbsp;or<br></span><span style="color: #0000BB">$stmt&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #DD0000">'SELECT&nbsp;*&nbsp;FROM&nbsp;users&nbsp;WHERE&nbsp;email&nbsp;=&nbsp;:email&nbsp;AND&nbsp;status=:status'</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">([</span><span style="color: #DD0000">'email'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$email</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'status'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$status</span><span style="color: #007700">]);<br></span><span style="color: #0000BB">$user&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetch</span><span style="color: #007700">();</span><span style="color: #0000BB"></span></code></code></pre>
<p>As you can see, for the positional placeholders, you have to supply a regular array with values, while for the named placeholders, it has to be an associative array, where keys have to match the placeholder names in the query. You cannot mix positional and named placeholders in the same query.</p>
<p>Please note that positional placeholders let you write shorter code, but are sensitive to the order of arguments (which have to be exactly the same as the order of the corresponding placeholders in the query). While named placeholders make your code more verbose, they allow random binding order.</p>
<p>Also note that despite a widespread delusion, no "<code>:</code>" in the keys is required.</p>
<p>After the execution you may start getting your data, using all supported methods, as described down in this article.</p>
<p>More examples can be found in the <a href="https://phpdelusions.net/pdo_examples">respective article</a>.</p>
<h4 id="methods" class="title-h4">Binding methods</h4>
<p>Passing data into <code>execute()</code> (like shown above) should be considered default and most convenient method.
When this method is used, all values will be bound as <strong>strings</strong> (save for <code>NULL</code> values, that will be sent to the query as is, i.e. as SQL <code>NULL</code>), but most of time it's all right and won't cause any problem. </p>
<p>However, sometimes it's better to set the data type explicitly. Possible cases are:</p>
<ul>
<li><a href="https://phpdelusions.net/pdo#limit">LIMIT</a> clause (or any other SQL clause that just cannot accept a string operand) if <a href="https://phpdelusions.net/pdo#emulation">emulation mode</a> is turned ON. </li>
<li>complex queries with non-trivial query plan that can be affected by a wrong operand type</li>
<li>peculiar column types, like <code>BIGINT</code> or <code>BOOLEAN</code> that require an operand of exact type to be bound (note that in order to bind a BIGINT value with PDO::PARAM_INT you need a <a href="https://phpdelusions.net/pdo#mysqlnd">mysqlnd</a>-based installation). </li>
</ul>
<p>In such a case explicit binding have to be used, for which you have a choice of two functions, <a href="http://php.net/manual/en/pdostatement.bindvalue.php">bindValue()</a> and <a href="http://php.net/manual/en/pdostatement.bindparam.php">bindParam()</a>. The former one has to be preferred, because, unlike <code>bindParam()</code> it has no side effects to deal with.</p>
<h4 id="bindable" class="title-h4">Query parts you can bind</h4>
<p>It is very important to understand which query parts you can bind using prepared statements and which you cannot. In fact, the list is overwhelmingly short: only string and numeric literals can be bound. So you can tell that as long as your data can be represented in the query as a numeric or a quoted string literal - it can be bound. For all other cases you cannot use PDO prepared statements at all: neither an identifier, or a comma-separated list, or a part of a quoted string literal or whatever else arbitrary query part cannot be bound using a prepared statement.</p>
<p>Workarounds for the most frequent use cases can be found in the <a href="https://phpdelusions.net/pdo#like">corresponding part of the article</a></p>
<h3 id="multiexec" class="title-h3">Prepared statements. Multiple execution</h3>
<p>Sometimes you can use prepared statements for the multiple execution of a prepared query. It is slightly faster than performing the same query again and again, as it does query parsing only once.
This feature would have been more useful if it was possible to execute a statement prepared in another PHP instance. But alas - it is not. So, you are limited to repeating the same query only within the same instance, which is seldom needed in regular PHP scripts and which is limiting the use of this feature to repeated inserts or updates:</p>
<pre><code><code><span style="color: #0000BB">$data&nbsp;</span><span style="color: #007700">=&nbsp;[<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">1&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">1000</span><span style="color: #007700">,<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">5&nbsp;</span><span style="color: #007700">=&gt;&nbsp;&nbsp;</span><span style="color: #0000BB">300</span><span style="color: #007700">,<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">9&nbsp;</span><span style="color: #007700">=&gt;&nbsp;&nbsp;</span><span style="color: #0000BB">200</span><span style="color: #007700">,<br>];<br></span><span style="color: #0000BB">$stmt&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #DD0000">'UPDATE&nbsp;users&nbsp;SET&nbsp;bonus&nbsp;=&nbsp;bonus&nbsp;+&nbsp;?&nbsp;WHERE&nbsp;id&nbsp;=&nbsp;?'</span><span style="color: #007700">);<br>foreach&nbsp;(</span><span style="color: #0000BB">$data&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$id&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$bonus</span><span style="color: #007700">)<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">([</span><span style="color: #0000BB">$bonus</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$id</span><span style="color: #007700">]);<br>}</span><span style="color: #0000BB"></span></code></code></pre>
<p>Note that this feature is a bit overrated. Not only it is needed too seldom to talk about, but the performance gain is not that big - query parsing is <i>real</i> fast these times.</p>
<p>Note that you can get this advantage only when <a href="https://phpdelusions.net/pdo#emulation">emulation mode</a> is turned <strong>off</strong>.</p>
<h3 id="dml" class="title-h3">Running SELECT INSERT, UPDATE, or DELETE statements</h3>
<p>Come on folks.
There is absolutely nothing special in these queries. To PDO they all the same. It doesn't matter which query you are running.</p>
<p>Just like it was shown above, what you need is to prepare a query with placeholders, and then execute it, sending variables separately. Either for <code>DELETE</code> and <code>SELECT</code> query the process is essentially the same. The only difference is (as <abbr title="Data Manipulation Language, INSERT, UPDATE and DELETE queries">DML</abbr> queries do not return any data), that you can use the method chaining and thus call <code>execute()</code> right along with <code>prepare()</code>:</p>
<pre><code><code><span style="color: #0000BB">$sql&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"UPDATE&nbsp;users&nbsp;SET&nbsp;name&nbsp;=&nbsp;?&nbsp;WHERE&nbsp;id&nbsp;=&nbsp;?"</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #0000BB">$sql</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">([</span><span style="color: #0000BB">$name</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$id</span><span style="color: #007700">]);</span><span style="color: #0000BB"></span></code></code></pre>
<p>However, if you want to get the number of affected rows, the code will have to be the same boresome three lines:</p>
<pre><code><code><span style="color: #0000BB">$stmt&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #DD0000">"DELETE&nbsp;FROM&nbsp;goods&nbsp;WHERE&nbsp;category&nbsp;=&nbsp;?"</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">([</span><span style="color: #0000BB">$cat</span><span style="color: #007700">]);<br></span><span style="color: #0000BB">$deleted&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">rowCount</span><span style="color: #007700">();</span><span style="color: #0000BB"></span></code></code></pre>
<p>More examples can be found in the <a href="https://phpdelusions.net/pdo_examples">respective article</a>.</p>
<h3 id="foreach" class="title-h3">Getting data out of statement. foreach()</h3>
<p>The most basic and direct way to get multiple rows from a statement would be <code>foreach()</code> loop. Thanks to <a href="http://php.net/manual/en/class.traversable.php">Traversable</a> interface, <code>PDOStatement</code> can be iterated over by using <code>foreach()</code> operator:</p>
<pre><code><code><span style="color: #0000BB">$stmt&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">'SELECT&nbsp;name&nbsp;FROM&nbsp;users'</span><span style="color: #007700">);<br>foreach&nbsp;(</span><span style="color: #0000BB">$stmt&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$row</span><span style="color: #007700">)<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">'name'</span><span style="color: #007700">]&nbsp;.&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br>}</span><span style="color: #0000BB"></span></code></code></pre>
<p>Note that this method is memory-friendly, as it doesn't load all the resulting rows in the memory but delivers them one by one (though keep in mind this <a href="https://phpdelusions.net/pdo#mysqlnd">issue</a>).</p>
<h3 id="fetch" class="title-h3">Getting data out of statement. fetch()</h3>
<p>We have seen this function already, but let's take a closer look. It fetches a single row from database, and moves the internal pointer in the result set, so consequent calls to this function will return all the resulting rows one by one. Which makes this method a rough analogue to <code>mysql_fetch_array()</code> but it works in a slightly different way: instead of many separate functions (<code>mysql_fetch_assoc()</code>, <code>mysql_fetch_row()</code>, etc), there is only one, but its behavior can be changed by a parameter. There are many fetch modes in PDO, and we will discuss them later, but here are few for starter:</p>
<ul>
<li><code>PDO::FETCH_NUM</code> returns enumerated array</li>
<li><code>PDO::FETCH_ASSOC</code> returns associative array</li>
<li><code>PDO::FETCH_BOTH</code> - both of the above</li>
<li><code>PDO::FETCH_OBJ</code> returns object</li>
<li><code>PDO::FETCH_LAZY</code> allows all three (numeric associative and object) methods without memory overhead.</li>
</ul>
<p>From the above you can tell that this function have to be used in two cases:</p>
<ol>
<li>
<p>When only one row is expected - to get that only row. For example,</p>
<pre><code><code><span style="color: #0000BB">$row&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetch</span><span style="color: #007700">(</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">FETCH_ASSOC</span><span style="color: #007700">);</span><span style="color: #0000BB"></span></code></code></pre>
<p>Will give you single row from the statement, in the form of associative array.</p>
</li>
<li>When we need to process the returned data somehow before use. In this case it have to be run through usual while loop, like one shown <a href="https://phpdelusions.net/pdo#query">above</a>.</li>
</ol>
<p>Another useful mode is <code>PDO::FETCH_CLASS</code>, which can create an object of particular class</p>
<pre><code><code><span style="color: #0000BB">$news&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">'SELECT&nbsp;*&nbsp;FROM&nbsp;news'</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">fetchAll</span><span style="color: #007700">(</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">FETCH_CLASS</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'News'</span><span style="color: #007700">);</span><span style="color: #0000BB"></span></code></code></pre>
<p>will produce an array filled with objects of News class, setting class properties from returned values. Note that in this mode</p>
<ul>
<li>properties are set <em>before</em> constructor call</li>
<li>for all undefined properties <code>__set</code> magic method will be called</li>
<li>if there is no <code>__set</code> method in the class, then new property will be created</li>
<li>private properties will be filled as well, which is a bit unexpected but quite handy</li>
</ul>
<p>Note that default mode is <code>PDO::FETCH_BOTH</code>, but you can change it using <code>PDO::ATTR_DEFAULT_FETCH_MODE</code> configuration option as shown in the connection example. Thus, once set, it can be omitted most of the time.</p>
<h4 id="returntypes" class="title-h4">Return types.</h4>
<p>Only when PDO is built upon <a href="https://phpdelusions.net/pdo#mysqlnd">mysqlnd</a> <em>and</em> <a href="https://phpdelusions.net/pdo#emulation">emulation mode</a> is <strong>off</strong>, then PDO will return <code>int</code> and <code>float</code> values with respective types. Say, if we create a table</p>
<pre><code><code><span style="color: #0000BB">create&nbsp;table&nbsp;typetest&nbsp;</span><span style="color: #007700">(</span><span style="color: #0000BB">string&nbsp;varchar</span><span style="color: #007700">(</span><span style="color: #0000BB">255</span><span style="color: #007700">),&nbsp;`</span><span style="color: #DD0000">int</span><span style="color: #007700">`&nbsp;</span><span style="color: #0000BB">int</span><span style="color: #007700">,&nbsp;`</span><span style="color: #DD0000">float</span><span style="color: #007700">`&nbsp;</span><span style="color: #0000BB">float</span><span style="color: #007700">,&nbsp;`</span><span style="color: #DD0000">null</span><span style="color: #007700">`&nbsp;</span><span style="color: #0000BB">int</span><span style="color: #007700">);<br></span><span style="color: #0000BB">insert&nbsp;into&nbsp;typetest&nbsp;values</span><span style="color: #007700">(</span><span style="color: #DD0000">'foo'</span><span style="color: #007700">,</span><span style="color: #0000BB">1</span><span style="color: #007700">,</span><span style="color: #0000BB">1.1</span><span style="color: #007700">,</span><span style="color: #0000BB">NULL</span><span style="color: #007700">);</span><span style="color: #0000BB"></span></code></code></pre>
<p>And then query it from mysqlnd-based PDO with emulation turned off, the output will be</p>
<pre><code><code><span style="color: #0000BB"></span><span style="color: #007700">array(</span><span style="color: #0000BB">4</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;[</span><span style="color: #DD0000">"string"</span><span style="color: #007700">]&nbsp;=&gt;&nbsp;</span><span style="color: #0000BB">string</span><span style="color: #007700">(</span><span style="color: #0000BB">3</span><span style="color: #007700">)&nbsp;</span><span style="color: #DD0000">"foo"<br>&nbsp;&nbsp;</span><span style="color: #007700">[</span><span style="color: #DD0000">"int"</span><span style="color: #007700">]&nbsp;&nbsp;&nbsp;&nbsp;=&gt;&nbsp;</span><span style="color: #0000BB">int</span><span style="color: #007700">(</span><span style="color: #0000BB">1</span><span style="color: #007700">)<br>&nbsp;&nbsp;[</span><span style="color: #DD0000">"float"</span><span style="color: #007700">]&nbsp;&nbsp;=&gt;&nbsp;</span><span style="color: #0000BB">float</span><span style="color: #007700">(</span><span style="color: #0000BB">1.1</span><span style="color: #007700">)<br>&nbsp;&nbsp;[</span><span style="color: #DD0000">"null"</span><span style="color: #007700">]&nbsp;&nbsp;&nbsp;=&gt;&nbsp;</span><span style="color: #0000BB">NULL<br></span><span style="color: #007700">}</span><span style="color: #0000BB"></span></code></code></pre>
<p>Otherwise the familiar <code>mysql_fetch_array()</code> behavior will be followed - all values returned as strings with only <code>NULL</code> returned as <code>NULL</code>.</p>
<p>If for some reason you don't like this behavior and prefer the old style with strings and NULLs only, then you can use the following configuration option to override it:</p>
<pre><code><code><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">setAttribute</span><span style="color: #007700">(</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">ATTR_STRINGIFY_FETCHES</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">true</span><span style="color: #007700">);&nbsp;</span><span style="color: #0000BB"></span></code></code></pre>
<p>Note that for the <code>DECIMAL</code> type the string is always returned, due to nature of this type intended to retain the precise value, unlike deliberately non-precise FLOAT and DOUBLE types.</p>
<h3 id="fetchcolumn" class="title-h3">Getting data out of statement. fetchColumn()</h3>
<p>A neat helper function that returns value of the singe field of returned row. Very handy when we are selecting only one field:</p>
<pre><code><code><span style="color: #0000BB"></span><span style="color: #FF8000">//&nbsp;Getting&nbsp;the&nbsp;name&nbsp;based&nbsp;on&nbsp;id<br></span><span style="color: #0000BB">$stmt&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #DD0000">"SELECT&nbsp;name&nbsp;FROM&nbsp;table&nbsp;WHERE&nbsp;id=?"</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">([</span><span style="color: #0000BB">$id</span><span style="color: #007700">]);<br></span><span style="color: #0000BB">$name&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetchColumn</span><span style="color: #007700">();<br><br></span><span style="color: #FF8000">//&nbsp;getting&nbsp;number&nbsp;of&nbsp;rows&nbsp;in&nbsp;the&nbsp;table&nbsp;utilizing&nbsp;method&nbsp;chaining<br></span><span style="color: #0000BB">$count&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">"SELECT&nbsp;count(*)&nbsp;FROM&nbsp;table"</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">fetchColumn</span><span style="color: #007700">();</span><span style="color: #0000BB"></span></code></code></pre>
<h3 id="fetchall" class="title-h3">Getting data out of statement in dozens different formats. fetchAll()</h3>
<p>That's most interesting function, with most astonishing features.
Mostly thanks to its existence one can call PDO a wrapper, as this function can automate many operations otherwise performed manually.</p>
<p><code>PDOStatement::fetchAll()</code> returns an array that consists of <b>all the rows</b> returned by the query.
From this fact we can make two conclusions:</p>
<ol>
<li>This function should not be used if many* rows have been selected. In such a case, a conventional while loop should be used to fetch rows one by one instead of getting them all as an array at once.<br>
* <em>"many" means more than is suitable to be shown on the average web page.</em></li>
<li>This function is mostly useful in a modern web application that never outputs data right away during fetching, but rather passes it to template.</li>
</ol>
<p>You'd be amazed, in how many different formats this function can return data in (and how little an average PHP user knows of them), all controlled by <code>PDO::FETCH_*</code> variables.
Some of them are:</p>
<h4 id="array" class="title-h4">Getting a plain array.</h4>
<p>By default, this function will return just simple enumerated array consists of all the returned rows. Row formatting constants, such as <code>PDO::FETCH_NUM</code>, <code>PDO::FETCH_ASSOC</code>, <code>PDO::FETCH_OBJ</code> etc can change the row format. </p>
<pre><code><code><span style="color: #0000BB">$data&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">'SELECT&nbsp;name&nbsp;FROM&nbsp;users'</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">fetchAll</span><span style="color: #007700">(</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">FETCH_ASSOC</span><span style="color: #007700">);<br></span><span style="color: #0000BB">var_export</span><span style="color: #007700">(</span><span style="color: #0000BB">$data</span><span style="color: #007700">);<br></span><span style="color: #FF8000">/*<br>array&nbsp;(<br>&nbsp;&nbsp;0&nbsp;=&gt;&nbsp;array('John'),<br>&nbsp;&nbsp;1&nbsp;=&gt;&nbsp;array('Mike'),<br>&nbsp;&nbsp;2&nbsp;=&gt;&nbsp;array('Mary'),<br>&nbsp;&nbsp;3&nbsp;=&gt;&nbsp;array('Kathy'),<br>)*/</span><span style="color: #0000BB"></span></code></code></pre>
<h4 id="column" class="title-h4">Getting a column.</h4>
<p>It is often very handy to get plain one-dimensional array right out of the query, if only one column out of many rows being fetched. Here you go:</p>
<pre><code><code><span style="color: #0000BB">$data&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">'SELECT&nbsp;name&nbsp;FROM&nbsp;users'</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">fetchAll</span><span style="color: #007700">(</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">FETCH_COLUMN</span><span style="color: #007700">);<br></span><span style="color: #FF8000">/*&nbsp;array&nbsp;(<br>&nbsp;&nbsp;0&nbsp;=&gt;&nbsp;'John',<br>&nbsp;&nbsp;1&nbsp;=&gt;&nbsp;'Mike',<br>&nbsp;&nbsp;2&nbsp;=&gt;&nbsp;'Mary',<br>&nbsp;&nbsp;3&nbsp;=&gt;&nbsp;'Kathy',<br>)*/</span><span style="color: #0000BB"></span></code></code></pre>
<h4 id="pairs" class="title-h4">Getting key-value pairs.</h4>
<p>Also extremely useful format, when we need to get the same column, but indexed not by numbers in order but by another field. Here goes <code>PDO::FETCH_KEY_PAIR</code> constant:</p>
<pre><code><code><span style="color: #0000BB">$data&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">'SELECT&nbsp;id,&nbsp;name&nbsp;FROM&nbsp;users'</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">fetchAll</span><span style="color: #007700">(</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">FETCH_KEY_PAIR</span><span style="color: #007700">);<br></span><span style="color: #FF8000">/*&nbsp;array&nbsp;(<br>&nbsp;&nbsp;104&nbsp;=&gt;&nbsp;'John',<br>&nbsp;&nbsp;110&nbsp;=&gt;&nbsp;'Mike',<br>&nbsp;&nbsp;120&nbsp;=&gt;&nbsp;'Mary',<br>&nbsp;&nbsp;121&nbsp;=&gt;&nbsp;'Kathy',<br>)*/</span><span style="color: #0000BB"></span></code></code></pre>
<p>Note that you have to select only two columns for this mode, first of which have to be unique.</p>
<h4 id="unique" class="title-h4">Getting rows indexed by unique field</h4>
<p>Same as above, but getting not one column but full row, yet indexed by an unique field, thanks to
<code>PDO::FETCH_UNIQUE</code> constant:</p>
<pre><code><code><span style="color: #0000BB">$data&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">'SELECT&nbsp;*&nbsp;FROM&nbsp;users'</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">fetchAll</span><span style="color: #007700">(</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">FETCH_UNIQUE</span><span style="color: #007700">);<br></span><span style="color: #FF8000">/*&nbsp;array&nbsp;(<br>&nbsp;&nbsp;104&nbsp;=&gt;&nbsp;array&nbsp;(<br>&nbsp;&nbsp;&nbsp;&nbsp;'name'&nbsp;=&gt;&nbsp;'John',<br>&nbsp;&nbsp;&nbsp;&nbsp;'car'&nbsp;=&gt;&nbsp;'Toyota',<br>&nbsp;&nbsp;),<br>&nbsp;&nbsp;110&nbsp;=&gt;&nbsp;array&nbsp;(<br>&nbsp;&nbsp;&nbsp;&nbsp;'name'&nbsp;=&gt;&nbsp;'Mike',<br>&nbsp;&nbsp;&nbsp;&nbsp;'car'&nbsp;=&gt;&nbsp;'Ford',<br>&nbsp;&nbsp;),<br>&nbsp;&nbsp;120&nbsp;=&gt;&nbsp;array&nbsp;(<br>&nbsp;&nbsp;&nbsp;&nbsp;'name'&nbsp;=&gt;&nbsp;'Mary',<br>&nbsp;&nbsp;&nbsp;&nbsp;'car'&nbsp;=&gt;&nbsp;'Mazda',<br>&nbsp;&nbsp;),<br>&nbsp;&nbsp;121&nbsp;=&gt;&nbsp;array&nbsp;(<br>&nbsp;&nbsp;&nbsp;&nbsp;'name'&nbsp;=&gt;&nbsp;'Kathy',<br>&nbsp;&nbsp;&nbsp;&nbsp;'car'&nbsp;=&gt;&nbsp;'Mazda',<br>&nbsp;&nbsp;),<br>)*/</span><span style="color: #0000BB"></span></code></code></pre>
<p>Note that first column selected have to be unique (in this query it is assumed that first column is id, but to be sure better list it explicitly).</p>
<h4 id="group" class="title-h4">Getting rows grouped by some field</h4>
<p><code>PDO::FETCH_GROUP</code> will group rows into a nested array, where indexes will be unique values from the first columns, and values will be arrays similar to ones returned by regular <code>fetchAll()</code>. The following code, for example, will separate boys from girls and put them into different arrays:</p>
<pre><code><code><span style="color: #0000BB">$data&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">'SELECT&nbsp;sex,&nbsp;name,&nbsp;car&nbsp;FROM&nbsp;users'</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">fetchAll</span><span style="color: #007700">(</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">FETCH_GROUP</span><span style="color: #007700">);<br>array&nbsp;(<br>&nbsp;&nbsp;</span><span style="color: #DD0000">'male'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;array&nbsp;(<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">0&nbsp;</span><span style="color: #007700">=&gt;&nbsp;array&nbsp;(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'name'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'John'</span><span style="color: #007700">,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'car'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'Toyota'</span><span style="color: #007700">,<br>&nbsp;&nbsp;&nbsp;&nbsp;),<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">1&nbsp;</span><span style="color: #007700">=&gt;&nbsp;array&nbsp;(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'name'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'Mike'</span><span style="color: #007700">,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'car'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'Ford'</span><span style="color: #007700">,<br>&nbsp;&nbsp;&nbsp;&nbsp;),<br>&nbsp;&nbsp;),<br>&nbsp;&nbsp;</span><span style="color: #DD0000">'female'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;array&nbsp;(<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">0&nbsp;</span><span style="color: #007700">=&gt;&nbsp;array&nbsp;(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'name'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'Mary'</span><span style="color: #007700">,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'car'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'Mazda'</span><span style="color: #007700">,<br>&nbsp;&nbsp;&nbsp;&nbsp;),<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">1&nbsp;</span><span style="color: #007700">=&gt;&nbsp;array&nbsp;(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'name'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'Kathy'</span><span style="color: #007700">,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'car'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'Mazda'</span><span style="color: #007700">,<br>&nbsp;&nbsp;&nbsp;&nbsp;),<br>&nbsp;&nbsp;),<br>)</span><span style="color: #0000BB"></span></code></code></pre>
<p>So, this is the ideal solution for such a popular demand like "group events by date" or "group goods by category". Some real life use cases:</p>
<ul>
<li><a href="http://stackoverflow.com/q/35317555/285587">How to multiple query results in order to reduce the query number?</a></li>
<li><a href="http://stackoverflow.com/a/41263854/285587">List records grouped by category name</a> </li>
</ul>
<p><strong>Other modes</strong></p>
<p>Of course, there is a <code>PDO::FETCH_FUNC</code> for the functional programming fans. </p>
<p>More modes are coming soon.</p>
<h3 id="errors" class="title-h3">Error handling. Exceptions</h3>
<p>Although there are several error handling modes in PDO, the only proper one is <code>PDO::ERRMODE_EXCEPTION</code>. So, one ought to always set it this way, either by adding this line after creation of PDO instance, </p>
<pre><code><code><span style="color: #0000BB">$dbh</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">setAttribute</span><span style="color: #007700">(&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">ATTR_ERRMODE</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">ERRMODE_EXCEPTION&nbsp;</span><span style="color: #007700">);</span><span style="color: #0000BB"></span></code></code></pre>
<p>or as a connection option, as demonstrated in the example above. And this is <em>all</em> you need for the basic error reporting. </p>
<h4 id="reporting_errors" class="title-h4">Reporting PDO errors</h4>
<p><strong>TL;DR:</strong><br>
Despite what all other tutorials say, <strong>you don't need a <code>try..catch</code> operator to report PDO errors</strong>. Catch an exception only if you have a handling scenario other than just reporting it. Otherwise just let it bubble up to a site-wide handler (note that you don't have to write one, there is a basic built-in handler in PHP, which is quite good).</p>
<p>The only exception (pun not intended) is the creation of the PDO instance, which in case of error might reveal the connection credentials (that would be the part of the stack trace). In order to hide them, we can wrap the connection code into a <code>try..catch</code> operator and then throw a new <code>ErrorException</code> that contains only the message but not the credentials.</p>
<p><strong>A long rant on the matter:</strong>   </p>
<p>Despite a widespread delusion, you should never catch errors to report them. A module (like a database layer) should not report its errors. This function has to be delegated to an application-wide handler. All we need is to raise an error (in the form of exception) - which we already did. That's all. Nor should you "<em>always wrap your PDO operations in a <code>try/catch</code></em>" like the most popular tutorial from tutsplus recommends. Quite contrary, catching an exception should be rather an exceptional case (pun intended).</p>
<p>In fact, there is nothing special in PDO exceptions - they are errors all the same. Thus, you have to treat them exactly the same way as other errors. If you had an error handler before, you shouldn't create a dedicated one for PDO. If you didn't care - it's all right too, as PHP is good with basic error handling and will conduct PDO exceptions all right.</p>
<p>Exception handling is one of the problems with PDO tutorials. Being acquainted with exceptions for the first time when starting with PDO, authors consider exceptions dedicated to this library, and start diligently (but improperly) handling exceptions for PDO only. This is utter nonsense. If one paid no special attention to any exceptions before, they shouldn't have changed their habit for PDO. If one didn't use <code>try..catch</code> before, they should keep with that, eventually learning how to use exceptions and when it is suitable to catch them.</p>
<p>So now you can tell that the PHP manual is wrong, <a href="http://php.net/manual/en/pdo.connections.php">stating that</a></p>
<blockquote>
<p>If your application does not catch the exception thrown from the PDO constructor, the default action taken by the zend engine is to terminate the script and display a back trace. This back trace will likely reveal the full database connection details, including the username and password.</p>
</blockquote>
<p>However, <strong>there is no such thing as "the displaying of a back trace"!</strong> What zend engine <em>really</em> does is just convert an uncaught exception into a fatal error. And then this fatal error is treated <strong>like any other error</strong> - so it will be displayed only if appropriate <code>php.ini</code> directive is set.
Thus, although you may or you may not catch an exception, it has absolutely nothing to do with displaying sensitive information, because it's <strong>a totally different configuration setting</strong> in response to this. So, do not catch PDO exceptions to report them. Instead, configure your server properly:</p>
<p>On a development server just turn displaying errors on:</p>
<pre><code><code><span style="color: #0000BB">ini_set</span><span style="color: #007700">(</span><span style="color: #DD0000">'display_errors'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">);</span><span style="color: #0000BB"></span></code></code></pre>
<p>While on a production server turn displaying errors off while logging errors on:</p>
<pre><code><code><span style="color: #0000BB">ini_set</span><span style="color: #007700">(</span><span style="color: #DD0000">'display_errors'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">);<br></span><span style="color: #0000BB">ini_set</span><span style="color: #007700">(</span><span style="color: #DD0000">'log_errors'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">);</span><span style="color: #0000BB"></span></code></code></pre>
<ul>
<li>keep in mind that <em>there are other errors that shouldn't be revealed to the user as well.</em>  </li>
</ul>
<h4 id="catch" class="title-h4">Catching PDO exceptions</h4>
<p>You may want to catch PDO errors only in two cases:</p>
<ol>
<li>If you are writing a wrapper for PDO, and you want to augment the error info with some additional data, like query string. In this case, catch the exception, gather the required information, and <strong>re-throw another Exception</strong>.</li>
<li>
<p>If you have a <strong>certain scenario</strong> for handling errors in the particular part of code. Some examples are: </p>
<ul>
<li>if the error can be bypassed, you can use try..catch for this. However, do not make it a habit. Empty catch in every aspect works as error suppression operator, <a href="http://programmers.stackexchange.com/questions/219788/is-error-suppressing-bad-practice">and so equally evil it is</a>.</li>
<li>if there is an action that has to be taken in case of failure, i.e. <a href="https://phpdelusions.net/pdo#transactions">transaction</a> rollback.</li>
<li>if you are waiting for a particular error to handle. In this case, catch the exception, see if the error is one you're looking for, and then handle this one. Otherwise just throw it again - so it will bubble up to the handler in the usual way.</li>
</ul>
</li>
</ol>
<p>E.g.:</p>
<pre><code><code><span style="color: #0000BB"></span><span style="color: #007700">try&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #DD0000">"INSERT&nbsp;INTO&nbsp;users&nbsp;VALUES&nbsp;(NULL,?,?,?,?)"</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">(</span><span style="color: #0000BB">$data</span><span style="color: #007700">);<br>}&nbsp;catch&nbsp;(</span><span style="color: #0000BB">PDOException&nbsp;$e</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$existingkey&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"Integrity&nbsp;constraint&nbsp;violation:&nbsp;1062&nbsp;Duplicate&nbsp;entry"</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">strpos</span><span style="color: #007700">(</span><span style="color: #0000BB">$e</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getMessage</span><span style="color: #007700">(),&nbsp;</span><span style="color: #0000BB">$existingkey</span><span style="color: #007700">)&nbsp;!==&nbsp;</span><span style="color: #0000BB">FALSE</span><span style="color: #007700">)&nbsp;{<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;Take&nbsp;some&nbsp;action&nbsp;if&nbsp;there&nbsp;is&nbsp;a&nbsp;key&nbsp;constraint&nbsp;violation,&nbsp;i.e.&nbsp;duplicate&nbsp;name<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">}&nbsp;else&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;</span><span style="color: #0000BB">$e</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>}</span><span style="color: #0000BB"></span></code></code></pre>
<p>However, in general, no dedicated treatment for PDO exceptions is ever needed. In short, to have PDO errors properly reported:</p>
<ol>
<li>Set PDO in exception mode.</li>
<li>Do not use <code>try..catch</code> to report errors. </li>
<li>Configure PHP for proper error reporting
<ul>
<li>on a <strong>live</strong> site set <code>display_errors=off</code> and <code>log_errors=on</code></li>
<li>on a <strong>development</strong> site, you may want to set <code>display_errors=on</code></li>
<li>of course, <code>error_reporting</code> has to be set to E_ALL in both cases</li>
</ul></li>
</ol>
<p>As a result, you will be always notified of all database errors without a single line of extra code! <a href="https://phpdelusions.net/try-catch">Further reading</a>.</p>
<h3 id="count" class="title-h3">Getting row count with PDO</h3>
<p>You don't needed it.</p>
<p>Although PDO offers a function for returning the number of rows found by the query, <code>PDOstatement::rowCount()</code>, you scarcely need it. Really.</p>
<p>If you think it over, you will see that this is a most misused function in the web. Most of time it is used not to <i>count</i> anything, but as a mere flag - just to see if there was any data returned. But for such a case you have the data itself! Just get your data, using either <code>fetch()</code> or <code>fetchAll()</code> - and it will serve as such a flag all right! Say, to see if there is any user with such a name, just select a row:</p>
<pre><code><code><span style="color: #0000BB">$stmt&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #DD0000">"SELECT&nbsp;1&nbsp;FROM&nbsp;users&nbsp;WHERE&nbsp;name=?"</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">([</span><span style="color: #0000BB">$name</span><span style="color: #007700">]);<br></span><span style="color: #0000BB">$userExists&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetchColumn</span><span style="color: #007700">();</span><span style="color: #0000BB"></span></code></code></pre>
<p>Exactly the same thing with getting either a single row or an array with rows:</p>
<pre><code><code><span style="color: #0000BB">$data&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">"SELECT&nbsp;*&nbsp;FROM&nbsp;table"</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">fetchAll</span><span style="color: #007700">();<br>if&nbsp;(</span><span style="color: #0000BB">$data</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;You&nbsp;have&nbsp;the&nbsp;data!&nbsp;No&nbsp;need&nbsp;for&nbsp;the&nbsp;rowCount()&nbsp;ever!<br></span><span style="color: #007700">}</span><span style="color: #0000BB"></span></code></code></pre>
<p>Remember that here you don't need the <i>count</i>, the actual number of rows, but rather a boolean flag. So you got it.</p>
<p>Not to mention that the second most popular use case for this function should never be used at all. One should never use the <code>rowCount()</code> to count rows in database! Instead, one has to ask a database to count them, and return the result in a <b>single</b> row:</p>
<pre><code><code><span style="color: #0000BB">$count&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">"SELECT&nbsp;count(1)&nbsp;FROM&nbsp;t"</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">fetchColumn</span><span style="color: #007700">();</span><span style="color: #0000BB"></span></code></code></pre>
<p>is the only proper way.</p>
<p>In essence:</p>
<ul>
<li>if you need to know how many rows in the table, use <code>SELECT COUNT(*)</code> query.</li>
<li>if you need to know whether your query returned any data - check that data.</li>
<li>if you still need to know how many rows has been returned by some query (though I hardly can imagine a case), then you can either use <code>rowCount()</code> or simply call <code>count()</code> on the array returned by <code>fetchAll()</code> (if applicable).</li>
</ul>
<p>Thus you could tell that the <a href="http://stackoverflow.com/a/883382/285587/">top answer for this question on Stack Overflow</a> is essentially pointless and harmful - a call to <code>rowCount()</code> could be never substituted with <code>SELECT count(*)</code> query - their purpose is essentially different, while running an extra query only to get the number of rows returned by other query makes absolutely no sense. </p>
<h3 id="affected" class="title-h3">Affected rows and insert id</h3>
<p>PDO is using the same function for returning both number of rows returned by SELECT statement and number of rows affected by <abbr title="Data Manipulation Language, INSERT, UPDATE and DELETE queries">DML</abbr> queries - <code>PDOstatement::rowCount()</code>. Thus, to get the number of rows affected, just call this function after performing a query. </p>
<p>Another frequently asked question is caused by the fact that mysql won't update the row, if new value is the same as old one. Thus number of rows affected could differ from the number of rows matched by the WHERE clause. Sometimes it is required to know this latter number. </p>
<p>Although you can tell <code>rowCount()</code> to return the number of rows matched instead of rows affected by setting <code>PDO::MYSQL_ATTR_FOUND_ROWS</code> option to TRUE, but, as this is a connection-only option and thus you cannot change it's behavior during runtime, you will have to stick to only one mode for the application, which could be not very convenient. </p>
<p>Note that <code>PDO::MYSQL_ATTR_FOUND_ROWS</code> is not guaranteed to work, as it's described in the <a href="https://phpdelusions.net/pdo#comment-276">comment</a> below.</p>
<p>Unfortunately, there is no PDO counterpart for the <code>mysql(i)_info()</code> function which output can be easily parsed and desired number found. This is one of minor PDO drawbacks.</p>
<p>An auto-generated identifier from a sequence or auto_inclement field in mysql can be obtained from the <a href="http://php.net/manual/en/pdo.lastinsertid.php">PDO::lastInsertId</a> function. An answer to a frequently asked question, "whether this function is safe to use in concurrent environment?" is positive: yes, it is safe. Being just an interface to MySQL C API <a href="http://dev.mysql.com/doc/refman/5.7/en/mysql-insert-id.html">mysql_insert_id()</a> function it's perfectly safe. </p>
<h3 id="like" class="title-h3">Prepared statements and LIKE clause</h3>
<p>Despite PDO's overall ease of use, there are some gotchas anyway, and I am going to explain some.</p>
<p>One of them is using placeholders with <code>LIKE</code> SQL clause. At first one would think that such a query will do:</p>
<pre><code><code><span style="color: #0000BB">$stmt&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #DD0000">"SELECT&nbsp;*&nbsp;FROM&nbsp;table&nbsp;WHERE&nbsp;name&nbsp;LIKE&nbsp;'%?%'"</span><span style="color: #007700">);</span><span style="color: #0000BB"></span></code></code></pre>
<p>but soon they will learn that it will produce an error. To understand its nature one has to understand that, <a href="https://phpdelusions.net/pdo#bindable">like it was said above</a>, <i>a placeholder have to represent a complete data literal only</i> - a string or a number namely. And by no means can it represent either a part of a literal or some arbitrary SQL part. So, when working with LIKE, we have to prepare our <strong>complete literal</strong> first, and then send it to the query the usual way:</p>
<pre><code><code><span style="color: #0000BB">$search&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"%</span><span style="color: #0000BB">$search</span><span style="color: #DD0000">%"</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$stmt&nbsp;&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #DD0000">"SELECT&nbsp;*&nbsp;FROM&nbsp;table&nbsp;WHERE&nbsp;name&nbsp;LIKE&nbsp;?"</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">([</span><span style="color: #0000BB">$search</span><span style="color: #007700">]);<br></span><span style="color: #0000BB">$data&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetchAll</span><span style="color: #007700">();</span><span style="color: #0000BB"></span></code></code></pre>
<h3 id="in" class="title-h3">Prepared statements and IN clause</h3>
<p>Just like it was said above, it is impossible to substitute an arbitrary query part with a placeholder. Any string you bind through a placeholder will be put into query as a single string literal. For example, a <em>string</em> <code>'1,2,3'</code> will be bound as a <em>string</em>, resulting in</p>
<pre><code><code><span style="color: #0000BB">SELECT&nbsp;</span><span style="color: #007700">*&nbsp;</span><span style="color: #0000BB">FROM&nbsp;table&nbsp;WHERE&nbsp;column&nbsp;IN&nbsp;</span><span style="color: #007700">(</span><span style="color: #DD0000">'1,2,3'</span><span style="color: #007700">)</span><span style="color: #0000BB"></span></code></code></pre>
<p>making SQL to search for just <em>one</em> value.</p>
<p>To make it right, one needs separated values, to make a query look like</p>
<pre><code><code><span style="color: #0000BB">SELECT&nbsp;</span><span style="color: #007700">*&nbsp;</span><span style="color: #0000BB">FROM&nbsp;table&nbsp;WHERE&nbsp;column&nbsp;IN&nbsp;</span><span style="color: #007700">(</span><span style="color: #DD0000">'1'</span><span style="color: #007700">,</span><span style="color: #DD0000">'2'</span><span style="color: #007700">,</span><span style="color: #DD0000">'3'</span><span style="color: #007700">)</span><span style="color: #0000BB"></span></code></code></pre>
<p>Thus, for the comma-separated values, like for <code>IN()</code> SQL operator, one must create a set of <code>?</code>s manually and put them into the query:</p>
<pre><code><code><span style="color: #0000BB">$arr&nbsp;</span><span style="color: #007700">=&nbsp;[</span><span style="color: #0000BB">1</span><span style="color: #007700">,</span><span style="color: #0000BB">2</span><span style="color: #007700">,</span><span style="color: #0000BB">3</span><span style="color: #007700">];<br></span><span style="color: #0000BB">$in&nbsp;&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">str_repeat</span><span style="color: #007700">(</span><span style="color: #DD0000">'?,'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">count</span><span style="color: #007700">(</span><span style="color: #0000BB">$arr</span><span style="color: #007700">)&nbsp;-&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">)&nbsp;.&nbsp;</span><span style="color: #DD0000">'?'</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$sql&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"SELECT&nbsp;*&nbsp;FROM&nbsp;table&nbsp;WHERE&nbsp;column&nbsp;IN&nbsp;(</span><span style="color: #0000BB">$in</span><span style="color: #DD0000">)"</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$stm&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$db</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #0000BB">$sql</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$stm</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">(</span><span style="color: #0000BB">$arr</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$data&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$stm</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetchAll</span><span style="color: #007700">();</span><span style="color: #0000BB"></span></code></code></pre>
<p>Not very convenient, but compared to mysqli it's <a href="https://phpdelusions.net/pdo/mysqli_comparison#in"><em>amazingly</em> concise</a>.</p>
<p>In case there are other placeholders in the query, you could use <code>array_merge()</code> function to join all the variables into a single array, adding your other variables in the form of arrays, in the order they appear in your query:</p>
<pre><code><code><span style="color: #0000BB">$arr&nbsp;</span><span style="color: #007700">=&nbsp;[</span><span style="color: #0000BB">1</span><span style="color: #007700">,</span><span style="color: #0000BB">2</span><span style="color: #007700">,</span><span style="color: #0000BB">3</span><span style="color: #007700">];<br></span><span style="color: #0000BB">$in&nbsp;&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">str_repeat</span><span style="color: #007700">(</span><span style="color: #DD0000">'?,'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">count</span><span style="color: #007700">(</span><span style="color: #0000BB">$arr</span><span style="color: #007700">)&nbsp;-&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">)&nbsp;.&nbsp;</span><span style="color: #DD0000">'?'</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$sql&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"SELECT&nbsp;*&nbsp;FROM&nbsp;table&nbsp;WHERE&nbsp;foo=?&nbsp;AND&nbsp;column&nbsp;IN&nbsp;(</span><span style="color: #0000BB">$in</span><span style="color: #DD0000">)&nbsp;AND&nbsp;bar=?&nbsp;AND&nbsp;baz=?"</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$stm&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$db</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #0000BB">$sql</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$params&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">array_merge</span><span style="color: #007700">([</span><span style="color: #0000BB">$foo</span><span style="color: #007700">],&nbsp;</span><span style="color: #0000BB">$arr</span><span style="color: #007700">,&nbsp;[</span><span style="color: #0000BB">$bar</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$baz</span><span style="color: #007700">]);<br></span><span style="color: #0000BB">$stm</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">(</span><span style="color: #0000BB">$params</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$data&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$stm</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetchAll</span><span style="color: #007700">();</span><span style="color: #0000BB"></span></code></code></pre>
<p>In case you are using named placeholders, the code would be a little more complex, as you have to create a sequence of the named placeholders, e.g. <code>:id0,:id1,:id2</code>. So the code would be:</p>
<pre><code><code><span style="color: #0000BB"></span><span style="color: #FF8000">//&nbsp;other&nbsp;parameters&nbsp;that&nbsp;are&nbsp;going&nbsp;into&nbsp;query<br></span><span style="color: #0000BB">$params&nbsp;</span><span style="color: #007700">=&nbsp;[</span><span style="color: #DD0000">"foo"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">"foo"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"bar"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">"bar"</span><span style="color: #007700">];<br><br></span><span style="color: #0000BB">$ids&nbsp;</span><span style="color: #007700">=&nbsp;[</span><span style="color: #0000BB">1</span><span style="color: #007700">,</span><span style="color: #0000BB">2</span><span style="color: #007700">,</span><span style="color: #0000BB">3</span><span style="color: #007700">];<br></span><span style="color: #0000BB">$in&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">""</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$i&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">;</span><span style="color: #FF8000">//&nbsp;we&nbsp;are&nbsp;using&nbsp;an&nbsp;external&nbsp;counter&nbsp;<br>//&nbsp;because&nbsp;the&nbsp;actual&nbsp;array&nbsp;key&nbsp;could&nbsp;be&nbsp;dangerous<br></span><span style="color: #007700">foreach&nbsp;(</span><span style="color: #0000BB">$ids&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$item</span><span style="color: #007700">)<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$key&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">":id"</span><span style="color: #007700">.</span><span style="color: #0000BB">$i</span><span style="color: #007700">++;<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$in&nbsp;</span><span style="color: #007700">.=&nbsp;</span><span style="color: #DD0000">"</span><span style="color: #0000BB">$key</span><span style="color: #DD0000">,"</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$in_params</span><span style="color: #007700">[</span><span style="color: #0000BB">$key</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$item</span><span style="color: #007700">;&nbsp;</span><span style="color: #FF8000">//&nbsp;collecting&nbsp;values&nbsp;into&nbsp;key-value&nbsp;array<br></span><span style="color: #007700">}<br></span><span style="color: #0000BB">$in&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">rtrim</span><span style="color: #007700">(</span><span style="color: #0000BB">$in</span><span style="color: #007700">,</span><span style="color: #DD0000">","</span><span style="color: #007700">);&nbsp;</span><span style="color: #FF8000">//&nbsp;:id0,:id1,:id2<br><br></span><span style="color: #0000BB">$sql&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"SELECT&nbsp;*&nbsp;FROM&nbsp;table&nbsp;WHERE&nbsp;foo=:foo&nbsp;AND&nbsp;id&nbsp;IN&nbsp;(</span><span style="color: #0000BB">$in</span><span style="color: #DD0000">)&nbsp;AND&nbsp;bar=:bar"</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$stm&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$db</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #0000BB">$sql</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$stm</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">(</span><span style="color: #0000BB">array_merge</span><span style="color: #007700">(</span><span style="color: #0000BB">$params</span><span style="color: #007700">,</span><span style="color: #0000BB">$in_params</span><span style="color: #007700">));&nbsp;</span><span style="color: #FF8000">//&nbsp;just&nbsp;merge&nbsp;two&nbsp;arrays<br></span><span style="color: #0000BB">$data&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$stm</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetchAll</span><span style="color: #007700">();</span><span style="color: #0000BB"></span></code></code></pre>
<p>Luckily, for the named placeholders we don't have to follow the strict order, so we can merge our arrays in any order.</p>
<h3 id="identifiers" class="title-h3">Protecting table and field names</h3>
<p>On Stack Overflow I've seen overwhelming number of PHP users implementing <a href="https://phpdelusions.net/pdo/lame_update">the most fatal PDO code</a>, thinking that only data values have to be protected. But of course it is not.</p>
<p>Unfortunately, PDO has no placeholder for identifiers (table and field names), so a developer must manually filter them out. Such a filter is often called a "white list" (where we only list allowed values) as opposed to a "black list" where we list disallowed values. Here is a brief example</p>
<pre><code><code><span style="color: #0000BB">$orders&nbsp;&nbsp;</span><span style="color: #007700">=&nbsp;[</span><span style="color: #DD0000">"name"</span><span style="color: #007700">,</span><span style="color: #DD0000">"price"</span><span style="color: #007700">,</span><span style="color: #DD0000">"qty"</span><span style="color: #007700">];&nbsp;</span><span style="color: #FF8000">//&nbsp;the&nbsp;white&nbsp;list&nbsp;of&nbsp;allowed&nbsp;fierld&nbsp;names<br></span><span style="color: #0000BB">$key&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">array_search</span><span style="color: #007700">(</span><span style="color: #0000BB">$_GET</span><span style="color: #007700">[</span><span style="color: #DD0000">'sort'</span><span style="color: #007700">],&nbsp;</span><span style="color: #0000BB">$orders</span><span style="color: #007700">);&nbsp;</span><span style="color: #FF8000">//&nbsp;see&nbsp;if&nbsp;we&nbsp;have&nbsp;such&nbsp;a&nbsp;name<br></span><span style="color: #0000BB">$orderby&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$orders</span><span style="color: #007700">[</span><span style="color: #0000BB">$key</span><span style="color: #007700">];&nbsp;</span><span style="color: #FF8000">//if&nbsp;not,&nbsp;first&nbsp;one&nbsp;will&nbsp;be&nbsp;set&nbsp;automatically.&nbsp;smart&nbsp;enuf&nbsp;:)</span><span style="color: #0000BB"></span></code></code></pre>
<p>the same approach should be used for the direction, although the code would be a bit simpler</p>
<pre><code><code><span style="color: #0000BB">$direction&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">_GET</span><span style="color: #007700">[</span><span style="color: #DD0000">'direction'</span><span style="color: #007700">]&nbsp;==&nbsp;</span><span style="color: #DD0000">'DESC'&nbsp;</span><span style="color: #007700">?&nbsp;</span><span style="color: #DD0000">'DESC'&nbsp;</span><span style="color: #007700">:&nbsp;</span><span style="color: #DD0000">'ASC'</span><span style="color: #007700">;</span><span style="color: #0000BB"></span></code></code></pre>
<p>having gottent these two variables this way will make them 100% safe</p>
<pre><code><code><span style="color: #0000BB">$query&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"SELECT&nbsp;*&nbsp;FROM&nbsp;`table`&nbsp;ORDER&nbsp;BY&nbsp;</span><span style="color: #0000BB">$orderby</span><span style="color: #DD0000">&nbsp;</span><span style="color: #0000BB">$direction</span><span style="color: #DD0000">"</span><span style="color: #007700">;&nbsp;</span><span style="color: #FF8000">//&nbsp;sound&nbsp;and&nbsp;safe</span><span style="color: #0000BB"></span></code></code></pre>
<p>The same approach must be used every time a table of a field name is going to be used in the query. </p>
<h3 id="limit" class="title-h3">A problem with LIMIT clause</h3>
<p>Another problem is related to the SQL <code>LIMIT</code> clause. When in <a href="https://phpdelusions.net/pdo#emulation">emulation mode</a> (which is on by default), PDO substitutes placeholders with actual data, instead of sending it separately. And with "lazy" binding (using array in <code>execute()</code>), PDO treats every parameter as a string. As a result, the prepared <code>LIMIT ?,?</code> query becomes <code>LIMIT '10', '10'</code> which is invalid syntax that causes query to fail.</p>
<p>There are two solutions:</p>
<p>One is <a href="https://phpdelusions.net/pdo#emulation">turning emulation off</a> (as MySQL can sort all placeholders properly). To do so one can run this code:</p>
<pre><code><code><span style="color: #0000BB">$conn</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">setAttribute</span><span style="color: #007700">(&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">ATTR_EMULATE_PREPARES</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">false&nbsp;</span><span style="color: #007700">);</span><span style="color: #0000BB"></span></code></code></pre>
<p>And parameters can be kept in <code>execute()</code>:</p>
<pre><code><code><span style="color: #0000BB">$conn</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">setAttribute</span><span style="color: #007700">(&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">ATTR_EMULATE_PREPARES</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">false&nbsp;</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$stmt&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #DD0000">'SELECT&nbsp;*&nbsp;FROM&nbsp;table&nbsp;LIMIT&nbsp;?,&nbsp;?'</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">([</span><span style="color: #0000BB">$offset</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$limit</span><span style="color: #007700">]);<br></span><span style="color: #0000BB">$data&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetchAll</span><span style="color: #007700">();</span><span style="color: #0000BB"></span></code></code></pre>
<p>Another way would be to bind these variables explicitly while setting the proper param type:</p>
<pre><code><code><span style="color: #0000BB">$stmt&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #DD0000">'SELECT&nbsp;*&nbsp;FROM&nbsp;table&nbsp;LIMIT&nbsp;?,&nbsp;?'</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">bindParam</span><span style="color: #007700">(</span><span style="color: #0000BB">1</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$offset</span><span style="color: #007700">,</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">PARAM_INT</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">bindParam</span><span style="color: #007700">(</span><span style="color: #0000BB">2</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$limit</span><span style="color: #007700">,</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">PARAM_INT</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">();<br></span><span style="color: #0000BB">$data&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetchAll</span><span style="color: #007700">();</span><span style="color: #0000BB"></span></code></code></pre>
<p>One peculiar thing about <code>PDO::PARAM_INT</code>: for some reason it does not enforce the type casting. Thus, using it on a number that has a string type will cause the aforementioned error: </p>
<pre><code><code><span style="color: #0000BB">$stmt&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #DD0000">"SELECT&nbsp;1&nbsp;LIMIT&nbsp;?"</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">bindValue</span><span style="color: #007700">(</span><span style="color: #0000BB">1</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"1"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">PARAM_INT</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">();</span><span style="color: #0000BB"></span></code></code></pre>
<p>But change <code>"1"</code> in the example to <code>1</code> - and everything will go smooth.</p>
<h3 id="transactions" class="title-h3">Transactions</h3>
<p>To successfully run a transaction, you have to make sure that error mode is set to exceptions, and learn three canonical methods:</p>
<ul>
<li><code>beginTransaction()</code> to start a transaction</li>
<li><code>commit()</code> to commit one</li>
<li><code>rollback()</code> to cancel all the changes you made since transaction start.</li>
</ul>
<p>Exceptions are essential for transactions because they can be caught. So in case one of the queries failed, the execution will be stopped and moved straight to the catch block, where the whole transaction will be rolled back.</p>
<p>So a typical example would be like</p>
<pre><code><code><span style="color: #0000BB"></span><span style="color: #007700">try&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">beginTransaction</span><span style="color: #007700">();<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$stmt&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #DD0000">"INSERT&nbsp;INTO&nbsp;users&nbsp;(name)&nbsp;VALUES&nbsp;(?)"</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;foreach&nbsp;([</span><span style="color: #DD0000">'Joe'</span><span style="color: #007700">,</span><span style="color: #DD0000">'Ben'</span><span style="color: #007700">]&nbsp;as&nbsp;</span><span style="color: #0000BB">$name</span><span style="color: #007700">)<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">([</span><span style="color: #0000BB">$name</span><span style="color: #007700">]);<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">commit</span><span style="color: #007700">();<br>}catch&nbsp;(</span><span style="color: #0000BB">Exception&nbsp;$e</span><span style="color: #007700">){<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">rollback</span><span style="color: #007700">();<br>&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;</span><span style="color: #0000BB">$e</span><span style="color: #007700">;<br>}</span><span style="color: #0000BB"></span></code></code></pre>
<p>Please note the following important things:</p>
<ul>
<li>PDO error reporting mode should be set to <code>PDO::ERRMODE_EXCEPTION</code></li>
<li>you have catch an <code>Exception</code>, not <code>PDOException</code>, as it doesn't matter what particular exception aborted the execution.</li>
<li>you should re-throw an exception after rollback, to be notified of the problem the usual way.</li>
<li>also make sure that a table engine supports transactions (i.e. for Mysql it should be InnoDB, not MyISAM)</li>
<li>there are no Data definition language (DDL) statements that define or modify database schema among queries in your transaction, as such a query will cause an implicit commit</li>
</ul>
<h3 id="call" class="title-h3">Calling stored procedures in PDO</h3>
<p>There is one thing about stored procedures any programmer stumbles upon at first: every stored procedure always returns <strong>one extra result set</strong>: one (or many) results with actual data and one just empty. Which means if you try to call a procedure and then proceed to another query, then <b>"Cannot execute queries while other unbuffered queries are active"</b> error will occur, because you have to clear that extra empty result first. Thus, after calling a stored procedure that is intended to return only one result set, just call <a href="http://php.net/manual/en/pdostatement.nextrowset.php"><code>PDOStatement::nextRowset()</code></a> once (of course after fetching all the returned data from statement, or it will be discarded):</p>
<pre><code><code><span style="color: #0000BB">$stmt&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">"CALL&nbsp;bar()"</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$data&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetchAll</span><span style="color: #007700">();<br></span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">nextRowset</span><span style="color: #007700">();</span><span style="color: #0000BB"></span></code></code></pre>
<p>While for the stored procedures returning many result sets the behavior will be the same as with <a href="https://phpdelusions.net/pdo#multiquery">multiple queries execution</a>: </p>
<pre><code><code><span style="color: #0000BB">$stmt&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #DD0000">"CALL&nbsp;foo()"</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">();<br>do&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$data&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetchAll</span><span style="color: #007700">();<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">$data</span><span style="color: #007700">);<br>}&nbsp;while&nbsp;(</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">nextRowset</span><span style="color: #007700">()&nbsp;&amp;&amp;&nbsp;</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">columnCount</span><span style="color: #007700">());</span><span style="color: #0000BB"></span></code></code></pre>
<p>However, as you can see here is another trick have to be used: remember that extra result set? It  is so essentially <em>empty</em> that even an attempt to fetch from it will produce an error. So, we cannot use just <code>while ($stmt-&gt;nextRowset())</code>. Instead, we have to check also for empty result. For which purpose <code>PDOStatement::columnCount()</code> is just excellent.</p>
<p>This feature is one of essential differences between old mysql ext and modern libraries: after calling a stored procedure with <code>mysql_query()</code> there was no way to continue working with the same connection, because there is no <code>nextResult()</code> function for <code>mysql ext</code>. One had to close the connection and then open a new one again in order to run other queries after calling a stored procedure. </p>
<p>Calling a stored procedure is a rare case where <code>bindParam()</code> use is justified, as it's the only way to handle <code>OUT</code> and <code>INOUT</code> parameters. The example can be found in the <a href="http://php.net/manual/en/pdo.prepared-statements.php#example-1009">corresponding manual chapter</a>. However, <strong>for mysql it doesn't work.</strong> You have to resort to an <a href="http://stackoverflow.com/a/23749445/285587">SQL variable and an extra call</a>.</p>
<p>Note that for the different databases the syntax could be different as well. For example, to run a sored procedure against Microsoft SQL server, use the following format</p>
<pre><code><code><span style="color: #0000BB">$stmt&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #DD0000">"EXEC&nbsp;stored_procedure&nbsp;?&nbsp;?"</span><span style="color: #007700">);</span><span style="color: #0000BB"></span></code></code></pre>
<p>where ? marks are placeholders. Note that no braces should be used in the call.</p>
<h3 id="multiquery" class="title-h3">Running multiple queries with PDO</h3>
<blockquote>
<p>Note there are no reasons to stuff multiple queries in a single call, and generally you don't need this functionality. Running queries one by one is equal in every way to running them in a batch. The only use case for this functionality I can think of is when you need to execute an existing SQL dump  and check for the results. </p>
</blockquote>
<p>When in <a href="https://phpdelusions.net/pdo#emulation">emulation mode</a>, PDO can run mutiple queries in the same statement, either via query() or <code>prepare()/execute()</code>. To access the result of consequent queries one has to use <a href="http://php.net/manual/en/pdostatement.nextrowset.php"><code>PDOStatement::nextRowset()</code></a>:  </p>
<pre><code><code><span style="color: #0000BB">$stmt&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #DD0000">"SELECT&nbsp;?;SELECT&nbsp;?"</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">([</span><span style="color: #0000BB">1</span><span style="color: #007700">,</span><span style="color: #0000BB">2</span><span style="color: #007700">]);<br>do&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$data&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetchAll</span><span style="color: #007700">();<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">$data</span><span style="color: #007700">);<br>}&nbsp;while&nbsp;(</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">nextRowset</span><span style="color: #007700">());</span><span style="color: #0000BB"></span></code></code></pre>
<p>Within this loop you'll be able to gather all the related information from the every query, like affected rows, auto-generated id or errors occurred. </p>
<p>It is important to understand that at the point of <code>execute()</code> PDO will report the error <strong>for the first query only</strong>. But if error occurred at any of consequent queries, to get that error one has to iterate over results. Despite some <a href="https://bugs.php.net/bug.php?id=61613">ignorant opinions</a>, PDO can not and should not report all the errors at once. Some people just cannot grasp the problem at whole, and don't understand that error message is not the only outcome from the query. There could be a dataset returned, or some metadata like insert id. To get these, one has to iterate over resultsets, one by one. But to be able to throw an error immediately, PDO would have to iterate automatically, and thus <strong>discard some results</strong>. Which would be a clear nonsense.</p>
<p>Unlike <code>mysqli_multi_query()</code> PDO doesn't make an asynchronous call, so you can't  "fire and forget" - send bulk of queries to mysql and close connection, PHP will wait until last query gets executed.</p>
<h3 id="emulation" class="title-h3">Emulation mode. PDO::ATTR_EMULATE_PREPARES</h3>
<p>One of the most controversial PDO configuration options is <code>PDO::ATTR_EMULATE_PREPARES</code>. What does it do? PDO can run your queries in two ways: </p>
<ol>
<li>It can use a <b>real</b> or native prepared statement:<br>
When prepare() is called, your query with placeholders gets sent to mysql as is, with all the question marks you put in (in case named placeholders are used, they are substituted with ?s as well), while actual data goes later, when execute() is called. </li>
<li>It can use <b>emulated</b> prepared statement, when your query is sent to mysql as proper SQL, with all the data in place, <b>properly formatted</b>. In this case only one roundtrip to database happens, with <code>execute()</code> call. For some drivers (including mysql) emulation mode is turned <code>ON</code> by default.</li>
</ol>
<p>Both methods has their drawbacks and advantages but, and - I have to stress on it - both being <b>equally secure</b>, if used properly. Despite rather appealing tone of the popular <a href="http://stackoverflow.com/a/12202218/285587">article on Stack Overflow</a>, in the end it says that <b>if you are using supported versions of PHP and MySQL properly, you are 100% safe</b>.
All you have to do is to set encoding in the DSN, as it shown in the <a href="https://phpdelusions.net/pdo#dsn">example above</a>, and your emulated prepared statements will be as secure as real ones. </p>
<p>Note that when native mode is used, <strong>the data is never appears in the query</strong>, which is parsed by the engine as is, with all the placeholders in place. If you're looking into Mysql query log for your prepared query, you have to understand that it's just an artificial query that has been created solely for logging purpose, but not a real one that has been executed.</p>
<p>Other issues with emulation mode as follows:</p>
<h4 id="emulation_on" class="title-h4">When emulation mode is turned ON</h4>
<p>one can use a handy feature of named prepared statements - a placeholder with same name could be used any number of times in the same query, while corresponding variable have to be bound only once. For some obscure reason this functionality is disabled when emulation mode is off:</p>
<pre><code><code><span style="color: #0000BB">$stmt&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #DD0000">"SELECT&nbsp;*&nbsp;FROM&nbsp;t&nbsp;WHERE&nbsp;foo&nbsp;LIKE&nbsp;:search&nbsp;OR&nbsp;bar&nbsp;LIKE&nbsp;:search"</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">([</span><span style="color: #DD0000">'search'</span><span style="color: #007700">]&nbsp;=&gt;&nbsp;</span><span style="color: #DD0000">"%</span><span style="color: #0000BB">$search</span><span style="color: #DD0000">%"</span><span style="color: #007700">);`</span><span style="color: #DD0000"></span></code></code></pre>
<p>Also, when emulation is <code>ON</code>, PDO is able to run <a href="https://phpdelusions.net/pdo#multiquery">multiple queries in one prepared statement</a>.</p>
<p>Also, as native prepared statements support only certain query types, you can run some queries with prepared statements only when emulation is <code>ON</code>. The following code will return table names in emulation mode and error otherwise:</p>
<pre><code><code><span style="color: #0000BB">$stmt&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #DD0000">"SHOW&nbsp;TABLES&nbsp;LIKE&nbsp;?"</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">([</span><span style="color: #DD0000">"%</span><span style="color: #0000BB">$name</span><span style="color: #DD0000">%"</span><span style="color: #007700">]);<br></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetchAll</span><span style="color: #007700">());</span><span style="color: #0000BB"></span></code></code></pre>
<h4 id="emulation_off" class="title-h4">When emulation mode is turned OFF</h4>
<p>One could bother not with parameter types, as mysql will sort all the types properly. Thus, even string can be bound to LIMIT parameters, as it was noted in the <a href="https://phpdelusions.net/pdo#limit">corresponding chapter</a>. </p>
<p>Also, this mode will allow to use the advantage of <a href="https://phpdelusions.net/pdo#multiexec">single prepare-multiple execute</a> feature.</p>
<p>It's hard to decide which mode have to be preferred, but for usability sake I would rather turn it <code>OFF</code>, to avoid a hassle with <code>LIMIT</code> clause. Other issues could be considered negligible in comparison. </p>
<h3 id="mysqlnd" class="title-h3">Mysqlnd and buffered queries. Huge datasets. </h3>
<p>Recently all PHP extensions that work with mysql database were updated based on a low-level library called <code>mysqlnd</code>, which replaced old <code>libmysql</code> client. Thus some changes in the PDO behavior, mostly described above and one that follows: </p>
<p>There is one thing called <a href="http://php.net/manual/en/mysqlinfo.concepts.buffering.php">buffered queries</a>. Although you probably didn't notice it, you were using them all the way. Unfortunately, here are bad news for you: unlike old PHP versions, where you were using buffered queries virtually for free, modern versions built upon <a href="http://php.net/manual/en/book.mysqlnd.php">mysqlnd driver</a> won't let you to do that anymore:</p>
<blockquote>
<p>When using libmysqlclient as library PHP's memory limit won't count the memory used for result sets unless the data is fetched into PHP variables. <strong>With mysqlnd the memory accounted for will include the full result set.</strong></p>
</blockquote>
<p>The whole thing is about a resultset, which stands for all the data found by the query. </p>
<p>When your SELECT query gets executed, there are two ways to deliver the results in your script: buffered and unbuffered one. When buffered method is used, all the data returned by the query <strong>gets copied in the script's memory</strong> at once. While in unbuffered mode a database server feeds the found rows one by one.</p>
<p>So you can tell that in buffered mode a resultset is always burdening up the memory on the server <em>even if fetching weren't started at all</em>. Which is why it is not advisable to select huge datasets if you don't need all the data from it. </p>
<p>Nonetheless, when old libmysql-based clients were used, this problem didn't bother PHP uers too much, because the memory consumed by the resultset didn't count in the the <code>memory_get_usage()</code> and <code>memory_limit</code>. </p>
<p>But with mysqlnd things got changed, and the resultset returned by the buffered query will be count towards both <code>memory_get_usage()</code> and <code>memory_limit</code>, no matter which way you choose to get the result:</p>
<pre><code><code><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">"create&nbsp;temporary&nbsp;table&nbsp;pdo_memtest&nbsp;(i&nbsp;int)"</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">"insert&nbsp;into&nbsp;pdo_memtest&nbsp;values&nbsp;(1),(1),(1),(1),(1),(1),(1),(1),(1),(1)"</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$sql&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"SELECT&nbsp;REPEAT('&nbsp;',&nbsp;1024&nbsp;*&nbsp;1024)&nbsp;as&nbsp;big&nbsp;FROM&nbsp;pdo_memtest"</span><span style="color: #007700">;<br><br></span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">setAttribute</span><span style="color: #007700">(</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">MYSQL_ATTR_USE_BUFFERED_QUERY</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">FALSE</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$mem&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">memory_get_usage</span><span style="color: #007700">();<br></span><span style="color: #0000BB">$stmt&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #0000BB">$sql</span><span style="color: #007700">);<br>while(</span><span style="color: #0000BB">$row&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetch</span><span style="color: #007700">());<br>echo&nbsp;</span><span style="color: #DD0000">"Memory&nbsp;used:&nbsp;"</span><span style="color: #007700">.</span><span style="color: #0000BB">round</span><span style="color: #007700">((</span><span style="color: #0000BB">memory_get_usage</span><span style="color: #007700">()&nbsp;-&nbsp;</span><span style="color: #0000BB">$mem</span><span style="color: #007700">)&nbsp;/&nbsp;</span><span style="color: #0000BB">1024&nbsp;</span><span style="color: #007700">/&nbsp;</span><span style="color: #0000BB">1024</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">2</span><span style="color: #007700">).</span><span style="color: #DD0000">"M\n"</span><span style="color: #007700">;<br><br></span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">setAttribute</span><span style="color: #007700">(</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">MYSQL_ATTR_USE_BUFFERED_QUERY</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">TRUE</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$mem&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">memory_get_usage</span><span style="color: #007700">();<br></span><span style="color: #0000BB">$stmt&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #0000BB">$sql</span><span style="color: #007700">);<br>while(</span><span style="color: #0000BB">$row&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetch</span><span style="color: #007700">());<br>echo&nbsp;</span><span style="color: #DD0000">"Memory&nbsp;used:&nbsp;"</span><span style="color: #007700">.</span><span style="color: #0000BB">round</span><span style="color: #007700">((</span><span style="color: #0000BB">memory_get_usage</span><span style="color: #007700">()&nbsp;-&nbsp;</span><span style="color: #0000BB">$mem</span><span style="color: #007700">)&nbsp;/&nbsp;</span><span style="color: #0000BB">1024&nbsp;</span><span style="color: #007700">/&nbsp;</span><span style="color: #0000BB">1024</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">2</span><span style="color: #007700">).</span><span style="color: #DD0000">"M\n"</span><span style="color: #007700">;</span><span style="color: #0000BB"></span></code></code></pre>
<p>will give you</p>
<pre><code><code><span style="color: #0000BB">Memory&nbsp;used</span><span style="color: #007700">:&nbsp;</span><span style="color: #0000BB">1M<br>Memory&nbsp;used</span><span style="color: #007700">:&nbsp;</span><span style="color: #0000BB">20.04M</span></code></code></pre>
<p>which means that with buffered query the memory is consumed <strong>even if you're fetching rows one by one!</strong> </p>
<p>So, keep in mind that if you are selecting a really huge amount of data, always set <code>PDO::MYSQL_ATTR_USE_BUFFERED_QUERY</code> to <code>FALSE</code>. </p>
<p>Of course, there are drawbacks. One is infamous </p>
<blockquote>
<p>Cannot execute queries while other unbuffered queries are active</p>
</blockquote>
<p>error message which means that until you won't retrieve all the selected rows from the unbuffered query, it will be impossible to run any other query against hte same database connection.</p>
<p>And a couple minor ones, </p>
<ol>
<li>With unbuffered query you can't use <code>rowCount()</code> method (which is useless, as we learned <a href="https://phpdelusions.net/pdo#count">above</a>) </li>
<li>Moving (seeking) the current resultset internal pointer back and forth (which is useless as well).</li>
</ol><br>
          <div>
            <h3 class="uppercase mb-1">Related articles:</h3>
            <ul class="link-list">
              <li class="active"><a href="https://phpdelusions.net/pdo/pdo_wrapper">Simple yet efficient PDO wrapper</a></li>
              <li class="active"><a href="https://phpdelusions.net/pdo/mysqli_comparison">Usability problems of mysqli compared to PDO</a></li>
              <li class="active"><a href="https://phpdelusions.net/pdo/fetch_modes">PDO Fetch Modes</a></li>
              <li class="active"><a href="https://phpdelusions.net/pdo/sql_injection_example">An SQL injection against which prepared statements won't help</a></li>
              <li class="active"><a href="https://phpdelusions.net/pdo/common_mistakes">Your first database wrapper's childhood diseases</a></li>
              <li class="active"><a href="https://phpdelusions.net/pdo/objects">Fetching objects with PDO</a></li>
              <li class="active"><a href="https://phpdelusions.net/pdo/mcve">MCVE or How to debug database interactions with PDO</a></li>
              <li class="active"><a href="https://phpdelusions.net/pdo/password_hash">Authenticating a user using PDO and password_verify()</a></li>
              <li class="active"><a href="https://phpdelusions.net/pdo/cargo_cult_prepared_statement">A cargo cult prepared statement</a></li>
              <li class="active"><a href="https://phpdelusions.net/pdo/whitelisting_helper_function">Whitelisting helper function</a></li>
            </ul>
          </div>
<br>
<br>
      </div>

      <div class="col-xs-12 col-sm-5 col-md-4">
        <div class="sidebar pb-6">
          <div class="sidebar-block bg-secondary p-3">
            <h3 class="uppercase mb-1"><a href="https://phpdelusions.net/pdo#comments">Got a question?</a></h3>
            <p class="mb-0">I am the only person to hold a gold badge in 
            <a href="http://stackoverflow.com/help/badges/4220/pdo" rel="nofollow"><img height="24" title="PDO gold badge" src="./(The only proper) PDO tutorial - Treating PHP Delusions_files/badge-pdo.png"></a>,
            <a href="http://stackoverflow.com/help/badges/6342/mysqli" rel="nofollow"><img height="24" title="Mysqli gold badge" src="./(The only proper) PDO tutorial - Treating PHP Delusions_files/badge-mysqli.png"></a>
            and 
            <a href="http://stackoverflow.com/help/badges/5981/sql-injection" rel="nofollow"><img height="24" title="SQL Injection gold badge" src="./(The only proper) PDO tutorial - Treating PHP Delusions_files/badge-sql-injection.png"></a>
             on Stack Overflow and I am eager to show the right way for PHP developers.</p>
            <p>Besides, your questions let me make my articles even better, so you are more than welcome to ask any question you got.</p>
            <p class="mb-0"><a href="https://phpdelusions.net/pdo#comments" style="text-decoration:underline;">Click here to ask!</a></p>
          </div>
          <div class="sidebar-block bg-primary p-3">
            <a href="https://phpdelusions.net/articles/error_reporting">
                <span class="uppercase">Latest article:</span><br>
                PHP Error Reporting
            </a>
          </div>

          <div class="sidebar-block bg-primary-10 p-3">
            <h3 class="uppercase mb-1">SEE ALSO:</h3>
            <ul class="link-list">
              <li class="active"><a href="https://phpdelusions.net/top">Top 10 PHP delusions</a></li>
              <li class="active"><a href="https://phpdelusions.net/pdo_examples">PDO Examples</a></li>
              <li class="active"><a href="https://phpdelusions.net/mysqli_examples">Mysqli Examples</a></li>
              <li class="active"><a href="https://phpdelusions.net/basic_principles_of_web_programming">Principles of web-programming</a></li>
              <li class="active"><a href="https://phpdelusions.net/pdo/pdo_wrapper">Simple yet efficient PDO wrapper</a></li>

              <li class="active"><a href="https://phpdelusions.net/pdo/mysqli_comparison">Usability problems of mysqli compared to PDO</a></li>

              <li class="active"><a href="https://phpdelusions.net/pdo/fetch_modes">PDO Fetch Modes</a></li>

              <li class="active"><a href="https://phpdelusions.net/pdo/sql_injection_example">An SQL injection against which prepared statements won't help</a></li>

              <li class="active"><a href="https://phpdelusions.net/pdo/common_mistakes">Your first database wrapper's childhood diseases</a></li>

              <li class="active"><a href="https://phpdelusions.net/pdo/objects">Fetching objects with PDO</a></li>

              <li class="active"><a href="https://phpdelusions.net/pdo/mcve">MCVE or How to debug database interactions with PDO</a></li>

              <li class="active"><a href="https://phpdelusions.net/pdo/password_hash">Authenticating a user using PDO and password_verify()</a></li>

              <li class="active"><a href="https://phpdelusions.net/pdo/cargo_cult_prepared_statement">A cargo cult prepared statement</a></li>

              <li class="active"><a href="https://phpdelusions.net/pdo/whitelisting_helper_function">Whitelisting helper function</a></li>

            </ul>
          </div>
          <div class="sidebar-block bg-primary-11 p-3">
              <h3 class="uppercase mb-1">Latest comments:</h3>
              <ul class="last-comments-list">
 
                <li>
	                05.04.21 14:20<br><span class="comment-author">Rachel</span>
                	for <a href="https://phpdelusions.net/pdo#comment-950">(The only proper) PDO tutorial:</a><br>
	                <span class="comment">If a user submits, say...

    "INSERT INTO users (username,email) VALUES  
   ... </span><br>
	                <a href="https://phpdelusions.net/pdo#comment-950">read more</a>
		        </li>
 
                <li>
	                04.04.21 03:29<br><span class="comment-author">learning_reader</span>
                	for <a href="https://phpdelusions.net/pdo_examples/insert#comment-949">INSERT query using PDO:</a><br>
	                <span class="comment">In the below example, isn't $data supposed to be a nested array of values? Otherwise, wouldn't... </span><br>
	                <a href="https://phpdelusions.net/pdo_examples/insert#comment-949">read more</a>
		        </li>
 
                <li>
	                01.04.21 00:07<br><span class="comment-author">jwigs</span>
                	for <a href="https://phpdelusions.net/pdo_examples/select#comment-948">SELECT query with PDO:</a><br>
	                <span class="comment">Thanks for the excellent site and tutorials, hugely useful resource. I think there maybe a typo... </span><br>
	                <a href="https://phpdelusions.net/pdo_examples/select#comment-948">read more</a>
		        </li>
 
                <li>
	                30.03.21 18:44<br><span class="comment-author">Alois Haidinger</span>
                	for <a href="https://phpdelusions.net/pdo/pdo_wrapper#comment-946">Simple yet efficient PDO wrapper:</a><br>
	                <span class="comment">Hi, can class MyPDO also be used within PHP 8 ? </span><br>
	                <a href="https://phpdelusions.net/pdo/pdo_wrapper#comment-946">read more</a>
		        </li>
 
                <li>
	                23.03.21 19:17<br><span class="comment-author">tobiv</span>
                	for <a href="https://phpdelusions.net/articles/or_die#comment-944">Operator precedence or how does 'or die()' work.:</a><br>
	                <span class="comment">&gt; On a side note, now you can tell why we are using || instead of OR when we want a boolean... </span><br>
	                <a href="https://phpdelusions.net/articles/or_die#comment-944">read more</a>
		        </li>
              </ul>

          </div>

          <div class="sidebar-block bg-primary-10 p-3" align="center">
<a class="twitter-timeline" href="https://twitter.com/ShrapnelCol" data-widget-id="732288407301435392" width="300" height="400" data-chrome="noheader nofooter noborder">Tweets by @ShrapnelCol</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
          </div>

          </div>
        </div>
        </div>
      
      
    
    
    <div class="comments pt-3 pb-3">
      <div class="container" id="comments">
        <div class="col-lg-6 col-md-9 col-sm-9">
          <h2>Add a comment</h2>
          <p>Please refrain from sending spam or advertising of any sort.<br>
          Messages with hyperlinks will be pending for moderator's review.</p>
          <p><b>Markdown is now supported:</b>
          </p><ul>
          <li><code>&gt;</code> before and an empty line after for a quote
          </li><li>four spaces to mark a block of code 
          </li></ul>
          <p></p>
          <form class="form-horizontal form-phpfaq mt-3" method="POST">
            <div class="form-group">
              <label for="comment-name" class="col-sm-4 control-label">Your name</label>
              <div class="col-sm-8">
                <input type="text" name="name" id="comment-name" class="form-control" value="">
              </div>
            </div>
            <div class="form-group">
              <label for="comment-email" class="col-sm-4 control-label">Are you a robot?</label>
              <div class="col-sm-8">
                <input type="text" name="email" id="comment-email" class="form-control">
              </div>
            </div>
            <div class="form-group">
              <label for="comment-comment" class="col-sm-4 control-label">Message</label>
              <div class="col-sm-8">
                <textarea name="body" rows="5" id="comment-comment" class="form-control"></textarea>
              </div>
            </div>
            <div class="form-group">
              <label for="comment-city" class="col-sm-4 control-label">Address</label>
              <div class="col-sm-8">
                <input type="text" name="city" id="comment-city" class="form-control" value="">
                <p class="form-control-static">If you want to get a reply from admin, you may enter your Email address above</p>
              </div>
            </div>
            <div class="form-group">
              <div class="col-sm-4"></div>
              <div class="col-sm-8 col-md-4 col-lg-4">
			      <input type="hidden" name="date" value="1619498710">
			      <input type="hidden" name="topic" value="15">
                <button type="submit" class="btn btn-phpfaq btn-block">Send</button>
              </div>
            </div>
          </form>

        </div>
      </div>
    </div>
    <div class="comments pt-6">
      <div class="container">
        <div class="col-xs-12 col-sm-7 col-md-8">
          <h2 class="h1">Comments:</h2>
          <ul class="comments-list">
 
            <li class="comment" id="comment-950">
              <div class="comment-author">
              	Rachel, 05.04.21 14:20              </div>
              <div class="comment-body" style="overflow:hidden"><p>If a user submits, say...</p>
<pre><code><code><span style="color: #0000BB"></span><span style="color: #DD0000">"INSERT&nbsp;INTO&nbsp;users&nbsp;(username,email)&nbsp;VALUES&nbsp;&nbsp;<br>('deckard','deckard@tyrell.tv')"</span><span style="color: #007700">;</span><span style="color: #0000BB"></span></code></code></pre>
<p>and either the username or the email (or both) are taken, what would be a correct method of handling this while conforming to the best practices described above - such that we get a notification like 'Email address is already in use', or 'Please choose another username', or 'Both the email address and username are already in use', etc.??</p></div>
            </li>
 
            <li class="comment" id="comment-936">
              <div class="comment-author">
              	Aaron Mason, 10.02.21 03:37              </div>
              <div class="comment-body" style="overflow:hidden"><p>Why did you edit my comment removing my reply to Mike?</p></div>
            </li>
 
            <li class="comment" id="comment-935">
              <div class="comment-author">
              	Aaron Mason, 09.02.21 06:41              </div>
              <div class="comment-body" style="overflow:hidden"><p>Hi The code $options = [PDO::ATTR... ]; fails to parse on my development server. I used $options = array(PDO::ATTR...); instead.</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hi Aaron!</p>
<p>Square bracket arrays appeared in PHP 5.4 which happened nearly TEN years ago. And the current version is PHP 8. And the least supported version is PHP 7.3. May be it's about time to upgrade your development server?</p>              </div>
            </li>
 
            <li class="comment" id="comment-934">
              <div class="comment-author">
              	Aaron Mason, 09.02.21 06:39              </div>
              <div class="comment-body" style="overflow:hidden"><p>A thought on using PDO with LIKE - I have hit this problem myself and mitigated it by using concatenation to join the wildcards to the incoming string.  Like (for SQL Server):</p>
<pre><code><code><span style="color: #0000BB">SELECT&nbsp;foo</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">bar<br>FROM&nbsp;baz<br>WHERE&nbsp;otherthing&nbsp;LIKE&nbsp;</span><span style="color: #DD0000">'%'&nbsp;</span><span style="color: #007700">+&nbsp;?&nbsp;+&nbsp;</span><span style="color: #DD0000">'%'</span><span style="color: #0000BB"></span></code></code></pre>
<p>or (for MySQL/MariaDB):</p>
<pre><code><code><span style="color: #0000BB">SELECT&nbsp;foo</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">bar<br>FROM&nbsp;baz<br>WHERE&nbsp;otherthing&nbsp;LIKE&nbsp;CONCAT</span><span style="color: #007700">(</span><span style="color: #DD0000">'%'</span><span style="color: #007700">,&nbsp;?,&nbsp;</span><span style="color: #DD0000">'%'</span><span style="color: #007700">)</span><span style="color: #0000BB"></span></code></code></pre>
<p>I'm sure there's an argument against this and I am open to receive it.</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hi Aaron!</p>
<p>Nope, it's just another way to do the same.</p>              </div>
            </li>
 
            <li class="comment" id="comment-933">
              <div class="comment-author">
              	Mike, 06.02.21 01:22              </div>
              <div class="comment-body" style="overflow:hidden"><p>Hi
The code $options = [PDO::ATTR... ]; fails to parse on my development server. I used $options = array(PDO::ATTR...); instead.</p></div>
            </li>
 
            <li class="comment" id="comment-930">
              <div class="comment-author">
              	Nick Harris, 14.01.21 21:35              </div>
              <div class="comment-body" style="overflow:hidden"><p>Thoughts on using a generator function for efficient retrieval of large number of rows?</p>
<pre><code><code><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$stmt&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$db</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">"SELECT&nbsp;*&nbsp;FROM&nbsp;`large_table`"</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$rows&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">getStmtRowByRow</span><span style="color: #007700">(</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach&nbsp;(</span><span style="color: #0000BB">$rows</span><span style="color: #007700">()&nbsp;as&nbsp;</span><span style="color: #0000BB">$row</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">'name'</span><span style="color: #007700">];<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;</span><span style="color: #0000BB">getStmtRowByRow</span><span style="color: #007700">(</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;function&nbsp;()&nbsp;use&nbsp;(</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;(</span><span style="color: #0000BB">$row&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetch</span><span style="color: #007700">(</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">FETCH_ASSOC</span><span style="color: #007700">))&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;yield&nbsp;</span><span style="color: #0000BB">$row</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span style="color: #0000BB"></span></code></code></pre></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Nick!</p>
<p>Yes it's possible. But given PDOStatement is already iterable, this code can be made much simpler:</p>
<pre><code><code><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$stmt&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$db</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">"SELECT&nbsp;*&nbsp;FROM&nbsp;`large_table`"</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach&nbsp;(</span><span style="color: #0000BB">$stmt&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$row</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">'name'</span><span style="color: #007700">];<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span style="color: #0000BB"></span></code></code></pre>              </div>
            </li>
 
            <li class="comment" id="comment-922">
              <div class="comment-author">
              	Carlos, 05.12.20 10:27              </div>
              <div class="comment-body" style="overflow:hidden"><p>Is it possible to combine transactions with the exapmple of PDO Wrapper?</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Carlos!</p>
<p>Transactions are orthogonal to a wrapper. You just use them, that's all. A wrapper just helps to execute query in one go, but the rest is just vanilla PDO, use it as usual.</p>              </div>
            </li>
 
            <li class="comment" id="comment-921">
              <div class="comment-author">
              	David, 04.12.20 13:03              </div>
              <div class="comment-body" style="overflow:hidden"><p>I have found your PDO tutorial so good. Is it available in book / PDF form?</p>
<p>Thank you so much for your hard work.</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello David!</p>
<p>No, there is no PDF. I should think of making it on learnpub...</p>              </div>
            </li>
 
            <li class="comment" id="comment-920">
              <div class="comment-author">
              	Lynne Kole, 03.12.20 20:13              </div>
              <div class="comment-body" style="overflow:hidden"><p>Id like to know if you can post a sample PHP Script that explains how to use the LIKE With PDO to search in a database for keywords.  The example Ive seen on your site explains a lot but doesnt explain how to retrieve the $data for viewing.</p></div>
            </li>
 
            <li class="comment" id="comment-918">
              <div class="comment-author">
              	Logray, 23.11.20 01:43              </div>
              <div class="comment-body" style="overflow:hidden"><p>Hi.
Best treatment ever!
A note:
PDO::ATTR_EMULATE_PREPARES   =&gt; true, //if set to false cannot SELECT from views!</p></div>
            </li>
 
            <li class="comment" id="comment-905">
              <div class="comment-author">
              	Mike, 04.10.20 22:44              </div>
              <div class="comment-body" style="overflow:hidden"><p>Please update your website especially PDO parts because I cannot understand what you are trying to mention. Terrible grammar. No fency, I wanted to say it because the information you stated are very valuable.</p>
<p>Thanks.</p></div>
            </li>
 
            <li class="comment" id="comment-902">
              <div class="comment-author">
              	Terry Kern, 25.09.20 16:47              </div>
              <div class="comment-body" style="overflow:hidden"><p>Hello, I've been reading the PDO article with interest. Since in the mission of this site article states that grammatical corrections are welcome I would like to report a small one I noticed. In the "Running SELECT INSERT, UPDATE, or DELETE statements" section of the PDO article the third sentence "To PDO they all the same" should be "To PDO they're all the same". I look forward to continuing my reading experience with glee.</p></div>
            </li>
 
            <li class="comment" id="comment-901">
              <div class="comment-author">
              	Ingus, 18.09.20 10:48              </div>
              <div class="comment-body" style="overflow:hidden"><p>Hello, i got till moment when i do not know if it is secure!</p>
<p>If SQL injection is inserted into myTableTwo via safe PDO query will it make my query below SQL injection open?
Is the query below safe?</p>
<p>$mysfield returns <code>SHOW COLUMNS FROM myTable</code></p>
<p>myTable columns match myTableTwo columns</p>
<pre><code><code><span style="color: #0000BB">$sql&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #DD0000">"INSERT&nbsp;INTO&nbsp;myTable&nbsp;("</span><span style="color: #007700">.</span><span style="color: #0000BB">$mysfields</span><span style="color: #007700">.</span><span style="color: #DD0000">")&nbsp;SELECT&nbsp;"</span><span style="color: #007700">.</span><span style="color: #0000BB">$mysfields</span><span style="color: #007700">.</span><span style="color: #DD0000">"&nbsp;FROM&nbsp;myTableTwo"</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$sql</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">();</span><span style="color: #0000BB"></span></code></code></pre></div>
            </li>
 
            <li class="comment" id="comment-893">
              <div class="comment-author">
              	Pedro, 27.08.20 15:10              </div>
              <div class="comment-body" style="overflow:hidden"><p>Hi, I think I found a way which suits my particular scenario: I collect 3 php variables: $class, $studentnum and $weeknr.</p>
<p>I don't know what an sql injection attack looks like, but it must be some text like:</p>
<pre><code><code><span style="color: #0000BB">SELECT&nbsp;ItemName</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">ItemDescription<br>FROM&nbsp;Items<br>WHERE&nbsp;ItemNumber&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">999</span><span style="color: #007700">;&nbsp;</span><span style="color: #0000BB">DROP&nbsp;TABLE&nbsp;USERS</span></code></code></pre>
<p>I set  </p>
<pre><code><code><span style="color: #0000BB">$classes&nbsp;</span><span style="color: #007700">=&nbsp;array(</span><span style="color: #DD0000">'19BE1'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'19BE2'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'19BE3'</span><span style="color: #007700">)&nbsp;</span><span style="color: #0000BB">then&nbsp;check</span><span style="color: #007700">:<br>if&nbsp;(!</span><span style="color: #0000BB">in_array</span><span style="color: #007700">(</span><span style="color: #0000BB">$class</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$classes</span><span style="color: #007700">))<br>{<br>&nbsp;&nbsp;</span><span style="color: #FF8000">//echo&nbsp;"The&nbsp;class&nbsp;name&nbsp;is&nbsp;wrong,&nbsp;try&nbsp;again.";<br>&nbsp;&nbsp;</span><span style="color: #0000BB">$searchError&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'The&nbsp;class&nbsp;name&nbsp;you&nbsp;wrote&nbsp;does&nbsp;not&nbsp;exist:&nbsp;'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$class</span><span style="color: #007700">;<br>&nbsp;&nbsp;</span><span style="color: #FF8000">//header('location:&nbsp;form.html.php');<br>&nbsp;&nbsp;</span><span style="color: #007700">include&nbsp;</span><span style="color: #DD0000">'form.html.php'</span><span style="color: #007700">;<br>&nbsp;&nbsp;exit();<br>}</span><span style="color: #0000BB"></span></code></code></pre>
<p>As I see it, any injection attack would not reach execution.
I check $studentnum to see if it is a 10 digit number and $weeknr to see if it is in the array: $weeks = array(Week1, .... , Week18)</p>
<p>My webpage only gets a couple of hundred visitors, students, a week, but I still wouldn't like to get "injected".
Do you think this will stop it??</p></div>
            </li>
 
            <li class="comment" id="comment-892">
              <div class="comment-author">
              	Federico, 25.08.20 20:28              </div>
              <div class="comment-body" style="overflow:hidden"><p>Hello!</p>
<p>Nice article!</p>
<p>I have an error with the stored procedures that returns more than a resultset. The first query on the sp is ok but the second uses an unknown field (a typo error). The PDO::nextRowset() returns false as expected. But I don't have any way to know which is the error that makes the second resultset is empty since PDO::errorInfo() returns "00000" because the first resultset is ok.</p>
<p>How can I catch the error on the second resultset?</p>
<p>This is the code:</p>
<pre><code><code><span style="color: #0000BB"></span><span style="color: #007700">do{<br></span><span style="color: #0000BB">$result&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetchAll</span><span style="color: #007700">();<br>if(</span><span style="color: #0000BB">$result</span><span style="color: #007700">){<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;Some&nbsp;cool&nbsp;stuff&nbsp;*/<br></span><span style="color: #007700">}<br>}while(</span><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">nextRowset</span><span style="color: #007700">());</span><span style="color: #0000BB"></span></code></code></pre>
<p>And the connection params:</p>
<pre><code><code><span style="color: #0000BB">$options&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">=&nbsp;[<br>\</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">ATTR_TIMEOUT&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">5</span><span style="color: #007700">,&nbsp;<br>\</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">ATTR_EMULATE_PREPARES&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">true</span><span style="color: #007700">,&nbsp;<br>\</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">MYSQL_ATTR_DIRECT_QUERY&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">,&nbsp;<br>\</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">ATTR_ERRMODE&nbsp;</span><span style="color: #007700">=&gt;&nbsp;\</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">ERRMODE_EXCEPTION</span><span style="color: #007700">,&nbsp;<br>\</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">MYSQL_ATTR_COMPRESS&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">true</span><span style="color: #007700">];<br><br></span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">link&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">(</span><span style="color: #DD0000">"mysql:host=</span><span style="color: #007700">{</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">host</span><span style="color: #007700">}</span><span style="color: #DD0000">;port=</span><span style="color: #007700">{</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">port</span><span style="color: #007700">}</span><span style="color: #DD0000">;dbname=</span><span style="color: #007700">{</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">dbname</span><span style="color: #007700">}</span><span style="color: #DD0000">"</span><span style="color: #007700">,&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">user</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">pass</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$options</span><span style="color: #007700">);</span><span style="color: #0000BB"></span></code></code></pre>
<p>Thank you!</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Federico</p>
<p>According to my experience, PDO should throw an exception when you're calling PDO::nextRowset() on the query with error.</p>              </div>
            </li>
 
            <li class="comment" id="comment-890">
              <div class="comment-author">
              	Rob, 25.08.20 13:23              </div>
              <div class="comment-body" style="overflow:hidden"><p>I have a html form with options to search a mysql database.</p>
<pre><code><code><span style="color: #0000BB"></span><span style="color: #007700">&lt;</span><span style="color: #0000BB">form&nbsp;action</span><span style="color: #007700">=</span><span style="color: #DD0000">"csvtable.php"&nbsp;</span><span style="color: #0000BB">method</span><span style="color: #007700">=</span><span style="color: #DD0000">"post"</span><span style="color: #007700">&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">Search&nbsp;</span><span style="color: #007700">&lt;</span><span style="color: #0000BB">input&nbsp;type</span><span style="color: #007700">=</span><span style="color: #DD0000">"text"&nbsp;</span><span style="color: #0000BB">name</span><span style="color: #007700">=</span><span style="color: #DD0000">"search"</span><span style="color: #007700">&gt;&lt;</span><span style="color: #0000BB">br</span><span style="color: #007700">&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color: #0000BB">br</span><span style="color: #007700">&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">Column</span><span style="color: #007700">:&nbsp;&lt;</span><span style="color: #0000BB">select&nbsp;name</span><span style="color: #007700">=</span><span style="color: #DD0000">"column"</span><span style="color: #007700">&gt;<br>&lt;</span><span style="color: #0000BB">option&nbsp;value</span><span style="color: #007700">=</span><span style="color: #DD0000">"DriverFirstName"</span><span style="color: #007700">&gt;</span><span style="color: #0000BB">Driver&nbsp;First</span><span style="color: #007700">&lt;/</span><span style="color: #0000BB">option</span><span style="color: #007700">&gt;<br>&lt;</span><span style="color: #0000BB">option&nbsp;value</span><span style="color: #007700">=</span><span style="color: #DD0000">"NavFirstName"</span><span style="color: #007700">&gt;</span><span style="color: #0000BB">Nav&nbsp;First</span><span style="color: #007700">&lt;/</span><span style="color: #0000BB">option</span><span style="color: #007700">&gt;<br>&lt;</span><span style="color: #0000BB">option&nbsp;value</span><span style="color: #007700">=</span><span style="color: #DD0000">"Car"</span><span style="color: #007700">&gt;</span><span style="color: #0000BB">Car</span><span style="color: #007700">&lt;/</span><span style="color: #0000BB">option</span><span style="color: #007700">&gt;<br>&lt;/</span><span style="color: #0000BB">select</span><span style="color: #007700">&gt;&lt;</span><span style="color: #0000BB">br</span><span style="color: #007700">&gt;&lt;</span><span style="color: #0000BB">br</span><span style="color: #007700">&gt;<br>&lt;</span><span style="color: #0000BB">input&nbsp;type&nbsp;</span><span style="color: #007700">=</span><span style="color: #DD0000">"submit"</span><span style="color: #007700">&gt;<br>&lt;/</span><span style="color: #0000BB">form</span><span style="color: #007700">&gt;</span><span style="color: #0000BB"></span></code></code></pre>
<p>This then goes to a .php page with a query like this</p>
<pre><code><code><span style="color: #0000BB">$sql&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"SELECT&nbsp;*&nbsp;FROM&nbsp;competitors&nbsp;WHERE&nbsp;</span><span style="color: #0000BB">$column</span><span style="color: #DD0000">&nbsp;like&nbsp;'%</span><span style="color: #0000BB">$search</span><span style="color: #DD0000">%'"</span><span style="color: #007700">;</span><span style="color: #0000BB"></span></code></code></pre>
<p>What I would like to do is run it in pdo like this</p>
<pre><code><code><span style="color: #0000BB">$stmt&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #DD0000">"SELECT&nbsp;*&nbsp;FROM&nbsp;`cartest`&nbsp;WHERE&nbsp;`column`&nbsp;LIKE&nbsp;?"</span><span style="color: #007700">);</span><span style="color: #0000BB"></span></code></code></pre>
<p>How do I set it up so column in the $tmmt line in equal to $column in the $sql  line. </p>
<p>Thanks</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Rob. It is shown in the article above, in ht section related to LIKE operator</p>              </div>
            </li>
 
            <li class="comment" id="comment-889">
              <div class="comment-author">
              	Pedro, 25.08.20 03:53              </div>
              <div class="comment-body" style="overflow:hidden"><p>Thanks for your advice!
I read somewhere that PDO could handle native and non-native variables, so I thought maybe prepare can take the php $variables, like this: </p>
<pre><code><code><span style="color: #0000BB">$result&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #0000BB">$sql</span><span style="color: #007700">);&nbsp;</span><span style="color: #0000BB"></span></code></code></pre>
<p>Is it really that simple? What if $class was actually some nasty sql injection code??</p>
<p>I did this, it seems to work, no errors and I get the result I expect.</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Pedro.</p>
<p>No, it is not that simple.
Beside calling prepare() you have to replace all data variables in the query  with placeholders, while variables themselves should be sent to execute. </p>
<p>By the way, I don't understand what "native and non-native variables" are. Never heard of them</p>              </div>
            </li>
 
            <li class="comment" id="comment-888">
              <div class="comment-author">
              	Pedro, 24.08.20 07:39              </div>
              <div class="comment-body" style="overflow:hidden"><p>As an amateur, I find PHP and SQL difficult.
Here, $class is the name of a class of students, like 19BE1, $weeknr is the school week, like Week1 and $studentnum is the student's student number, like 1234567890.</p>
<p>If I define a query like this (this does what I want):</p>
<pre><code><code><span style="color: #0000BB">$sql&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'SELECT&nbsp;'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$class&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">'login.name,&nbsp;'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$class&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">'login.number,&nbsp;'&nbsp;</span><span style="color: #007700">.&nbsp;<br></span><span style="color: #0000BB">$class&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">'login.max_attendance,&nbsp;'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$class&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">'login.attendance,&nbsp;<br>19BE_all_scores.your_score&nbsp;AS&nbsp;your_total_score,&nbsp;<br>19BE_all_scores.'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$weeknr&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">'&nbsp;AS&nbsp;your_score_this_week,&nbsp;'<br></span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$class&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">'_max_scores.'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$weeknr&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">'&nbsp;AS&nbsp;week_max,&nbsp;'&nbsp;<br></span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$class&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">'_max_scores.total_score&nbsp;AS&nbsp;maximum_points&nbsp;FROM&nbsp;'&nbsp;<br></span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$class&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">'login&nbsp;INNER&nbsp;JOIN&nbsp;19BE_all_scores&nbsp;ON&nbsp;'&nbsp;<br></span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$class&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">'login.number&nbsp;=&nbsp;19BE_all_scores.number&nbsp;INNER&nbsp;JOIN&nbsp;'&nbsp;<br></span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$class&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">'_max_scores&nbsp;ON&nbsp;'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$class&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">'login.number&nbsp;=&nbsp;'&nbsp;<br></span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$class&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">'_max_scores.number&nbsp;WHERE&nbsp;'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$class&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">'login.number&nbsp;=&nbsp;'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$studentnum</span><span style="color: #007700">;</span><span style="color: #0000BB"></span></code></code></pre>
<p>Do I need a prepare statement to avoid sql injection before:</p>
<pre><code><code><span style="color: #0000BB">$result&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #0000BB">$sql</span><span style="color: #007700">);</span><span style="color: #0000BB"></span></code></code></pre>
<p>Does query() need to be 'prepared'?</p>
<p>Thanks for any tips or advice!</p>
<p>Pedro</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Pedro!</p>
<p>Yes, your query needs to be prepared and data variables should be replaced by placeholders, like it is shown in the article.</p>
<p>Also, you should really really change the database design:</p>
<ol>
<li>There shouldn't be separate tables for the classes. There must be a single table for the classes.</li>
<li>There shouldn't be a separate column for the week number. There must be just a date column, from which the week number would be simply calculated. </li>
<li>An enumerated table name also looks suspicious and should be also changed to a single table if you have other tables similar to 19BE_all_scores</li>
</ol>
<p>So variables $class and $weeknr should be in the WHERE part and should be replaced with a placeholder, as well as the $studentnum.</p>              </div>
            </li>
 
            <li class="comment" id="comment-884">
              <div class="comment-author">
              	Virgil Bierschwale, 02.08.20 18:06              </div>
              <div class="comment-body" style="overflow:hidden"><p>converting my mapping site to PDO and it works great until I try and retrieve 10,000 records.</p>
<p>Not sure how to write a for loop for pdo.
Found this example and tried it, but I'm missing something and was wondering if you had any recommendations.</p>
<pre><code><code><span style="color: #0000BB">$sql&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"SELECT&nbsp;EMPLOYER_NAME,&nbsp;SECONDARY_ENTITY_BUSINESS_NAME,&nbsp;wlat,&nbsp;wlng&nbsp;<br>FROM&nbsp;h1bdisclosuredataFY2020&nbsp;<br>where&nbsp;EMPLOYER_NAME&nbsp;like&nbsp;'%"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">srchname&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"%'&nbsp;<br>or&nbsp;SECONDARY_ENTITY_BUSINESS_NAME&nbsp;like&nbsp;'%"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">srchname&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"%'&nbsp;"</span><span style="color: #007700">;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$stmt&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">conn</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #0000BB">$sql</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//return&nbsp;$stmt-&gt;fetchAll(PDO::FETCH_ASSOC);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//$stmt-&gt;closeCursor();<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$sql</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">SetFetchMode</span><span style="color: #007700">(</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">FETCH_ASSOC</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while(</span><span style="color: #0000BB">$row&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$sql</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetch</span><span style="color: #007700">())&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">'EMPLOYER_NAME'</span><span style="color: #007700">]&nbsp;.&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">'SECONDARY_ENTITY_BUSINESS_NAME'</span><span style="color: #007700">]&nbsp;.&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">'wlat'</span><span style="color: #007700">]&nbsp;.&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">'wlng'</span><span style="color: #007700">]&nbsp;.&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span style="color: #0000BB"></span></code></code></pre></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Virgil!</p>
<p>Technically it should work. </p>
<p>If it doesn't then it would be a good idea to provide some description of the result you get. </p>
<p>Besides, you are using PDO prepared statement entirely wrong. Please read the article above.</p>              </div>
            </li>
 
            <li class="comment" id="comment-875">
              <div class="comment-author">
              	Kerstin, 02.07.20 12:30              </div>
              <div class="comment-body" style="overflow:hidden"><p>Thank you for the tutorial. It helps a lot!</p>
<p>I want to comment on the section on the rowCount() method: You are writing that one scarcely needs it because normally you only need to know if there is 0 or more lines.
But I use it a lot, especially when I need to know if I have to use plural or singular in a text. E.g. "You have 1 new message" or "2 new messages". For that it is not sufficient to just know if there is date or not.
You present an alternative with getting it directly from the database and state that this is a better way to do it. Could you please tell why? For performance reasons?</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Kerstin!</p>
<p>Thank you for a good question. Yes, exactly, it's for the performance reasons. As a rule of thumb, one should always select the exact information they need from a database:</p>
<ul>
<li>if you need the rows then select the rows using fetchAll() and then you can use PHP's count() to get the number</li>
<li>if you don't need the rows but only the number, then select the number</li>
</ul>              </div>
            </li>
 
            <li class="comment" id="comment-873">
              <div class="comment-author">
              	Bogdan, 10.06.20 21:29              </div>
              <div class="comment-body" style="overflow:hidden"><p>Please write a book called PHP Idiots. I will buy two copies. Thank you!</p></div>
            </li>
 
            <li class="comment" id="comment-871">
              <div class="comment-author">
              	Ken, 28.05.20 21:18              </div>
              <div class="comment-body" style="overflow:hidden"><p>Is there a way to get your blogs as one "book"/pdf.  I am more comfortable reading on paper than on line.</p>
<p>Thanks Ken</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Ken!</p>
<p>No, there is no PDF version but as far as I know there are many services that convert a web page to PDF. I never used it myself though but I hope the result would be satisfactory</p>              </div>
            </li>
 
            <li class="comment" id="comment-866">
              <div class="comment-author">
              	ptmp727, 22.05.20 20:52              </div>
              <div class="comment-body" style="overflow:hidden"><p>I am building a small framework of my own and I am not creating an ORM, But I have a DAO per entity/table which manages the relations superficially,</p>
<p>I read about multi queries being exactly the same as one by one in every way,</p>
<p>So what is the best way to do multiple insert, update,delete in one hit?
If I did all these in one single query, would it not be faster?</p>
<p>If not, then maybe its easier to just do one query separately?</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello!</p>
<p>No, you have read it wrong. Doing a multi query is NOT the same as doing one.<br>
And no, it is not faster either.</p>
<p>The proper way to run multiple DML  queries is to use a <em>transaction</em> and a prepared statement:</p>
<ol>
<li>Prepare your DELETE, INSERT or UPDATE query</li>
<li>then start a transaction</li>
<li>then execute your prepared query with different sets of data in a loop</li>
<li>Then commit the transaction</li>
</ol>
<p>You can get an example here: <a href="https://phpdelusions.net/pdo_examples/insert#multiple">https://phpdelusions.net/pdo_examples/insert#multiple</a></p>              </div>
            </li>
 
            <li class="comment" id="comment-854">
              <div class="comment-author">
              	Ivano Dagna, 10.05.20 18:13              </div>
              <div class="comment-body" style="overflow:hidden"><p>Hello! I have a simple table with a massive number of records, and this is causing memory and timeout issues when I use fetchAll(). I think using a cursor would solve them, but I never used them.
May you please give me an advice or point me towards a good source of examples?
Thanks in advance
Ivano</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Ivano!</p>
<p>You can find the example here: <a href="https://phpdelusions.net/pdo_examples/select#multiple">https://phpdelusions.net/pdo_examples/select#multiple</a></p>
<p>Also, consider using unbuffered query, as explained here: <a href="https://phpdelusions.net/pdo#mysqlnd">https://phpdelusions.net/pdo#mysqlnd</a></p>
<p>However, in the first place you should consider to process lesser amounts of data. You can use WHERE or LIMIT clauses to limit the amount of rows selected. Also, when applicable, you can ask a database to perform all calculations and return the result in a single row.</p>              </div>
            </li>
 
            <li class="comment" id="comment-851">
              <div class="comment-author">
              	Ian Sebryk, 29.04.20 11:50              </div>
              <div class="comment-body" style="overflow:hidden"><p>i have a db field that i want to use to track intervals.  i want to push completed intervals onto the db field when they are completed.  to wit:</p>
<pre><code class="language-mysql">intervals = '10'
intervals = '1020'   &lt;-- pushing 20 onto the field
intervals = '102040'   &lt;-- pushing 40 onto the field
intervals = '102040SP'   &lt;-- pushing SP onto the field</code></pre>
<p>the values will never decrement (and order doesn't really matter, if that's a factor), so i'm only looking for a way to <code>UPDATE</code> the field, but i have no idea how to do that because <code>UPDATE tbl SET ...</code> just overwrites the existing contents.  i looked into <code>CONCAT</code>, but that works with variables the user provides, not with existing data AND additional user data.  if i were to write some PSEUDO code, it might look like this:</p>
<pre><code class="language-php">UPDATE tbl PUSHTO interval VALUE newInterval WHERE id='id' AND date='date'</code></pre>
<p>so.  how would i structure my query for PDO?  would there be any issues with validation?  can you help me out here?  thanks in advance for your time.</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Ian!</p>
<p>Although CONCAT certainly works with variables the user provides, I would <strong>strongly</strong> suggest to normalize your table structure instead. </p>
<p>To normalize in the database world means to eliminate questions like this. Intervals should be really really a <strong>separate table</strong> where you add intervals on the distinct <strong>rows</strong>.</p>
<p>You can then even get the same string in your SELECT query using a GROUP_CONCAT() function, id needed.</p>              </div>
            </li>
 
            <li class="comment" id="comment-835">
              <div class="comment-author">
              	Wanze, 26.03.20 01:14              </div>
              <div class="comment-body" style="overflow:hidden"><p>How does inserting file into mysql table work from .csv file. I have a pdo db.
Thanks.</p></div>
            </li>
 
            <li class="comment" id="comment-834">
              <div class="comment-author">
              	AnrDaemon, 23.03.20 02:59              </div>
              <div class="comment-body" style="overflow:hidden"><p>@Ingus, did you run same query in mysql console by hands?</p></div>
            </li>
 
            <li class="comment" id="comment-833">
              <div class="comment-author">
              	Ingus, 20.03.20 22:43              </div>
              <div class="comment-body" style="overflow:hidden"><p>Hello there! Could you help me understand why this query is not showing any row?</p>
<pre><code><code><span style="color: #0000BB">$Query&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$main</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">con</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #DD0000">"SELECT&nbsp;*&nbsp;FROM&nbsp;earnings&nbsp;WHERE&nbsp;user&nbsp;=&nbsp;?&nbsp;ORDER&nbsp;BY&nbsp;id&nbsp;DESC&nbsp;LIMIT&nbsp;?,&nbsp;?"</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$Query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">([</span><span style="color: #0000BB">$_SESSION</span><span style="color: #007700">[</span><span style="color: #DD0000">'UID'</span><span style="color: #007700">],&nbsp;</span><span style="color: #0000BB">$start</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$limit</span><span style="color: #007700">]);<br>while(</span><span style="color: #0000BB">$row&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$Query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetch</span><span style="color: #007700">()){<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...<br>}</span><span style="color: #0000BB"></span></code></code></pre></div>
            </li>
 
            <li class="comment" id="comment-832">
              <div class="comment-author">
              	Michael, 18.03.20 21:10              </div>
              <div class="comment-body" style="overflow:hidden"><p>Hi - Thank you for the excellent site and invaluable information! Im following your advice in using prepared statements to lessen any risk on a site Im building. I would like to use a prepared PDO statement for an INSERT...ON DUPLICATE KEY and an example would be very much appreciated. Thank you.</p></div>
            </li>
 
            <li class="comment" id="comment-831">
              <div class="comment-author">
              	James Miller, 13.03.20 00:00              </div>
              <div class="comment-body" style="overflow:hidden"><p>I see not examples of an UPDATE stored procedure in PDO. I have tried to make this work, but have failed. I have not problem with UPDATE PDO, but not calling a sproc for an update. Is this possible or is it nonsensical to try and use?</p></div>
            </li>
 
            <li class="comment" id="comment-829">
              <div class="comment-author">
              	Coulston, 10.03.20 12:59              </div>
              <div class="comment-body" style="overflow:hidden"><p>How can I create two forms on one page that submits form data in two different scripts; Let's say a login page and a registration page that submits data on two different scripts, one for login and another for registration</p></div>
            </li>
 
            <li class="comment" id="comment-827">
              <div class="comment-author">
              	Noel, 02.03.20 13:01              </div>
              <div class="comment-body" style="overflow:hidden"><p>Hey, great article, well done. Im not sure if i missed it but how do you close the connection and statement? In mysql you close the database connection and statement, is that something you do with PDO or did i miss something.</p></div>
            </li>
 
            <li class="comment" id="comment-826">
              <div class="comment-author">
              	Sergio A. Kessler, 22.02.20 00:43              </div>
              <div class="comment-body" style="overflow:hidden"><p>ok, what about this:</p>
<pre><code><code><span style="color: #0000BB"></span><span style="color: #FF8000">//&nbsp;the&nbsp;list&nbsp;of&nbsp;allowed&nbsp;field&nbsp;names<br></span><span style="color: #0000BB">$allowed&nbsp;</span><span style="color: #007700">=&nbsp;[</span><span style="color: #DD0000">"name"</span><span style="color: #007700">,</span><span style="color: #DD0000">"surname"</span><span style="color: #007700">,</span><span style="color: #DD0000">"email"</span><span style="color: #007700">];<br><br></span><span style="color: #0000BB">$primary_key_name&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'id'</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$primary_key_value&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">48</span><span style="color: #007700">;<br><br></span><span style="color: #FF8000">/***********************************************<br>&nbsp;*&nbsp;update&nbsp;the&nbsp;record<br>&nbsp;*/<br></span><span style="color: #0000BB">$set&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">implode</span><span style="color: #007700">(</span><span style="color: #DD0000">'=?,&nbsp;'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">array_keys</span><span style="color: #007700">(</span><span style="color: #0000BB">array_intersect_key</span><span style="color: #007700">(</span><span style="color: #0000BB">$new_row</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$allowed</span><span style="color: #007700">)))&nbsp;.&nbsp;</span><span style="color: #DD0000">'=?'</span><span style="color: #007700">;<br><br></span><span style="color: #0000BB">$sql&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"update&nbsp;table1&nbsp;set&nbsp;</span><span style="color: #0000BB">$set</span><span style="color: #DD0000">&nbsp;where&nbsp;</span><span style="color: #0000BB">$primary_key_name</span><span style="color: #DD0000">&nbsp;=&nbsp;?"</span><span style="color: #007700">;<br><br></span><span style="color: #0000BB">$sql_params&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">array_values</span><span style="color: #007700">(</span><span style="color: #0000BB">$new_row</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$sql_params</span><span style="color: #007700">[]&nbsp;=&nbsp;</span><span style="color: #0000BB">$primary_key_value</span><span style="color: #007700">;<br><br></span><span style="color: #0000BB">$st&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$db</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #0000BB">$sql</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$st</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">(</span><span style="color: #0000BB">$sql_params</span><span style="color: #007700">);<br></span><span style="color: #FF8000">/*<br>&nbsp;*&nbsp;/update&nbsp;the&nbsp;record<br>&nbsp;************************************************/</span><span style="color: #0000BB"></span></code></code></pre></div>
            </li>
 
            <li class="comment" id="comment-824">
              <div class="comment-author">
              	Sergio A. Kessler, 19.02.20 16:17              </div>
              <div class="comment-body" style="overflow:hidden"><p>WRT:</p>
<pre><code><code><span style="color: #0000BB">$in&nbsp;&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">str_repeat</span><span style="color: #007700">(</span><span style="color: #DD0000">'?,'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">count</span><span style="color: #007700">(</span><span style="color: #0000BB">$arr</span><span style="color: #007700">)&nbsp;-&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">)&nbsp;.&nbsp;</span><span style="color: #DD0000">'?'</span><span style="color: #007700">;</span><span style="color: #0000BB"></span></code></code></pre>
<p>if $arr is empty, you still get a '?', I use:</p>
<pre><code><code><span style="color: #0000BB">$in&nbsp;&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">implode</span><span style="color: #007700">(</span><span style="color: #DD0000">','</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">array_fill</span><span style="color: #007700">(</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">count</span><span style="color: #007700">(</span><span style="color: #0000BB">$arr</span><span style="color: #007700">),&nbsp;</span><span style="color: #DD0000">'?'</span><span style="color: #007700">));</span><span style="color: #0000BB"></span></code></code></pre>
<p>where if $arr is empty, $in is also empty</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>If array is empty then empty in() clause will cause an SQL error, so it has to be checked before the query execution.</p>              </div>
            </li>
 
            <li class="comment" id="comment-823">
              <div class="comment-author">
              	Sergio A. Kessler, 19.02.20 03:13              </div>
              <div class="comment-body" style="overflow:hidden"><p>I like to use: </p>
<pre><code><code><span style="color: #0000BB">&nbsp;</span><span style="color: #FF8000">/***********************************************<br>&nbsp;*&nbsp;update&nbsp;the&nbsp;record<br>&nbsp;*/<br></span><span style="color: #0000BB">$set&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">implode</span><span style="color: #007700">(</span><span style="color: #DD0000">'=?,&nbsp;'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">array_keys</span><span style="color: #007700">(</span><span style="color: #0000BB">$new_row</span><span style="color: #007700">))&nbsp;.&nbsp;</span><span style="color: #DD0000">'=?'</span><span style="color: #007700">;<br><br></span><span style="color: #0000BB">$sql&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"update&nbsp;centro_donacion&nbsp;set&nbsp;</span><span style="color: #0000BB">$set</span><span style="color: #DD0000">&nbsp;where&nbsp;</span><span style="color: #0000BB">$primary_key_name</span><span style="color: #DD0000">&nbsp;=&nbsp;?"</span><span style="color: #007700">;<br><br></span><span style="color: #0000BB">$sql_params&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">array_values</span><span style="color: #007700">(</span><span style="color: #0000BB">$new_row</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$sql_params</span><span style="color: #007700">[]&nbsp;=&nbsp;</span><span style="color: #0000BB">$primary_key_value</span><span style="color: #007700">;<br><br></span><span style="color: #0000BB">$st&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$db</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #0000BB">$sql</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$st</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">(</span><span style="color: #0000BB">$sql_params</span><span style="color: #007700">);<br></span><span style="color: #FF8000">/*<br>*&nbsp;/update&nbsp;the&nbsp;record<br>************************************************/</span><span style="color: #0000BB"></span></code></code></pre></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Sergio!</p>
<p>With this code you've got two problems: </p>
<ul>
<li>potential but <strong>very real</strong> security breach. Field names / array keys being added to the query <strong>absolutely untreated</strong></li>
<li>a possible formatting issue. the field name may happen to coincide with  mysql reserved word and it will result in the query error. </li>
</ul>
<p>I've got an article that covers both problems, please check it out: <a href="https://phpdelusions.net/pdo_examples/dynamical_update">https://phpdelusions.net/pdo_examples/dynamical_update</a></p>              </div>
            </li>
 
            <li class="comment" id="comment-816">
              <div class="comment-author">
              	GioMBG, 09.02.20 20:53              </div>
              <div class="comment-body" style="overflow:hidden"><p>Hi Master,
for the purpose of security, on a machine that connects to the dbs only locally, does it make sense to read the users dbs with a connection other than the one used to read other dbs ??
now therefore I make 2 types of different connections ( $conn1 &amp; $conn2 ) through 2 db.inc.php that I carry inside my functions through :
global $conn1, $conn2...
now I made some changes and managing 2 different types of connections became really problematic, and I think to understand the bad pratice of call the connections with global...
so I was wondering if it made sense to keep them separate or go MUCH simpler keeping one for all without having problem recalling one connection only in my functions with global $conn...
suggestions ?
always thanks
Gio</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Gio!</p>
<p>I don't see any reason to have an extra connections. As a rule, every website is using just a single connection. I have a feeling that anyone who recommends an extra connection for the extra security never used it in the real life.</p>              </div>
            </li>
 
            <li class="comment" id="comment-812">
              <div class="comment-author">
              	John Thompson, 31.01.20 06:06              </div>
              <div class="comment-body" style="overflow:hidden"><p>I'm trying to make my PDO code portable. With mysqli you can have you database, host, username/password in a db.inc or db.php then include it when you start your code. I am not finding that I'm able to do that. For example:</p>
<p>db.inc/db.php</p>
<pre><code><code><span style="color: #0000BB">$host&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"Server"</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$database&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"Cats"</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$user&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"Frank"</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$password&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"something"</span><span style="color: #007700">;</span><span style="color: #0000BB"></span></code></code></pre>
<p>On the php file to do the action:</p>
<pre><code><code><span style="color: #0000BB"></span><span style="color: #007700">include(</span><span style="color: #0000BB">db</span><span style="color: #007700">.</span><span style="color: #0000BB">php</span><span style="color: #007700">);</span><span style="color: #0000BB"></span></code></code></pre>
<p>Then call your variables and run the mysqli connection then the query.
If I try that in PDO I get errors. Is this just not done? Or there's a proper way to have 1 file with my DSN, username, password and database name?</p>
<p>Thank You in advance,</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello John!</p>
<p>Of course it can be done. </p>
<p>The error is not some imminent but probably some mistake in your implementation. A few problems I can spot right away:</p>
<ul>
<li>there is no opening php tag in db.php. the first line should be &lt;?php</li>
<li>there are missing quotes when you call include. it should be include 'db.php';</li>
<li>dubious path to db.php. Make sure you are providing a correct <em>absolute</em> path to a file. Check out the relevant article: <a href="https://phpdelusions.net/articles/paths">https://phpdelusions.net/articles/paths</a></li>
</ul>
<p>If you still encounter some errors, try to google them - usually there are many answers on Stack Overflow explainig the problem.</p>              </div>
            </li>
 
            <li class="comment" id="comment-803">
              <div class="comment-author">
              	Charles Henderson, 20.01.20 21:53              </div>
              <div class="comment-body" style="overflow:hidden"><p>Ok, first let me just say, I am not asking you to explain to me how to do this, just asking if it is possible. I asked if anyone could point me in the right direction on how to do it on Stack Exchange and was told that the answer to that question could fill books lol. So basically I just want to know if it is possible to do, and if it is, I will roll up my sleeves and do a lot of reading.</p>
<p>Basically we currently have a customer invoicing program made in Access, forms built in Access and using Access database. There are 2 main parts, the customer info and the invoice itself. It looks like there is a customer table and an invoice table. When an invoice is made it links to the customer by the incremental ID of the invoice. Basically I would like to make a web form that has all the information on one page. Top has customer info, and if it is a new customer the info can put inputted and submitted to database, if it is a return customer then the customer can be looked up by customer ID, license number, or lastname, and the rest of the info autofilled from the record. Then the invoice can be filled out and submitted, linking the invoice to the customer. In the end an invoice can be saved, emailed, or printed. Does that sound like something that is possible to make? If I did not do a good job explaining I can send you screenshots of what we are currently using and of what I would like the new one to look like. Thank you in advance for any help you can offer.</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Charles!</p>
<p>Well, everything is doable, the question is the amount of effort you are willing to spend. </p>
<p>The easiest way would be to ditch everything you have now and rebuild the system using PHP HTML and SQLite. For this stack the task is of low to moderate complexity, can be done in a month if you have no prior experience.</p>
<p>If you still need the connection to your existing Access database, it would be tricky to achieve and clumsy to maintain. And I've got no solution from top off my head right now.</p>              </div>
            </li>
 
            <li class="comment" id="comment-801">
              <div class="comment-author">
              	Ingus, 10.01.20 13:14              </div>
              <div class="comment-body" style="overflow:hidden"><p>Replaying to your last reply (Ingus, 10.01.20 11:16):
Thanks for fetch() fix!</p>
<p>But what if i had like this:</p>
<pre><code><code><span style="color: #0000BB"></span><span style="color: #007700">if(</span><span style="color: #0000BB">mysqli_num_rows</span><span style="color: #007700">(</span><span style="color: #0000BB">$result</span><span style="color: #007700">)==</span><span style="color: #0000BB">0</span><span style="color: #007700">){&nbsp;</span><span style="color: #FF8000">//do&nbsp;something&nbsp;}<br></span><span style="color: #007700">if(</span><span style="color: #0000BB">mysqli_num_rows</span><span style="color: #007700">(</span><span style="color: #0000BB">$result</span><span style="color: #007700">)==</span><span style="color: #0000BB">1</span><span style="color: #007700">){&nbsp;</span><span style="color: #FF8000">//do&nbsp;something&nbsp;else&nbsp;}<br></span><span style="color: #007700">if(</span><span style="color: #0000BB">mysqli_num_rows</span><span style="color: #007700">(</span><span style="color: #0000BB">$result</span><span style="color: #007700">)==</span><span style="color: #0000BB">5</span><span style="color: #007700">){&nbsp;</span><span style="color: #FF8000">//do&nbsp;something&nbsp;else&nbsp;}</span><span style="color: #0000BB"></span></code></code></pre>
<p>How to get same result with PDO?</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>I can't even think where you would need such a code but you can fetch all rows into array using fetchAll() and then count them</p>
<pre><code><code><span style="color: #0000BB">$rows&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$result</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetchAll</span><span style="color: #007700">();<br></span><span style="color: #0000BB">$count&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">count</span><span style="color: #007700">(</span><span style="color: #0000BB">$rows</span><span style="color: #007700">);<br>if(</span><span style="color: #0000BB">$count&nbsp;</span><span style="color: #007700">==&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">){&nbsp;</span><span style="color: #FF8000">//do&nbsp;something&nbsp;}<br></span><span style="color: #007700">elseif(</span><span style="color: #0000BB">$count&nbsp;</span><span style="color: #007700">==&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">){&nbsp;</span><span style="color: #FF8000">//do&nbsp;something&nbsp;else&nbsp;}<br></span><span style="color: #007700">elseif(</span><span style="color: #0000BB">$count&nbsp;</span><span style="color: #007700">==&nbsp;</span><span style="color: #0000BB">5</span><span style="color: #007700">){&nbsp;</span><span style="color: #FF8000">//do&nbsp;something&nbsp;else&nbsp;}</span><span style="color: #0000BB"></span></code></code></pre>
<p>But wait. <strong>If you need only count, but not the data itself</strong> then select only count.</p>
<pre><code><code><span style="color: #0000BB">$stmt&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #DD0000">"SELECT&nbsp;count(*)&nbsp;FROM&nbsp;my_table&nbsp;WHERE&nbsp;id=?&nbsp;AND&nbsp;username=?&nbsp;AND&nbsp;email=?&nbsp;ORDER&nbsp;BY&nbsp;id&nbsp;DESC"</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">([</span><span style="color: #0000BB">$val1</span><span style="color: #007700">,</span><span style="color: #0000BB">$val2</span><span style="color: #007700">,</span><span style="color: #0000BB">$val3</span><span style="color: #007700">]);<br></span><span style="color: #0000BB">$count&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetchColumn</span><span style="color: #007700">();<br>if(</span><span style="color: #0000BB">$count&nbsp;</span><span style="color: #007700">==&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">){&nbsp;</span><span style="color: #FF8000">//do&nbsp;something&nbsp;}</span><span style="color: #0000BB"></span></code></code></pre>              </div>
            </li>
 
            <li class="comment" id="comment-800">
              <div class="comment-author">
              	Ingus, 10.01.20 11:16              </div>
              <div class="comment-body" style="overflow:hidden"><p>I m having issue converting mysqli to PDO </p>
<p>My code:</p>
<pre><code><code><span style="color: #0000BB">$result&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #DD0000">"SELECT&nbsp;status,&nbsp;date&nbsp;FROM&nbsp;my_table&nbsp;WHERE&nbsp;id=?&nbsp;AND&nbsp;username=?&nbsp;AND&nbsp;email=?&nbsp;ORDER&nbsp;BY&nbsp;id&nbsp;DESC"</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$result</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">([</span><span style="color: #0000BB">$val1</span><span style="color: #007700">,</span><span style="color: #0000BB">$val2</span><span style="color: #007700">,</span><span style="color: #0000BB">$val3</span><span style="color: #007700">]);<br></span><span style="color: #0000BB">$row&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$result</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetchColumn</span><span style="color: #007700">();</span><span style="color: #0000BB"></span></code></code></pre>
<p>I had for mysqli:</p>
<pre><code><code><span style="color: #0000BB"></span><span style="color: #007700">if&nbsp;((</span><span style="color: #0000BB">mysqli_num_rows</span><span style="color: #007700">(</span><span style="color: #0000BB">$result</span><span style="color: #007700">)==</span><span style="color: #0000BB">0</span><span style="color: #007700">)||(</span><span style="color: #0000BB">time</span><span style="color: #007700">()-</span><span style="color: #0000BB">strtotime</span><span style="color: #007700">(</span><span style="color: #0000BB">$date</span><span style="color: #007700">)&gt;</span><span style="color: #0000BB">120</span><span style="color: #007700">)){&nbsp;&nbsp;</span><span style="color: #FF8000">//DO&nbsp;SOMETHING&nbsp;&nbsp;}</span><span style="color: #0000BB"></span></code></code></pre>
<p>The question is how to make same effect with count returned lines with PDO?</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Ingus!</p>
<p>I am not sure what are you doing here but at least I can tell that fetchColumn() is not suitable for such a query, because you are selecting two columns, not one.</p>
<p>Change the last line to </p>
<pre><code><code><span style="color: #0000BB">$row&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$result</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetch</span><span style="color: #007700">();</span><span style="color: #0000BB"></span></code></code></pre>
<p>and then you can use this $row variable instead of mysqli_num_rows() because not empty $row means your query returned something:</p>
<pre><code><code><span style="color: #0000BB">&nbsp;</span><span style="color: #007700">if&nbsp;(</span><span style="color: #0000BB">$row&nbsp;</span><span style="color: #007700">||(</span><span style="color: #0000BB">time</span><span style="color: #007700">()-</span><span style="color: #0000BB">strtotime</span><span style="color: #007700">(</span><span style="color: #0000BB">$date</span><span style="color: #007700">)&gt;</span><span style="color: #0000BB">120</span><span style="color: #007700">)){&nbsp;&nbsp;</span><span style="color: #FF8000">//DO&nbsp;SOMETHING&nbsp;&nbsp;}</span><span style="color: #0000BB"></span></code></code></pre>
<p>Here you can use status, $row['date'] and $row['status']. If $date above is the date from $row then just write $row['date'] instead of $date.</p>              </div>
            </li>
 
            <li class="comment" id="comment-799">
              <div class="comment-author">
              	Ingus, 07.01.20 11:39              </div>
              <div class="comment-body" style="overflow:hidden"><p>Hello, first of all thanks for such a good tutorial! It teached me allot!</p>
<p>I m about to make new script and i m going to use PDO! Clients that will use this script have different wishes about database type. ..
One want SQL other want MySQL so i have question!
Can i make script that allows both database structures and if database type would be needed to change all i had to do would be change connection string?</p>
<p>Thanks in advance!</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Ingus,</p>
<p>As a rule, it is not possible because of different SQL flavors. For example in SQL Server there is no LIMIT operator, but there is TOP instead and so on. </p>
<p>It means you have to test all your queries for all servers.</p>
<p>For a a true database-agnostic application look for some DBAL, such as Doctrine or Eloquent.</p>              </div>
            </li>
 
            <li class="comment" id="comment-798">
              <div class="comment-author">
              	steve, 06.01.20 07:09              </div>
              <div class="comment-body" style="overflow:hidden"><p>Just wanted to say THANK YOU for this! Still working through it, but the explanations for everything is so much better than YouTube videos and other tuts that just give code for one way that works. I feel like I'm actually learning this stuff (and the RIGHT way), and not just copying code.</p>
<p>Thanks again!</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Steve!</p>
<p>Thank you for your feedback. Such a response is a thing that keeps this site going. </p>
<p>Please keep in mind that best gratitude is questions. Do not hesitate to ask for clarification or an example. It will help me to make this site better.</p>              </div>
            </li>
 
            <li class="comment" id="comment-792">
              <div class="comment-author">
              	grotto, 05.12.19 20:44              </div>
              <div class="comment-body" style="overflow:hidden"><p>I'm having some issues with a particular file that I'm updating to pdo and I'm suspicious that it's related to the fact that some of the DB columns are bigint.  Could you please elaborate on the bigint idiosyncrasies you mentioned in your main article and how to deal with them.  I'm also looking for a place to get help with my pdo issues but I've gotten bad response from asking questions on  SO and I'm not sure where else might be a good source for help.  Any suggestions would be greatly appreciated!</p></div>
            </li>
 
            <li class="comment" id="comment-789">
              <div class="comment-author">
              	Todd Loomis, 30.11.19 23:23              </div>
              <div class="comment-body" style="overflow:hidden"><p>How does this work with fulltext searches?  I'm using mysql and PHP, and I've been trying to create prepared statements, but cannot get it to work:</p>
<pre><code><code><span style="color: #0000BB"></span><span style="color: #007700">if&nbsp;(((</span><span style="color: #0000BB">strpos</span><span style="color: #007700">(</span><span style="color: #0000BB">$keywords</span><span style="color: #007700">,</span><span style="color: #DD0000">'+'</span><span style="color: #007700">))&nbsp;!==&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">)&nbsp;||&nbsp;((</span><span style="color: #0000BB">strpos</span><span style="color: #007700">(</span><span style="color: #0000BB">$keywords</span><span style="color: #007700">,</span><span style="color: #DD0000">'-'</span><span style="color: #007700">))&nbsp;!==&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">))&nbsp;{<br></span><span style="color: #0000BB">$booleaninsert&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"&nbsp;IN&nbsp;BOOLEAN&nbsp;MODE"</span><span style="color: #007700">;<br>}&nbsp;else&nbsp;{<br></span><span style="color: #0000BB">$booleaninsert&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"&nbsp;IN&nbsp;NATURAL&nbsp;LANGUAGE&nbsp;MODE"</span><span style="color: #007700">;<br>}<br><br></span><span style="color: #0000BB">$search&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"%</span><span style="color: #0000BB">$keywords</span><span style="color: #DD0000">%"</span><span style="color: #007700">;<br></span><span style="color: #FF8000">//&nbsp;$stmt&nbsp;&nbsp;=&nbsp;$pdo-&gt;prepare("SELECT&nbsp;*&nbsp;FROM&nbsp;table&nbsp;WHERE&nbsp;name&nbsp;LIKE&nbsp;?");<br></span><span style="color: #0000BB">$stmt&nbsp;&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #DD0000">"SELECT&nbsp;*,&nbsp;MATCH(modelnumber,&nbsp;mfg,&nbsp;releasedate,&nbsp;code)&nbsp;AGAINST&nbsp;(?&nbsp;"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$booleaninsert&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">")&nbsp;AS&nbsp;score&nbsp;FROM&nbsp;songs&nbsp;WHERE&nbsp;MATCH(modelnumber,&nbsp;mfg,&nbsp;releasedate,&nbsp;code)&nbsp;AGAINST&nbsp;(?&nbsp;"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$booleaninsert&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">")"</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">([</span><span style="color: #0000BB">$search</span><span style="color: #007700">]);<br></span><span style="color: #0000BB">$data&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetchAll</span><span style="color: #007700">();</span><span style="color: #0000BB"></span></code></code></pre>
<p>Thanks!
Todd</p></div>
            </li>
 
            <li class="comment" id="comment-788">
              <div class="comment-author">
              	Ted, 24.11.19 22:41              </div>
              <div class="comment-body" style="overflow:hidden"><p>I'm extremely confused.</p>
<p>What the heck do you mean by "here is an example for mysql"? Do I need to use this code if I'm using a msql database? What does most of this code mean?</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Ted!</p>
<p>Sorry for the late answer. </p>
<p>I am not sure what do you mean with "msql". As far as I know, PDO doesn't support such a database. May be it's mysql or MS SQL server? For the latter you will need different connection code, see <a href="https://www.php.net/manual/en/ref.pdo-dblib.php">https://www.php.net/manual/en/ref.pdo-dblib.php</a></p>
<p>And what does this code mean is fully explained in another article, <a href="https://phpdelusions.net/pdo_examples/connect_to_mysql">https://phpdelusions.net/pdo_examples/connect_to_mysql</a></p>              </div>
            </li>
 
            <li class="comment" id="comment-779">
              <div class="comment-author">
              	Ricardo Miller, 14.11.19 00:22              </div>
              <div class="comment-body" style="overflow:hidden"><p>Hiya thanks for your knowledge on the PDO its helping me massively understand PDO better but I am having a issue. </p>
<pre><code><code><span style="color: #0000BB"></span><span style="color: #007700">private&nbsp;function&nbsp;</span><span style="color: #0000BB">__construct</span><span style="color: #007700">()<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$params&nbsp;</span><span style="color: #007700">=&nbsp;[<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">ATTR_EMULATE_PREPARES&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">,&nbsp;</span><span style="color: #FF8000">//&nbsp;turn&nbsp;off&nbsp;emulation&nbsp;mode&nbsp;for&nbsp;"real"&nbsp;prepared&nbsp;statements<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">ATTR_ERRMODE&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">ERRMODE_EXCEPTION</span><span style="color: #007700">,&nbsp;</span><span style="color: #FF8000">//turn&nbsp;on&nbsp;errors&nbsp;in&nbsp;the&nbsp;form&nbsp;of&nbsp;exceptions<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">ATTR_DEFAULT_FETCH_MODE&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">FETCH_ASSOC</span><span style="color: #007700">,&nbsp;</span><span style="color: #FF8000">//make&nbsp;the&nbsp;default&nbsp;fetch&nbsp;be&nbsp;an&nbsp;associative&nbsp;array<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">];&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">$_dbh&nbsp;</span><span style="color: #007700">=&nbsp;@new&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">Config</span><span style="color: #007700">::</span><span style="color: #0000BB">DB_DRIVER&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">':host='&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">Config</span><span style="color: #007700">::</span><span style="color: #0000BB">DB_HOST&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">';dbname='&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">Config</span><span style="color: #007700">::</span><span style="color: #0000BB">DB_NAME&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">';charset='&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">Config</span><span style="color: #007700">::</span><span style="color: #0000BB">DB_CHARSET</span><span style="color: #007700">,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">Config</span><span style="color: #007700">::</span><span style="color: #0000BB">DB_USER</span><span style="color: #007700">,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">Config</span><span style="color: #007700">::</span><span style="color: #0000BB">DB_PASSWORD</span><span style="color: #007700">,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;PDO&nbsp;options&nbsp;*/<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$params<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//self::$_dbh-&gt;setAttribute(&nbsp;PDO::ATTR_EMULATE_PREPARES,&nbsp;false&nbsp;);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">}&nbsp;catch&nbsp;(</span><span style="color: #0000BB">Exception&nbsp;$e</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;If&nbsp;we&nbsp;can't&nbsp;established&nbsp;a&nbsp;database&nbsp;connection&nbsp;return&nbsp;and&nbsp;error<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">DBWrapper</span><span style="color: #007700">::</span><span style="color: #0000BB">fatal</span><span style="color: #007700">(</span><span style="color: #DD0000">"<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;An&nbsp;error&nbsp;occurred&nbsp;while&nbsp;connecting&nbsp;to&nbsp;the&nbsp;database&nbsp;"&nbsp;</span><span style="color: #007700">.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">Config</span><span style="color: #007700">::</span><span style="color: #0000BB">DB_NAME&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"The&nbsp;error&nbsp;reported&nbsp;by&nbsp;the&nbsp;server&nbsp;was:"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$e</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getMessage</span><span style="color: #007700">()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">$_dbh</span><span style="color: #007700">;<br>}</span><span style="color: #0000BB"></span></code></code></pre></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Ricardo.</p>
<p>In order to have the code formatter you must pad it with 4 spaces from the left and an <strong>empty line from the top</strong>.</p>
<p>So what your issue is?</p>              </div>
            </li>
 
            <li class="comment" id="comment-778">
              <div class="comment-author">
              	Justin, 08.11.19 21:40              </div>
              <div class="comment-body" style="overflow:hidden"><p>First, thanks for your insight into PDO and the creation of a wrapper. My wrapper wasn't too far off but was able to make some adjustments thanks to the information you have shared. I have also gone through the delusions article as well and it has also helped me reexamine parts of my code.</p>
<p>Secondly, I have a site running on PHP 5.4.45 with a custom created PDO wrapper as well as other custom classes I created to fulfill my needs. It has been running near flawlessly (except for some of hand PHP errors) for the past 4 or so years this way. Now however is the time to upgrade the server. After upgrading the server to 5.6 I started to experience major issues right away with MySQL. It seems that there was a major shift in code handling by PHP from 5.4 to 5.6 with the way it is handling DB connections. The server is now hating my code and opening way too many connections to MySQL and crashing the server. Do you know what change they made between these two versions that I may be overlooking?</p>
<p>Thanks in advance.</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Justin!</p>
<p>I cannot think of any reason related to PHP version. It should work exactly as before. </p>
<p>However, there are two most frequent reasons for too many connections.</p>
<p>First of all make sure you are no using a persistent connection.<br>
Then make sure your wrapper connects only once during the script executions. Most likely it's the case.</p>              </div>
            </li>
 
            <li class="comment" id="comment-776">
              <div class="comment-author">
              	James Miller, 01.11.19 01:22              </div>
              <div class="comment-body" style="overflow:hidden"><p>Not a question, but a thank you and praise for your work. I cannot tell you how much simpler your code examples have made my attempts at being a programmer. You must have a paypal account or a manner to make contributions. If not you should. Once agains thank you.</p></div>
            </li>
 
            <li class="comment" id="comment-771">
              <div class="comment-author">
              	Mohamed, 24.10.19 20:01              </div>
              <div class="comment-body" style="overflow:hidden"><p>Please advise whether below method is correct, if I don't set to PDO::ATTR_PERSISTENT =&gt; TRUE, I don't know why it's not rolling back.</p>
<pre><code><code><span style="color: #0000BB"></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">Database&nbsp;</span><span style="color: #007700">{<br>&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;</span><span style="color: #0000BB">$host&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">DB_HOST</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;</span><span style="color: #0000BB">$user&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">DB_USER</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;</span><span style="color: #0000BB">$pass&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">DB_PASS</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;</span><span style="color: #0000BB">$dbname&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">DB_NAME</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;</span><span style="color: #0000BB">$charset&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'utf8mb4'</span><span style="color: #007700">;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;</span><span style="color: #0000BB">$dbh</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;</span><span style="color: #0000BB">$error</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;public&nbsp;$table&nbsp;=&nbsp;NULL;<br>&nbsp;&nbsp;&nbsp;&nbsp;/*--------------------------------------------------------------------------------*/<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">__construct</span><span style="color: #007700">(){<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;Set&nbsp;DSN<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$dsn&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'mysql:host='</span><span style="color: #007700">.</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">host</span><span style="color: #007700">.</span><span style="color: #DD0000">';dbname='</span><span style="color: #007700">.</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">dbname</span><span style="color: #007700">;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">charset</span><span style="color: #007700">;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$options&nbsp;</span><span style="color: #007700">=&nbsp;array(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">ATTR_PERSISTENT&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">TRUE</span><span style="color: #007700">,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">ATTR_ERRMODE&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">ERRMODE_EXCEPTION<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;PDO::ATTR_EMULATE_PREPARES&nbsp;=&gt;&nbsp;false<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;Create&nbsp;PDO&nbsp;instance<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">try{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">dbh&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">(</span><span style="color: #0000BB">$dsn</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">user</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">pass</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$options&nbsp;</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(</span><span style="color: #0000BB">PDOException&nbsp;$e</span><span style="color: #007700">){<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">error&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$e</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getMessage</span><span style="color: #007700">();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;echo&nbsp;$this-&gt;error;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">die(</span><span style="color: #DD0000">"Database&nbsp;Connection&nbsp;Failed&nbsp;"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">error</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;}</span><span style="color: #0000BB"></span></code></code></pre></div>
            </li>
 
            <li class="comment" id="comment-770">
              <div class="comment-author">
              	Mohamed, 24.10.19 19:19              </div>
              <div class="comment-body" style="overflow:hidden"><p>Hi, Thanks for your replay.</p>
<p>Transactions is not rolling back on mysql query failure, if PDO::ATTR_PERSISTENT =&gt; TRUE is not used.</p>
<p>Please advise the solution.</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Mohamed</p>
<p>The PDO::ATTR_PERSISTENT is not relevant to transactions. Most likely your transaction is not rolled back because the table in the database does not support them. Make sure the table is created with InnoDB engine. And also check out other prerequisites noted in the corresponding section: <a href="https://phpdelusions.net/pdo#transactions">https://phpdelusions.net/pdo#transactions</a></p>              </div>
            </li>
 
            <li class="comment" id="comment-765">
              <div class="comment-author">
              	Wim de Bok, 18.10.19 15:32              </div>
              <div class="comment-body" style="overflow:hidden"><p>Finding valuable sources on the internet is never easy but I am glad I found this one. Great article on PHP and PDO, thank you!</p></div>
            </li>
 
            <li class="comment" id="comment-764">
              <div class="comment-author">
              	Mohamed, 18.10.19 09:56              </div>
              <div class="comment-body" style="overflow:hidden"><p>Please advise on usage on below, whether to use or not in transanctions</p>
<p>PDO::ATTR_PERSISTENT =&gt; TRUE,</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Mohamed!</p>
<p>The answer is very simple: just <strong>never</strong> use PDO::ATTR_PERSISTENT =&gt; TRUE unless you have a very skilled dedicated server admin who would tell you this option is necessary and who would then configure your database server, HTTP server and PHP properly.</p>
<p>In any other case this option will do you much more harm than good. Especially with transactions, as such an option will result in transactions extended between different scripts execution with unpredictable results.</p>              </div>
            </li>
 
            <li class="comment" id="comment-762">
              <div class="comment-author">
              	Elizabeth, 17.10.19 12:11              </div>
              <div class="comment-body" style="overflow:hidden"><p>Hi,
I managed to solve my issue sent earlier today by replacing the while loop with [ $user = $stmt-&gt;fetch(); ] which i grabbed from your site - thank you :)</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Elizabeth,</p>
<p>Thank you very much, such feedback means a lot!</p>              </div>
            </li>
 
            <li class="comment" id="comment-754">
              <div class="comment-author">
              	Daniel Collin, 04.10.19 15:46              </div>
              <div class="comment-body" style="overflow:hidden"><p>Hi, very good article! Thanx</p></div>
            </li>
 
            <li class="comment" id="comment-745">
              <div class="comment-author">
              	Lynne K., 12.09.19 12:11              </div>
              <div class="comment-body" style="overflow:hidden"><p>Hi,
I'd like to use PDO to access a reviews database with mysql.  I'm completely new to PDO and am upgrading from PHP5 to PHP7.  The query I am having trouble with is:</p>
<pre><code><code><span style="color: #0000BB">$query&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"select&nbsp;*&nbsp;from&nbsp;rsd_reviews&nbsp;order&nbsp;by&nbsp;new_date&nbsp;limit&nbsp;</span><span style="color: #0000BB">$offset</span><span style="color: #DD0000">,&nbsp;</span><span style="color: #0000BB">$limit</span><span style="color: #DD0000">"</span><span style="color: #007700">;</span><span style="color: #0000BB"></span></code></code></pre>
<p>Could you assist?</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Lynne!</p>
<p>Three things:</p>
<ol>
<li>Always use <strong>placeholders</strong> in place of actual variables in youe query, just like it explained in the article. </li>
<li>Make sure $offset and $limit have correct values.</li>
<li>Make sure you are <a href="https://phpdelusions.net/pdo_examples/connect_to_mysql">connecting to PDO properly</a> and have PHP configured to report errors</li>
</ol>
<p>In case it doesn't help, please get back with a more detailed description what particular trouble you are having.</p>              </div>
            </li>
 
            <li class="comment" id="comment-742">
              <div class="comment-author">
              	Christopher, 06.09.19 01:05              </div>
              <div class="comment-body" style="overflow:hidden"><p>What does PDO stand for?
PHP
Data
Objects?
Always give a definition for an acronym, if it is one.</p></div>
            </li>
 
            <li class="comment" id="comment-738">
              <div class="comment-author">
              	pink, 21.08.19 06:31              </div>
              <div class="comment-body" style="overflow:hidden"><blockquote>
<p>How is it different from your method?</p>
</blockquote>
<pre><code><code><span style="color: #0000BB"></span><span style="color: #007700">&lt;?</span><span style="color: #0000BB">php<br></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">DB&nbsp;</span><span style="color: #007700">{<br>private&nbsp;</span><span style="color: #0000BB">$pdo&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">;<br>private&nbsp;</span><span style="color: #0000BB">$stmt&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">;<br><br>function&nbsp;</span><span style="color: #0000BB">__construct</span><span style="color: #007700">(){<br>try&nbsp;{<br>&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">pdo&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">(<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"mysql:host=localhost;dbname=test;charset=utf8"</span><span style="color: #007700">,&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"root"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">""</span><span style="color: #007700">,&nbsp;[<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">ATTR_ERRMODE&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">ERRMODE_EXCEPTION</span><span style="color: #007700">,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">ATTR_DEFAULT_FETCH_MODE&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">FETCH_ASSOC</span><span style="color: #007700">,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">ATTR_EMULATE_PREPARES&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">,<br>&nbsp;&nbsp;&nbsp;&nbsp;]<br>&nbsp;&nbsp;);<br>}&nbsp;catch&nbsp;(</span><span style="color: #0000BB">Exception&nbsp;$ex</span><span style="color: #007700">)&nbsp;{&nbsp;die(</span><span style="color: #0000BB">$ex</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getMessage</span><span style="color: #007700">());&nbsp;}</span><span style="color: #0000BB"></span></code></code></pre>
<p>}</p>
<pre><code><code><span style="color: #0000BB"></span><span style="color: #007700">function&nbsp;</span><span style="color: #0000BB">__destruct</span><span style="color: #007700">(){<br>if&nbsp;(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">stmt</span><span style="color: #007700">!==</span><span style="color: #0000BB">null</span><span style="color: #007700">)&nbsp;{&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">stmt&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">;&nbsp;}<br>if&nbsp;(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">pdo</span><span style="color: #007700">!==</span><span style="color: #0000BB">null</span><span style="color: #007700">)&nbsp;{&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">pdo&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">;&nbsp;}</span><span style="color: #0000BB"></span></code></code></pre>
<p>}</p>
<p>function select($sql, $cond=null){
$result = false;
try {
$this-&gt;stmt = $this-&gt;pdo-&gt;prepare($sql);
$this-&gt;stmt-&gt;execute($cond);
$result = $this-&gt;stmt-&gt;fetchAll();
} catch (Exception $ex) { die($ex-&gt;getMessage()); }
$this-&gt;stmt = null;
return $result;
}
}
?&gt;</p></div>
            </li>
 
            <li class="comment" id="comment-737">
              <div class="comment-author">
              	Tachi, 14.08.19 16:34              </div>
              <div class="comment-body" style="overflow:hidden"><p>You are great! I'm quite new to PHP and I'm renewing old code of a former colleague with PDO and I found your example with the IN clause very helpful. Many many thanks
Here I have an example where the placeholder after the IN clause could be a single value or a range of values. I wanted to share. I hope it is useful for others.</p>
<pre><code><code><span style="color: #0000BB"></span><span style="color: #007700">if&nbsp;(&nbsp;</span><span style="color: #0000BB">is_array</span><span style="color: #007700">(</span><span style="color: #0000BB">$groupID</span><span style="color: #007700">)&nbsp;)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$in&nbsp;</span><span style="color: #007700">=&nbsp;&nbsp;</span><span style="color: #0000BB">str_repeat</span><span style="color: #007700">(</span><span style="color: #DD0000">"?,"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">count</span><span style="color: #007700">(</span><span style="color: #0000BB">$groupID</span><span style="color: #007700">)&nbsp;-&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">)&nbsp;.&nbsp;</span><span style="color: #DD0000">"?"</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$arr&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$groupID</span><span style="color: #007700">;<br>}&nbsp;else&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$in&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"?"</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$arr&nbsp;</span><span style="color: #007700">=&nbsp;[</span><span style="color: #0000BB">$groupID</span><span style="color: #007700">];<br>}<br></span><span style="color: #0000BB">$sql&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"SELECT&nbsp;parent_groupID,&nbsp;child_groupID&nbsp;FROM&nbsp;table&nbsp;WHERE&nbsp;parent_groupID&nbsp;IN&nbsp;(</span><span style="color: #0000BB">$in</span><span style="color: #DD0000">)&nbsp;ORDER&nbsp;BY&nbsp;ordinal&nbsp;ASC"</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$stmt&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$dsn</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #0000BB">$sql</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">(</span><span style="color: #0000BB">$arr</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$r&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetchAll</span><span style="color: #007700">();</span><span style="color: #0000BB"></span></code></code></pre></div>
            </li>
 
            <li class="comment" id="comment-722">
              <div class="comment-author">
              	Chuck Robinson, 01.07.19 22:35              </div>
              <div class="comment-body" style="overflow:hidden"><p>I noticed something weird about pdo ssl, if you misspell the key name values such as
PDO::MYSQL_ATTR_SSL_KEY =&gt; 'mispeled key name'
it still works which is kinda strange.</p></div>
            </li>
 
            <li class="comment" id="comment-718">
              <div class="comment-author">
              	Joe, 08.06.19 14:28              </div>
              <div class="comment-body" style="overflow:hidden"><p>I have issue with single quote ' I can't see the word like Don't or won't instead of don't I can see "don" missing apostrophe and t how do I fix it?
Thank you</p>
<pre><code><code><span style="color: #0000BB"></span><span style="color: #007700">&lt;?</span><span style="color: #0000BB">php<br></span><span style="color: #007700">try&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$conn&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">(</span><span style="color: #DD0000">"mysql:host=localhost;&nbsp;dbname=test"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"root"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">""</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$conn</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">setAttribute</span><span style="color: #007700">(</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">ATTR_ERRMODE</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">ERRMODE_EXCEPTION</span><span style="color: #007700">);<br>}<br>catch(</span><span style="color: #0000BB">PDOException&nbsp;$e</span><span style="color: #007700">)<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #0000BB">$sql&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"&lt;br&gt;"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$e</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getMessage</span><span style="color: #007700">();<br>}<br><br></span><span style="color: #0000BB">$stmt&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$conn</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">"&nbsp;SELECT&nbsp;*&nbsp;FROM&nbsp;users&nbsp;"</span><span style="color: #007700">);<br>while(</span><span style="color: #0000BB">$row&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetch</span><span style="color: #007700">())<br>{<br>echo&nbsp;</span><span style="color: #DD0000">"<br>&lt;form&nbsp;action='update.php'&nbsp;method='POST'&gt;&nbsp;<br>&lt;input&nbsp;type='hidden'&nbsp;name=&nbsp;'id'&nbsp;value='</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #0000BB">id</span><span style="color: #007700">]</span><span style="color: #DD0000">'&gt;&nbsp;<br>&lt;td&gt;&nbsp;&lt;input&nbsp;type='text'&nbsp;name=&nbsp;'firstname'&nbsp;value='</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #0000BB">firstname</span><span style="color: #007700">]</span><span style="color: #DD0000">'&nbsp;&gt;<br>&lt;input&nbsp;type='text'&nbsp;name='lastname'&nbsp;value='</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #0000BB">lastname</span><span style="color: #007700">]</span><span style="color: #DD0000">'&gt;&nbsp;<br>&lt;input&nbsp;type='text'&nbsp;name='email'&nbsp;value='</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #0000BB">email</span><span style="color: #007700">]</span><span style="color: #DD0000">'&gt;&nbsp;<br>&lt;input&nbsp;type='submit'&nbsp;name='insert'&nbsp;value='Update'&gt;&nbsp;<br>&lt;/form&gt;&nbsp;<br>}<br>?&gt;</span></code></code></pre></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Joe,</p>
<p>This is a very common problem. Just look at the HTML source of your page and you'll find why. When yo have "don't" in the value, it becomes like this </p>
<pre><code><code><span style="color: #0000BB"></span><span style="color: #007700">&lt;</span><span style="color: #0000BB">input&nbsp;type</span><span style="color: #007700">=</span><span style="color: #DD0000">'text'&nbsp;</span><span style="color: #0000BB">name</span><span style="color: #007700">=</span><span style="color: #DD0000">'lastname'&nbsp;</span><span style="color: #0000BB">value</span><span style="color: #007700">=</span><span style="color: #DD0000">'don'</span><span style="color: #0000BB">t</span><span style="color: #DD0000">'&gt;&nbsp;</span></code></code></pre>
<p>see - it closes the quote.</p>
<p>To avoid this, you must apply <code>htmlspecialchars()</code> with <code>ENT_QUOTES</code> parameter to all your variables.</p>              </div>
            </li>
 
            <li class="comment" id="comment-693">
              <div class="comment-author">
              	ymtaufik, 30.04.19 01:10              </div>
              <div class="comment-body" style="overflow:hidden"><p>Hello Expert</p>
<p>To prevent my apps from sql injection, I use str_replace for any input parameter ($kiki) as below :</p>
<pre><code><code><span style="color: #0000BB"></span><span style="color: #007700">foreach&nbsp;(</span><span style="color: #0000BB">$_POST&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$varname&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$varvalue</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$arr</span><span style="color: #007700">[</span><span style="color: #0000BB">$i</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #0000BB">$varname</span><span style="color: #007700">];<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$i&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$i&nbsp;</span><span style="color: #007700">+</span><span style="color: #0000BB">1</span><span style="color: #007700">;<br>}<br><br>if&nbsp;(</span><span style="color: #0000BB">$i&nbsp;</span><span style="color: #007700">&gt;=</span><span style="color: #0000BB">1&nbsp;</span><span style="color: #007700">)&nbsp;{</span><span style="color: #0000BB">$kiki&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$arr</span><span style="color: #007700">[</span><span style="color: #0000BB">0</span><span style="color: #007700">]&nbsp;.&nbsp;</span><span style="color: #DD0000">"^"</span><span style="color: #007700">;}<br>if&nbsp;(</span><span style="color: #0000BB">$i&nbsp;</span><span style="color: #007700">&gt;=</span><span style="color: #0000BB">2&nbsp;</span><span style="color: #007700">)&nbsp;{</span><span style="color: #0000BB">$kiki&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$kiki&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$arr</span><span style="color: #007700">[</span><span style="color: #0000BB">1</span><span style="color: #007700">]&nbsp;.&nbsp;</span><span style="color: #DD0000">"^"</span><span style="color: #007700">;}<br>if&nbsp;(</span><span style="color: #0000BB">$i&nbsp;</span><span style="color: #007700">&gt;=</span><span style="color: #0000BB">3&nbsp;</span><span style="color: #007700">)&nbsp;{</span><span style="color: #0000BB">$kiki&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$kiki&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$arr</span><span style="color: #007700">[</span><span style="color: #0000BB">2</span><span style="color: #007700">]&nbsp;.&nbsp;</span><span style="color: #DD0000">"^"</span><span style="color: #007700">;}<br>if&nbsp;(</span><span style="color: #0000BB">$i&nbsp;</span><span style="color: #007700">&gt;=</span><span style="color: #0000BB">4&nbsp;</span><span style="color: #007700">)&nbsp;{</span><span style="color: #0000BB">$kiki&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$kiki&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$arr</span><span style="color: #007700">[</span><span style="color: #0000BB">3</span><span style="color: #007700">]&nbsp;.&nbsp;</span><span style="color: #DD0000">"^"</span><span style="color: #007700">;}<br>if&nbsp;(</span><span style="color: #0000BB">$i&nbsp;</span><span style="color: #007700">&gt;=</span><span style="color: #0000BB">5&nbsp;</span><span style="color: #007700">)&nbsp;{</span><span style="color: #0000BB">$kiki&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$kiki&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$arr</span><span style="color: #007700">[</span><span style="color: #0000BB">4</span><span style="color: #007700">]&nbsp;.&nbsp;</span><span style="color: #DD0000">"^"</span><span style="color: #007700">;}<br><br></span><span style="color: #0000BB">$vowels&nbsp;</span><span style="color: #007700">=&nbsp;array(</span><span style="color: #DD0000">";"</span><span style="color: #007700">,</span><span style="color: #DD0000">":"</span><span style="color: #007700">,</span><span style="color: #DD0000">"#"</span><span style="color: #007700">,</span><span style="color: #DD0000">"+"</span><span style="color: #007700">,</span><span style="color: #DD0000">"*"</span><span style="color: #007700">,</span><span style="color: #DD0000">"."</span><span style="color: #007700">,</span><span style="color: #DD0000">"|"</span><span style="color: #007700">,</span><span style="color: #DD0000">"="</span><span style="color: #007700">,</span><span style="color: #DD0000">"%"</span><span style="color: #007700">,</span><span style="color: #DD0000">"'"</span><span style="color: #007700">,</span><span style="color: #DD0000">"/"</span><span style="color: #007700">,</span><span style="color: #DD0000">"$"</span><span style="color: #007700">,</span><span style="color: #DD0000">"("</span><span style="color: #007700">,</span><span style="color: #DD0000">"{"</span><span style="color: #007700">,</span><span style="color: #DD0000">"["</span><span style="color: #007700">,</span><span style="color: #DD0000">"&amp;"</span><span style="color: #007700">,</span><span style="color: #DD0000">"!"</span><span style="color: #007700">,</span><span style="color: #DD0000">"@"</span><span style="color: #007700">,</span><span style="color: #DD0000">"?"</span><span style="color: #007700">,</span><span style="color: #DD0000">","</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$kiki&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">str_replace</span><span style="color: #007700">(</span><span style="color: #0000BB">$vowels</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"-"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$kiki</span><span style="color: #007700">);&nbsp;&nbsp;<br><br></span><span style="color: #0000BB">$val&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">explode</span><span style="color: #007700">(</span><span style="color: #DD0000">"^"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$kiki</span><span style="color: #007700">);</span><span style="color: #0000BB"></span></code></code></pre>
<p>then :</p>
<pre><code><code><span style="color: #0000BB">$sql&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"SELECT&nbsp;*&nbsp;FROM&nbsp;zuser&nbsp;WHERE&nbsp;nameu='"</span><span style="color: #007700">.</span><span style="color: #0000BB">$val</span><span style="color: #007700">[</span><span style="color: #0000BB">1</span><span style="color: #007700">].</span><span style="color: #DD0000">"'&nbsp;AND&nbsp;passw='"</span><span style="color: #007700">.</span><span style="color: #0000BB">$val</span><span style="color: #007700">[</span><span style="color: #0000BB">2</span><span style="color: #007700">].</span><span style="color: #DD0000">"'"</span><span style="color: #007700">;</span><span style="color: #0000BB"></span></code></code></pre>
<p>is it still vulnerable?, can you help how to inject with above sanitation ?
regards</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello.</p>
<p>Yes it is vulnerable. You can find many answers on Stack Overflow that explain how to inject with above sanitation.</p>
<p>You should use prepared statements instead of this.</p>              </div>
            </li>
 
            <li class="comment" id="comment-687">
              <div class="comment-author">
              	Shahrulhadi, 17.04.19 06:32              </div>
              <div class="comment-body" style="overflow:hidden"><p>Hi, i am currently using php framework Yii 2. Yii 3 is in development, and i am planning to use that when it is release.
Can you verify if they use proper PDO?
If Yii doesnt use proper PDO, what php framework do you suggest?</p></div>
            </li>
 
            <li class="comment" id="comment-685">
              <div class="comment-author">
              	Dave Coates, 10.04.19 17:15              </div>
              <div class="comment-body" style="overflow:hidden"><p>Hi.  This is an excellent web site - thanks!<br>
I have read page after page about retrieving multiple rows and multiple row sets, but I can't find anywhere which explains the mechanics of how multiple row sets work.  My question is... When calling a stored procedure via PDO which returns multiple row sets, are all the row sets returned to PDO at once, or is there subsequent communication between the server and PDO every time I make a call to GetNextRowSet?  Thanks in advance.
Dave.</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Dave!</p>
<p>That's a very good question, and the answer is the option 2: subsequent communication between the server and PDO.</p>
<p>That's actually the whole point, as each resultset is completely separated from others, bearing its own metadata such as error information number if returned rows, etc.</p>
<p>After all, you can tell that other resultsets are waiting on the server by trying to execute another query while not finishing with getting them all - the error message will say that you cannot execute any queries while other results are waiting.</p>
<p>Hope it is clearer for you now!
Feel free to to ask if you still have questions though.</p>              </div>
            </li>
 
            <li class="comment" id="comment-678">
              <div class="comment-author">
              	tamir, 01.04.19 21:38              </div>
              <div class="comment-body" style="overflow:hidden"><p>hi, i have problem with prepare query and the asc/desc parameter, i cant bind in the execute, i tried to catcatinate it before the query and dont manage to do it. what is the right way?</p></div>
            </li>
 
            <li class="comment" id="comment-677">
              <div class="comment-author">
              	Gavin, 01.04.19 16:27              </div>
              <div class="comment-body" style="overflow:hidden"><p>Please NEVER take this website down. It is EXTREMELY useful and concise. Thankyou</p></div>
            </li>
 
            <li class="comment" id="comment-676">
              <div class="comment-author">
              	Nedum, 30.03.19 14:33              </div>
              <div class="comment-body" style="overflow:hidden"><p>Please Sir,
While running a query, this error message came up: Unknown Character Set!
While building the DSN, I added charset=$charset to the string. And $charset = "utf8mb4" .
What did I do wrong here Please?</p>
<p>And, when I do search and retrieve pages of data, to format display pagination, is it wrong to use PDO::rowCount() in this case too?</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Nedum!</p>
<p>Most likely your database server is rather old and doean't support this rather new encoding. Use utf8 instead.</p>
<p>As of PDO::rowCount() - yes, it is gravely wrong to use it for pagination. Use SELECT COUNT(*) instead.</p>              </div>
            </li>
 
            <li class="comment" id="comment-670">
              <div class="comment-author">
              	Ali, 18.03.19 23:34              </div>
              <div class="comment-body" style="overflow:hidden"><p>Great article with great details. I spent years and years on using PDO and I learnt a lot with pain and blood, but this article still had new things for me. I wish I had read that many many years ago. Thank you!</p>
<p>However I found a paragraph in this article that somehow I think that can be misleading for beginners: </p>
<p>"An answer to a frequently asked question, "whether this function is safe to use in concurrent environment?" is positive: yes, it is safe. Being just an interface to MySQL C API mysql_insert_id() function it's perfectly safe."</p>
<p>So for Beginners, I want to rephrase this paragraph:</p>
<p>PDO::lastInsertId IS GUARANTEED to return correct ID of last inserted row in the script, even on concurrent environments, but it CAN BE harmfully dangerous and unsafe with seeded IDs (e.g. mysql's auto-increment or most pseudo randoms like rand() function) on concurrent environments IF you use it to calculate next row's ID. One should never calculate next row's ID based on previous row's ID in a concurrent environment. If you need next ID, just insert a new row in the table, and use PDO::lastInsertID to get that ID. That is because with seeded row IDs on concurrent environments like the web, collision IDs WILL happen and you end up in tears.</p>
<p>So, just to repeat it again:</p>
<ol>
<li>At first, insert a row</li>
<li>Then use PDO::lastInsertID if you need the ID of the inserted row</li>
<li>If you need the ID of next inserting row, don't calculate it from last inserted row, just go back to #1</li>
</ol></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Ali!</p>
<p>Thank you very much for such a thoughtful comment!<br>
I wholeheartedly agree with this warning, but I feel that it is a bit off topic, as it is not directly related to PDO, but to the abuse of the auto-generated identifiers in general. </p>
<p>Ho be honest, given right now am not thinking of reducing the size of the article rather than enlarging it, I am reluctant to adding any additional information not directly related to PDO. Either way this comment will remain here to warn all the readers, so thank you again for it!</p>              </div>
            </li>
 
            <li class="comment" id="comment-667">
              <div class="comment-author">
              	KK, 15.03.19 05:24              </div>
              <div class="comment-body" style="overflow:hidden"><p>How can you execute trigger queries with pdo. </p>
<p>I am using easydb and I get the following error. I have tried with and without delimiter statements and both fail.</p>
<p>Fatal error: Uncaught PDOException: SQLSTATE[HY000]: General error: 2014 Cannot execute queries while other unbuffered queries are active. Consider using PDOStatement::fetchAll(). Alternatively, if your code is only ever going to run against mysql, you may enable query buffering by setting the PDO::MYSQL_ATTR_USE_BUFFERED_QUERY attribute.</p>
<pre><code><code><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$triggerquery&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"&nbsp;CREATE&nbsp;TRIGGER&nbsp;`</span><span style="color: #0000BB">$triggername</span><span style="color: #DD0000">`&nbsp;</span><span style="color: #0000BB">$triggertime</span><span style="color: #DD0000">&nbsp;ON&nbsp;`</span><span style="color: #0000BB">$tablename</span><span style="color: #DD0000">`&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FOR&nbsp;EACH&nbsp;ROW&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BEGIN&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF(NEW.`</span><span style="color: #0000BB">$triggercol</span><span style="color: #DD0000">`&nbsp;IS&nbsp;NULL)&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;THEN&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;NEW.`</span><span style="color: #0000BB">$triggercol</span><span style="color: #DD0000">`&nbsp;=&nbsp;UNIX_TIMESTAMP();&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;IF;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"</span><span style="color: #007700">;</span><span style="color: #0000BB"></span></code></code></pre></div>
            </li>
 
            <li class="comment" id="comment-665">
              <div class="comment-author">
              	KK, 12.03.19 12:21              </div>
              <div class="comment-body" style="overflow:hidden"><p>I am using paragonies easydb pdo wrapper. but for connection errors, it displays username and pwd. i have tried using silent mode. but, no luck. is there any other way to ensure username and pwd are not used.
fyi: it uses the try catch mechanism.</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello!</p>
<p>That's a very good question.</p>
<p>The leak is coming from the way Factory::create() method is called. </p>
<p>The simplest solution would be to wrap the Factory::create() call in a try-catch, as it is used for vanilla PDO in this article:</p>
<pre><code><code><span style="color: #0000BB"></span><span style="color: #007700">try&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$db&nbsp;</span><span style="color: #007700">=&nbsp;\</span><span style="color: #0000BB">ParagonIE</span><span style="color: #007700">\</span><span style="color: #0000BB">EasyDB</span><span style="color: #007700">\</span><span style="color: #0000BB">Factory</span><span style="color: #007700">::</span><span style="color: #0000BB">create</span><span style="color: #007700">(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'mysql:host=localhost;dbname=something'</span><span style="color: #007700">,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'username'</span><span style="color: #007700">,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'putastrongpasswordhere'<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">);<br>}&nbsp;catch(</span><span style="color: #0000BB">Throwable&nbsp;$e</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;\</span><span style="color: #0000BB">Exception</span><span style="color: #007700">(</span><span style="color: #0000BB">$e</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getMessage</span><span style="color: #007700">());<br>}</span><span style="color: #0000BB"></span></code></code></pre>
<p>It will take the credential details out of the error message. </p>
<p>This method is not very clean but it's quick and it works. </p>
<p>The better solution would be to change the way Factory::create() is called, so I will reach Paragonie to discuss the matter.</p>              </div>
            </li>
 
            <li class="comment" id="comment-649">
              <div class="comment-author">
              	Silver, 21.02.19 12:23              </div>
              <div class="comment-body" style="overflow:hidden"><p>Hey,
Thanks alot for the reply! I looked into the CSRF token and I'm definetly going to be using that for my forms. Also about the third point you made, did you mean I shouldn't be giving users the ability to input/check some box in order to include some php file? or did you have something else in mind? Also thanks for the file upload part, I'll definetly go by that advice next time I am going to be working with files.</p>
<p>Silver</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Choosing a file to include based on the user input is perfectly fine. I meant you should never directly put the user ipout in include (or any other function dealing with files).</p>              </div>
            </li>
 
            <li class="comment" id="comment-646">
              <div class="comment-author">
              	Silver, 19.02.19 18:50              </div>
              <div class="comment-body" style="overflow:hidden"><p>Hey
I'm building a web application with php/sql and also js on the user's side.
I have a question regarding security, specifically about input/output sanitization.
Right now I'm using PDO with prepared statements to contact my DB (SQL) and also I am using Regex for input validation both on the server side and user side. Is there anything else I should be doing to user inputs? Secondly on the output side i understand it is needed to sanitize output with htmlspecialchars() so people can't add in "evil html code/and js" is there anything else I should look into there or is that enough for a small userbase web application? I can also add that some of the data I'm working with falls under delicate user data according to GDPR.
Sorry for the long question! :)</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Silver!</p>
<p>First of all, security is not a simple matter that can be covered in a comment. There are a lot of areas to look for.</p>
<p>But speaking of SQL injection and XSS you are taking it right. </p>
<p>Other areas to look for are (you can google up the terms)</p>
<ul>
<li>Consider adding CSRF token to your form </li>
<li>make sure you don't include any file on your site  based on user input.</li>
<li>make sure you are not using eval()</li>
<li>if you're allowing file uploads, filter uploaded files based on their extensions and rename files to your own names. </li>
</ul>
<p>that's of course not the full list, just to elaborate a bit on your question. But again, it it not a simple matter that can be covered in a comment.</p>              </div>
            </li>
 
            <li class="comment" id="comment-642">
              <div class="comment-author">
              	Dennis, 15.02.19 12:23              </div>
              <div class="comment-body" style="overflow:hidden"><p>Hello! Thank you for this site! Although a lot is very clear, there is something I can't work out. So, my problem is: How can I connect my database class with my other class which has a function insert() to start a transaction with prepared statement to start a transaction for multiple inserts...
Can you show me a example?
My Database connection class:</p>
<pre><code><code><span style="color: #0000BB"></span><span style="color: #007700">&lt;?</span><span style="color: #0000BB">php<br><br></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">DatabaseController<br></span><span style="color: #007700">{<br>private&nbsp;</span><span style="color: #0000BB">$servername</span><span style="color: #007700">;<br>private&nbsp;</span><span style="color: #0000BB">$username</span><span style="color: #007700">;<br>private&nbsp;</span><span style="color: #0000BB">$password</span><span style="color: #007700">;<br>private&nbsp;</span><span style="color: #0000BB">$dbname</span><span style="color: #007700">;<br>private&nbsp;</span><span style="color: #0000BB">$charset</span><span style="color: #007700">;<br>protected&nbsp;</span><span style="color: #0000BB">$conn</span><span style="color: #007700">;<br><br>public&nbsp;function&nbsp;</span><span style="color: #0000BB">connect</span><span style="color: #007700">()<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">servername&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"localhost"</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">username&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"root"</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">password&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">""</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">dbname&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"scores"</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">charset&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"utf8mb4"</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$options&nbsp;</span><span style="color: #007700">=&nbsp;[<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">ATTR_ERRMODE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">ERRMODE_EXCEPTION</span><span style="color: #007700">,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">ATTR_DEFAULT_FETCH_MODE&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">FETCH_ASSOC</span><span style="color: #007700">,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">ATTR_EMULATE_PREPARES&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">,<br>&nbsp;&nbsp;&nbsp;&nbsp;];<br>&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$dsn&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"mysql:host="&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">servername&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">";dbname="&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">dbname</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$conn&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">(</span><span style="color: #0000BB">$dsn</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">username</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">password</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">charset</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$options</span><span style="color: #007700">);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$conn</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(</span><span style="color: #0000BB">Exception&nbsp;$e</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"Connection&nbsp;failed:&nbsp;"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$e</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getMessage</span><span style="color: #007700">();<br><br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;}<br>}</span><span style="color: #0000BB"></span></code></code></pre></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Dennis!</p>
<p>Using the database connection is a tricky subject. There are several approaches discussed in the adjacent chapter: <a href="https://phpdelusions.net/pdo/pdo_wrapper#availability">https://phpdelusions.net/pdo/pdo_wrapper#availability</a>
It's hard to tell with one will suit you best, but at least you should make sure that there is only one connection opened and used for all database interactions during a single script runtime. Feel free to reach back if something is still unclear. </p>
<p>Also, a bit irrelevant, but I noticed some issues with your DatabaseController class. I have an article on the common issues with database classes: <a href="https://phpdelusions.net/pdo/common_mistakes">https://phpdelusions.net/pdo/common_mistakes</a>
you may find it interesting.</p>              </div>
            </li>
 
            <li class="comment" id="comment-639">
              <div class="comment-author">
              	Jerome Betareu, 12.02.19 11:46              </div>
              <div class="comment-body" style="overflow:hidden"><p>hello, the table contains over a million records. 1 record per minute for several years. No wonder the treatment times were getting longer and longer!
In short, I removed almost the entire beginning of the code to process a week of data and the processing time is now 1.24 seconds :)
Thank you very much for opening my eyes to the problem.</p></div>
            </li>
 
            <li class="comment" id="comment-638">
              <div class="comment-author">
              	Jerome Betareu, 11.02.19 20:46              </div>
              <div class="comment-body" style="overflow:hidden"><p>You are absolutely right !
I focused on the query itself but it is actually the 2 min and max queries that are not good!
Obviously the whole table is treated by the WHERE clause since $timestampmin is the timestamp of the first record of the table and $timestampmax is the last!
I will look at this tomorrow because it starts to be late (and my eyes do not see much ...)
thank you again for your precious help.</p></div>
            </li>
 
            <li class="comment" id="comment-637">
              <div class="comment-author">
              	Jerome Betareu, 11.02.19 11:09              </div>
              <div class="comment-body" style="overflow:hidden"><p>Here is the request</p>
<pre><code><code><span style="color: #0000BB">$connection&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">sql_pdo_connexion&nbsp;</span><span style="color: #007700">(</span><span style="color: #0000BB">$server</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$base</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$login</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$pass</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$timestampmin&nbsp;</span><span style="color: #007700">=&nbsp;$&nbsp;</span><span style="color: #0000BB">connection&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">query&nbsp;</span><span style="color: #007700">(</span><span style="color: #DD0000">"SELECT&nbsp;MIN&nbsp;(timestamp)&nbsp;FROM`&nbsp;</span><span style="color: #0000BB">$table_type</span><span style="color: #DD0000">`&nbsp;"</span><span style="color: #007700">)&nbsp;-&gt;&nbsp;</span><span style="color: #0000BB">fetchColumn&nbsp;</span><span style="color: #007700">();<br></span><span style="color: #0000BB">$timestampmax&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$connection&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">query&nbsp;</span><span style="color: #007700">(</span><span style="color: #DD0000">"SELECT&nbsp;MAX&nbsp;(timestamp)&nbsp;FROM`&nbsp;</span><span style="color: #0000BB">$table_type</span><span style="color: #DD0000">`&nbsp;"</span><span style="color: #007700">)&nbsp;-&gt;&nbsp;</span><span style="color: #0000BB">fetchColumn&nbsp;</span><span style="color: #007700">();<br></span><span style="color: #0000BB">$datetimedebut&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">date&nbsp;</span><span style="color: #007700">(</span><span style="color: #DD0000">'Y-m-d'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$timestampmin</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$datetimefin&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">date&nbsp;</span><span style="color: #007700">(</span><span style="color: #DD0000">'Y-m-d'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$timestampmax</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$datedebut&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">date&nbsp;</span><span style="color: #007700">(</span><span style="color: #DD0000">'Y-m-d'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$timestampdebut</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$query&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"SELECT&nbsp;timestamp,&nbsp;Tmax,&nbsp;Tmin,&nbsp;TCon,&nbsp;Ton,&nbsp;Teur,&nbsp;flag<br>FROM&nbsp;`</span><span style="color: #0000BB">$table_type</span><span style="color: #DD0000">`<br>WHERE&nbsp;timestamp&nbsp;BETWEEN&nbsp;</span><span style="color: #0000BB">$timestampdebut</span><span style="color: #DD0000">&nbsp;AND&nbsp;</span><span style="color: #0000BB">$timestampfin</span><span style="color: #DD0000"><br>ORDER&nbsp;BY&nbsp;timestamp&nbsp;"</span><span style="color: #007700">;<br><br></span><span style="color: #0000BB">$sql&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">sql_pdo_query&nbsp;</span><span style="color: #007700">(</span><span style="color: #0000BB">$connection</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$query</span><span style="color: #007700">);</span><span style="color: #0000BB"></span></code></code></pre></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Jerome</p>
<p>To me, the above code makes no sense. It looks like all the records from table are selected. You are selecting all rows between min and max value in some column - so it is effectively all the rows. What's the point of it? Why bother with WHERE condition then?</p>
<p>In case this query returns too much rows, then indeed in will take a lot of time. Any chance you could reduce the number of rows selected?</p>              </div>
            </li>
 
            <li class="comment" id="comment-636">
              <div class="comment-author">
              	Jerome Betareu, 11.02.19 11:02              </div>
              <div class="comment-body" style="overflow:hidden"><p>the code</p>
<pre><code><code><span style="color: #0000BB">$d1&nbsp;&nbsp;</span><span style="color: #007700">=&nbsp;array();<br></span><span style="color: #0000BB">$d2&nbsp;&nbsp;</span><span style="color: #007700">=&nbsp;array();<br></span><span style="color: #0000BB">$d3&nbsp;&nbsp;</span><span style="color: #007700">=&nbsp;array();<br></span><span style="color: #0000BB">$d5&nbsp;&nbsp;</span><span style="color: #007700">=&nbsp;array();<br></span><span style="color: #0000BB">$array_ON&nbsp;</span><span style="color: #007700">=&nbsp;array();<br></span><span style="color: #0000BB">$array_OFF&nbsp;</span><span style="color: #007700">=&nbsp;array();<br>while&nbsp;(</span><span style="color: #0000BB">$row&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$sql</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetch</span><span style="color: #007700">(</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">FETCH_ASSOC</span><span style="color: #007700">))&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;&nbsp;&nbsp;Execution&nbsp;in&nbsp;11&nbsp;seconds&nbsp;!&nbsp;!&nbsp;!&nbsp;!&nbsp;&nbsp;--&nbsp;very&nbsp;BAD&nbsp;!<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$t&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">'timestamp'</span><span style="color: #007700">]&nbsp;*&nbsp;</span><span style="color: #0000BB">1000</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">array_push&nbsp;</span><span style="color: #007700">(</span><span style="color: #0000BB">$d1</span><span style="color: #007700">,&nbsp;array(</span><span style="color: #0000BB">$t</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">floatval</span><span style="color: #007700">(</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">"Tmax"</span><span style="color: #007700">])));<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">array_push&nbsp;</span><span style="color: #007700">(</span><span style="color: #0000BB">$d2</span><span style="color: #007700">,&nbsp;array(</span><span style="color: #0000BB">$t</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">floatval</span><span style="color: #007700">(</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">"Tmin"</span><span style="color: #007700">])));<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">array_push&nbsp;</span><span style="color: #007700">(</span><span style="color: #0000BB">$d3</span><span style="color: #007700">,&nbsp;array(</span><span style="color: #0000BB">$t</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">floatval</span><span style="color: #007700">(</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">"TCon"</span><span style="color: #007700">])));<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">array_push&nbsp;</span><span style="color: #007700">(</span><span style="color: #0000BB">$d5</span><span style="color: #007700">,&nbsp;array(</span><span style="color: #0000BB">$t</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">floatval</span><span style="color: #007700">(</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">"Teur"</span><span style="color: #007700">])));<br>&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">floatval</span><span style="color: #007700">(</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">"flag"</span><span style="color: #007700">])&nbsp;==&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">)&nbsp;{&nbsp;</span><span style="color: #FF8000">//&nbsp;Chauffage&nbsp;OFF<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">array_push&nbsp;</span><span style="color: #007700">(</span><span style="color: #0000BB">$array_OFF&nbsp;</span><span style="color: #007700">,&nbsp;array(</span><span style="color: #0000BB">$t</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">floatval</span><span style="color: #007700">(</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">"Ton"</span><span style="color: #007700">])));<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">array_push&nbsp;</span><span style="color: #007700">(</span><span style="color: #0000BB">$array_ON&nbsp;</span><span style="color: #007700">,&nbsp;array(</span><span style="color: #0000BB">$t</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">));<br>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">array_push&nbsp;</span><span style="color: #007700">(</span><span style="color: #0000BB">$array_ON&nbsp;</span><span style="color: #007700">,&nbsp;array(</span><span style="color: #0000BB">$t</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">floatval</span><span style="color: #007700">(</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">"Ton"</span><span style="color: #007700">])));<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">array_push&nbsp;</span><span style="color: #007700">(</span><span style="color: #0000BB">$array_OFF&nbsp;</span><span style="color: #007700">,&nbsp;array(</span><span style="color: #0000BB">$t</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">));<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>}<br></span><span style="color: #0000BB">$sql</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">closeCursor</span><span style="color: #007700">();</span><span style="color: #0000BB"></span></code></code></pre>
<p>Thank you again for your help</p></div>
            </li>
 
            <li class="comment" id="comment-635">
              <div class="comment-author">
              	Jerome Betareu, 11.02.19 11:00              </div>
              <div class="comment-body" style="overflow:hidden"><p>Hello, thank you for responding quickly. After analysis of some requests it turns out that it is the extraction of the data which is extremely long. For example, the next query runs in about 1 second while data retrieval takes 11 seconds!
I know I'm abusing (a bit) and optimizing queries is not part of your post but if you could give me a solution it would be really nice. An article above would be welcome and I think that newbies like me would find very valuable information.</p></div>
            </li>
 
            <li class="comment" id="comment-633">
              <div class="comment-author">
              	Jerome Betareu, 08.02.19 13:05              </div>
              <div class="comment-body" style="overflow:hidden"><p>Hello, first of all I apologize for my english (I'm French). I am a student and I am currently working for a company that would like to take over a web site developed by another student in the past ...
in short, my knowledge of PHP are rudimentary and your site has taught me a lot but I ask myself a few questions about the obtimization of performance in the writing of PDO requests.
For example, is it possible to optimize this query in terms of CPU utilization and RAM. The site being sullied on a Raspberry PI v2, the speed of display is also an important criterium ...</p>
<pre><code><code><span style="color: #0000BB">$query</span><span style="color: #007700">=</span><span style="color: #DD0000">"SELECT&nbsp;qdate,&nbsp;DATE_FORMAT(qdate,&nbsp;'</span><span style="color: #0000BB">$dateformatsql</span><span style="color: #DD0000">')&nbsp;AS&nbsp;'periode'&nbsp;,<br>ROUND(&nbsp;((MAX(`type_1`)&nbsp;-&nbsp;MIN(`type_1`))&nbsp;/&nbsp;1000)&nbsp;,1&nbsp;)&nbsp;AS&nbsp;'type_1',<br>ROUND(&nbsp;((MAX(`type_2`)&nbsp;-&nbsp;MIN(`type_2`))&nbsp;/&nbsp;1000)&nbsp;,1&nbsp;)&nbsp;AS&nbsp;'type_2'<br>FROM&nbsp;`</span><span style="color: #0000BB">$table_type</span><span style="color: #DD0000">`<br>WHERE&nbsp;timestamp&nbsp;&gt;&nbsp;'</span><span style="color: #0000BB">$timedebut</span><span style="color: #DD0000">'<br>GROUP&nbsp;BY&nbsp;periode<br>ORDER&nbsp;BY&nbsp;qdate"&nbsp;</span><span style="color: #007700">;</span><span style="color: #0000BB"></span></code></code></pre>
<p>thank you for your reply</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Jerome!</p>
<p>This question is a bit out of the scope of this article but I'll be glad to help. I think you should make sure there is an index on the timestamp field. It's hard to tell any more without knowing the details. But you could always try to check the performance by adding EXPLAIN keyword before SELECT in your query and studying its output.</p>              </div>
            </li>
 
            <li class="comment" id="comment-630">
              <div class="comment-author">
              	William Entriken, 01.02.19 01:49              </div>
              <div class="comment-body" style="overflow:hidden"><p>Some of the " in example code are unnecessary and could be '</p></div>
            </li>
 
            <li class="comment" id="comment-626">
              <div class="comment-author">
              	Walter, 25.01.19 01:38              </div>
              <div class="comment-body" style="overflow:hidden"><p>Please help with SQL application.</p>
<p>I want to <code>Select * from  table Quotes</code>, where one or more items exist in table <code>Work Orders</code> where <code>Quotes.quote = Work Orders.quote</code> and <code>Work Orders.stat='OPEN'</code></p>
<p>I know I could do a query on table <code>Work Orders</code>, fetch column, and then feed the result into a query on table <code>Quotes,</code> but I feel like the database can do this. What is the SQL to have the database make this comparison?</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Walter!</p>
<p>Yes you are right, a database can do it. The query is almost one you wrote already, you only need to add a JOIN clause</p>
<pre><code><code><span style="color: #0000BB">SELECT&nbsp;Quotes</span><span style="color: #007700">.*&nbsp;</span><span style="color: #0000BB">FROM&nbsp;Quotes&nbsp;<br>JOIN&nbsp;</span><span style="color: #007700">`</span><span style="color: #DD0000">Work&nbsp;Orders</span><span style="color: #007700">`&nbsp;</span><span style="color: #0000BB">ON&nbsp;Quotes</span><span style="color: #007700">.</span><span style="color: #0000BB">quote&nbsp;</span><span style="color: #007700">=&nbsp;`</span><span style="color: #DD0000">Work&nbsp;Orders</span><span style="color: #007700">`.</span><span style="color: #0000BB">quote<br>WHERE&nbsp;</span><span style="color: #007700">`</span><span style="color: #DD0000">Work&nbsp;Orders</span><span style="color: #007700">`.</span><span style="color: #0000BB">stat</span><span style="color: #007700">=</span><span style="color: #DD0000">'OPEN'</span><span style="color: #0000BB"></span></code></code></pre>
<p>Stack Overflow ans Wikipedia has many great articles explaining JOIN, you may want to learn about joins there.</p>              </div>
            </li>
 
            <li class="comment" id="comment-625">
              <div class="comment-author">
              	Khangi, 24.01.19 23:29              </div>
              <div class="comment-body" style="overflow:hidden"><p>Hello, I do not see what's wrong in my request! Can you give me the solution please?</p>
<pre><code><code><span style="color: #0000BB">$stat&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'off'</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$req&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #DD0000">'UPDATE&nbsp;bus&nbsp;SET&nbsp;onoff&nbsp;=&nbsp;:onoff'</span><span style="color: #007700">);<br>&nbsp;</span><span style="color: #0000BB">$req</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">(array(</span><span style="color: #DD0000">'onoff'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$stat</span><span style="color: #007700">));&nbsp;</span><span style="color: #0000BB"></span></code></code></pre>
<p>thank you so much</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Khangi!</p>
<p>I don't see it either. Just to be sure, don't you forget to add a WHERE clause?</p>
<p>In any case, any problem with a PDO query would raise an error that should help you to find the problem</p>              </div>
            </li>
 
            <li class="comment" id="comment-622">
              <div class="comment-author">
              	Kris, 18.01.19 13:44              </div>
              <div class="comment-body" style="overflow:hidden"><p>Great article. Helped me a lot. Thanks!</p></div>
            </li>
 
            <li class="comment" id="comment-621">
              <div class="comment-author">
              	John Pierce, 17.01.19 20:13              </div>
              <div class="comment-body" style="overflow:hidden"><p>thank you very much for your super fast response!
Actually, I had thought to do like that but I thought wrong that as I had no data fields in the table I could not do it ... error!</p>
<p>it is unfortunate that no command like BOTTOM or TOP is available under SQL, it would facilitate many things ... :)
Thx</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello John!</p>
<p>I must warn you in this regard again, because if you think that using BOTTOM or TOP would facilitate many things you are probably doing something wrong. </p>
<p>And your UPDATE query is the example. If you want to update the "last record" than you definitely doing it wrong. To update a record you must know for certain which particular record you want to update, not just a relative position. If you can explain why do you need this update I will tell you ow to do it right</p>              </div>
            </li>
 
            <li class="comment" id="comment-620">
              <div class="comment-author">
              	John Pierce, 17.01.19 19:10              </div>
              <div class="comment-body" style="overflow:hidden"><p>I will have another question about UPDATE.
How to formulate the query to modify only the last record of the table?
Of course, there are no ID fields in this table, only a primary key.
thx</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello John.</p>
<p>At least for mysql, there is no way to tell "the last" record, unless you have a field designated for this purpose. So I would recommend either an auto_incremented id, or at least a datetime field that would hold the time when the row was added. </p>
<p>Besides, "the last" is too clumsy a description, you must know the exact key for the row you need to update. Other wise a race condition may ruin your operation</p>              </div>
            </li>
 
            <li class="comment" id="comment-619">
              <div class="comment-author">
              	John Pierce, 17.01.19 19:05              </div>
              <div class="comment-body" style="overflow:hidden"><p>Hello, by doing some research I found your site which unfortunately did not answer to my problem.
I would like to UPDATE a table looking for a particular record using WHERE but obviously my syntax should not be correct.
Can you help me please ?</p>
<pre><code><code><span style="color: #0000BB">$data&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"pierce"</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$req&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$con</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare&nbsp;</span><span style="color: #007700">(</span><span style="color: #DD0000">"UPDATE&nbsp;contact&nbsp;SET<br>bic&nbsp;=:&nbsp;bic,<br>orson&nbsp;=:&nbsp;orson,<br>country&nbsp;=:&nbsp;country,<br>code&nbsp;=:&nbsp;code,<br>wash&nbsp;=:&nbsp;wash<br>WHERE&nbsp;name&nbsp;=&nbsp;</span><span style="color: #0000BB">$data</span><span style="color: #DD0000">"</span><span style="color: #007700">);<br><br>&nbsp;</span><span style="color: #0000BB">$req</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">execute&nbsp;</span><span style="color: #007700">(array&nbsp;(<br>&nbsp;</span><span style="color: #DD0000">'bic'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$bic</span><span style="color: #007700">,<br>&nbsp;</span><span style="color: #DD0000">'orson'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$orson</span><span style="color: #007700">,<br>&nbsp;</span><span style="color: #DD0000">'country'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$country</span><span style="color: #007700">,<br>&nbsp;</span><span style="color: #DD0000">'code'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$code</span><span style="color: #007700">,<br>&nbsp;</span><span style="color: #DD0000">'wash'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$wash</span><span style="color: #007700">));</span><span style="color: #0000BB"></span></code></code></pre>
<p>The request is executed but the table is not modified!
Can you tell me how to implement this please?
WHERE name = $data</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello John!</p>
<p>Well, the answer is written on this very page, although I admit it is not that explicit as should be:</p>
<blockquote>
<p>So, for every query you run, if at least one variable is going to be used, you have to substitute it with a placeholder, then prepare your query, and then execute it, passing variables separately.</p>
</blockquote>
<p>It meand that <strong>every single variable</strong> should be substituted with a placeholder and then go into execute:</p>
<pre><code><code><span style="color: #0000BB">$data&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"pierce"</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$req&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$con</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare&nbsp;</span><span style="color: #007700">(</span><span style="color: #DD0000">"UPDATE&nbsp;contact&nbsp;SET<br>bic&nbsp;=&nbsp;:bic,<br>orson&nbsp;=&nbsp;:orson,<br>country&nbsp;=&nbsp;:country,<br>code&nbsp;=&nbsp;:code,<br>wash&nbsp;=&nbsp;:wash<br>WHERE&nbsp;name&nbsp;=&nbsp;:data"</span><span style="color: #007700">);<br><br>&nbsp;</span><span style="color: #0000BB">$req</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">execute&nbsp;</span><span style="color: #007700">(array&nbsp;(<br>&nbsp;</span><span style="color: #DD0000">'bic'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$bic</span><span style="color: #007700">,<br>&nbsp;</span><span style="color: #DD0000">'orson'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$orson</span><span style="color: #007700">,<br>&nbsp;</span><span style="color: #DD0000">'country'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$country</span><span style="color: #007700">,<br>&nbsp;</span><span style="color: #DD0000">'code'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$code</span><span style="color: #007700">,<br>&nbsp;</span><span style="color: #DD0000">'wash'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$wash</span><span style="color: #007700">,<br>&nbsp;</span><span style="color: #DD0000">'data'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$data</span><span style="color: #007700">,<br>));</span><span style="color: #0000BB"></span></code></code></pre>
<p>In you current form the query is not executed but rather produces an error, due to that $data veriable i the query and also a space between a colon and a placeholder name (it should be :bic, not :bic). </p>
<p>I fixed these issues in your code and now it should work.</p>              </div>
            </li>
 
            <li class="comment" id="comment-615">
              <div class="comment-author">
              	Haseeb khan, 01.01.19 12:37              </div>
              <div class="comment-body" style="overflow:hidden"><p>i want a to select data between two dates using pdo
here is the column value (12/31/2018 6:25:21 PM)</p></div>
            </li>
 
            <li class="comment" id="comment-611">
              <div class="comment-author">
              	momo, 24.12.18 09:54              </div>
              <div class="comment-body" style="overflow:hidden"><p>Can you teach me how to search for my question?</p>
<p>My question is:
I did this:</p>
<pre><code><code><span style="color: #0000BB">$statement&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #DD0000">'select&nbsp;*&nbsp;from&nbsp;mytodo.todos'</span><span style="color: #007700">);</span><span style="color: #0000BB"></span></code></code></pre>
<p>However, only by luck did I try to qualify my todos table with its database mytodo and see that when I</p>
<pre><code><code><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">$statement</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetchAll</span><span style="color: #007700">());</span><span style="color: #0000BB"></span></code></code></pre>
<p>there is anything but an empty array. </p>
<p>I was adding to this table, and on my sql gui I could see they were adding, and same with the sql terminal, yet the fetchAll array was empty when I neglected the <code>mytodo.</code> part.</p>
<p>If I didn't have luck, what search terms could I have entered on search engines to tell me that I need to do that prepending of the database name to my column? </p>
<p>I'm following these beginner PHP videos on laracast, and quite a few times copying the exact thing in the video doesn't seem to work (I'm on PHP 7.2 with MySQL8, that itself was not smooth to set up with all the troubleshooting the "caching_sha2_password" stuff), so I've been searching a lot from the beginning. Couldn't search for the right term for this problem I had and I'm scared once I progress to bigger errors, I wouldn't be able to find my way out! </p>
<p>Thanks</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello momo</p>
<p>I don't know if it's your case, but only prepare() is not enough. You must always execute a prepared query to get the results. </p>
<p>As of searching the answer, I would probably search for the basic PDO select example and follow it attentively.   </p>
<p>However, if it works only if you add mytodo. part, it simply means that you are connection to some other database and natuarally you have to denote the database yoiu want to work with in the query.</p>
<p>Searching would be straightforward, something like my query works only if I add database to the table name</p>              </div>
            </li>
 
            <li class="comment" id="comment-599">
              <div class="comment-author">
              	Gio, 11.12.18 03:06              </div>
              <div class="comment-body" style="overflow:hidden"><p>Hi,
any compliment is superfluous.
A question fi possible,
I have some difficulties to run a query LIKE :</p>
<pre><code><code><span style="color: #0000BB">SELECT&nbsp;id&nbsp;FROM&nbsp;table&nbsp;WHERE&nbsp;id&nbsp;</span><span style="color: #007700">=&nbsp;:</span><span style="color: #0000BB">id&nbsp;</span><span style="color: #007700">AND&nbsp;</span><span style="color: #0000BB">catalog&nbsp;LIKE&nbsp;</span><span style="color: #007700">?</span></code></code></pre>
<p>suggestions ?</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Gio!</p>
<p>You cannot use positional and named placeholders in the same query</p>
<p>So it should be either</p>
<pre><code><code><span style="color: #0000BB">SELECT&nbsp;id&nbsp;FROM&nbsp;table&nbsp;WHERE&nbsp;id&nbsp;</span><span style="color: #007700">=&nbsp;:</span><span style="color: #0000BB">id&nbsp;</span><span style="color: #007700">AND&nbsp;</span><span style="color: #0000BB">catalog&nbsp;LIKE&nbsp;</span><span style="color: #007700">:</span><span style="color: #0000BB">text</span></code></code></pre>
<p>or </p>
<pre><code><code><span style="color: #0000BB">SELECT&nbsp;id&nbsp;FROM&nbsp;table&nbsp;WHERE&nbsp;id&nbsp;</span><span style="color: #007700">=&nbsp;?&nbsp;AND&nbsp;</span><span style="color: #0000BB">catalog&nbsp;LIKE&nbsp;</span><span style="color: #007700">?</span></code></code></pre>              </div>
            </li>
 
            <li class="comment" id="comment-598">
              <div class="comment-author">
              	gratefulHacker, 09.12.18 16:33              </div>
              <div class="comment-body" style="overflow:hidden"><p>Just want to say thank you for your articles. They have been incredibly informative and helpful.</p></div>
            </li>
 
            <li class="comment" id="comment-593">
              <div class="comment-author">
              	Chris S, 23.11.18 20:32              </div>
              <div class="comment-body" style="overflow:hidden"><p>I'm not sure if it's possible to reply to a reply here for us regular peons, but thank you for your quick and very thorough reply (and I apologize for starting a new comment thread if it's possible to reply to my own). That was an extremely helpful response. </p>
<p>To be honest, I actually always saw the backticks used elsewhere and had no idea the purpose... "what an unnecessary, and ugly-looking thing to do", I thought. I come from a professional Oracle background, so MySQL is "familiar", but not second nature. It wasn't until reading this (fantastic) article that I learned what those backticks are for. Thank you!</p>
<p>I'll go update my code to use the backticks, just in case. And yeah, sorry, "user input" wasn't a very descriptive term to use, but I can say that yes, everything is hardcoded. I definitely would not be using any reserved words in table names, but I like the idea of just following good standards, and doing that early on enough in development (which is the case here) and sticking to them throughout any coding I do. So, off I go to fix it all up!</p>
<p>Thanks again. I can't stress just how much I learned from this article already.</p></div>
            </li>
 
            <li class="comment" id="comment-592">
              <div class="comment-author">
              	Chris S, 22.11.18 22:45              </div>
              <div class="comment-body" style="overflow:hidden"><p>I'm a little confused on whether I need to worry about escaping/backticking my table names in querying/DDL statements.</p>
<p>My table names are all constants, stored in a constants php file so that if I ever change things like schema name or something like that, I have one central place to update. So for example, I have a constant defined like so:</p>
<pre><code><code><span style="color: #0000BB">DEFINE</span><span style="color: #007700">(</span><span style="color: #DD0000">'NS_TBL_PLAYERS'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'NS_PLAYERS'</span><span style="color: #007700">);</span><span style="color: #0000BB"></span></code></code></pre>
<p>So in my code I may do something like:</p>
<pre><code><code><span style="color: #0000BB">$sql&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"SELECT&nbsp;column1&nbsp;from&nbsp;"</span><span style="color: #007700">.</span><span style="color: #0000BB">NS_TBL_PLAYERS</span><span style="color: #007700">.</span><span style="color: #DD0000">"&nbsp;WHERE&nbsp;id&nbsp;=&nbsp;:player_id"</span><span style="color: #007700">;<br></span><span style="color: #0000BB">stmt&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #0000BB">$sql</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">bindValue</span><span style="color: #007700">(</span><span style="color: #DD0000">":id"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$player_id</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">PARAM_INT</span><span style="color: #007700">);<br>if&nbsp;(</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">())&nbsp;{..&nbsp;</span><span style="color: #0000BB">yada&nbsp;yada</span><span style="color: #007700">..</span><span style="color: #0000BB"></span></code></code></pre>
<p>My syntax above might be a little off.. part of that is by memory, but that's not the point of my qustion. , I'm just wondering if I open myself to SQL injection by doing the table dynamically like above, without any backticking/escaping or anything. A user has no input whatsoever into what "NS_TBL_PLAYERS" is... that all comes from "constants.php" file I have on the server. So I assume that unless they somehow gain access to that file to update it (in which case I probably have bigger worries) the above code is safe?</p>
<p>Thanks for your time and advice, and this article ((The only proper) PDO tutorial) is incredibly well done.</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Chris!</p>
<p>That's a really good question.</p>
<p>From the SQL injection point of view, rules are simple:</p>
<ol>
<li>All data must be supplied though a placeholder.</li>
<li>All other parts of the query must be hard-coded in your script.</li>
</ol>
<p>So as far as I can see, your code follows the rules, therefore there is no problem.</p>
<p>However, from the correct SQL syntax point of view there could be a problem. Your table name could be an SQL reserved word or an incorrect syntax (contain a space or a hyphen for example) so it's much better to enclose it in backticks, just in case. So the only difference I would make is</p>
<pre><code><code><span style="color: #0000BB">$sql&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"SELECT&nbsp;column1&nbsp;from&nbsp;`"</span><span style="color: #007700">.</span><span style="color: #0000BB">NS_TBL_PLAYERS</span><span style="color: #007700">.</span><span style="color: #DD0000">"`&nbsp;WHERE&nbsp;id&nbsp;=&nbsp;:player_id"</span><span style="color: #007700">;</span><span style="color: #0000BB"></span></code></code></pre>
<p>And it should be OK. </p>
<p>Whereas you need to worry about escaping/backticking only if your query parts are coming from the user side (field names for example). In this case you must choose them from a whitelist - so effectively it will make them hardcoded and thus immune to injection.</p>
<p>I would also avoid the "user input" term as being quite vague and uncertain. A "hardcoded value" is much better to me, as you can always be certain, whether it's written in your code or not. If not - then ot hould be added to the query through a placeholder. </p>
<p>Hope this long and winding rant would be of any value for you! :)</p>              </div>
            </li>
 
            <li class="comment" id="comment-581">
              <div class="comment-author">
              	Harachi, 12.11.18 20:09              </div>
              <div class="comment-body" style="overflow:hidden"><p>Hello, thank you for this excellent articles that filled a lot of my shortcomings.
unfortunately there is still a lot and if you want to fill another ... :)</p>
<p>I am stuck in my development because I can not use the min and max functions in a select with a limit. Visibly, 'limit' is incompatible with these 2 functions but there may be a trick ...
here is my code:</p>
<pre><code><code><span style="color: #0000BB">$query&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'SELECT&nbsp;MAX(price)&nbsp;AS&nbsp;Pmax&nbsp;,&nbsp;MIN(price)&nbsp;AS&nbsp;Pmin&nbsp;FROM&nbsp;book&nbsp;ORDER&nbsp;BY&nbsp;timestamp&nbsp;DESC&nbsp;LIMIT&nbsp;0,10'</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$sql&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">sql_pdo_query</span><span style="color: #007700">(</span><span style="color: #0000BB">$connexion</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$query</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$row&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$sql</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetch</span><span style="color: #007700">(</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">FETCH_ASSOC</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$Pmax&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">'Pmax'</span><span style="color: #007700">];<br></span><span style="color: #0000BB">$Pmin&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">'Pmin'</span><span style="color: #007700">];<br>echo&nbsp;</span><span style="color: #0000BB">$Pmin</span><span style="color: #007700">.</span><span style="color: #DD0000">'&nbsp;'</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$Pmax</span><span style="color: #007700">;</span><span style="color: #0000BB"></span></code></code></pre>
<p>I also tested with this code:</p>
<pre><code><code><span style="color: #0000BB">$Pmax&nbsp;</span><span style="color: #007700">=&nbsp;(float)</span><span style="color: #0000BB">current</span><span style="color: #007700">(</span><span style="color: #0000BB">$connexion</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">"SELECT&nbsp;price&nbsp;FROM&nbsp;book&nbsp;ORDER&nbsp;BY&nbsp;timestamp&nbsp;DESC&nbsp;LIMIT&nbsp;0,10"</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">fetch</span><span style="color: #007700">());<br></span><span style="color: #0000BB">$Pmin&nbsp;</span><span style="color: #007700">=&nbsp;(float)</span><span style="color: #0000BB">current</span><span style="color: #007700">(</span><span style="color: #0000BB">$connexion</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">"SELECT&nbsp;price&nbsp;FROM&nbsp;book&nbsp;ORDER&nbsp;BY&nbsp;timestamp&nbsp;ASC&nbsp;LIMIT&nbsp;0,10"</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">fetch</span><span style="color: #007700">());<br>echo&nbsp;</span><span style="color: #DD0000">'Pmax&nbsp;=&nbsp;'</span><span style="color: #007700">.</span><span style="color: #0000BB">$Pmax&nbsp;</span><span style="color: #007700">.</span><span style="color: #DD0000">'&nbsp;'</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">'Pmin&nbsp;=&nbsp;'</span><span style="color: #007700">.</span><span style="color: #0000BB">$Pmin</span><span style="color: #007700">;</span><span style="color: #0000BB"></span></code></code></pre>
<p>with this code I would like the min and the max of the last 10 records of my database but obviously as soon as 'limit' is used the returned values are not good!
Do you have a way of doing that works please?
Thank you for your help</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Harachi!</p>
<p>Thank you for the good question.</p>
<p>Your queries don't work because LIMIT is indeed incompatible with the way you are using min and max. SQL operators work from left to right, so min and max are taken from the entire table ordered by timestamp, and then <em>only one row returned</em> gets limited to 10 rows.</p>
<p>The simplest solution would be to add a sub-query (not tested):</p>
<pre><code><code><span style="color: #0000BB">SELECT&nbsp;MAX</span><span style="color: #007700">(</span><span style="color: #0000BB">price</span><span style="color: #007700">)&nbsp;AS&nbsp;</span><span style="color: #0000BB">Pmax&nbsp;</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">MIN</span><span style="color: #007700">(</span><span style="color: #0000BB">price</span><span style="color: #007700">)&nbsp;AS&nbsp;</span><span style="color: #0000BB">Pmin&nbsp;<br>FROM&nbsp;</span><span style="color: #007700">(</span><span style="color: #0000BB">SELECT&nbsp;price&nbsp;FROM&nbsp;book&nbsp;ORDER&nbsp;BY&nbsp;timestamp&nbsp;DESC&nbsp;LIMIT&nbsp;0</span><span style="color: #007700">,</span><span style="color: #0000BB">10</span><span style="color: #007700">)&nbsp;as&nbsp;</span><span style="color: #0000BB">t</span><span style="color: #007700">;</span><span style="color: #0000BB"></span></code></code></pre>
<p>Also note that the way you are taking a single value from the query is rather peculiar, given PDO has a method for that already:</p>
<pre><code><code><span style="color: #0000BB">$Pmax&nbsp;</span><span style="color: #007700">=&nbsp;(float)</span><span style="color: #0000BB">$connexion</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">"SELECT&nbsp;..."</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">fetchColumn</span><span style="color: #007700">();</span><span style="color: #0000BB"></span></code></code></pre>              </div>
            </li>
 
            <li class="comment" id="comment-576">
              <div class="comment-author">
              	Zeef75, 06.11.18 23:37              </div>
              <div class="comment-body" style="overflow:hidden"><p>Hello, certainly off topic but I start ...
Already, very good article on PDO, I learned a lot.
My problem is that I have to resume a development written in C CLI that I have to adapt to the PDO. Of course I can not find any documentation.
Would you be so kind as to indicate a URL or can I find this information?</p>
<p>for example, how to program this function?</p>
<pre><code><code><span style="color: #0000BB">int&nbsp;readconfig&nbsp;</span><span style="color: #007700">()<br>{<br></span><span style="color: #0000BB">MYSQL&nbsp;mysql</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">mysql_init&nbsp;</span><span style="color: #007700">(&amp;&nbsp;</span><span style="color: #0000BB">mysql</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">mysql_options&nbsp;</span><span style="color: #007700">(&amp;&nbsp;</span><span style="color: #0000BB">mysql</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">MYSQL_READ_DEFAULT_GROUP</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"option"</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">mysql_real_connect&nbsp;</span><span style="color: #007700">(&amp;&nbsp;</span><span style="color: #0000BB">mysql</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">mysql_host</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">mysql_login</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">mysql_pwd</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">mysql_db</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">NULL</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">))&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">mysql_query&nbsp;</span><span style="color: #007700">(&amp;&nbsp;</span><span style="color: #0000BB">mysql</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"SELECT&nbsp;*&nbsp;FROM&nbsp;Netwho"</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">MYSQL_RES&nbsp;</span><span style="color: #007700">*&nbsp;</span><span style="color: #0000BB">result&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">NULL</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">MYSQL_ROW&nbsp;row</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">result&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">mysql_use_result&nbsp;</span><span style="color: #007700">(&amp;&nbsp;</span><span style="color: #0000BB">mysql</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;((</span><span style="color: #0000BB">row&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">mysql_fetch_row&nbsp;</span><span style="color: #007700">(</span><span style="color: #0000BB">result</span><span style="color: #007700">)))&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">Tconsign_p&nbsp;</span><span style="color: #007700">=&nbsp;(float)&nbsp;</span><span style="color: #0000BB">atof&nbsp;</span><span style="color: #007700">(</span><span style="color: #0000BB">row&nbsp;</span><span style="color: #007700">[</span><span style="color: #0000BB">0</span><span style="color: #007700">]);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">Tconsign_c&nbsp;</span><span style="color: #007700">=&nbsp;(float)&nbsp;</span><span style="color: #0000BB">atof&nbsp;</span><span style="color: #007700">(</span><span style="color: #0000BB">row&nbsp;</span><span style="color: #007700">[</span><span style="color: #0000BB">1</span><span style="color: #007700">]);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">mysql_free_result&nbsp;</span><span style="color: #007700">(</span><span style="color: #0000BB">result</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">mysql_close&nbsp;</span><span style="color: #007700">(&amp;&nbsp;</span><span style="color: #0000BB">mysql</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">syslog&nbsp;</span><span style="color: #007700">(</span><span style="color: #0000BB">LOG_INFO</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"ERROR"</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">;<br>}</span><span style="color: #0000BB"></span></code></code></pre>
<p>With my thanks</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Zeef!</p>
<p>That's a standard Mysql C API. To rewrite it to PHP/PDO, you basically need this:</p>
<pre><code><code><span style="color: #0000BB"></span><span style="color: #007700">function&nbsp;</span><span style="color: #0000BB">readconfig&nbsp;</span><span style="color: #007700">(</span><span style="color: #0000BB">$pdo</span><span style="color: #007700">)<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;global&nbsp;</span><span style="color: #0000BB">$Tconsign_p</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$Tconsign_c</span><span style="color: #007700">;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$stmt&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">"SELECT&nbsp;*&nbsp;FROM&nbsp;Netwho"</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;((</span><span style="color: #0000BB">$row&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetch</span><span style="color: #007700">(</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">FETCH_NUM</span><span style="color: #007700">)))&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$Tconsign_p&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$row&nbsp;</span><span style="color: #007700">[</span><span style="color: #0000BB">0</span><span style="color: #007700">];<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$Tconsign_c&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #0000BB">1</span><span style="color: #007700">];<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>}</span><span style="color: #0000BB"></span></code></code></pre>
<p>note that the function is called with a parameter $pdo, which should be a valid <a href="https://phpdelusions.net/pdo_examples/connect_to_mysql">PDO instance</a> created before.</p>
<p>The function is written to the best of my C knowledge (which is very limited), so it could be wrong.
Feel free to ask any questions, I'll be happy to help.</p>              </div>
            </li>
 
            <li class="comment" id="comment-571">
              <div class="comment-author">
              	Ezeribe Adolf, 30.10.18 02:51              </div>
              <div class="comment-body" style="overflow:hidden"><p>Please accept my gratitude for your kindness and willingness to take questions and sacrifice your time for me and a host of others.
My question:
In the Catch Block, following the $pdo instantiation, a backslash preceded the PDOException. What role is the slash performing there?</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Adolf!</p>
<p>Thank you for your kind words!</p>
<p>A backslash here denotes a <a href="http://php.net/manual/en/language.namespaces.php">namespace</a> - a relatively new concept in PHP. </p>
<p>It does not affect your code if you don't use namespaces but prevents an error/confusion if you do. Basically all PHP built-in classes are in the root namespace, so just a single backslash means - the root namespace.</p>              </div>
            </li>
 
            <li class="comment" id="comment-564">
              <div class="comment-author">
              	Madapakas, 11.10.18 18:56              </div>
              <div class="comment-body" style="overflow:hidden"><p>Hello Thanks for PDO Examples :D Very Helpful &lt;3</p></div>
            </li>
 
            <li class="comment" id="comment-558">
              <div class="comment-author">
              	Najam, 28.09.18 15:19              </div>
              <div class="comment-body" style="overflow:hidden"><p>That is one fine article about PDO. Thanks a million.</p></div>
            </li>
 
            <li class="comment" id="comment-550">
              <div class="comment-author">
              	moose, 14.09.18 01:03              </div>
              <div class="comment-body" style="overflow:hidden"><p>$opt does not equal $options, see below.</p>
<pre><code><code><span style="color: #0000BB">$opt&nbsp;</span><span style="color: #007700">=&nbsp;[<br></span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">ATTR_ERRMODE&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">ERRMODE_EXCEPTION</span><span style="color: #007700">,<br></span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">ATTR_DEFAULT_FETCH_MODE&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">FETCH_ASSOC</span><span style="color: #007700">,<br></span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">ATTR_EMULATE_PREPARES&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">,</span><span style="color: #0000BB"></span></code></code></pre>
<p>];</p>
<p>try {
$pdo = new PDO($dsn, $user, $pass, $options);
}</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello moose!</p>
<p>Thank you very much, fixed!</p>              </div>
            </li>
 
            <li class="comment" id="comment-542">
              <div class="comment-author">
              	Joseph Milumbe, 02.09.18 23:46              </div>
              <div class="comment-body" style="overflow:hidden"><p>Can you make a PDF version of this walk-through?</p></div>
            </li>
 
            <li class="comment" id="comment-535">
              <div class="comment-author">
              	Jeff, 14.08.18 04:22              </div>
              <div class="comment-body" style="overflow:hidden"><p>You're doing god's work.</p></div>
            </li>
 
            <li class="comment" id="comment-530">
              <div class="comment-author">
              	Stephen Austin, 07.08.18 18:28              </div>
              <div class="comment-body" style="overflow:hidden"><p>I am a novice.
I want to build a scoring application for a 'cricket' sports match which will involve a lot of real time inserting recalculation and updating and outputting.
I've set up WampServer, I know I can build the Database and tables.
Because of all the good things I've heard about PDO and because I will need to be connected to Mysql for about six hours straight,
My question is,
Do you think that this is the best or a good way to approach such a project. (Software wise)?</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Stephen!</p>
<p>Yes, of course, PDO is the best API a novice could choose. </p>
<p>Please note that unless you are using websockets, there won't be a constant connection to a database. By default, PHP processes are atomic, a request initiated from a browser makes a php script run, return the requested data, and die. So it connects to a database every time. A very good and simple model.</p>              </div>
            </li>
 
            <li class="comment" id="comment-529">
              <div class="comment-author">
              	Jeff Hawkins, 02.08.18 01:59              </div>
              <div class="comment-body" style="overflow:hidden"><p>Great stuff, but... I've posted a question at stackexchange for "PHP 7.2.8 PDO Fails to Connect to MySQL 8.0.12" that you may be interested in:
<a href="https://serverfault.com/questions/924367/php-7-2-8-pdo-fails-to-connect-to-mysql-8-0-12-ga-in-aws-ec2-lemp-stack">https://serverfault.com/questions/924367/php-7-2-8-pdo-fails-to-connect-to-mysql-8-0-12-ga-in-aws-ec2-lemp-stack</a></p>
<p>In short, I used your advice above to write code more than a year ago, that has worked great with PHP 7.0 and MySQL 5.7. But though all other connections that I can think of to this MySQL work, PHP will not connect. Have tried many things so far. Wondering if you will have better ideas.</p>
<p>Thanks much.</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Jeff!</p>
<p>Glad you got your case resolved.
I had no idea of this issue and had nothing to offer but now I see it was resolved.</p>              </div>
            </li>
 
            <li class="comment" id="comment-523">
              <div class="comment-author">
              	Benedict, 23.07.18 19:07              </div>
              <div class="comment-body" style="overflow:hidden"><p>This is tutorial is superb. I would advice that you compile this into a book.</p></div>
            </li>
 
            <li class="comment" id="comment-517">
              <div class="comment-author">
              	Henry, 22.06.18 20:47              </div>
              <div class="comment-body" style="overflow:hidden"><p>When is it OK NOT to use parameter binding, and when should you REALLY use it?  Use when there is user input, or data being passed from one page to another (PHP)?  Don't need to use when getting data within the same code page without any input except for the code itself?  Would appreciate our opinion.  Thanks!</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Henry!</p>
<p>Thank you for the good question. There is indeed too much misunderstanding in the matter. So let's make it straight:</p>
<p>In the article it is explicitly stated as:</p>
<blockquote>
<p><strong>for every query you run, if at least one variable is going to be used, you have to substitute it with a placeholder, then prepare your query, and then execute it, passing variables separately</strong></p>
</blockquote>
<p>Notice that there is <strong>not a single condition</strong> you mentioned in your comment like "user input", "data within the same code page" and such. Simply because all these terms are essentially vague and uncertain. There is no certain definition  for "user input". Different people take it differently, with catastrophic results. The moment you start separating the seep from the goat, the "clean" data from "unclean", the moment you are making your first step to disaster. </p>
<p>Remember, every application evolves over time. And something that has been hardcoded for ten years, one day becomes dynamically changed and dangerous. Why take chances? Why base your decision empty musings instead of following one simple rule - any variable that goes into query should be substituted with a placeholder, regardless of the source.</p>              </div>
            </li>
 
            <li class="comment" id="comment-515">
              <div class="comment-author">
              	Erik, 20.06.18 14:10              </div>
              <div class="comment-body" style="overflow:hidden"><p>user interface for upload a photo</p>
<pre><code><code><span style="color: #0000BB"></span><span style="color: #007700">&lt;</span><span style="color: #0000BB">div&nbsp;</span><span style="color: #007700">class=</span><span style="color: #DD0000">"col-md-3"</span><span style="color: #007700">&gt;<br>&lt;</span><span style="color: #0000BB">form&nbsp;</span><span style="color: #007700">class=</span><span style="color: #DD0000">"form-group"&nbsp;</span><span style="color: #0000BB">method</span><span style="color: #007700">=</span><span style="color: #DD0000">"POST"&nbsp;</span><span style="color: #0000BB">enctype</span><span style="color: #007700">=</span><span style="color: #DD0000">"multipart/data-form"</span><span style="color: #007700">&gt;<br>&lt;</span><span style="color: #0000BB">label&nbsp;</span><span style="color: #007700">for=</span><span style="color: #DD0000">"avatar"</span><span style="color: #007700">&gt;</span><span style="color: #0000BB">Upload&nbsp;Avatar</span><span style="color: #007700">&lt;/</span><span style="color: #0000BB">label</span><span style="color: #007700">&gt;<br>&lt;</span><span style="color: #0000BB">input&nbsp;type</span><span style="color: #007700">=</span><span style="color: #DD0000">"file"&nbsp;</span><span style="color: #0000BB">name</span><span style="color: #007700">=</span><span style="color: #DD0000">"avatar"&nbsp;</span><span style="color: #007700">class=</span><span style="color: #DD0000">"form-control"&nbsp;</span><span style="color: #0000BB">required</span><span style="color: #007700">&gt;<br>&lt;</span><span style="color: #0000BB">p&nbsp;</span><span style="color: #007700">class=</span><span style="color: #DD0000">"help-block"</span><span style="color: #007700">&gt;</span><span style="color: #0000BB">we&nbsp;accepted&nbsp;2&nbsp;mb&nbsp;file&nbsp;only</span><span style="color: #007700">!!&lt;/</span><span style="color: #0000BB">p</span><span style="color: #007700">&gt;<br>&lt;</span><span style="color: #0000BB">input&nbsp;type</span><span style="color: #007700">=</span><span style="color: #DD0000">"submit"&nbsp;</span><span style="color: #0000BB">name</span><span style="color: #007700">=</span><span style="color: #DD0000">"upload"&nbsp;</span><span style="color: #0000BB">value</span><span style="color: #007700">=</span><span style="color: #DD0000">"Upload&nbsp;Avatar"</span><span style="color: #007700">&gt;</span><span style="color: #0000BB"></span></code></code></pre>
<p>for transaction</p>
<pre><code><code><span style="color: #0000BB"></span><span style="color: #007700">if(isset(</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">'upload'</span><span style="color: #007700">])){<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$file&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$_FILES</span><span style="color: #007700">[</span><span style="color: #DD0000">"avatar"</span><span style="color: #007700">][</span><span style="color: #DD0000">"tmp_name"</span><span style="color: #007700">];<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$dir&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"upload/"</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$path&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$dir</span><span style="color: #007700">.</span><span style="color: #0000BB">$file</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;if(</span><span style="color: #0000BB">move_uploaded_file</span><span style="color: #007700">(</span><span style="color: #0000BB">$path</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$dir</span><span style="color: #007700">)){;<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$db</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">setAttribute</span><span style="color: #007700">(</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">ATTR_ERRMODE</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">ERRMODE_EXCEPTION</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$user_id&nbsp;</span><span style="color: #007700">=&nbsp;(int)</span><span style="color: #0000BB">$_SESSION</span><span style="color: #007700">[</span><span style="color: #DD0000">'namauser'</span><span style="color: #007700">];<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$insert_photo&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$db</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">"SELECT&nbsp;*&nbsp;FROM&nbsp;member&nbsp;WHERE&nbsp;namauser&nbsp;=&nbsp;'"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$_SESSION</span><span style="color: #007700">[</span><span style="color: #DD0000">'namauser'</span><span style="color: #007700">]&nbsp;.&nbsp;</span><span style="color: #DD0000">"'"</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$sql&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$db</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">"INSERT&nbsp;INTO&nbsp;avatar&nbsp;VALUES&nbsp;('0',&nbsp;'</span><span style="color: #0000BB">$path</span><span style="color: #DD0000">',&nbsp;'</span><span style="color: #0000BB">$user_id</span><span style="color: #DD0000">',&nbsp;NOW())"</span><span style="color: #007700">);<br>}else{<br>&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">'&lt;script&nbsp;type="text/javascript"&gt;alert("Sorry,&nbsp;the&nbsp;data&nbsp;cannot&nbsp;be&nbsp;processed");&lt;/script&gt;'</span><span style="color: #007700">;<br>}<br>}<br>&lt;/</span><span style="color: #0000BB">form</span><span style="color: #007700">&gt;</span><span style="color: #0000BB"></span></code></code></pre>
<p>// this part of user profile picture preview</p>
<pre><code><code><span style="color: #0000BB"></span><span style="color: #007700">&lt;</span><span style="color: #0000BB">div&nbsp;</span><span style="color: #007700">class=</span><span style="color: #DD0000">"col-md-6"</span><span style="color: #007700">&gt;<br>&lt;?</span><span style="color: #0000BB">php<br>&nbsp;&nbsp;&nbsp;&nbsp;$ambilphoto&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$db</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">"SELECT&nbsp;*&nbsp;FROM&nbsp;avatar"</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$photo&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$ambilphoto</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetch</span><span style="color: #007700">(</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">FETCH_ASSOC</span><span style="color: #007700">);<br></span><span style="color: #0000BB">?&gt;<br></span>&lt;h2&nbsp;class="text-center&nbsp;text-muted"&gt;Apakah&nbsp;ini&nbsp;photo&nbsp;anda?&lt;/h2&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;img&nbsp;src="<span style="color: #0000BB">&lt;?=$photo</span><span style="color: #007700">[</span><span style="color: #DD0000">'avatar'</span><span style="color: #007700">]</span><span style="color: #0000BB">?&gt;</span>"&nbsp;class="img-responsive"&nbsp;style="width:5<br>&nbsp;&nbsp;&nbsp;&nbsp;0%;&nbsp;height:auto;"&gt;<br>&lt;/div&gt;?&gt;
</code></code></pre>
<p>I have already tried googling anywhere but has no result, when i remember i have bookmarked your page, then I open it.
I cannot upload my photo with this.</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Erik!</p>
<p>At least I an see that enctype="multipart/data-form" part is wrong. It should be enctype="multipart/form-data".</p>
<p>There could be other issues as well. But it makes very little sense in posting a code and asking what is wrong with it. Humans are not intended to run a code mentally, it's a job for a computer. So you have to run your code, make sure that all possible error reporting is on and start debugging. To tell you truth, debugging is the main occupations for any programmer. So it is not writing a program that takes most time but finding out why doesn't it work.</p>              </div>
            </li>
 
            <li class="comment" id="comment-513">
              <div class="comment-author">
              	Erik, 17.06.18 17:55              </div>
              <div class="comment-body" style="overflow:hidden"><blockquote>
</blockquote>
<pre><code><code><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$id_user&nbsp;</span><span style="color: #007700">=(int)</span><span style="color: #0000BB">$_SESSION</span><span style="color: #007700">[</span><span style="color: #DD0000">'id'</span><span style="color: #007700">];<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$userdata&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$db</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #DD0000">"SELECT&nbsp;*&nbsp;FROM&nbsp;member&nbsp;WHERE&nbsp;id&nbsp;=&nbsp;?"</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$userdata</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">([</span><span style="color: #0000BB">$_SESSION</span><span style="color: #007700">[</span><span style="color: #DD0000">'id'</span><span style="color: #007700">]]);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$usr&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$userdata</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetch</span><span style="color: #007700">(</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">FETCH_ASSOC</span><span style="color: #007700">);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color: #0000BB">tr</span><span style="color: #007700">&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color: #0000BB">td</span><span style="color: #007700">&gt;&lt;?=</span><span style="color: #0000BB">$usr</span><span style="color: #007700">[</span><span style="color: #DD0000">'id'</span><span style="color: #007700">]</span><span style="color: #0000BB">?&gt;</span>&lt;/td&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;<span style="color: #0000BB">&lt;?=$usr</span><span style="color: #007700">[</span><span style="color: #DD0000">'usernama'</span><span style="color: #007700">]</span><span style="color: #0000BB">?&gt;</span>&lt;/td&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;<span style="color: #0000BB">&lt;?=$usr</span><span style="color: #007700">[</span><span style="color: #DD0000">'nomorhp'</span><span style="color: #007700">]</span><span style="color: #0000BB">?&gt;</span>&lt;/td&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;<span style="color: #0000BB">&lt;?=$usr</span><span style="color: #007700">[</span><span style="color: #DD0000">'email'</span><span style="color: #007700">]</span><span style="color: #0000BB">?&gt;</span>&lt;/td&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;<span style="color: #0000BB">&lt;?=$usr</span><span style="color: #007700">[</span><span style="color: #DD0000">'password'</span><span style="color: #007700">]</span><span style="color: #0000BB">?&gt;</span>&lt;/td&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;<span style="color: #0000BB">&lt;?=$usr</span><span style="color: #007700">[</span><span style="color: #DD0000">'kelas'</span><span style="color: #007700">]</span><span style="color: #0000BB">?&gt;</span>&lt;/td&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;<span style="color: #0000BB">&lt;?=$usr</span><span style="color: #007700">[</span><span style="color: #DD0000">'jurusan'</span><span style="color: #007700">]</span><span style="color: #0000BB">?&gt;</span>&lt;/td&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;<span style="color: #0000BB">&lt;?=$usr</span><span style="color: #007700">[</span><span style="color: #DD0000">'kabupaten'</span><span style="color: #007700">]</span><span style="color: #0000BB">?&gt;</span>&lt;/td&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tr&gt;?&gt;
</code></code></pre>
<blockquote>
<p>I've used to your code given, but I do beg your pardon, I cannot see the data I need, I just see white screen whit table head data.</p>
</blockquote></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>This code should work, given there is a closing PHP tag ?&gt; between PHP and HTML</p>              </div>
            </li>
 
            <li class="comment" id="comment-512">
              <div class="comment-author">
              	Erik, 17.06.18 11:42              </div>
              <div class="comment-body" style="overflow:hidden"><p>code:</p>
<pre><code><code><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">&lt;?</span><span style="color: #0000BB">php&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$id_user&nbsp;</span><span style="color: #007700">=(int)</span><span style="color: #0000BB">$_SESSION</span><span style="color: #007700">[</span><span style="color: #DD0000">'id'</span><span style="color: #007700">];<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$userdata&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$db</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #DD0000">"SELECT&nbsp;*&nbsp;FROM&nbsp;member&nbsp;WHERE&nbsp;id&nbsp;=&nbsp;?"</span><span style="color: #007700">,</span><span style="color: #DD0000">'$id_user'</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$userdata</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">binparam</span><span style="color: #007700">(</span><span style="color: #DD0000">':$_SESSION['</span><span style="color: #0000BB">id</span><span style="color: #DD0000">']'</span><span style="color: #007700">,?);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$userdata</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$usr&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$userdata</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetch</span><span style="color: #007700">(</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">FETCH_ASSOC</span><span style="color: #007700">);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">?&gt;<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;tr&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000BB">&lt;?=$usr</span><span style="color: #007700">[</span><span style="color: #DD0000">'user&nbsp;data'</span><span style="color: #007700">]&nbsp;</span><span style="color: #FF8000">//how&nbsp;to&nbsp;fetch&nbsp;whole&nbsp;user&nbsp;(login)&nbsp;data&nbsp;here?'</span><span style="color: #0000BB">?&gt;<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/td&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tr&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tbody&gt;<br>&lt;/table&gt;<br>&lt;/div&gt;?&gt;
</code></code></pre></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Erik!</p>
<p>You have problem in your code. it should be </p>
<pre><code><code><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$id_user&nbsp;</span><span style="color: #007700">=(int)</span><span style="color: #0000BB">$_SESSION</span><span style="color: #007700">[</span><span style="color: #DD0000">'id'</span><span style="color: #007700">];<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$userdata&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$db</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #DD0000">"SELECT&nbsp;*&nbsp;FROM&nbsp;member&nbsp;WHERE&nbsp;id&nbsp;=&nbsp;?"</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$userdata</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">([</span><span style="color: #0000BB">$_SESSION</span><span style="color: #007700">[</span><span style="color: #DD0000">'id'</span><span style="color: #007700">]]);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$usr&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$userdata</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetch</span><span style="color: #007700">(</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">FETCH_ASSOC</span><span style="color: #007700">);</span><span style="color: #0000BB"></span></code></code></pre>
<p>Then you can display all the user data that is already fetched. You need to know the column names in order to display them though. </p>
<p>For example, if there is a name column, you can display it using $usr['name'] and so on.</p>              </div>
            </li>
 
            <li class="comment" id="comment-511">
              <div class="comment-author">
              	Sebastian Wallace, 12.06.18 23:23              </div>
              <div class="comment-body" style="overflow:hidden"><p>What a fantastic article. Very helpful, packed full of information! Many thanks.</p></div>
            </li>
 
            <li class="comment" id="comment-509">
              <div class="comment-author">
              	Developer, 07.06.18 21:17              </div>
              <div class="comment-body" style="overflow:hidden"><p>Excelent article! Answered some of my questions right up !</p></div>
            </li>
 
            <li class="comment" id="comment-476">
              <div class="comment-author">
              	Johnny B, 18.04.18 21:18              </div>
              <div class="comment-body" style="overflow:hidden"><p>Hi,
I was wondering if you could do a simple client/server pdo api example? I have been unable to find an examples/tutorials for a simple one. This should be geared towards having an application log data and then submit it either php or json/js to a remote DB site. I have made it work without an api, and with a simple php api . However I fail to be able to do this with PDO. It is not as simple as one would think.</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Johnny!</p>
<p>You are probably mistaking PDO with something else. PDO is simply a database API, it knows nothing of json/js or application log data. It belongs to that "remote DB site" only. How this site is called is of no PDO's concern. In short, PDO is just a function to run your SQL query against a database server, no more. </p>
<p>Such a client/server pdo api example simply doesn't exist. The only server PDO talks to is a database server. Whereas any API is always implemented in PHP, which, in turn, uses PDO to query a database.</p>              </div>
            </li>
 
            <li class="comment" id="comment-465">
              <div class="comment-author">
              	Script47, 15.04.18 08:07              </div>
              <div class="comment-body" style="overflow:hidden"><p>This resource you have come up with is extremely helpful, especially the parts where you explain where prepared statements can be used.</p>
<p>Thank you for all the effort you put in to it.</p>
<p>In the transaction section when you make mention of the rollback function, is it not meant to be in camel case as shown in the documentation?</p>
<p>(<a href="http://php.net/manual/en/pdo.rollback.php">http://php.net/manual/en/pdo.rollback.php</a>)</p>
<p>Have you considered writing articles on design patterns and or generic articles regarding writing smarter code in general?</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello!</p>
<p>In PHP, function and method names are case-insensitive, so technically it could be anything. </p>
<p>Although it could make sense to use a camel case to separate different words in the method name, "rollback" is the established term by itself in a database word and could be count as a whole word, thus making it unnecessary to use a camel case in it.</p>              </div>
            </li>
 
            <li class="comment" id="comment-462">
              <div class="comment-author">
              	Marvin, 11.04.18 17:14              </div>
              <div class="comment-body" style="overflow:hidden"><p>Does this statement prevent sql injection or does it turn emulation mode off??</p>
<p>setAttribute(PDO::ATTR_EMULATE_PREPARES, false);</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Marvin!</p>
<p>It does turn emulation mode off</p>              </div>
            </li>
 
            <li class="comment" id="comment-461">
              <div class="comment-author">
              	Greg, 10.04.18 21:17              </div>
              <div class="comment-body" style="overflow:hidden"><p>Regarding the following error when using PDO fetch():</p>
<blockquote>
<p>General error: 2014 Cannot execute queries while other unbuffered queries are active.  Consider using PDOStatement::fetchAll().  Alternatively, if your code is only ever going to run against mysql, you may enable query buffering by setting the PDO::MYSQL_ATTR_USE_BUFFERED_QUERY attribute.</p>
</blockquote>
<p>It seems as though there are multiple ways to fix this, however I'm really curious what YOU would recommend. There are so many differing opinions online, however yours is the only one I actually trust, so I thought I would ask you directly.</p>
<p>The possible fixes seem to be:</p>
<ul>
<li>Changing all fetch() instances to fetchAll() (which would require some additional code re-writing)</li>
<li>If only using MySQL, enable MYSQL_ATTR_USE_BUFFERED_QUERY (it seems like this fix might not work 100% of the time)</li>
<li>Using closeCursor after fetch() calls</li>
</ul>
<p>Are there any of these methods that you prefer? Or NOT prefer?</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Greg!</p>
<p>This error can be caused by different problems. Therefore different solutions.</p>
<p>Most of time you should never see such an error at all. The only plausible case could be caused by a stored procedure, and should be treated as explained in the corresponding chapter.</p>
<p>If you have a certain scenario in mind, please share, I'll try to sort it out</p>              </div>
            </li>
 
            <li class="comment" id="comment-451">
              <div class="comment-author">
              	eFko, 04.04.18 22:54              </div>
              <div class="comment-body" style="overflow:hidden"><p>$stmt = $pdo-&gt;prepare("SELECT value FROM table WHERE id=?");
$stmt-&gt;execute([$_GET['id']]);
$data = $stmt-&gt;fetchColumn();
if ($data){
if ($data==0){
// do something
} else {
// do something else
}
} else {
// do default action
}</p>
<p>If value is 0, this code always do default action. How to select only one column a check it when this column is 0?</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello eFko!</p>
<p>If I get you right, instead of <code>if($data)</code> you can test for FALSE value with strict comparison in the first condition:</p>
<pre><code><code><span style="color: #0000BB"></span><span style="color: #007700">if&nbsp;(</span><span style="color: #0000BB">$data&nbsp;</span><span style="color: #007700">!==&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">){</span><span style="color: #0000BB"></span></code></code></pre>
<p>should do something when $data = 0</p>              </div>
            </li>
 
            <li class="comment" id="comment-447">
              <div class="comment-author">
              	tharring, 27.03.18 20:04              </div>
              <div class="comment-body" style="overflow:hidden"><p>That was it! I closed the &lt;input&gt; tag too soon. I also needed to remove id= for every input field, including the submit button, which I changed from type="button" to type="submit". Now everything works! I as able to insert into select fields in the table, not all fields.  Thanks so much for your help!</p></div>
            </li>
 
            <li class="comment" id="comment-446">
              <div class="comment-author">
              	tharring, 27.03.18 05:52              </div>
              <div class="comment-body" style="overflow:hidden"><p>You are not showing an INSERT example and I really need help using a FORM and getting the info from the form into the db. AMPPS says I'm using php7 but my exports say it's 5.6.37. Here's my info and using php tags:</p>
<pre><code><code><span style="color: #0000BB"></span><span style="color: #007700">include&nbsp;</span><span style="color: #DD0000">"localpdo.php"</span><span style="color: #007700">;<br>if&nbsp;(isset(</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">'insert'</span><span style="color: #007700">]))&nbsp;{&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;Prepare&nbsp;the&nbsp;SQL&nbsp;query<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$stmt&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$conn</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #DD0000">"INSERT&nbsp;INTO&nbsp;timesheet&nbsp;(vol_id,&nbsp;flag)&nbsp;VALUES(:vol_id,:flag)"</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">bindParam</span><span style="color: #007700">(</span><span style="color: #DD0000">'vol_id'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">'vol_id'</span><span style="color: #007700">],&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">PARAM_INT</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">bindParam</span><span style="color: #007700">(</span><span style="color: #DD0000">'flag'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">'flag'</span><span style="color: #007700">],&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">PARAM_STR</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">();<br>}&nbsp;else&nbsp;{&nbsp;</span><span style="color: #FF8000">//&nbsp;}<br></span><span style="color: #007700">-&nbsp;-&nbsp;-&nbsp;<br>&lt;</span><span style="color: #0000BB">form&nbsp;name</span><span style="color: #007700">=</span><span style="color: #DD0000">"form1"&nbsp;</span><span style="color: #0000BB">method</span><span style="color: #007700">=</span><span style="color: #DD0000">"post"&nbsp;</span><span style="color: #0000BB">action</span><span style="color: #007700">=</span><span style="color: #DD0000">""</span><span style="color: #007700">&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color: #0000BB">input&nbsp;type</span><span style="color: #007700">=</span><span style="color: #DD0000">"text"&nbsp;</span><span style="color: #0000BB">name</span><span style="color: #007700">=</span><span style="color: #DD0000">"vol_id"&nbsp;</span><span style="color: #0000BB">id</span><span style="color: #007700">=</span><span style="color: #DD0000">"vol_id"</span><span style="color: #007700">&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;?</span><span style="color: #0000BB">php&nbsp;</span><span style="color: #007700">if&nbsp;(isset(</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">'vol_id'</span><span style="color: #007700">])&nbsp;===&nbsp;</span><span style="color: #0000BB">true</span><span style="color: #007700">)&nbsp;{&nbsp;echo&nbsp;</span><span style="color: #DD0000">'value="'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">'vol_id'</span><span style="color: #007700">],&nbsp;</span><span style="color: #DD0000">'"'</span><span style="color: #007700">;&nbsp;}&nbsp;</span><span style="color: #0000BB">?&gt;<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&lt;input&nbsp;type="text"&nbsp;name="flag"&nbsp;id="flag"&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000BB">&lt;?php&nbsp;</span><span style="color: #007700">if&nbsp;(isset(</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">'flag'</span><span style="color: #007700">])&nbsp;===&nbsp;</span><span style="color: #0000BB">true</span><span style="color: #007700">)&nbsp;{&nbsp;echo&nbsp;</span><span style="color: #DD0000">'value="'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">'flag'</span><span style="color: #007700">],&nbsp;</span><span style="color: #DD0000">'"'</span><span style="color: #007700">;&nbsp;}&nbsp;</span><span style="color: #0000BB">?&gt;<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&lt;input&nbsp;name="insert"&nbsp;id="insert"&nbsp;type="button"&nbsp;value="Start&nbsp;Time"&gt;<br>&lt;/form&gt;?&gt;
</code></code></pre>
<p>I have two TIMESTAMP fields for start/end times and an AI id field which auto-fill with each new record so I don't insert into them. Can you see what I'm doing wrong and help me? Thanks.</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello1 tharring!</p>
<p>There is nothing wrong with your insert. Its HTML form which is at least wrong. You are closing an HTML tag too early
should be like</p>
<pre><code><code><span style="color: #0000BB"></span><span style="color: #007700">&lt;</span><span style="color: #0000BB">form&nbsp;name</span><span style="color: #007700">=</span><span style="color: #DD0000">"form1"&nbsp;</span><span style="color: #0000BB">method</span><span style="color: #007700">=</span><span style="color: #DD0000">"post"&nbsp;</span><span style="color: #0000BB">action</span><span style="color: #007700">=</span><span style="color: #DD0000">""</span><span style="color: #007700">&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color: #0000BB">input&nbsp;type</span><span style="color: #007700">=</span><span style="color: #DD0000">"text"&nbsp;</span><span style="color: #0000BB">name</span><span style="color: #007700">=</span><span style="color: #DD0000">"vol_id"&nbsp;</span><span style="color: #0000BB">id</span><span style="color: #007700">=</span><span style="color: #DD0000">"vol_id"&nbsp;</span><span style="color: #0000BB">value</span><span style="color: #007700">=</span><span style="color: #DD0000">"&lt;?php&nbsp;if&nbsp;(isset(</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">'vol_id']))&nbsp;{&nbsp;?&gt;&lt;?=&nbsp;_POST['vol_id']&nbsp;?&gt;&lt;?php&nbsp;}&nbsp;?&gt;"</span><span style="color: #007700">&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color: #0000BB">input&nbsp;type</span><span style="color: #007700">=</span><span style="color: #DD0000">"text"&nbsp;</span><span style="color: #0000BB">name</span><span style="color: #007700">=</span><span style="color: #DD0000">"flag"&nbsp;</span><span style="color: #0000BB">id</span><span style="color: #007700">=</span><span style="color: #DD0000">"flag"&nbsp;</span><span style="color: #007700">&lt;?</span><span style="color: #0000BB">php&nbsp;</span><span style="color: #007700">if&nbsp;(isset(</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">'flag'</span><span style="color: #007700">]))&nbsp;{&nbsp;</span><span style="color: #0000BB">?&gt;&lt;?=&nbsp;$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">'flag'</span><span style="color: #007700">]&nbsp;</span><span style="color: #0000BB">?&gt;&lt;?php&nbsp;</span><span style="color: #007700">}&nbsp;</span><span style="color: #0000BB">?&gt;</span>"&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;input&nbsp;name="insert"&nbsp;id="insert"&nbsp;type="button"&nbsp;value="Start&nbsp;Time"&gt;<br>&lt;/form&gt;?&gt;
</code></code></pre>              </div>
            </li>
 
            <li class="comment" id="comment-444">
              <div class="comment-author">
              	James, 25.03.18 04:33              </div>
              <div class="comment-body" style="overflow:hidden"><p>Hi there, firstly thanks a lot for the article. I have a question of my own.  </p>
<p>Is there an efficient way of doing an <code>UPDATE..SET..WHERE</code></p>
<p>with large dataset? For example, instead of multiple SET <code>queue_order=$queue_order WHERE queue_id=$queue_id;</code>, is there a way to bundle them in a single PDO statement without using a for loop?  </p>
<p>Thanks.</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello James!</p>
<p>Although there are ways to do that, I would advise against. There is no point in stuffing as much queries in one statement as possible. <strong>Prepared statements</strong> are exactly for that purpose. Just prepare your UPDATE statement once and then execute it in a loop, like it shown in this article: <a href="https://phpdelusions.net/pdo#multiexec">https://phpdelusions.net/pdo#multiexec</a></p>
<p>It will be as fast as a single statement.</p>
<p>If your updates will run unexpectedly slow, then it's your database settings to blame. To fix that, wrap your updates in a single transaction.</p>              </div>
            </li>
 
            <li class="comment" id="comment-443">
              <div class="comment-author">
              	armel, 24.03.18 06:35              </div>
              <div class="comment-body" style="overflow:hidden"><p>Hello I wish to resume coding after more than 2 years without practice. now i want to realize my personal projects with php mvc in a first so I want to understand how to start! thank you!</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Armel!</p>
<p>My strong recommendation wouild be to try a well-established framework, Symfony preferably. It will give you the best understanding of MVC.</p>              </div>
            </li>
 
            <li class="comment" id="comment-442">
              <div class="comment-author">
              	armel, 24.03.18 06:31              </div>
              <div class="comment-body" style="overflow:hidden"><p>Bonjour
Je souhaiterai reprendre ? coder apr?s plus de 2 ans sans pratique.
maintenant je veux r?aliser mes projets perso avec  php mvc dans un premier tant je veux comprendre comment d?buter!
merci!</p></div>
            </li>
 
            <li class="comment" id="comment-437">
              <div class="comment-author">
              	Michael, 01.03.18 22:48              </div>
              <div class="comment-body" style="overflow:hidden"><p>Thanks for your reply. I followed your guide for beginners and implemented the logging-errors advice. So far, the best approach :-)</p></div>
            </li>
 
            <li class="comment" id="comment-371">
              <div class="comment-author">
              	Santi, 10.02.18 13:55              </div>
              <div class="comment-body" style="overflow:hidden"><p>$query = "SELECT tbl_product.*, tbl_cart.id as cart_id,tbl_cart.quantity FROM tbl_product, tbl_cart WHERE
tbl_product.id = tbl_cart.product_id AND tbl_cart.member_id = ?";</p>
<p>what does this queery mean?</p></div>
            </li>
 
            <li class="comment" id="comment-362">
              <div class="comment-author">
              	Victor Alvarado, 03.02.18 22:54              </div>
              <div class="comment-body" style="overflow:hidden"><p>Hi men, good post, VERY GOOD, i have a question about procedures.</p>
<p>How can i use procedures with FOREACH, how can i replace the while with foreach, implementing the empty result prevention, or is more efficiente use while instead?, because i like work with foreach</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Victor!</p>
<p>It is not very clear  what you are asking, but in general there is no difference between using foreach and while.</p>
<p>In both cases you can just iterate over the statement. In case there is no result, then there simply will be no output:</p>
<pre><code><code><span style="color: #0000BB"></span><span style="color: #007700">foreach&nbsp;(</span><span style="color: #0000BB">$stmt&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$row</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">'name'</span><span style="color: #007700">];<br>}</span><span style="color: #0000BB"></span></code></code></pre>
<p>In case you want to know if there is any result beforehand, just fetch the resulting dataset using fetchAll():</p>
<pre><code><code><span style="color: #0000BB">$data&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetchAll</span><span style="color: #007700">();<br>if&nbsp;(</span><span style="color: #0000BB">$data</span><span style="color: #007700">){<br>&nbsp;&nbsp;&nbsp;&nbsp;foreach&nbsp;(</span><span style="color: #0000BB">$data&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$row</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">'name'</span><span style="color: #007700">];<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>}&nbsp;else&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"No&nbsp;data"</span><span style="color: #007700">;<br>}</span><span style="color: #0000BB"></span></code></code></pre>
<p>Hope it is clear now, but if not, please ask</p>              </div>
            </li>
 
            <li class="comment" id="comment-361">
              <div class="comment-author">
              	Michael, 03.02.18 17:18              </div>
              <div class="comment-body" style="overflow:hidden"><p>Hi,
Very good tutorial, thanks for sharing. My production database server went down and when the app tried to connect to it, the error report threw back the database connection details. Not nice. How would you recommend to handle this error?
Thx</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Michael!</p>
<p>This is a very important question!
However, it is not actually related to PDO or database, but rather to the whole PHP configuration. Your PHP sees to be misconfigured, leaking every error message outside, which shouldn't be. Actually, every error message is a breach in the security, so the solution should be a general one.</p>
<p>On a live server PHP must be configured to log errors instead of displaying them, so it would never happen again to leak your database credentials outside. You may find useful my article on the PHP error reporting configuration: <a href="https://phpdelusions.net/articles/error_reporting">https://phpdelusions.net/articles/error_reporting</a></p>
<p>Feel free to drop a line if something is still unclear or you disagree with the proposed solution</p>              </div>
            </li>
 
            <li class="comment" id="comment-347">
              <div class="comment-author">
              	GioMBG, 31.01.18 02:37              </div>
              <div class="comment-body" style="overflow:hidden"><p>first thx for your tutorial.
injection paranoia :
prepare = safe ?</p>
<pre><code><code><span style="color: #0000BB">$Q&nbsp;</span><span style="color: #007700">=&nbsp;(</span><span style="color: #DD0000">'SELECT&nbsp;COUNT(Artist)&nbsp;AS&nbsp;cnt_artists&nbsp;FROM&nbsp;artists&nbsp;WHERE&nbsp;Artist&nbsp;LIKE&nbsp;?'</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$q&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$conn</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #0000BB">$Q</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$q</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">(array(</span><span style="color: #0000BB">$letter</span><span style="color: #007700">.</span><span style="color: #DD0000">'%'</span><span style="color: #007700">));</span><span style="color: #0000BB"></span></code></code></pre>
<p>it is safe ?
thx</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Gio!</p>
<p>Yes, that's perfectly safe. PDO witll either correctly format a parameter for you (if emulation mode is turned on) or even send it <strong>completely separated</strong> from the query, and so there would be no way for it to interfere.</p>              </div>
            </li>
 
            <li class="comment" id="comment-345">
              <div class="comment-author">
              	Tony L, 19.01.18 13:26              </div>
              <div class="comment-body" style="overflow:hidden"><p>Beware that bitfields in MySQL suffer from the same problem that terms in the LIMIT clause do when using prepared statements, i.e. in emulation mode, strings are not correctly interpreted. So if you are converting code like
mysql_query("create table foo (bits bit(48))");
mysql_query("insert into foo (bits) values ($val)";
into
$pdo-&gt;prepare("insert into foo (bits) values (?)")-&gt;execute([64]);
you will actually get the value 13876 inserted (0011 0110 0011 0100) which is the bytes of the ASCII characters '6' and '4'.</p>
<p>To fix this, either turn off emulation, or use bindParam as described in the section on LIMIT, or change your code to
$pdo-&gt;prepare("insert into foo (bits) values (cast(? as decimal))")-&gt;execute([64]);
Something for the next version of this page perhaps?</p></div>
            </li>
 
            <li class="comment" id="comment-343">
              <div class="comment-author">
              	Brinth, 09.01.18 09:27              </div>
              <div class="comment-body" style="overflow:hidden"><p>hi i am getting such an error-
" Please make the application/config/database.php file writable". </p>
<p>how to make a php file writable using chd in remote server?</p></div>
            </li>
 
            <li class="comment" id="comment-341">
              <div class="comment-author">
              	jeff van fleet, 08.01.18 18:53              </div>
              <div class="comment-body" style="overflow:hidden"><p>i am brand new to pdo and i have a question about database connections. </p>
<p>on one page you say: </p>
<blockquote>
<p>constructor parameter is the most robust method in case your code is OOP. For the every class that needs a database connection, make PDO a constructor parameter</p>
</blockquote>
<p>but on another page you say:</p>
<blockquote>
<p>The connection has to be made only once! No connects in every function. No connects in every class constructor. Otherwise, multiple connections will be created, which will eventually kill your database server. Thus, a sole PDO instance has to be created and then used through whole script execution</p>
</blockquote>
<p>these statements seem contradictory to me.  can you please explain how to properly connect to a database with pdo? I am using oop php.</p>
<p>thanks, jeff</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Jeff! </p>
<p>Thank you for the good question!</p>
<p>When you assign an object to a variable, there remains just a single object, whereas the second variable being just a <em>reference</em> to it. So when you are sending a PDO instance into a class' constructor, then it's actually a reference, that points to the same PDO instance. So the initial PDO object is not gets duplicated but remains essentially a single instance.</p>
<p>So you can tell that the former statement doesn't violate the rule from the latter but rater gets along with it</p>
<p>Hope it is clear now but feel free to ask if not!</p>              </div>
            </li>
 
            <li class="comment" id="comment-333">
              <div class="comment-author">
              	T G, 26.12.17 00:33              </div>
              <div class="comment-body" style="overflow:hidden"><p>Great Column!</p>
<p>I was wondering on the following code snippet:</p>
<pre><code><code><span style="color: #0000BB">$data&nbsp;</span><span style="color: #007700">=&nbsp;[</span><span style="color: #DD0000">'name'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'foo'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'submit'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'submit'</span><span style="color: #007700">];&nbsp;</span><span style="color: #FF8000">//&nbsp;data&nbsp;for&nbsp;insert<br></span><span style="color: #0000BB">$allowed&nbsp;</span><span style="color: #007700">=&nbsp;[</span><span style="color: #DD0000">"name"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"surname"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"email"</span><span style="color: #007700">];&nbsp;</span><span style="color: #FF8000">//&nbsp;allowed&nbsp;fields&nbsp;<br></span><span style="color: #0000BB">$values&nbsp;</span><span style="color: #007700">=&nbsp;[];&nbsp;<br></span><span style="color: #0000BB">$set&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">""</span><span style="color: #007700">;&nbsp;foreach&nbsp;(</span><span style="color: #0000BB">$allowed&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$field</span><span style="color: #007700">)&nbsp;{&nbsp;<br>if&nbsp;(isset(</span><span style="color: #0000BB">$data</span><span style="color: #007700">[</span><span style="color: #0000BB">$field</span><span style="color: #007700">]))&nbsp;{&nbsp;<br></span><span style="color: #0000BB">$set</span><span style="color: #007700">.=</span><span style="color: #DD0000">""</span><span style="color: #007700">.</span><span style="color: #0000BB">str_replace</span><span style="color: #007700">(</span><span style="color: #DD0000">""</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"`"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$field</span><span style="color: #007700">).</span><span style="color: #DD0000">""</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"=:</span><span style="color: #0000BB">$field</span><span style="color: #DD0000">,&nbsp;"</span><span style="color: #007700">;&nbsp;<br></span><span style="color: #0000BB">$values</span><span style="color: #007700">[</span><span style="color: #0000BB">$field</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$data</span><span style="color: #007700">[</span><span style="color: #0000BB">$field</span><span style="color: #007700">];&nbsp;<br>}&nbsp;<br>}&nbsp;<br></span><span style="color: #0000BB">$set&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">substr</span><span style="color: #007700">(</span><span style="color: #0000BB">$set</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;-</span><span style="color: #0000BB">2</span><span style="color: #007700">);</span><span style="color: #0000BB"></span></code></code></pre>
<p>Why are you escaping the field names. Should the $allowed whitelist already handle any SQL injection risk?</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello T G!</p>
<p>Yeah, that's an awkward moment. On the one hand, you don't have to escape a whitelisted value as nobody in their right mind would use a backtick in the field name. On the other hand, however, if you take the formatting routine as an abstract one, unaware of the data source, it would be natural to do the full processing, both quoting and escaping - just like any good quoting function should do. </p>
<p>I think it would be better to move the full quoting routine into a distinct function that will be doing the correct formatting regardless. I suppose it will arise less questions. What do you think?</p>              </div>
            </li>
 
            <li class="comment" id="comment-331">
              <div class="comment-author">
              	jayenn, 23.12.17 23:49              </div>
              <div class="comment-body" style="overflow:hidden"><p>Hi and thanks  for this great information. I have learnt a lot about PDO and - at least as useful - about a consistent approach to error handling! I also like your style of writing. Thanks mucho!</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Jayenn!</p>
<p>Thank you for your kind words and especially for mentioning the error handling stuff! I am nor sort of crusade in changing the current state of error handling in PHP.</p>
<p>Feel free to check back if you have any problem though - any real life use case can make my articles batter for everyone.</p>              </div>
            </li>
 
            <li class="comment" id="comment-330">
              <div class="comment-author">
              	AA, 21.12.17 09:53              </div>
              <div class="comment-body" style="overflow:hidden"><p>I have a pdo search engine using MYSQL database. How can I get the number of search results per "MYSQL field"?</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello!</p>
<p>Just run a </p>
<pre><code><code><span style="color: #0000BB">SELECT&nbsp;COUNT</span><span style="color: #007700">(*)&nbsp;</span><span style="color: #0000BB">FROM&nbsp;your_table&nbsp;WHERE&nbsp;&nbsp;field&nbsp;</span><span style="color: #007700">=&nbsp;?</span></code></code></pre>
<p>and select that number using fetchColumn()</p>              </div>
            </li>
 
            <li class="comment" id="comment-325">
              <div class="comment-author">
              	Jason Franklin, 07.12.17 00:09              </div>
              <div class="comment-body" style="overflow:hidden"><p>It appears that adding a code block does not work. I just tried submitting another comment with code, but it did not appear as I expected.</p></div>
            </li>
 
            <li class="comment" id="comment-324">
              <div class="comment-author">
              	Jason Franklin, 06.12.17 19:27              </div>
              <div class="comment-body" style="overflow:hidden"><p>I submitted a comment a few days ago about escaping operands for the LIKE operator.  Do you think it may have been sent to a spam folder?</p>
<p>I figured it would have made it through by now...</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Jason!</p>
<p>There is no spam folder, but it could have been an error on the site.</p>
<p>Escaping special characters used for the LIKE operator is not specific to PDO, it's rather related to the particular database. But probably I should add a mention at least for MySQL. </p>
<p>What was your question anyway?</p>              </div>
            </li>
 
            <li class="comment" id="comment-323">
              <div class="comment-author">
              	vincent, 05.12.17 14:49              </div>
              <div class="comment-body" style="overflow:hidden"><p>I was talking with another programmer and hes was complaining about SQL query not working (He has not the use to test his queries on the database before coding them on PHP).
And he said :</p>
<p>-- It would be usefull to be able to directely see the query made by PDO to the database.<br>
-- you mean with the values of binded ?<br>
-- Yes !<br>
-- For debugging ?<br>
-- Of course, what kind of programmer do you take me for ?  </p>
<p>I searched I stumbled on you (Your articles are wonderfully readable by the way).</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Vincent!</p>
<p>Although it is often useful to have a query from PDO with all the data interpolated, I would rather use it for the profiling. </p>
<p>Whereas when a query is not working, all you need as an error message from a database, that will tell you precisely, what is the problem. Note that you should be using prepared statements to avoid silly syntax errors caused by the data - it goes without saying. </p>
<p>That said, there are several code snippets and packages that can get you raw SQL from a prepared query, just google for "pdo interpolated query" or "PDO raw query".</p>              </div>
            </li>
 
            <li class="comment" id="comment-322">
              <div class="comment-author">
              	Mike McPherson, 30.11.17 14:31              </div>
              <div class="comment-body" style="overflow:hidden"><p>I have a simple loop that runs a small number of update statements
if there's only one in the loop it works fine
more than one and only the first works, with no errors reported
I'm confused!!</p>
<pre><code><code><span style="color: #0000BB"></span><span style="color: #007700">for&nbsp;(</span><span style="color: #0000BB">$i</span><span style="color: #007700">=</span><span style="color: #0000BB">0</span><span style="color: #007700">;&nbsp;</span><span style="color: #0000BB">$i</span><span style="color: #007700">&lt;</span><span style="color: #0000BB">$count</span><span style="color: #007700">;&nbsp;</span><span style="color: #0000BB">$i</span><span style="color: #007700">++)&nbsp;{<br></span><span style="color: #0000BB">$SQL&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"UPDATE&nbsp;Candidate&nbsp;C&nbsp;SET&nbsp;engineer&nbsp;=&nbsp;'"&nbsp;</span><span style="color: #007700">.</span><span style="color: #0000BB">$engineer</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"'&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;..."</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$result&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$db</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #0000BB">$SQL</span><span style="color: #007700">);<br>}</span><span style="color: #0000BB"></span></code></code></pre></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Mike!</p>
<p>Dunno why did you cut off the part after WHERE but it's impossible to tell anything without seeing the actual code, sorry.</p>
<p>Most likely you are just updating the same row.</p>              </div>
            </li>
 
            <li class="comment" id="comment-319">
              <div class="comment-author">
              	Jorge, 27.11.17 06:57              </div>
              <div class="comment-body" style="overflow:hidden"><blockquote>
<p>Unfortunately, there is some confusion. PDO::quote() creates a data literal, not an identifier. For example, for MySQL the returned value will be enclosed in quotes, not backticks, which will make it unsuitable to be used as a table name.</p>
</blockquote>
<p>How frustrating. I just tested with PostgreSQL, but it uses single quotes so it worked there.
One wonders why in so many years, such a basic and necessary feature is not there (found a thread from 2008 with people complaining about this, sayng it's years overdue).
I just migrated from MDB2 because of it's unfinished state and difficult install method and chose PDO. One of my tables matches one of MySQL's many reserved words, so I must quote it and I was using quoteidentifier from MDB2.
I see Zend Engine has it, but that means a large dependency for a single quoting function.
Seems I'll have to roll up my sleeves. Thanks for the heads up, it could have gone unnoticed otherwise!</p></div>
            </li>
 
            <li class="comment" id="comment-317">
              <div class="comment-author">
              	Jorge, 26.11.17 03:29              </div>
              <div class="comment-body" style="overflow:hidden"><p>Nice rundown, much better than overly complex tutorials.
However, identifier quoting does exist in PDO (didn't back then?).</p>
<p>$pdo-&gt;quote('mytablename');
will take care of any strange quotes. Keep in mind only MySQL uses backticks, so using this is better if you want to keep it a little more DB-agnostic.</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Jorge!</p>
<p>Thank you for your feedback.</p>
<p>Unfortunately, there is some confusion. PDO::quote() creates a data literal, not an identifier. For example, for MySQL the returned value will be enclosed in quotes, not backticks, which will make it unsuitable to be used as a table name.</p>              </div>
            </li>
 
            <li class="comment" id="comment-313">
              <div class="comment-author">
              	Emma, 14.11.17 09:22              </div>
              <div class="comment-body" style="overflow:hidden"><p>Dear Colonel, I greatly appreciate this website and the common sense you share on Stack Overflow. May I ask you, please, if you have time, to take a look at a conundrum I have posted on SO? (<a href="https://stackoverflow.com/questions/47278348/php-output-echoed-out-of-order">https://stackoverflow.com/questions/47278348/php-output-echoed-out-of-order</a>). I understand if that's not possible for you. Best wishes for the future</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Emma!</p>
<p>I see it has been happily resolved already. Glad you got it working and thank you for your kind words.</p>
<p>Feel free to come back if you have any other questions :)</p>              </div>
            </li>
 
            <li class="comment" id="comment-312">
              <div class="comment-author">
              	Tyler, 13.11.17 09:25              </div>
              <div class="comment-body" style="overflow:hidden"><p>Oh I typed in my second thought before I saw that you had responded to my question. Looks like we came to the same conclusion,</p>
<p>Awesome
Thanks for your response</p></div>
            </li>
 
            <li class="comment" id="comment-311">
              <div class="comment-author">
              	Tyler, 13.11.17 09:21              </div>
              <div class="comment-body" style="overflow:hidden"><p>I suppose I could run a sub-query on COUNT(*)</p></div>
            </li>
 
            <li class="comment" id="comment-310">
              <div class="comment-author">
              	Tyler, 13.11.17 08:02              </div>
              <div class="comment-body" style="overflow:hidden"><p>Hello, I am running into a problem with pagination. As you recommend I use COUNT(*). But when using with GROUP BY I have a problem. With just one GROUP BY I can use COUNT(DISTINCT column). But now I have a query that requires 2 GROUP BY's and am having a problem and SQL_CALC_FOUND_ROWS is not a solution for my case. It's looking like  'then you can either use rowCount() or simply call count() on the array returned by fetchAll()" are my only solutions.</p>
<p>Do you have any suggestions?</p>
<p>P.S. Thanks for your great PDO reference site.</p>
<p>Ty</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Tyler!</p>
<p>Thank you for the good question. I should have added it to the article.
And especially thank you for asking. It's always better to ask than devise something of your own.</p>
<p>Yes, there is a way to ask a database to count on its side in this case as well. Just wrap your query into another query, like</p>
<pre><code><code><span style="color: #0000BB">SELECT&nbsp;count</span><span style="color: #007700">(*)&nbsp;</span><span style="color: #0000BB">FROM&nbsp;</span><span style="color: #007700">(</span><span style="color: #0000BB">SELECT&nbsp;1&nbsp;FROM&nbsp;</span><span style="color: #007700">...&nbsp;</span><span style="color: #0000BB">here&nbsp;goes&nbsp;the&nbsp;rest&nbsp;of&nbsp;your&nbsp;query</span><span style="color: #007700">)</span><span style="color: #0000BB"></span></code></code></pre>
<p>The idea is to wrap your query into another, and use it to count results. For this purpose we are selecting just a constant value "1" instead of the actual fields in your main query, just to make a database to do less job.</p>
<p>Feel free to ask if you got any other questions!</p>              </div>
            </li>
 
            <li class="comment" id="comment-309">
              <div class="comment-author">
              	John Hind, 09.11.17 14:45              </div>
              <div class="comment-body" style="overflow:hidden"><p>In testing I notice that if you use sql statements containing LIKE in combination with $_GET it is possible to inject % into the statement and retrieve all the data from a table.
e.g. if I do not escape the % this retrieves all users.
<a href="http://example.php/?first_name">http://example.php?first_name</a>=%</p>
<p>The issue is referenced here
<a href="http://php.net/manual/en/pdostatement.bindvalue.php">http://php.net/manual/en/pdostatement.bindvalue.php</a></p>
<p>but I can't find any mention of it in your more extensive documentation.
I have to say that I did not understand the code example you use to explain how to use 'like' with pdo.</p>
<p>Thanks,
John</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello John.</p>
<p>first of all, be advised to distinguish an <em>official</em> manual page for <em>user-contributed comments</em>. The latter can be left by any unsuspecting fellow and should be taken with a pinch of salt. </p>
<p>As of your concern, it's really simple.</p>
<ol>
<li>if your code inside example.php is not intended for the substring search, then you should NOT use LIKE in the first place. </li>
<li>if your code inside example.php is intended for the substring search, then it means that the entire table contents is <em>already</em> exposed and you have nothing to complain of. for example, if you are using something like `'%'.$_GET['first_name'].'%', then I will have only run 28 requests with a different letter each to dump your "entire database" without any special character used.</li>
</ol>              </div>
            </li>
 
            <li class="comment" id="comment-308">
              <div class="comment-author">
              	M, 06.11.17 12:04              </div>
              <div class="comment-body" style="overflow:hidden"><p>Greetings. I have enjoyed reading your content, especially the part about the PDO wrapper. Your site has become a bit of a reference on the topic. Helps people not to reinvent the wheel every day. As a personal wish, if I may, I'd like to get your insights on 'cache invalidation' an PDO. A bit off topic perhaps - it's just something I am working on these days. An ambitious idea of having a "caching system" underlying the app, i.e. transparent to the app who whouldn't know if data is coming from Memcache or the database. Queries would be handled by the PDO wrapper (-ish) and cached (using memcache), and also invalidated when 'interested' rows are updated/deleted. Not an easy task to develop something like that. Also, it'd be nice to have the User comments about "nested transactions" (see <a href="http://php.net/manual/en/pdo.begintransaction.php">http://php.net/manual/en/pdo.begintransaction.php</a>) incorporated in your articles, would probably be useful for a bunch of people. Great work.</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello M!</p>
<p>Yes this question a bit off topic, but from my experience I would rather warn you against such a generic all-embracing cache solution. In my opinion, your regular queries should be fast by themselves, without the need of any cache. And it's only a few exceptional cases should be handled using a cache, but such cases should be carefully handpicked, considered using a regular optimization, and only then optimized using a cache, with a carefully considered invalidation. </p>
<p>Regarding transactions, thank you for the suggestion, I will add a link to that comment.</p>              </div>
            </li>
 
            <li class="comment" id="comment-307">
              <div class="comment-author">
              	Zohra Pardesi, 02.11.17 16:57              </div>
              <div class="comment-body" style="overflow:hidden"><p>Hi, I again stuck at some point, Now I am trying to edit product details which I already have added. I also have added image field when I click on edit button and then when I add only some feature after clicking on update button I find Picture which I did not touch have gone.... Now after analysing I have understood the Problem but I am unable to resolve the issue if you can help me in this please.
my code is:</p>
<pre><code><code><span style="color: #0000BB"></span><span style="color: #007700">if(isset(</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">'update_product'</span><span style="color: #007700">])){<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$product_name&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">'product_name'</span><span style="color: #007700">];<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$cat_name</span><span style="color: #007700">=</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">'cat_name'</span><span style="color: #007700">];<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$sub_cat_name</span><span style="color: #007700">=</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">'sub_cat_name'</span><span style="color: #007700">];<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$product_img1</span><span style="color: #007700">=</span><span style="color: #0000BB">$_FILES</span><span style="color: #007700">[</span><span style="color: #DD0000">'product_img1'</span><span style="color: #007700">][</span><span style="color: #DD0000">'name'</span><span style="color: #007700">];<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">move_uploaded_file</span><span style="color: #007700">(</span><span style="color: #0000BB">$product_img1_tmp</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"images/products_images/</span><span style="color: #0000BB">$product_img1</span><span style="color: #DD0000">"</span><span style="color: #007700">);&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB"></span></code></code></pre>
<p>See in above When we use move_uploaded_file then what happen actually is our database only get the path of image while image actually move or resides into the folder we have mentioned into path.
So, when I try to edit/update page when code approached to database field product_img1 it only find path but not actual image. I think there must be a way like move_uploaded_file which I don't know :(</p>
<p>Please could you help me in this? how to fix this issue that if I don't want to update image, image should remain there?????</p></div>
            </li>
 
            <li class="comment" id="comment-305">
              <div class="comment-author">
              	Zohra Pardesi, 22.10.17 22:39              </div>
              <div class="comment-body" style="overflow:hidden"><p>Hi David, Yeah, you are right, I am mad that since hours I was checking my code madly, then took some rest and when again checked, I found my mistakes, both foreign keys I had placed wrongly; I corrected in the way below and my code is now working perfectly:
into insert statement (cat_id, sub_cat_id) and into values($cat_name, $sub_cat_name)</p>
<p>I also removed function NOW() and mysql is taking time itself. i might don't need to do anything. I was so happy and wanted to let you know, when came here I found your reply.
I really appreciate you for a quick response, you are doing such a great job by helping students. Great work!
I will try to bound foreign keys as well as suggested.
Thanks a lot and Regards,</p></div>
            </li>
 
            <li class="comment" id="comment-303">
              <div class="comment-author">
              	Zohra Pardesi, 22.10.17 16:54              </div>
              <div class="comment-body" style="overflow:hidden"><p>Hi, I am trying to learn PDO but stuck as receiving error message says: "PDOStatement::execute(): SQLSTATE[HY093]: Invalid parameter number: parameter was not defined" here is code:</p>
<pre><code><code><span style="color: #0000BB"></span><span style="color: #007700">if(isset(</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">'add_product'</span><span style="color: #007700">]))&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$product_name&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">'product_name'</span><span style="color: #007700">];<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$cat_id</span><span style="color: #007700">=</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">'cat_name'</span><span style="color: #007700">];&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//Foreign&nbsp;Key&nbsp;from&nbsp;main_cat&nbsp;table<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$sub_cat_id</span><span style="color: #007700">=</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">'sub_cat_name'</span><span style="color: #007700">];&nbsp;</span><span style="color: #FF8000">//Foreign&nbsp;Key&nbsp;from&nbsp;sub_cat&nbsp;table<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$product_price</span><span style="color: #007700">=</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">'product_price'</span><span style="color: #007700">];<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$product_warranty</span><span style="color: #007700">=</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">'product_warranty'</span><span style="color: #007700">];</span><span style="color: #0000BB"></span></code></code></pre>
<p>cat_id and sub_cat_id are foreign keys while I also want to get date and time into Products table by function Now()
Prepare statement and bindParam is as below:</p>
<pre><code><code><span style="color: #0000BB">$add_product&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$conn</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #DD0000">"insert&nbsp;into&nbsp;products(&nbsp;product_name,&nbsp;cat_name,&nbsp;sub_cat_name,&nbsp;product_price,&nbsp;product_warranty,&nbsp;product_add_date)&nbsp;v<br>alues&nbsp;(:product_name,&nbsp;</span><span style="color: #0000BB">$cat_id</span><span style="color: #DD0000">,&nbsp;</span><span style="color: #0000BB">$sub_cat_id</span><span style="color: #DD0000">,&nbsp;:product_price,&nbsp;:product_warranty,&nbsp;NOW())"</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$add_product</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">bindParam</span><span style="color: #007700">(</span><span style="color: #DD0000">":product_name"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$product_name</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$add_product</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">bindParam</span><span style="color: #007700">(</span><span style="color: #DD0000">":product_price"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$product_price</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$add_product</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">bindParam</span><span style="color: #007700">(</span><span style="color: #DD0000">":product_warranty"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$product_warranty</span><span style="color: #007700">);</span><span style="color: #0000BB"></span></code></code></pre>
<p>Call to function has been made into form where I need this to be executed. </p>
<p>It looks like I have set bindParam wrongly, I don't understand how to make it perfectly for cat_id, sub_cat_id and function NOW();
your help will be appreciated. regards,</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Zohra!</p>
<p>All you need is to brace yourself and write a consistent code. Either in your editor or here in comments.</p>
<p>I took your code and run it on my local server and there is no "Invalid parameter number". Therefore I suppose that you are just doing some mistakes when running your code and don't verify it, hence the error. </p>
<p>So just double check your code, and it will work!</p>
<p>Note that you should use prepared statements for ALL variables.  $cat_id, $sub_cat_id should be bound as well.</p>              </div>
            </li>
 
            <li class="comment" id="comment-299">
              <div class="comment-author">
              	David E, 21.10.17 14:37              </div>
              <div class="comment-body" style="overflow:hidden"><p>Can you help me please. I am trying to perform the following PDO. All the values are here are present. However I get an error message " Call to a member function prepare() on null in "etc.</p>
<pre><code><code><span style="color: #0000BB">$mbrwks&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"UPDATE&nbsp;friends1&nbsp;SET&nbsp;Wks&nbsp;=&nbsp;?,&nbsp;Yno&nbsp;=&nbsp;?,&nbsp;Mno&nbsp;=&nbsp;?,&nbsp;Regdat&nbsp;=&nbsp;?,&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Amount&nbsp;=&nbsp;?,Cheque&nbsp;=&nbsp;?,Status&nbsp;=&nbsp;?&nbsp;WHERE&nbsp;Friendship&nbsp;=&nbsp;?"</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #0000BB">$mbrwks</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">([</span><span style="color: #0000BB">$weeks</span><span style="color: #007700">,</span><span style="color: #0000BB">$yrs</span><span style="color: #007700">,</span><span style="color: #0000BB">$mm</span><span style="color: #007700">,</span><span style="color: #0000BB">$rdat</span><span style="color: #007700">,</span><span style="color: #0000BB">$fee</span><span style="color: #007700">,</span><span style="color: #0000BB">$cn</span><span style="color: #007700">,</span><span style="color: #0000BB">$c</span><span style="color: #007700">,</span><span style="color: #0000BB">$rn</span><span style="color: #007700">]);</span><span style="color: #0000BB"></span></code></code></pre></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello David!</p>
<p>This error means that you are calling $pdo inside a function, where variable scope is different. You need to make your PDO instance accessible. A short list of variants is listed here: <a href="https://phpdelusions.net/pdo_examples/connect_to_mysql#access">https://phpdelusions.net/pdo_examples/connect_to_mysql#access</a></p>
<p>Please feel free to comment back if you need any help with any particular method</p>              </div>
            </li>
 
            <li class="comment" id="comment-296">
              <div class="comment-author">
              	Ed, 17.10.17 18:43              </div>
              <div class="comment-body" style="overflow:hidden"><p>Thanks so much for your quick response. I think I just need to take a step back and do some more reading. I think this code wont work anyway because the scope of the $bdo variable is outside of the function. I need to work that one out next!</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Ed!</p>
<p>Whoops, I didn't notice the issue with variable scope, shame on me.</p>
<p>There are several ways you could get a PDO instance. You may check this page for some suggestions: <a href="https://phpdelusions.net/pdo/pdo_wrapper">PDO wrapper</a></p>              </div>
            </li>
 
            <li class="comment" id="comment-295">
              <div class="comment-author">
              	Ed, 17.10.17 13:49              </div>
              <div class="comment-body" style="overflow:hidden"><p>Thanks for the great and extensive instructions. I havent got very far but I am having a problem with passing the result of a function into a conditional statement. The database connects ok but I think the problem is here:</p>
<pre><code><code><span style="color: #0000BB">$result&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetch</span><span style="color: #007700">();<br>return&nbsp;(</span><span style="color: #0000BB">$result&nbsp;</span><span style="color: #007700">==</span><span style="color: #0000BB">1</span><span style="color: #007700">)?</span><span style="color: #0000BB">true</span><span style="color: #007700">:</span><span style="color: #0000BB">false</span><span style="color: #007700">);</span><span style="color: #0000BB"></span></code></code></pre>
<p>Any ideas?</p>
<pre><code><code><span style="color: #0000BB">$host&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'localhost'</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$db&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'mydb'</span><span style="color: #007700">;&nbsp;<br></span><span style="color: #0000BB">$user&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'dba'</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$pass&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">''</span><span style="color: #007700">;<br></span><span style="color: #FF8000">##$charset&nbsp;=&nbsp;'utf8mb4';<br><br></span><span style="color: #0000BB">$dsn&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"mysql:host=</span><span style="color: #0000BB">$host</span><span style="color: #DD0000">;dbname=</span><span style="color: #0000BB">$db</span><span style="color: #DD0000">"</span><span style="color: #007700">;<br></span><span style="color: #FF8000">##var_dump($dsn);<br><br></span><span style="color: #0000BB">$opt&nbsp;</span><span style="color: #007700">=&nbsp;[<br></span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">ATTR_ERRMODE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">=&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">ERRMODE_EXCEPTION</span><span style="color: #007700">,<br></span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">ATTR_DEFAULT_FETCH_MODE&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">FETCH_ASSOC</span><span style="color: #007700">,<br></span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">ATTR_EMULATE_PREPARES&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">,<br>];<br><br>try{<br></span><span style="color: #0000BB">$pdo&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">(</span><span style="color: #0000BB">$dsn</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$user</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$pass</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$opt</span><span style="color: #007700">);<br></span><span style="color: #FF8000">##var_dump($pdo);<br></span><span style="color: #007700">}catch(</span><span style="color: #0000BB">Exception&nbsp;$e</span><span style="color: #007700">){<br>echo&nbsp;</span><span style="color: #DD0000">'Message:&nbsp;'&nbsp;</span><span style="color: #007700">.</span><span style="color: #0000BB">$e</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getMessage</span><span style="color: #007700">();<br>exit;<br>}<br><br>function&nbsp;</span><span style="color: #0000BB">user_exists</span><span style="color: #007700">(</span><span style="color: #0000BB">$username</span><span style="color: #007700">)&nbsp;{<br></span><span style="color: #0000BB">$stmt&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #DD0000">'SELECT&nbsp;COUNT(uid)&nbsp;FROM&nbsp;users&nbsp;WHERE&nbsp;username&nbsp;=&nbsp;:username'</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">([</span><span style="color: #DD0000">'username'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$username</span><span style="color: #007700">]);<br></span><span style="color: #0000BB">$result&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetch</span><span style="color: #007700">();<br>return&nbsp;(</span><span style="color: #0000BB">$result&nbsp;</span><span style="color: #007700">==</span><span style="color: #0000BB">1</span><span style="color: #007700">)?</span><span style="color: #0000BB">true</span><span style="color: #007700">:</span><span style="color: #0000BB">false</span><span style="color: #007700">);<br>}<br><br>if(</span><span style="color: #0000BB">user_exists</span><span style="color: #007700">(</span><span style="color: #DD0000">'admin'</span><span style="color: #007700">)&nbsp;===&nbsp;</span><span style="color: #0000BB">true</span><span style="color: #007700">)&nbsp;{<br>echo&nbsp;</span><span style="color: #DD0000">"exists"</span><span style="color: #007700">;<br>}&nbsp;else&nbsp;{<br>echo&nbsp;</span><span style="color: #DD0000">"doesnt&nbsp;exist"</span><span style="color: #007700">;<br>}</span><span style="color: #0000BB"></span></code></code></pre></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Ed! </p>
<p>Thank you for the perfectly formatted question!</p>
<p>Yes, you spotted the problem perfectly. The value returned by fetch() method is not a number but array, and therefore comparing it with a number won't give you any good result. </p>
<p>If you want to fetch the number, you should use fetchColumn() instead. So your code would be</p>
<pre><code><code><span style="color: #0000BB"></span><span style="color: #007700">function&nbsp;</span><span style="color: #0000BB">user_exists</span><span style="color: #007700">(</span><span style="color: #0000BB">$username</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$stmt&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #DD0000">'SELECT&nbsp;COUNT(uid)&nbsp;FROM&nbsp;users&nbsp;WHERE&nbsp;username&nbsp;=&nbsp;:username'</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">([</span><span style="color: #DD0000">'username'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$username</span><span style="color: #007700">]);<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$result&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetchColumn</span><span style="color: #007700">();<br>&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;(</span><span style="color: #0000BB">$result&nbsp;</span><span style="color: #007700">==&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">);<br>}</span><span style="color: #0000BB"></span></code></code></pre>
<p>Besides, the result of == operator is already a boolean, no need to add another condition, you can return it right away.</p>
<p>Also note that echong the error message right away is not advised. Consider the information from the section related to <a href="https://phpdelusions.net/articles/error_reporting">PHP error reporting</a></p>
<p>Feel free to ask if you have any other questions!</p>              </div>
            </li>
 
            <li class="comment" id="comment-294">
              <div class="comment-author">
              	Konrad, 15.10.17 01:15              </div>
              <div class="comment-body" style="overflow:hidden"><p>Hi.</p>
<p>I have a small suggestion - if there are more than e.g. 10 comments, they could be hidden under "show more comments" link, or something. IMHO it doesn't have to be ajax, just a hidden &lt;div&gt; which you show upon clicking the link.</p>
<p>Right now people look at the scrollbar and get scared, because they think the article is soooo long. While it is quite long, and comprehensive, it is not <em>that</em> huge :P   </p>
<p>Plus, next to the 'address' field in the 'comments' section, you could add "not required" and "will not be published" </p>
<p>Thank you very much for this article, I like pointing here ppl who want to start with PDO :P</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Konrad!</p>
<p>Thank you for the suggestions!
I'll definitely implement both of them soon.</p>              </div>
            </li>
 
            <li class="comment" id="comment-291">
              <div class="comment-author">
              	Bryte, 12.10.17 12:46              </div>
              <div class="comment-body" style="overflow:hidden"><p>Hi, please am trying to get a value from a field in a datatable, the scenario is like this:
I have a table with data about four columns, at a click of a button which is an action in the table, a modal appears with four input boxes, I made the first input box disabled so as to pick a value from a field in the table. But i can't seem to implement it. Please can you help?</p></div>
            </li>
 
            <li class="comment" id="comment-285">
              <div class="comment-author">
              	David, 05.10.17 18:45              </div>
              <div class="comment-body" style="overflow:hidden"><p>Thank you for your reply.
I am a little confused though, but will try to solve my lack of knowledge.
Regards.
David.</p></div>
            </li>
 
            <li class="comment" id="comment-284">
              <div class="comment-author">
              	David Entwistle, 05.10.17 18:09              </div>
              <div class="comment-body" style="overflow:hidden"><p>I would appreciate your help with a PDO issue.
I am calling a PDO select function which works except I only get one piece of data from a file that contains two pieces. the code is </p>
<p>The field "Dn" should return "Firstname Surname" separted by a space.
All I get returned is the Firstname.
Please can you help me ?
Regards David.</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello David!</p>
<p>Most likely your issue is not with PDO but with HTML.
Check the HRML source of your page and find your last name all right.</p>
<p>Then follow the HTML syntax and wrap Dn field value in quotes :)</p>              </div>
            </li>
 
            <li class="comment" id="comment-281">
              <div class="comment-author">
              	Tyler, 04.10.17 06:03              </div>
              <div class="comment-body" style="overflow:hidden"><p>Hey, I was linked to your site, and it seems to have some nice recommendations. That said, I was looking at the section on rowCount, and it seems like you take quite the position on 'it shouldn't be necessary'. I've run into this quite a bit when performing pagination of results, and I'm curious as to what your recommendation is to do in this case instead of getting a row count?</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Tyler!</p>
<p>I should have probably emphasized it better, but using anything like row count for pagination is not something "not necessary" but a big mistake.</p>
<p>For paginafion you need 2 queries: one that gets actual data for a particular page, for this query you don't need no count at all.</p>
<p>Another query, which is used to get the total number of rows, should never be using anything like row count. Instead of selecting actual rows and then discarding them, only to get the count, one have to get just the count already, by using a select count(*) query. Otherwise it will defeat the very purpose of pagination: selecting only a smaller amount of data that will be actually processed. It's not a big deal for a personal home page, but selecting all the big data only to count it may kill a mature site.</p>              </div>
            </li>
 
            <li class="comment" id="comment-280">
              <div class="comment-author">
              	MF, 29.09.17 14:57              </div>
              <div class="comment-body" style="overflow:hidden"><p>Hi!
Whoever you are. I just wanted to let you know, that all your tips and best practices are helping me a lot to code better and more efficient.
I can't thank you enough!</p></div>
            </li>
 
            <li class="comment" id="comment-279">
              <div class="comment-author">
              	K, 28.09.17 22:48              </div>
              <div class="comment-body" style="overflow:hidden"><p>I just wanted to say thank you - your solution worked perfectly!</p></div>
            </li>
 
            <li class="comment" id="comment-277">
              <div class="comment-author">
              	JamesP, 27.09.17 11:50              </div>
              <div class="comment-body" style="overflow:hidden"><p>So I understand PDO Prepared Statements should protect from SQL injection and ' escapes. But when I attempted the following...</p>
<pre><code><code><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;$id&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"2'&nbsp;AND&nbsp;name='Entry2"</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$someinfo&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"updated"</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;...</span><span style="color: #0000BB">DB&nbsp;Stuff</span><span style="color: #007700">...<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$conn&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">(</span><span style="color: #DD0000">"mysql:host=</span><span style="color: #0000BB">$servername</span><span style="color: #DD0000">;dbname=</span><span style="color: #0000BB">$dbname</span><span style="color: #DD0000">"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$username</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$dbpassword</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$stmt&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$conn</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #DD0000">"UPDATE&nbsp;testdb&nbsp;SET&nbsp;info=:someinfo&nbsp;WHERE&nbsp;id=:id"</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">bindParam</span><span style="color: #007700">(</span><span style="color: #DD0000">':id'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$id</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">bindParam</span><span style="color: #007700">(</span><span style="color: #DD0000">':someinfo'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$someinfo</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">();</span><span style="color: #0000BB"></span></code></code></pre>
<p>Then the row with id=2 and name=entry2 would be updated. I should note, I only saw this behavior within the "WHERE ..." part of the query. It did not escape in the "SET...WHERE" part of the query, and I wasn't able to add any additional queries in either. I observed the same behavior when I tried with mysqli as well.</p>
<p>That said, I didn't find anyone pointing this out anywhere, and when I asked on Stack Overflow, no one believed me. I could probably just manually replace ' instances with something else for storage and replace again for output, but the fact that I'm the only one who seems to observe this has me seriously confused. Any insight would be greatly appreciated.</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello James!</p>
<p>It is quite strange that on Stack Overflow nobody believed you, as the behavior is quite expected, given the way mysql (and PHP as well) treat input values. Well, nothing strange on the other hand, given the average level of expertise there. </p>
<p>So, the issue is not actually an injection, neither it has anything to do with PDO. It's an integral part of MySQL. By default, in the older versions of Mysql (pre 5.7. if I am not mistaken), when casting input value to an integer, it takes first numeric characters, cutting off everything else. You can see it with such a simple example:</p>
<pre><code><code><span style="color: #0000BB">mysql</span><span style="color: #007700">&gt;&nbsp;</span><span style="color: #0000BB">select&nbsp;</span><span style="color: #DD0000">'25&nbsp;ponies'&nbsp;</span><span style="color: #007700">+&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">;<br>+-----------------+<br>|&nbsp;</span><span style="color: #DD0000">'25&nbsp;ponies'&nbsp;</span><span style="color: #007700">+&nbsp;</span><span style="color: #0000BB">0&nbsp;</span><span style="color: #007700">|<br>+-----------------+<br>|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">25&nbsp;</span><span style="color: #007700">|<br>+-----------------+</span><span style="color: #0000BB"></span></code></code></pre>
<p>As you can see, the value become just 25 when cast to an integer to perform an arithmetic operation. </p>
<p>Exactly the same happened in your example. Value "2" has been taken out of the "2' AND name='Entry2" string which made a legitimate query and thus the record got updated.</p>
<p>To prevent this behavior you can set mysql in strict mode, like </p>
<pre><code><code><span style="color: #0000BB">set&nbsp;SQL_MODE</span><span style="color: #007700">=</span><span style="color: #DD0000">'STRICT_TRANS_TABLES'</span><span style="color: #007700">;</span><span style="color: #0000BB"></span></code></code></pre>
<p>it will start throwing errors for the malformed numeric values instead of silently casting them. </p>
<p>I've reopened your question on Stack Overflow, you can now write an answer for it and link to this comment, <a href="https://phpdelusions.net/pdo#comment-277">https://phpdelusions.net/pdo#comment-277</a> as a proof</p>              </div>
            </li>
 
            <li class="comment" id="comment-276">
              <div class="comment-author">
              	Your Friendly PHP Neighbour, 26.09.17 19:10              </div>
              <div class="comment-body" style="overflow:hidden"><p>Beware that nothing will alert you about the lack of support for the <code>PDO::MYSQL_ATTR_FOUND_ROWS</code> attribute.</p>
<p>Only way to check if your PHP is going to ignore this attribute is to call <code>$pdo-&gt;getAttribute(PDO::MYSQL_ATTR_FOUND_ROWS)</code>. Not sure why this <a href="https://bugs.php.net/bug.php?id=62782">isn't done when setting the attribute</a>. Go figure the reasoning behind this.</p>
<p>To reiterate: </p>
<ol>
<li>The PDO class constant <code>PDO::MYSQL_ATTR_FOUND_ROWS</code> doesn't always work, <a href="https://bugs.php.net/bug.php?id=63781">even if the constant is defined</a>.</li>
<li>To test if it will work, you must use <code>getAttribute()</code>.</li>
<li>If the connection option doesn't work, you're out of luck (short of recompiling your PDO driver). </li>
<li><a href="https://bugs.php.net/bug.php?id=44135">Don't trust the manual.</a>.</li>
</ol></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Neighbour!</p>
<p>I thank you for your valuable info! Looks like an important case. I added the link to this comment to the article.</p>
<p>Though I can answer one of your concerns. Given that <code>MYSQL_ATTR_FOUND_ROWS</code> is a <em>connection</em> option for MySQL, it's impossible to use it anywhere else, and thus there is no way to change this parameter on the fly, within the same connection, unless Mysqli C API will be changed.</p>              </div>
            </li>
 
            <li class="comment" id="comment-275">
              <div class="comment-author">
              	K, 20.09.17 22:45              </div>
              <div class="comment-body" style="overflow:hidden"><p>Hi,</p>
<p>I'm sorry if my previous question was unclear, but I'd love an answer, even as to whether this is possible, if you have the time.</p>
<p>I'd like to do something like this:</p>
<pre><code><code><span style="color: #0000BB">$query&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$dbc</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #DD0000">"UPDATE<br>&nbsp;&nbsp;&nbsp;&nbsp;customer_info<br>&nbsp;&nbsp;&nbsp;&nbsp;SET<br>&nbsp;&nbsp;&nbsp;&nbsp;customer_name&nbsp;=&nbsp;:customer_name,<br>&nbsp;&nbsp;&nbsp;&nbsp;billing_email&nbsp;=&nbsp;:billing_email<br>&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;customer_id&nbsp;=&nbsp;:customer_id"</span><span style="color: #007700">);</span><span style="color: #0000BB"></span></code></code></pre>
<p>where customer_name and customer_email come from (sanitized) user inputs. Is it possible to format this query so that if I wanted to update ONLY the customer name or ONLY the customer email it would not overwrite the item that I'm NOT updating? So if the user inputs a customer name and leaves the email blank, it will update the name but preserve the email that is already in the database.</p>
<p>In order to do this would I have to write a separate query for each item? In my actual code I have many other items that I'd like to be able to update without overwriting the information in all of the database columns at once. It seems like using positional parameters might be a solution, but I haven't been able to get it to work. I was hoping you could tell me if this is possible, thanks!</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello!</p>
<p>Sorry for the delayed answer, by the time you asked for the first time, I've been on vacations and missed your comment.</p>
<p>What I would suggest is to create a query dynamically, from the array provided, as it's explained in <a href="https://phpdelusions.net/pdo/sql_injection_example#solution">this article</a></p>
<p>So it should be like</p>
<pre><code><code><span style="color: #0000BB"></span><span style="color: #FF8000">//&nbsp;create&nbsp;an&nbsp;array&nbsp;that&nbsp;contains&nbsp;fields&nbsp;you&nbsp;want&nbsp;to&nbsp;update<br></span><span style="color: #0000BB">$data&nbsp;</span><span style="color: #007700">=&nbsp;[</span><span style="color: #DD0000">"customer_name"</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #DD0000">"something"</span><span style="color: #007700">;<br><br></span><span style="color: #FF8000">//&nbsp;create&nbsp;a&nbsp;whitelist&nbsp;to&nbsp;be&nbsp;sure<br></span><span style="color: #0000BB">$allowed&nbsp;</span><span style="color: #007700">=&nbsp;[</span><span style="color: #DD0000">"customer_name"</span><span style="color: #007700">,</span><span style="color: #DD0000">"billing_email"</span><span style="color: #007700">];<br><br></span><span style="color: #FF8000">//&nbsp;create&nbsp;a&nbsp;SET&nbsp;clause&nbsp;dynamically<br></span><span style="color: #0000BB">$params&nbsp;</span><span style="color: #007700">=&nbsp;[];<br></span><span style="color: #0000BB">$setStr&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">""</span><span style="color: #007700">;<br>foreach&nbsp;(</span><span style="color: #0000BB">$allowed&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$key</span><span style="color: #007700">)<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(isset(</span><span style="color: #0000BB">$data</span><span style="color: #007700">[</span><span style="color: #0000BB">$key</span><span style="color: #007700">])&nbsp;&amp;&amp;&nbsp;</span><span style="color: #0000BB">$key&nbsp;</span><span style="color: #007700">!=&nbsp;</span><span style="color: #DD0000">"id"</span><span style="color: #007700">)<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$setStr&nbsp;</span><span style="color: #007700">.=&nbsp;</span><span style="color: #DD0000">"`"</span><span style="color: #007700">.</span><span style="color: #0000BB">str_replace</span><span style="color: #007700">(</span><span style="color: #DD0000">"`"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"``"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$key</span><span style="color: #007700">).</span><span style="color: #DD0000">"`&nbsp;=&nbsp;:"</span><span style="color: #007700">.</span><span style="color: #0000BB">$key</span><span style="color: #007700">.</span><span style="color: #DD0000">","</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$params</span><span style="color: #007700">[</span><span style="color: #0000BB">$key</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #0000BB">$key</span><span style="color: #007700">];<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>}<br></span><span style="color: #0000BB">$setStr&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">rtrim</span><span style="color: #007700">(</span><span style="color: #0000BB">$setStr</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">","</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$params</span><span style="color: #007700">[</span><span style="color: #DD0000">'id'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$id</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #DD0000">"UPDATE&nbsp;customer_info&nbsp;SET&nbsp;</span><span style="color: #0000BB">$setStr</span><span style="color: #DD0000">&nbsp;WHERE&nbsp;customer_id&nbsp;=&nbsp;:id"</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">(</span><span style="color: #0000BB">$params</span><span style="color: #007700">);</span><span style="color: #0000BB"></span></code></code></pre>
<p>Feel free to ask if you have any other questions</p>              </div>
            </li>
 
            <li class="comment" id="comment-273">
              <div class="comment-author">
              	Jeremy, 15.09.17 11:04              </div>
              <div class="comment-body" style="overflow:hidden"><p>Thank you for your reply.
I will give more detail into my reasoning.</p>
<p>I have an online store i have built and i am afraid that a customer may be left on a blank page or an abruptly ended script without reason during the checkout process, or post checkout process receiving their order confirmation. I've encountered such an error myself on another website from having an intermittent internet connection and being left without any notification it leaves fear of having paid for something without the order having being processed properly on their end. </p>
<p>I've been trying to handle every single type of error imaginable so my code is full of try... catches as well as a billion if statements. I'm desperately trying make my coding much more efficient. </p>
<p>My use of the try... catch operator would also be that if there was an error on a product page I would have liked it to just keep the script running and display the 'Sorry we could not find your product' situation, as a kind of diversion until i can fix what is wrong.</p>
<p>I will read you article on error reporting in further depth.</p>
<p>Thank you</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Jeremy!</p>
<p>I am eager to hear what are your thoughts after reading the article? Do you agree that centralized error reporting is better than catching every  exception separately?</p>
<p>At the very least you an create a global try..catch wrapping your whole code from start to end. But To me, using a handler is more elegant solution</p>              </div>
            </li>
 
            <li class="comment" id="comment-272">
              <div class="comment-author">
              	David Entwistle, 11.09.17 18:05              </div>
              <div class="comment-body" style="overflow:hidden"><p>Please can you help me resolve an issue?
I have a user input box which starts a search of a PDO MySql table :- using this code snippet.&lt;input type="text" name = "t1" id="t1" placeholder="Enter an RD number"&gt;
&lt;input type="button" name="button1" value="GO" onClick="aa();"&gt; &lt;/td&gt;
&lt;td colspan="2" align="center"&gt;&lt;div id="d1"&gt;&lt;/td&gt;
via this code- &lt;script type="text/javascript"&gt;
function aa()
{
var xmlhttp=new XMLHttpRequest();
xmlhttp.open("GET","getrd.php?Regno="+document.getElementById("t1").value,false);
xmlhttp.send(null);
document.getElementById("d1").innerHTML=xmlhttp.responseText;&lt;script&gt; this returns 3 data items.  All this works. My issue is how can I put these 3 data items into &lt;input type="text" name = "Rd" id="ret1" placeholder="Rd No" &gt;
&lt;input type="text" name = "Dn" id="ret2" placeholder="DN"&gt;
&lt;input type="text" name = "St" id="ret3" placeholder="Status"&gt;
I have tried a number of variations of the above code without success, I am sure there is a way to do it but I am unable to get there yet.
Many thanks.
David.</p></div>
            </li>
 
            <li class="comment" id="comment-271">
              <div class="comment-author">
              	Jeremy, 08.09.17 01:01              </div>
              <div class="comment-body" style="overflow:hidden"><p>So i understand that i shouldn't use try .. catch for error reporting. But is it fine to use for displaying a custom notification to the user that an error has occurred?</p>
<p>Furthermore, if omitting rowCount as a boolean flag and using the $stmt variable to see if any data was returned;</p>
<pre><code><code><span style="color: #0000BB">$data&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">"SELECT&nbsp;*&nbsp;FROM&nbsp;table"</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">fetchAll</span><span style="color: #007700">();<br>if&nbsp;(</span><span style="color: #0000BB">$data</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;You&nbsp;have&nbsp;the&nbsp;data!&nbsp;No&nbsp;need&nbsp;for&nbsp;the&nbsp;rowCount()&nbsp;ever!<br></span><span style="color: #007700">}</span><span style="color: #0000BB"></span></code></code></pre>
<p>If an exception has been thrown and caught the $data variable remains set and giving a true boolean value even though there is no data present, and it doesn't seem possible to globally unset($data) inside the catch as it's a function.</p>
<p>I would like to catch an error to notify the use 'Something went wrong' and to return a false boolean flag to handle the rest of the script outside of the try... catch. How would you recommend the best way i can achieve this?</p>
<p>I'm still learning programming.</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Jeremy!</p>
<p>Sorry for the delayed answer, I've been on vacation.</p>
<p>Regarding the first question, it is <em>extremely seldom</em> when you need to provide a custom error message. Given you are still learning, it is possible that your understanding of the error reporting is rather wrong. Kindly read this article, <a href="https://phpdelusions.net/articles/error_reporting">https://phpdelusions.net/articles/error_reporting</a> and I hope you'll change your mind. </p>
<p>The second question is simpler to answer. If an exception has been thrown and caught, the $data variable is <strong>not set</strong>, so there is no trouble with unsetting it whatsoever. </p>
<p>If you want to continue the script execution even in case of error, it's a <strong>fair use</strong> of the try..catch operator. But still, I cannot imagine the practical case. Could you please comment back with a little more detailed description of the scenario you have in mind?</p>              </div>
            </li>
 
            <li class="comment" id="comment-268">
              <div class="comment-author">
              	Adri, 03.09.17 18:25              </div>
              <div class="comment-body" style="overflow:hidden"><p>Thank you for that. However, I'm now confused even more. I get:  "Fatal error: Call to a member function query() on null" and then the path to the document... Alternatively, I get a blank page</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Well, this one is simple. All you need is to read the article above, Particularly the <a href="https://phpdelusions.net/pdo#errors">error reporting</a> part. You didn't tell a database to report mysql errors and thus getting this cryptic one. Just make it the proper way and see.</p>              </div>
            </li>
 
            <li class="comment" id="comment-266">
              <div class="comment-author">
              	Adri, 03.09.17 15:54              </div>
              <div class="comment-body" style="overflow:hidden"><p>Thanks very much (hope formatting is correct). Here it is. I created one class for connecting to my database:</p>
<pre><code><code><span style="color: #0000BB"></span><span style="color: #007700">&lt;?</span><span style="color: #0000BB">php<br></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">Database&nbsp;</span><span style="color: #007700">{<br>private&nbsp;static&nbsp;</span><span style="color: #0000BB">$instance&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">;<br>private&nbsp;function&nbsp;</span><span style="color: #0000BB">__construct</span><span style="color: #007700">(){}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;</span><span style="color: #0000BB">getInstance</span><span style="color: #007700">()&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(</span><span style="color: #0000BB">is_null</span><span style="color: #007700">(</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">$instance</span><span style="color: #007700">)){<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">$instance&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">(</span><span style="color: #DD0000">"mysql:host=localhost;dbname=elektroakustika;"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"root"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">""</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">$instance</span><span style="color: #007700">;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span style="color: #0000BB"></span></code></code></pre>
<p>And now I'm making one that is supposed to handle queries (called it ActiveRecord as that is the pattern I'm trying to implement):</p>
<pre><code><code><span style="color: #0000BB"></span><span style="color: #007700">abstract&nbsp;class&nbsp;</span><span style="color: #0000BB">ActiveRecord&nbsp;</span><span style="color: #007700">{&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;</span><span style="color: #0000BB">$conn</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;</span><span style="color: #0000BB">getAll</span><span style="color: #007700">(){<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$conn&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Database</span><span style="color: #007700">::</span><span style="color: #0000BB">getInstance</span><span style="color: #007700">();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$table&nbsp;</span><span style="color: #007700">=&nbsp;static::</span><span style="color: #0000BB">$table</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$q&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$conn</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">"select&nbsp;*&nbsp;from&nbsp;</span><span style="color: #007700">{</span><span style="color: #0000BB">$table</span><span style="color: #007700">}</span><span style="color: #DD0000">"</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$res&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$q</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetchAll</span><span style="color: #007700">();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$res</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>}</span><span style="color: #0000BB"></span></code></code></pre>
<p>Finally, I plan to create a class for each table in my db, that will extend the previous class and use one of the methods I'll create in ActiveRecord. Something like this: </p>
<pre><code><code><span style="color: #0000BB"></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">Autor&nbsp;</span><span style="color: #007700">extends&nbsp;</span><span style="color: #0000BB">ActiveRecord&nbsp;</span><span style="color: #007700">{<br>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;</span><span style="color: #0000BB">$table&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"autor"</span><span style="color: #007700">;<br>}<br></span><span style="color: #0000BB">$conn&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Database</span><span style="color: #007700">::</span><span style="color: #0000BB">getInstance</span><span style="color: #007700">();<br></span><span style="color: #0000BB">$allAutors&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Autor</span><span style="color: #007700">::</span><span style="color: #0000BB">getAll</span><span style="color: #007700">();<br></span><span style="color: #0000BB">print_r</span><span style="color: #007700">(</span><span style="color: #0000BB">$allAutors</span><span style="color: #007700">);</span><span style="color: #0000BB"></span></code></code></pre>
<p>When I run the last code, I get the error, so obviously, my query is wrong. I realize this is quite basic, but I can't seem to solve the problem. Thank you!</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Adri!</p>
<p>Sorry I forgot to mention that a code should be padded by empty lines as well. But nevermind, I already added them.</p>
<p>First and foremost: the "error" you are getting is not just a red card telling you that you failed something. It usually <strong>explains</strong> what specific error you made. So it's always worth to read what the error says or at least provide to a person you are asking for help. There could be thousands errors, and its no use to stare at the code looking for them if PHP can tell you that already. Especially because it can be caused not by the code itself but by some other issue - a database, or server config or whatever.</p>
<p>As of your code, I tried it and it works.</p>              </div>
            </li>
 
            <li class="comment" id="comment-265">
              <div class="comment-author">
              	Adri, 02.09.17 16:49              </div>
              <div class="comment-body" style="overflow:hidden"><p>Hi! I'm trying to implement PDO in my code (I'm a complete noob, by the way) and I have a "why won't this work" type of issue. Would you mind checking it out (I'm not sure if that is OK, which is why I'm not sharing the code now)? Thanks for your explanations, by the way, they are incredibly useful!</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Adri!</p>
<p>Yes it's all right to ask a question here. Just make sure that your code is indented by 4 spaces, so it will be nicely formatted</p>              </div>
            </li>
 
            <li class="comment" id="comment-261">
              <div class="comment-author">
              	Valdas, 27.08.17 23:18              </div>
              <div class="comment-body" style="overflow:hidden"><p>Thanks a lot, PDO is FTW :)))</p></div>
            </li>
 
            <li class="comment" id="comment-257">
              <div class="comment-author">
              	K, 25.08.17 17:50              </div>
              <div class="comment-body" style="overflow:hidden"><p>Hi, sorry if this is a double post! I wasn't sure if my other comment was in moderation or disappeared. </p>
<p>Thanks for the great tutorial, it's one of the best I've come across for learning to use PDO. </p>
<p>I was wondering if you could give an example of how to create a PDO update query where you can have a variable number of inputs. So for example if I have a form where I can update a customer's name, email, or phone number. But sometimes I want to update only one at a time without overwriting the information already in the database.</p></div>
            </li>
 
            <li class="comment" id="comment-255">
              <div class="comment-author">
              	Tomi, 14.08.17 20:17              </div>
              <div class="comment-body" style="overflow:hidden"><p>Awesome! I'm just learning PHP and this was the first tutorial that made any sense. Most have code without going to the details which are the most confusing part at the start</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Tomi!</p>
<p>Thank you for your kind words!</p>
<p>Can you do me a favor? I am going to add a section called "PDO examples" with practical examples of PDO usage. If you can think of any example case you'd like you see, please drop a comment.</p>              </div>
            </li>
 
            <li class="comment" id="comment-254">
              <div class="comment-author">
              	abinax, 11.08.17 22:27              </div>
              <div class="comment-body" style="overflow:hidden"><p>Thank You</p></div>
            </li>
 
            <li class="comment" id="comment-251">
              <div class="comment-author">
              	Trevor S, 26.07.17 21:27              </div>
              <div class="comment-body" style="overflow:hidden"><p>This is an awesome guide, thanks so much for this.</p></div>
            </li>
 
            <li class="comment" id="comment-250">
              <div class="comment-author">
              	Christian, 24.07.17 18:05              </div>
              <div class="comment-body" style="overflow:hidden"><p>So a normal use case would be like this.</p>
<pre><code><code><span style="color: #0000BB">$table&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">myTable</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$table&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"`"</span><span style="color: #007700">.</span><span style="color: #0000BB">str_replace</span><span style="color: #007700">(</span><span style="color: #DD0000">"`"</span><span style="color: #007700">,</span><span style="color: #DD0000">"``"</span><span style="color: #007700">,</span><span style="color: #0000BB">$table</span><span style="color: #007700">).</span><span style="color: #DD0000">"`"</span><span style="color: #007700">;</span><span style="color: #0000BB"></span></code></code></pre>
<p>Now $table is:</p>
<pre><code><code><span style="color: #0000BB">$table&nbsp;</span><span style="color: #007700">=&nbsp;`</span><span style="color: #DD0000">myTable</span><span style="color: #007700">`;</span><span style="color: #0000BB"></span></code></code></pre>
<p>Then I use this for query:</p>
<pre><code><code><span style="color: #0000BB">$sql&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">SELECT&nbsp;</span><span style="color: #007700">*&nbsp;</span><span style="color: #0000BB">from&nbsp;$table</span><span style="color: #007700">;&nbsp;</span><span style="color: #0000BB"></span></code></code></pre>
<p>or use </p>
<pre><code><code><span style="color: #0000BB">$sql&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">SELECT&nbsp;</span><span style="color: #007700">*&nbsp;</span><span style="color: #0000BB">from&nbsp;</span><span style="color: #007700">`</span><span style="color: #0000BB">$table</span><span style="color: #007700">`</span><span style="color: #0000BB"></span><span style="color: #007700">;&nbsp;</span><span style="color: #0000BB"></span></code></code></pre>
<p>?</p>
<p>Thanks again.</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Christian!</p>
<p>If backticks are already added to the identifier, then there is no point to add them again. So it should be your first variant.</p>              </div>
            </li>
 
            <li class="comment" id="comment-249">
              <div class="comment-author">
              	Christian, 24.07.17 16:37              </div>
              <div class="comment-body" style="overflow:hidden"><p>Thank you for articles and your responses to questions. Can you please clarify the section Prepared statements and table names?</p>
<pre><code><code><span style="color: #0000BB">$table&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"`"</span><span style="color: #007700">.</span><span style="color: #0000BB">str_replace</span><span style="color: #007700">(</span><span style="color: #DD0000">"`"</span><span style="color: #007700">,</span><span style="color: #DD0000">"``"</span><span style="color: #007700">,</span><span style="color: #0000BB">$table</span><span style="color: #007700">).</span><span style="color: #DD0000">"`"</span><span style="color: #0000BB"></span></code></code></pre>
<p>I read that MySQL an identifier needs a (`) backtick if it contains special characters or is a reserved word. In your example we concatenate (`) backticks on both side of the identifier and replace single backticks with double backticks on original $table variable. So the new $table variable would be ``identifier`` because extra backticks are like an escape character(\) and that would remove one backtick? How does this sanitize $table variable ? Does this have anything to do with PHP Execution Operators? Thank you for your help!</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Christian!</p>
<p>Thank you for the good question.
Look at this from the point of view of the regular string formatting. To format a string we need to enclose it into delimiters and then escape those delimiters that could happen to be inside. Exactly the same we are doing here: We are adding delimiters (single backticks around) and then escaping these that are could be already inside of the table name. But we don't double the surrounding backticks, neither removing any. The above statement could be split into two:</p>
<pre><code><code><span style="color: #0000BB">$table&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">str_replace</span><span style="color: #007700">(</span><span style="color: #DD0000">"`"</span><span style="color: #007700">,</span><span style="color: #DD0000">"``"</span><span style="color: #007700">,</span><span style="color: #0000BB">$table</span><span style="color: #007700">);&nbsp;</span><span style="color: #FF8000">//&nbsp;escape&nbsp;possible&nbsp;delimiters&nbsp;inside<br></span><span style="color: #0000BB">$table&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"`</span><span style="color: #0000BB">$table</span><span style="color: #DD0000">)`"</span><span style="color: #007700">;&nbsp;</span><span style="color: #FF8000">//&nbsp;adding&nbsp;backticks</span><span style="color: #0000BB"></span></code></code></pre>
<p>Imagine we have a table name coming from the user input and a hacker put a backtick inside. Without doubling, with only surrounding backticks we'll get an injection:</p>
<pre><code><code><span style="color: #0000BB">$table&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"table`&nbsp;UNION&nbsp;...&nbsp;--"</span><span style="color: #007700">;&nbsp;</span><span style="color: #FF8000">//&nbsp;coming&nbsp;from&nbsp;user<br></span><span style="color: #0000BB">$sql&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"SELECT&nbsp;FROM&nbsp;`</span><span style="color: #0000BB">$table</span><span style="color: #DD0000">`&nbsp;LIMIT&nbsp;10"</span><span style="color: #007700">;</span><span style="color: #0000BB"></span></code></code></pre>
<p>will result with malicious query </p>
<pre><code><code><span style="color: #0000BB">$sql&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"SELECT&nbsp;FROM&nbsp;`table`&nbsp;UNION&nbsp;...&nbsp;--`&nbsp;LIMIT&nbsp;10"</span><span style="color: #007700">;</span><span style="color: #0000BB"></span></code></code></pre>
<p>whereas with doubled backticks inside the whole statement will make a query like this </p>
<pre><code><code><span style="color: #0000BB">$sql&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"SELECT&nbsp;FROM&nbsp;`table``&nbsp;UNION&nbsp;...&nbsp;--`&nbsp;LIMIT&nbsp;10"</span><span style="color: #007700">;</span><span style="color: #0000BB"></span></code></code></pre>
<p>Where </p>
<pre><code><code><span style="color: #0000BB"></span><span style="color: #007700">`</span><span style="color: #DD0000">table</span><span style="color: #007700">``</span><span style="color: #DD0000">&nbsp;UNION&nbsp;...&nbsp;--</span><span style="color: #007700">`</span><span style="color: #0000BB"></span></code></code></pre>
<p>is a single identifier (a-non existent of course, which will produce an error, but an error is better than injection).</p>
<p>Hope it is clear now. If not, please ask :)</p>              </div>
            </li>
 
            <li class="comment" id="comment-248">
              <div class="comment-author">
              	Christian, 24.07.17 16:32              </div>
              <div class="comment-body" style="overflow:hidden"><p>Thank you for articles and your responses to questions.  Can you please clarify the section Prepared statements and table names?</p>
<pre><code><code><span style="color: #0000BB">$table&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"`"</span><span style="color: #007700">.</span><span style="color: #0000BB">str_replace</span><span style="color: #007700">(</span><span style="color: #DD0000">"`"</span><span style="color: #007700">,</span><span style="color: #DD0000">"``"</span><span style="color: #007700">,</span><span style="color: #0000BB">$table</span><span style="color: #007700">).</span><span style="color: #DD0000">"`"</span><span style="color: #0000BB"></span></code></code></pre>
<p>I read that MySQL an identifier needs a (<code>) backtick if it contains special characters or is a reserved word. In your example we concatenate (</code>) backticks on both side of the identifier and replace single backticks with double backticks on original $table variable.  So the new $table variable would be <code>identifier</code> because extra backticks are like an escape character() and that would remove one backtick?  How does this sanitize $table variable ? Does this have anything to do with PHP Execution Operators? Thank you for your help!</p></div>
            </li>
 
            <li class="comment" id="comment-245">
              <div class="comment-author">
              	Bill Hayden, 13.07.17 13:44              </div>
              <div class="comment-body" style="overflow:hidden"><p>There seems to be a bug in the code sample that describes the foreach functionality:</p>
<pre><code><code><span style="color: #0000BB">$stmt&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">'SELECT&nbsp;name&nbsp;FROM&nbsp;users'</span><span style="color: #007700">);<br>foreach&nbsp;(</span><span style="color: #0000BB">$stmt&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$row</span><span style="color: #007700">)<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">'name'</span><span style="color: #007700">]&nbsp;.&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br>}</span><span style="color: #0000BB"></span></code></code></pre>
<p>This should be:</p>
<pre><code><code><span style="color: #0000BB">$stmt&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">'SELECT&nbsp;name&nbsp;FROM&nbsp;users'</span><span style="color: #007700">);<br>foreach&nbsp;(</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetchAll</span><span style="color: #007700">()&nbsp;as&nbsp;</span><span style="color: #0000BB">$row</span><span style="color: #007700">)<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">'name'</span><span style="color: #007700">]&nbsp;.&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br>}</span><span style="color: #0000BB"></span></code></code></pre>
<p>Alternatively, you could put -&gt;fetchAll() at the end of the $stmt assignment instead of in the foreach.</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello, Bill!</p>
<p>There is no error and there is an explanation why it is so.</p>
<p>Let me suggest you to try the first code snippet yourself, see it actually works and then follow the link from the article explaining the trick :)</p>              </div>
            </li>
 
            <li class="comment" id="comment-244">
              <div class="comment-author">
              	Christian, 12.07.17 22:17              </div>
              <div class="comment-body" style="overflow:hidden"><p>Does Sanitizing like the following make sense?</p>
<pre><code><code><span style="color: #0000BB">$pdo&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">(</span><span style="color: #DD0000">'sqlite:/path/db/users.db'</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$stmt&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #DD0000">'SELECT&nbsp;name&nbsp;FROM&nbsp;users&nbsp;WHERE&nbsp;id&nbsp;=&nbsp;:id'</span><span style="color: #007700">);<br></span><span style="color: #FF8000">//&nbsp;filter&nbsp;your&nbsp;data&nbsp;first&nbsp;,&nbsp;especially&nbsp;important&nbsp;for&nbsp;INSERT,&nbsp;UPDATE,&nbsp;etc.<br></span><span style="color: #0000BB">$id&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">filter_input</span><span style="color: #007700">(</span><span style="color: #0000BB">INPUT_GET</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'id'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">FILTER_SANITIZE_NUMBER_INT</span><span style="color: #007700">);&nbsp;&nbsp;<br></span><span style="color: #FF8000">//&nbsp;Automatically&nbsp;sanitized&nbsp;for&nbsp;SQL&nbsp;by&nbsp;PDO<br></span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">bindParam</span><span style="color: #007700">(</span><span style="color: #DD0000">':id'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$id</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">PARAM_INT</span><span style="color: #007700">);&nbsp;<br></span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">();</span><span style="color: #0000BB"></span></code></code></pre></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Christian!</p>
<p>If you mean <code>filter_input()</code>, it's superfluous for this code snippet. Using prepared statement is secure enough. So, an extra sanitization won't make too much sense.</p>
<p>Personally, I would make such a snippet quite shorter</p>
<pre><code><code><span style="color: #0000BB">$pdo&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">(</span><span style="color: #DD0000">'sqlite:/path/db/users.db'</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$stmt&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #DD0000">'SELECT&nbsp;name&nbsp;FROM&nbsp;users&nbsp;WHERE&nbsp;id&nbsp;=&nbsp;?'</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">([</span><span style="color: #0000BB">$_GET</span><span style="color: #007700">[</span><span style="color: #DD0000">'id'</span><span style="color: #007700">]]);&nbsp;</span><span style="color: #0000BB"></span></code></code></pre>
<p>but it's only a matter of taste and you can keep with manual binding and named parameters.</p>              </div>
            </li>
 
            <li class="comment" id="comment-243">
              <div class="comment-author">
              	David Entwistle, 10.07.17 16:22              </div>
              <div class="comment-body" style="overflow:hidden"><p>Thanks for your reply.  When a user has logged in they presented with a menu screen to choose where on the site they want to work. Then a menu second allows them to select a sub area to work in according to their user rights. its function is to open MySql tables via a PDO connection. this is the problem screen. it is taking too long to appear. Thanks David E.</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>It's hard to tell what could be a problem.
But at least try to change "localhost" to 127.0.0.1 in the DSN.</p>
<p>If it's not the case, you need to investigate more, what particular operator in your code takes all the time.</p>              </div>
            </li>
 
            <li class="comment" id="comment-242">
              <div class="comment-author">
              	David Entwistle, 10.07.17 15:01              </div>
              <div class="comment-body" style="overflow:hidden"><p>Many thanks for your prompt reply. I was trying to avoid the "waiting for" messages.  Your answer is very much appreciated. Thanks again. David E.</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Can you please elaborate on these "waiting for" messages? May be I can offer some solution, but for the moment I am not quite getting what is it.</p>              </div>
            </li>
 
            <li class="comment" id="comment-241">
              <div class="comment-author">
              	David Entwistle, 10.07.17 14:45              </div>
              <div class="comment-body" style="overflow:hidden"><p>A question of good practice.
Is it appropriate to create database connection at login time and then not close the connection until logging out ?</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello David!</p>
<p>thank you for the good question.</p>
<p>It depends on what you're calling "login" and "logout".<br>
In case you're talking of a user visiting your site, it would be impossible. The nature of PHP's life-cycle is atomic. It starts every time a user visits another page, generates the page to be shown, and then dies, a fraction of second after starting. And so with every new page a new PDO connection inevitably have to be established.</p>
<p>In case you are talking of a single script execution - yes, like it said in the article, the connection should be established only once.</p>
<p>You're welcome to ask if something is still unclear for you!</p>              </div>
            </li>
 
            <li class="comment" id="comment-240">
              <div class="comment-author">
              	Sujata, 10.07.17 14:14              </div>
              <div class="comment-body" style="overflow:hidden"><blockquote>
<p>Thanks for the great article!</p>
</blockquote></div>
            </li>
 
            <li class="comment" id="comment-238">
              <div class="comment-author">
              	David Entwistle, 06.07.17 18:06              </div>
              <div class="comment-body" style="overflow:hidden"><p>Many thanks for the updated code, it is working perfectly now.  Very much appreciated. Kind regards. David E.</p></div>
            </li>
 
            <li class="comment" id="comment-236">
              <div class="comment-author">
              	David Entwistle, 05.07.17 14:55              </div>
              <div class="comment-body" style="overflow:hidden"><p>Many thanks for rapid response to my PDO query and thanks for the conversion coding.
I have this line in my connection code already, but I did add your line to the new script. PDO::ATTR_EMULATE_PREPARES   =&gt; false,
However I am still getting error message SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'LIKE ? ORDER BY Friendship LIMIT ?,?' at line 1. I am stuck now. Hope you can help me. Many thanks.</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello David!</p>
<p>First, I must confess that I made a terrible mistake. I overlooked the severe vulnerability in your code. If $option is coming from the browser, then it's a disaster. You should sanitize this variable, checking it against an array of predefined values. And most likely this is the source of the error you are getting.</p>
<p>So the final code would be</p>
<pre><code><code><span style="color: #0000BB">$options&nbsp;</span><span style="color: #007700">=&nbsp;[</span><span style="color: #DD0000">"name"</span><span style="color: #007700">,</span><span style="color: #DD0000">"price"</span><span style="color: #007700">,</span><span style="color: #DD0000">"qty"</span><span style="color: #007700">];&nbsp;</span><span style="color: #FF8000">//&nbsp;set&nbsp;your&nbsp;own&nbsp;values<br></span><span style="color: #0000BB">$key&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">array_search</span><span style="color: #007700">(</span><span style="color: #0000BB">$option</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$options</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$option&nbsp;&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$options</span><span style="color: #007700">[</span><span style="color: #0000BB">$key</span><span style="color: #007700">];<br><br></span><span style="color: #0000BB">$query&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"SELECT&nbsp;*&nbsp;FROM&nbsp;friends1&nbsp;WHERE&nbsp;`</span><span style="color: #0000BB">$option</span><span style="color: #DD0000">`&nbsp;LIKE&nbsp;?&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ORDER&nbsp;BY&nbsp;Friendship&nbsp;LIMIT&nbsp;?,?"</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$stmt&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #0000BB">$query</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">([</span><span style="color: #DD0000">"%</span><span style="color: #0000BB">$srch</span><span style="color: #DD0000">%"</span><span style="color: #007700">,</span><span style="color: #0000BB">$start</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$records_per_page</span><span style="color: #007700">]);<br></span><span style="color: #0000BB">$data&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetchAll</span><span style="color: #007700">();</span><span style="color: #0000BB"></span></code></code></pre>
<p>The first three lines are responsible for the $option santitization.</p>              </div>
            </li>
 
            <li class="comment" id="comment-234">
              <div class="comment-author">
              	William Entriken, 30.06.17 18:55              </div>
              <div class="comment-body" style="overflow:hidden"><p>s/count(/COUNT(/g</p></div>
            </li>
 
            <li class="comment" id="comment-233">
              <div class="comment-author">
              	William Entriken, 30.06.17 18:34              </div>
              <div class="comment-body" style="overflow:hidden"><p>"Good ORMs are Doctrine, Eloquent, RedBean, and Yii::AR. Aura.SQL is a good example of a PDO wrapper with many additional features."</p>
<p>Please provide a review of these or maybe a separate post. It is a huge qualifier when you say "for real applications you'll need to use one of these bunch of libraries but for now let me tell you all about PDO..."</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello William!</p>
<p>Thank you for a good suggestion.
Indeed it's a very good idea to outline at least essential features of these libraries and to show why they actually to be preferred. I cannot promise it will appear soon, as it' pretty much an undertaking, but I'll definitely will start composing such an article</p>              </div>
            </li>
 
            <li class="comment" id="comment-232">
              <div class="comment-author">
              	David Entwistle, 30.06.17 12:23              </div>
              <div class="comment-body" style="overflow:hidden"><p>How may I convert this mysql query to PDO query.</p>
<pre><code><code><span style="color: #0000BB">$query&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"SELECT&nbsp;*&nbsp;FROM&nbsp;friends1&nbsp;WHERE&nbsp;</span><span style="color: #0000BB">$option</span><span style="color: #DD0000">&nbsp;LIKE&nbsp;'%</span><span style="color: #0000BB">$srch</span><span style="color: #DD0000">%'&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ORDER&nbsp;BY&nbsp;Friendship&nbsp;LIMIT&nbsp;</span><span style="color: #0000BB">$start</span><span style="color: #DD0000">,</span><span style="color: #0000BB">$records_per_page</span><span style="color: #DD0000">"</span><span style="color: #007700">;</span><span style="color: #0000BB"></span></code></code></pre>
<p><code>$option</code> is user selected from dropdown list.
<code>$srch</code> is user input search criteria.</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello David!</p>
<p>There are two issues to keep in mind when converting such a query, both mentioned in this article:</p>
<ol>
<li>First, you have to make sure that the whole search string is set to a variable, including wildcard characters</li>
<li>Second, make sure that emulation is turned off, to make LIMIT parameters binding easier</li>
</ol>
<p>So the final code would be</p>
<pre><code><code><span style="color: #0000BB">$query&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"SELECT&nbsp;*&nbsp;FROM&nbsp;friends1&nbsp;WHERE&nbsp;</span><span style="color: #0000BB">$option</span><span style="color: #DD0000">&nbsp;LIKE&nbsp;?&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ORDER&nbsp;BY&nbsp;Friendship&nbsp;LIMIT&nbsp;?,?"</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$stmt&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #0000BB">$query</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">([</span><span style="color: #DD0000">"%</span><span style="color: #0000BB">$srch</span><span style="color: #DD0000">%"</span><span style="color: #007700">,</span><span style="color: #0000BB">$start</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$records_per_page</span><span style="color: #007700">]);<br></span><span style="color: #0000BB">$data&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetchAll</span><span style="color: #007700">();</span><span style="color: #0000BB"></span></code></code></pre>
<p>Hope it helps!</p>              </div>
            </li>
 
            <li class="comment" id="comment-225">
              <div class="comment-author">
              	Jan Stekl, 20.06.17 03:37              </div>
              <div class="comment-body" style="overflow:hidden"><p>Very, very good website for someone starting with PDO. Thank You for making it!</p></div>
            </li>
 
            <li class="comment" id="comment-224">
              <div class="comment-author">
              	Ganesh, 17.06.17 09:25              </div>
              <div class="comment-body" style="overflow:hidden"><p>Hi, </p>
<p>Trying to get last 25 row in ascending order but getting error any idea what could be error</p>
<pre><code><code><span style="color: #0000BB">$sql&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'(SELECT&nbsp;`id`,`msg`,`time`,`sender_id`,`mid`&nbsp;from&nbsp;msgs&nbsp;WHERE&nbsp;mid&nbsp;&gt;&nbsp;0&nbsp;and&nbsp;`grp_id`&nbsp;=&nbsp;:grp_id2&nbsp;ORDER&nbsp;BY&nbsp;id&nbsp;DESC&nbsp;limit&nbsp;25)&nbsp;ORDER&nbsp;BY&nbsp;id&nbsp;ASC'</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$sql_array&nbsp;</span><span style="color: #007700">=&nbsp;array(<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'grp_id2'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$grp_id<br></span><span style="color: #007700">);<br></span><span style="color: #0000BB">$stmt&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$data</span><span style="color: #007700">[</span><span style="color: #DD0000">'pdo'</span><span style="color: #007700">]-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #0000BB">$sql</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">(</span><span style="color: #0000BB">$sql_array</span><span style="color: #007700">);</span><span style="color: #0000BB"></span></code></code></pre>
<p>output</p>
<blockquote>
<p>Warning: PDO::prepare(): Unknown type 17 sent by the server. Please send a report to the developers in msgs.php on line 174
Fatal error: Call to a member function execute() on boolean in msgs.php on line 176</p>
</blockquote></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Ganesh!</p>
<p>Thank you for your question.
I never seen such an error message before.
Looks like you already posted a bug on the PHP site, <a href="https://bugs.php.net/bug.php?id=74769">https://bugs.php.net/bug.php?id=74769</a></p>
<p>Looks like it's all you can do.</p>              </div>
            </li>
 
            <li class="comment" id="comment-223">
              <div class="comment-author">
              	Ganesh Kandu, 15.06.17 14:38              </div>
              <div class="comment-body" style="overflow:hidden"><p>Hi,
Thanks for Awesome Documentation and easiest on </p>
<p>what should i care about when i am migrating to postgresql from mysql ???</p></div>
            </li>
 
            <li class="comment" id="comment-222">
              <div class="comment-author">
              	Ganesh Kandu, 15.06.17 14:15              </div>
              <div class="comment-body" style="overflow:hidden"><p>Thanks</p></div>
            </li>
 
            <li class="comment" id="comment-221">
              <div class="comment-author">
              	Ganesh Kandu, 14.06.17 10:20              </div>
              <div class="comment-body" style="overflow:hidden"><p>I Want to use dbprefix</p>
<pre><code><code><span style="color: #0000BB">CREATE&nbsp;TABLE&nbsp;</span><span style="color: #007700">`</span><span style="color: #DD0000">%DBPREFIX%_poll_vote</span><span style="color: #007700">`&nbsp;(<br>&nbsp;`</span><span style="color: #DD0000">id</span><span style="color: #007700">`&nbsp;</span><span style="color: #0000BB">int</span><span style="color: #007700">(</span><span style="color: #0000BB">11</span><span style="color: #007700">)&nbsp;</span><span style="color: #0000BB">NOT&nbsp;NULL&nbsp;AUTO_INCREMENT</span><span style="color: #007700">,<br>&nbsp;`</span><span style="color: #DD0000">ip</span><span style="color: #007700">`&nbsp;</span><span style="color: #0000BB">int</span><span style="color: #007700">(</span><span style="color: #0000BB">11</span><span style="color: #007700">)&nbsp;DEFAULT&nbsp;</span><span style="color: #0000BB">NULL</span><span style="color: #007700">,<br>)&nbsp;</span><span style="color: #0000BB">ENGINE</span><span style="color: #007700">=</span><span style="color: #0000BB">InnoDB&nbsp;</span><span style="color: #007700">DEFAULT&nbsp;</span><span style="color: #0000BB">CHARSET</span><span style="color: #007700">=</span><span style="color: #0000BB">utf8</span></code></code></pre>
<p>in select,update and insert also
should i use :dbprefix but not working</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Ganesh!</p>
<p>Unfortunately, PDO doesn't have a placeholder for the table name. So So all you can do is to use a PHP variable and make sure it is not coming from user input:</p>
<pre><code><code><span style="color: #0000BB">CREATE&nbsp;TABLE&nbsp;</span><span style="color: #007700">`{</span><span style="color: #0000BB">$DBPREFIX</span><span style="color: #007700">}</span><span style="color: #DD0000">_poll_vote</span><span style="color: #007700">`&nbsp;(<br>&nbsp;`</span><span style="color: #DD0000">id</span><span style="color: #007700">`&nbsp;</span><span style="color: #0000BB">int</span><span style="color: #007700">(</span><span style="color: #0000BB">11</span><span style="color: #007700">)&nbsp;</span><span style="color: #0000BB">NOT&nbsp;NULL&nbsp;AUTO_INCREMENT</span><span style="color: #007700">,<br>&nbsp;`</span><span style="color: #DD0000">ip</span><span style="color: #007700">`&nbsp;</span><span style="color: #0000BB">int</span><span style="color: #007700">(</span><span style="color: #0000BB">11</span><span style="color: #007700">)&nbsp;DEFAULT&nbsp;</span><span style="color: #0000BB">NULL</span><span style="color: #007700">,<br>)&nbsp;</span><span style="color: #0000BB">ENGINE</span><span style="color: #007700">=</span><span style="color: #0000BB">InnoDB&nbsp;</span><span style="color: #007700">DEFAULT&nbsp;</span><span style="color: #0000BB">CHARSET</span><span style="color: #007700">=</span><span style="color: #0000BB">utf8</span></code></code></pre>              </div>
            </li>
 
            <li class="comment" id="comment-218">
              <div class="comment-author">
              	bifa, 09.06.17 11:50              </div>
              <div class="comment-body" style="overflow:hidden"><p>Very instructives
Thanks.</p></div>
            </li>
 
            <li class="comment" id="comment-217">
              <div class="comment-author">
              	Thapelo, 07.06.17 13:43              </div>
              <div class="comment-body" style="overflow:hidden"><p>Thank you for your advice. I would like you to be my mentor. I have still going through your site and I am happy to tell you that I am really learning a lot. </p>
<p>Thank you very much.</p></div>
            </li>
 
            <li class="comment" id="comment-215">
              <div class="comment-author">
              	Thapelo, 06.06.17 20:14              </div>
              <div class="comment-body" style="overflow:hidden"><p>Hi,
I found out that your site is very useful to me as i am a beginner to coding. I wanted to know whether to use mysqli or pdo. I searched and came to a point which i decided to pay more attention to using pdo than mysqli.
My question is, am i on the right track with my decision or do i have to lern php with mysqli first?</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello!</p>
<p>PDO is easier to use, therefore it is easier to learn as well.
So I would recommend to keep up with PDO.</p>              </div>
            </li>
 
            <li class="comment" id="comment-214">
              <div class="comment-author">
              	Greg, 02.06.17 18:24              </div>
              <div class="comment-body" style="overflow:hidden"><p>"<em>In such a case explicit binding have to be used, for which you have a choice of two functions, bindValue() and bindParam(). The former one has to be preferred, because, unlike bindParam() it has no side effects to deal with.</em>"</p>
<p>You mention that bindParam has side effects, but there's no explanation as to what they are. PHP The Right Way and some other sites recommend bindParam, so I'm really curious why you recommend bindValue.</p></div>
            </li>
 
            <li class="comment" id="comment-212">
              <div class="comment-author">
              	daniel phillis, 30.05.17 22:12              </div>
              <div class="comment-body" style="overflow:hidden"><p>Thank you for providing a great resource. I want to reference your site in my undergrad paper to Flidners University South Australia, on serving my first database with WAMP, can i obtain your name ?</p></div>
            </li>
 
            <li class="comment" id="comment-210">
              <div class="comment-author">
              	Mark, 25.05.17 20:13              </div>
              <div class="comment-body" style="overflow:hidden"><p>I'm trying to run a stored procedure on a Sybase 11.0.1.2596 database in a PHP file using PDO and dblib as the driver. I can call a procedure with no parameters with no problems using something like:</p>
<pre><code><code><span style="color: #0000BB">call&nbsp;custom</span><span style="color: #007700">.</span><span style="color: #0000BB">show_clocked_in_employees</span></code></code></pre>
<p>However, if the procedure takes parameters, I get an error. If I have a procedure like this that takes 2 parameters:</p>
<pre><code><code><span style="color: #0000BB">create&nbsp;procedure&nbsp;custom</span><span style="color: #007700">.</span><span style="color: #0000BB">custom_sp_R_cons_rvc_time_prd_ttls</span><span style="color: #007700">(</span><span style="color: #0000BB">in&nbsp;business_date_start&nbsp;timestamp</span><span style="color: #007700">,</span><span style="color: #0000BB">in&nbsp;business_date_end&nbsp;timestamp</span><span style="color: #007700">)<br></span><span style="color: #0000BB">result</span><span style="color: #007700">(</span><span style="color: #0000BB">start_business_date&nbsp;timestamp</span><span style="color: #007700">,</span><span style="color: #0000BB">end_business_date&nbsp;timestamp</span><span style="color: #007700">,</span><span style="color: #0000BB">store_number&nbsp;OBJ_NUM</span><span style="color: #007700">,</span><span style="color: #0000BB">store_id&nbsp;SEQ_NUM</span><span style="color: #007700">,...)<br></span><span style="color: #0000BB">begin<br>&nbsp;&nbsp;</span><span style="color: #007700">declare&nbsp;@</span><span style="color: #0000BB">start_business_date&nbsp;timestamp</span><span style="color: #007700">;<br>&nbsp;&nbsp;declare&nbsp;@</span><span style="color: #0000BB">end_business_date&nbsp;timestamp</span><span style="color: #007700">;<br>&nbsp;&nbsp;...<br></span><span style="color: #0000BB">end</span></code></code></pre>
<p>I have tried calling it many ways and received different errors including this:</p>
<pre><code><code><span style="color: #0000BB">SQL&nbsp;Anywhere&nbsp;Error&nbsp;</span><span style="color: #007700">-</span><span style="color: #0000BB">188</span><span style="color: #007700">:&nbsp;</span><span style="color: #0000BB">Not&nbsp;enough&nbsp;values&nbsp;</span><span style="color: #007700">for&nbsp;</span><span style="color: #0000BB">host&nbsp;variables&nbsp;</span><span style="color: #007700">[</span><span style="color: #0000BB">13638</span><span style="color: #007700">]&nbsp;(</span><span style="color: #0000BB">severity&nbsp;16</span><span style="color: #007700">)&nbsp;[(</span><span style="color: #0000BB">null</span><span style="color: #007700">)]</span><span style="color: #0000BB"></span></code></code></pre>
<p>etc. If I run this procedure in a SQL client like RazorSQL using:</p>
<pre><code><code><span style="color: #0000BB">call&nbsp;custom</span><span style="color: #007700">.</span><span style="color: #0000BB">custom_sp_R_cons_rvc_time_prd_ttls</span><span style="color: #007700">(</span><span style="color: #DD0000">'2017-05-02'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'2017-05-02'</span><span style="color: #007700">)</span><span style="color: #0000BB"></span></code></code></pre>
<p>it works perfectly. The exact way I'm trying to call it is like this:</p>
<pre><code><code><span style="color: #0000BB">$dbh&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">(</span><span style="color: #DD0000">'dblib:host=&lt;host_ip&gt;'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$user</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$password</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$stmt&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$dbh</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #DD0000">'call&nbsp;custom.custom_sp_R_cons_rvc_time_prd_ttls(:start_date,&nbsp;:end_date)'</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$new_params&nbsp;</span><span style="color: #007700">=&nbsp;array(</span><span style="color: #DD0000">':start_date'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'2017-05-02'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">':end_date'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'2017-05-02'</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">(</span><span style="color: #0000BB">$new_params</span><span style="color: #007700">);</span><span style="color: #0000BB"></span></code></code></pre></div>
            </li>
 
            <li class="comment" id="comment-209">
              <div class="comment-author">
              	John, 25.05.17 15:09              </div>
              <div class="comment-body" style="overflow:hidden"><p>I would like to know more, is there any pdf's available about this tutorial I'm eager to learn</p></div>
            </li>
 
            <li class="comment" id="comment-206">
              <div class="comment-author">
              	Alex, 23.05.17 11:11              </div>
              <div class="comment-body" style="overflow:hidden"><p>Hi! Another brief question:
I was expecting to receive the exact same results using this approaches, but it seems I got different results (results in terms of the output results/data of the query)</p>
<pre><code><code><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">bindParam</span><span style="color: #007700">(</span><span style="color: #DD0000">':Lim'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$L</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">PARAM_INT</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">bindParam</span><span style="color: #007700">(</span><span style="color: #DD0000">':Lim2'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$L2</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">PARAM_INT</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">bindParam</span><span style="color: #007700">(</span><span style="color: #DD0000">':Name'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$Name</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">PARAM_STR</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">bindParam</span><span style="color: #007700">(</span><span style="color: #DD0000">':Name2'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$Name2</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">PARAM_STR</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">();&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB"></span></code></code></pre>
<p>And then this one:
$stmt-&gt;execute(["Lim" =&gt; $L, "Lim2" =&gt; $L2, "Name" =&gt; $Name, "Name2" =&gt; $Name2]);</p>
<p>I'm I missing something? Shouldn't have been the exact results?</p>
<p>Thanks!</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Nope, as long as this code works, there should be no difference.
The only case I can think of is when you are comparing a numeric value with a string field, something like <code>name=1</code> in SQL. In this case results are indeed unpredictable. </p>
<p>Do you mind to provide more details on the difference you are talking about?</p>              </div>
            </li>
 
            <li class="comment" id="comment-205">
              <div class="comment-author">
              	Alex, 23.05.17 10:53              </div>
              <div class="comment-body" style="overflow:hidden"><p>Hello,
I am following closely your tutorial and I am really grateful for the useful information.
Now I need your help again:</p>
<p>As you said, there is a problem with the Limit clause.. and I'm stuck in the middle.</p>
<p>On one hand, I need the  emulation mode turned ON as I have to query for multiple fields having the same name, as in your example:</p>
<pre><code><code><span style="color: #0000BB">$stmt&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #DD0000">"SELECT&nbsp;*&nbsp;FROM&nbsp;t&nbsp;WHERE&nbsp;foo&nbsp;LIKE&nbsp;:search&nbsp;OR&nbsp;bar&nbsp;LIKE&nbsp;:search"</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">([</span><span style="color: #DD0000">'search'</span><span style="color: #007700">]&nbsp;=&gt;&nbsp;</span><span style="color: #DD0000">"%</span><span style="color: #0000BB">$search</span><span style="color: #DD0000">%"</span><span style="color: #007700">);`</span><span style="color: #DD0000"><br><br>The&nbsp;query&nbsp;is&nbsp;even&nbsp;more&nbsp;complex,&nbsp;type&nbsp;of:<br><br></span><span style="color: #0000BB">$stmt</span><span style="color: #DD0000">&nbsp;=&nbsp;</span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #DD0000">("SELECT&nbsp;*&nbsp;FROM&nbsp;t&nbsp;WHERE&nbsp;(((foo&nbsp;LIKE&nbsp;:search&nbsp;OR&nbsp;bar&nbsp;LIKE&nbsp;:search)&nbsp;AND&nbsp;(boo&nbsp;LIKE&nbsp;:search2"))&nbsp;OR&nbsp;((foo2&nbsp;LIKE&nbsp;:search&nbsp;OR&nbsp;bar2&nbsp;LIKE&nbsp;:search)&nbsp;&nbsp;AND&nbsp;(boo&nbsp;LIKE:&nbsp;search2))&nbsp;...&nbsp;and&nbsp;so&nbsp;on&nbsp;)&nbsp;&nbsp;LIMIT&nbsp;:Limit1,&nbsp;Limit2</span></code></code></pre>
<p>And on the other hand I need the Limit parameters, for which the emulation needs to be OFF in order to function. </p>
<p>Otherwise, Is there any way to bind only the values for Limit parameters and continue executing:
$stm -&gt;execute(array_merge($params,${"in_params{$x}"}));    </p>
<p>Thanks a lot!</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Alex!</p>
<p>Thank you for a good question!</p>
<p>Indeed there is no way to combine the execute and bindvalue methods.
So in general you just have to write all the binding by hand.
I suppose that for an exceptional case it is not a big deal.</p>
<p>However, I think there is a workaround, which is quite close to your requirements: you can write a loop, binding all other parameters from array, and then make two distinct bindvalue calls, something like this:</p>
<pre><code><code><span style="color: #0000BB"></span><span style="color: #007700">for&nbsp;</span><span style="color: #0000BB">each</span><span style="color: #007700">(</span><span style="color: #0000BB">$params&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$key&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$value</span><span style="color: #007700">)<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">bindValue</span><span style="color: #007700">(</span><span style="color: #0000BB">$key</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$value</span><span style="color: #007700">);<br>}<br></span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">bindValue</span><span style="color: #007700">(</span><span style="color: #DD0000">'Limit1'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$limit1</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">bindValue</span><span style="color: #007700">(</span><span style="color: #DD0000">'Limit2'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$limit2</span><span style="color: #007700">);</span><span style="color: #0000BB"></span></code></code></pre>
<p>This is all I can offer. Hope it helps!</p>              </div>
            </li>
 
            <li class="comment" id="comment-202">
              <div class="comment-author">
              	Boz, 14.05.17 01:30              </div>
              <div class="comment-body" style="overflow:hidden"><p>Hi,</p>
<p>I have a piece of hardware that collects data  and operates a machine and then you can log into it to get statistics. A second operation it does (not very well) is send out data to a web database which stores what it sends. Every tutorial i find with api for php uses mysqli connect or other bad practices. Do you have to do a tutorial with the right pdo framework?</p></div>
            </li>
 
            <li class="comment" id="comment-195">
              <div class="comment-author">
              	Friend, 04.05.17 17:07              </div>
              <div class="comment-body" style="overflow:hidden"><p>There's a misspelling in the Transactions section:</p>
<p>"to cancel all the changes you made sihce transaction start"</p>
<p>sihce should be since</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Thank you, fixed.</p>              </div>
            </li>
 
            <li class="comment" id="comment-188">
              <div class="comment-author">
              	MgAnt, 24.04.17 19:37              </div>
              <div class="comment-body" style="overflow:hidden"><p>It's c. 2017, seven years after mysql 5.5.3 was published, which supports utf8mb4 - don't you think you should suggest this as encoding instead of utf-8?</p></div>
            </li>
 
            <li class="comment" id="comment-187">
              <div class="comment-author">
              	Dave, 21.04.17 23:17              </div>
              <div class="comment-body" style="overflow:hidden"><blockquote>
<p>you can use the method chaining and thus call execute() right along with prepare():</p>
</blockquote>
<pre><code><code><span style="color: #0000BB">$sql&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"UPDATE&nbsp;users&nbsp;SET&nbsp;name&nbsp;=&nbsp;?&nbsp;WHERE&nbsp;id&nbsp;=&nbsp;?"</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #0000BB">$sql</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">([</span><span style="color: #0000BB">$name</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$id</span><span style="color: #007700">]);</span><span style="color: #0000BB"></span></code></code></pre>
<blockquote>
<p>However, if you want to get the number of affected rows, the code will have to be the same boresome three lines:</p>
</blockquote>
<pre><code><code><span style="color: #0000BB">$stmt&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #DD0000">"DELETE&nbsp;FROM&nbsp;goods&nbsp;WHERE&nbsp;category&nbsp;=&nbsp;?"</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">([</span><span style="color: #0000BB">$cat</span><span style="color: #007700">]);<br></span><span style="color: #0000BB">$deleted&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">rowCount</span><span style="color: #007700">();</span><span style="color: #0000BB"></span></code></code></pre>
<p>Have you considered</p>
<pre><code><code><span style="color: #0000BB"></span><span style="color: #007700">(</span><span style="color: #0000BB">$stmt&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #DD0000">"DELETE&nbsp;FROM&nbsp;goods&nbsp;WHERE&nbsp;category&nbsp;=&nbsp;?"</span><span style="color: #007700">))-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">([</span><span style="color: #0000BB">$cat</span><span style="color: #007700">]);<br></span><span style="color: #0000BB">$deleted&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">rowCount</span><span style="color: #007700">();</span><span style="color: #0000BB"></span></code></code></pre></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Dave!</p>
<p>Everyone is tempted to do that at first, but soon realizes it's impossible :)</p>
<p>The method chaining returns the return value of the <em>last method</em> in the chain, <code>execute()</code> here, and it's a boolean value. So it won't work.</p>
<p>To overcome this inconvenience I propose to extend PDO a bit, as it shown in the other article, <a href="https://phpdelusions.net/pdo/pdo_wrapper">https://phpdelusions.net/pdo/pdo_wrapper</a></p>
<p>So we can make it </p>
<pre><code><code><span style="color: #0000BB">&nbsp;$deleted&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">run</span><span style="color: #007700">(</span><span style="color: #DD0000">"DELETE&nbsp;FROM&nbsp;goods&nbsp;WHERE&nbsp;category&nbsp;=&nbsp;?"</span><span style="color: #007700">,[</span><span style="color: #0000BB">$cat</span><span style="color: #007700">])-&gt;</span><span style="color: #0000BB">rowCount</span><span style="color: #007700">();</span><span style="color: #0000BB"></span></code></code></pre>              </div>
            </li>
 
            <li class="comment" id="comment-186">
              <div class="comment-author">
              	Phil Wilkinson, 21.04.17 01:29              </div>
              <div class="comment-body" style="overflow:hidden"><p>Got caught out last night when upgrading our production server's PHP7 version and modules (most likely php7-pdo?).  PDO couldn't parse this previously working DSN:</p>
<pre><code><code><span style="color: #0000BB">mysql</span><span style="color: #007700">:</span><span style="color: #0000BB">host</span><span style="color: #007700">=</span><span style="color: #0000BB">localhost</span><span style="color: #007700">:</span><span style="color: #0000BB">13304</span><span style="color: #007700">;</span><span style="color: #0000BB">dbname</span><span style="color: #007700">=</span><span style="color: #0000BB">test</span><span style="color: #007700">;</span><span style="color: #0000BB">charset</span><span style="color: #007700">=</span><span style="color: #0000BB">utf8</span></code></code></pre>
<p>Fixed with this (note the port has moved in the DSN):</p>
<pre><code><code><span style="color: #0000BB">mysql</span><span style="color: #007700">:</span><span style="color: #0000BB">host</span><span style="color: #007700">=</span><span style="color: #0000BB">localhost</span><span style="color: #007700">;</span><span style="color: #0000BB">dbname</span><span style="color: #007700">=</span><span style="color: #0000BB">test</span><span style="color: #007700">;</span><span style="color: #0000BB">port</span><span style="color: #007700">=</span><span style="color: #0000BB">13304</span><span style="color: #007700">;</span><span style="color: #0000BB">charset</span><span style="color: #007700">=</span><span style="color: #0000BB">utf8</span></code></code></pre>
<p>Better to stay safe and follow the manual gents.</p></div>
            </li>
 
            <li class="comment" id="comment-185">
              <div class="comment-author">
              	Priya Telvekar, 19.04.17 18:50              </div>
              <div class="comment-body" style="overflow:hidden"><p>Hi, really good stuff to know. Helped me!! Thanks!</p></div>
            </li>
 
            <li class="comment" id="comment-184">
              <div class="comment-author">
              	Jeff, 18.04.17 23:56              </div>
              <div class="comment-body" style="overflow:hidden"><p>I'm having a hard time gaining an understanding of best practices of real world implementation of PDO. Especially file structuring - as in where my PDO connection should be located and efficiently used throughout a php app. If this is not within the scope of this site perhaps you can direct me to a good reference. Thanks!</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Jeff!</p>
<p>Thank you for the good question, it's perfectly within the scope of this site.</p>
<p>In general, you just create a separate file where PDO instance is created, like <code>$pdo = new PDO ...</code>. And then just include/require that file into every script that needs a PDO connection.</p>
<p>The main question here is how to use that instance. And this answer depends on your coding style. If your code is procedural, then just use that <code>$pdo</code> variable. To make it accessible inside functions, either make it <code>global</code> or use a static wrapper like one is shown on the next page: <a href="https://phpdelusions.net/pdo/pdo_wrapper">https://phpdelusions.net/pdo/pdo_wrapper</a></p>
<p>If your code is OOP, that it's a different tory, too big to cover in a comment. You may google for the Dependency injection and IoC containers.</p>
<p>If you still have some questions, I'll be glad to answer.</p>              </div>
            </li>
 
            <li class="comment" id="comment-180">
              <div class="comment-author">
              	Alex, 21.02.17 16:24              </div>
              <div class="comment-body" style="overflow:hidden"><p>So the following query seems to not work:</p>
<pre><code><code><span style="color: #0000BB">$sql&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"SELECT&nbsp;u.*,&nbsp;AVG(Rating)&nbsp;As&nbsp;AverageRating&nbsp;FROM&nbsp;users&nbsp;u&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LEFT&nbsp;JOIN&nbsp;RatingsTable&nbsp;r&nbsp;WHERE&nbsp;r.UserID=u.id<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;Active&nbsp;=&nbsp;1"</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$users&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #0000BB">$sql</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">fetchAll</span><span style="color: #007700">();</span><span style="color: #0000BB"></span></code></code></pre>
<p>I don't know if is due to the fact that there are 2 WHERE clauses (I've removed one).
Also as logic I don't know if it is intended to return what I  expect. </p>
<ul>
<li>So I need to retrieve all the details from Users (from those users that are active);</li>
<li>then, for the users that have Ratings (and the ratings are also active), I need to see the ratings, otherwise I'll just stick with the user's info and mention that there is no rating for him.</li>
</ul>
<p>Isn't the JOIN supposed to return only those that have ratings?</p>
<p>Thanx!</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hi Alex,</p>
<p>Sorry it was a copy paste error. There should be ON instead of first WHERE.
Regarding JOIN, the the original one indeed will get you only users with ratings. But LEFT JOIN is a special join to give you all users regardless.</p>
<p>As of your other question, remember those u and r used in the query? they are called aliases and intended to distinguish field names from different tables. So the final query would be</p>
<pre><code><code><span style="color: #0000BB">$sql&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"SELECT&nbsp;u.*,&nbsp;AVG(Rating)&nbsp;As&nbsp;AverageRating&nbsp;FROM&nbsp;users&nbsp;u&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;LEFT&nbsp;JOIN&nbsp;RatingsTable&nbsp;r&nbsp;ON&nbsp;r.UserID=u.id&nbsp;AND&nbsp;r.Active&nbsp;=&nbsp;1<br>&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;u.Active&nbsp;=&nbsp;1"</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$users&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #0000BB">$sql</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">fetchAll</span><span style="color: #007700">();</span><span style="color: #0000BB"></span></code></code></pre>
<p>And, regarding your last comment, PHP is all right.</p>              </div>
            </li>
 
            <li class="comment" id="comment-178">
              <div class="comment-author">
              	Alex, 21.02.17 16:02              </div>
              <div class="comment-body" style="overflow:hidden"><p>Hi again, (it seems that my first comment wasn't posted - It was submitted several minutes before this one: Alex, 21.02.17 01:36)</p>
<p>OK, thanks a lot for suggestions, I'll give it another shot during this night.
Only one more question here:</p>
<ul>
<li>as my both selects contain "WHERE ACTIVE = 1" it refers one time at User being active and the second time it refers the Rating being Active = 1 (so we have to make sure that users is activated and that his rating has been approved). Using your suggested code, could I make something like this?
$sql = "SELECT u.*, AVG(Rating) As AverageRating FROM users u
WHERE Active = 1 (## Meaning User to be active ##)
LEFT JOIN RatingsTable r WHERE r.UserID=u.id
WHERE Active = 1"; (## Meaning the Rating for the corresponding User -  to be active as well ##)</li>
</ul>
<p>Thanks a lot! </p>
<p>P.S. My first comment (really first comment that I cannot see it here / maybe it wasn't even submitted successfully) was about your suggestion between  PHP / Java / Python for a good, robust, stable but flexible web application, based on your experience. Maybe also suggesting a set of "knowledge toolkit".</p>
<p>Kind regards,
Alex</p></div>
            </li>
 
            <li class="comment" id="comment-177">
              <div class="comment-author">
              	Alex, 21.02.17 01:36              </div>
              <div class="comment-body" style="overflow:hidden"><p>Hello again,
How do you see a better implementation for this case, as migrating it from simple mySql to PDO is seems a lot slower:
I have multiple users to retrieve from DB and show their information, but some information is stored in another tables, so then I have to run another query in the while loop, for each User ID </p>
<p>Example:</p>
<pre><code><code><span style="color: #0000BB">$stmt&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #DD0000">"SELECT&nbsp;*&nbsp;FROM&nbsp;users&nbsp;WHERE&nbsp;&nbsp;Active&nbsp;=&nbsp;1&nbsp;ORDER&nbsp;BY&nbsp;RAND&nbsp;()"</span><span style="color: #007700">);&nbsp;&nbsp;&nbsp;&nbsp;<br></span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">();<br></span><span style="color: #0000BB">$i&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">;<br>foreach&nbsp;(</span><span style="color: #0000BB">$stmt&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$row</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$Fname</span><span style="color: #007700">[</span><span style="color: #0000BB">$i</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">'Fname'</span><span style="color: #007700">];<br>....&nbsp;and&nbsp;</span><span style="color: #0000BB">so&nbsp;on<br><br>&nbsp;&nbsp;&nbsp;&nbsp;$getRatings&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #DD0000">"SELECT&nbsp;AVG(Rating)&nbsp;As&nbsp;AverageRating&nbsp;FROM&nbsp;RatingsTable&nbsp;WHERE&nbsp;UserID=&nbsp;'</span><span style="color: #0000BB">$UserID</span><span style="color: #007700">[</span><span style="color: #0000BB">$j</span><span style="color: #007700">]</span><span style="color: #DD0000">'&nbsp;AND&nbsp;Active&nbsp;=&nbsp;'1'"</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$getRatings</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">();<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$i</span><span style="color: #007700">++;<br>}</span><span style="color: #0000BB"></span></code></code></pre>
<p>so the point here is that I'm assigning the details from DB to arrays of First Names, Last Names, User ID's, then Ratings and some other information that I need to retrieve from other tables based on the specific UserID.
Is there a better, cleaner, faster way to do it, maybe not using so many arrays and using the $row['anythingHere'] variables and using it / displaying in the loop (not just storing / assigning in the loop and then use it later based on the array indexes).</p>
<p>Thanks a lot!</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Alex!</p>
<p>That's a really good question. Indeed, there are means for the improvement, both for the performance and cleaner code. </p>
<p>From what I see, there are three main points </p>
<ul>
<li>Take out ORDER BY RAND() part. It doesn't seem to do any good, but can slow down things considerably.</li>
<li>Take out the nested query as well, and use LEFT JOIN instead. You can join as many tables as you wish</li>
<li>Get all records at once in a single array using fetchAll() method</li>
</ul>
<p>So it should be something like this</p>
<pre><code><code><span style="color: #0000BB">$sql&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"SELECT&nbsp;u.*,&nbsp;AVG(Rating)&nbsp;As&nbsp;AverageRating&nbsp;FROM&nbsp;users&nbsp;u&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LEFT&nbsp;JOIN&nbsp;RatingsTable&nbsp;r&nbsp;WHERE&nbsp;r.UserID=u.id<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;Active&nbsp;=&nbsp;1"</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$users&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #0000BB">$sql</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">fetchAll</span><span style="color: #007700">();<br></span><span style="color: #0000BB">shuffle</span><span style="color: #007700">(</span><span style="color: #0000BB">$users</span><span style="color: #007700">);&nbsp;</span><span style="color: #FF8000">//&nbsp;if&nbsp;you&nbsp;need&nbsp;them&nbsp;to&nbsp;be&nbsp;random</span><span style="color: #0000BB"></span></code></code></pre>
<p>Now you can loop over single $users array and get any column. Fname, for example:</p>
<pre><code><code><span style="color: #0000BB"></span><span style="color: #007700">foreach(</span><span style="color: #0000BB">$users&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$row</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">'Fname'</span><span style="color: #007700">];<br>}</span><span style="color: #0000BB"></span></code></code></pre>
<p>If the code still be slow, make sure that you have an index for the UserID field in AverageRating table (and in the all other linked tables as well). </p>
<p>Feel free to ask if you have any other questions!</p>              </div>
            </li>
 
            <li class="comment" id="comment-176">
              <div class="comment-author">
              	quraisah, 20.02.17 17:22              </div>
              <div class="comment-body" style="overflow:hidden"><p>Thanks it help me.thanks again if i had any inquiry regarding pdo i will back to this web again.</p></div>
            </li>
 
            <li class="comment" id="comment-175">
              <div class="comment-author">
              	quraisah, 20.02.17 10:38              </div>
              <div class="comment-body" style="overflow:hidden"><p>how suppose im write using pdo style for user redirect their respective webpage after login. example admin login will re direct to admin page and normal user redirect to user page after login. please show some simple example.</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello!</p>
<p>this question doesn't really belong to PDO as you have to deal with the information already fetched from the database. Assuming you have a variable <code>$row</code> with user data where level <code>field</code> is responsible for the user level, the code would be</p>
<pre><code><code><span style="color: #0000BB"></span><span style="color: #007700">if(</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">'level'</span><span style="color: #007700">]&nbsp;==&nbsp;</span><span style="color: #DD0000">'admin'</span><span style="color: #007700">)&nbsp;</span><span style="color: #0000BB">header</span><span style="color: #007700">(</span><span style="color: #DD0000">"Location:&nbsp;/admin.php"</span><span style="color: #007700">)</span><span style="color: #0000BB"></span></code></code></pre>
<p>You can add as many such condition as you like. Hope it helps!</p>              </div>
            </li>
 
            <li class="comment" id="comment-174">
              <div class="comment-author">
              	Relexk, 18.02.17 01:19              </div>
              <div class="comment-body" style="overflow:hidden"><p>how do i make something like this with pdo</p>
<p>$userquery = mysql_query("SELECT fname, lname, email FROM register WHERE email ='$login_session'") or die("the query could be fale please try again");
if(mysql_num_rows($userquery) != 1){
die("that username could not be found!");
}
while($row = mysql_fetch_array($userquery, MYSQL_ASSOC)){</p>
<pre><code><code><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;$dbfname&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">"fname"</span><span style="color: #007700">];<br>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$dblname&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">"lname"</span><span style="color: #007700">];<br>&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$dbemail&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">"email"</span><span style="color: #007700">];<br>&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;if(</span><span style="color: #0000BB">$login_session&nbsp;</span><span style="color: #007700">!=&nbsp;</span><span style="color: #0000BB">$dbemail</span><span style="color: #007700">){<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><span style="color: #0000BB"></span></code></code></pre>
<p>thanks i advance</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello!</p>
<p>With PDO this code will be much simpler:</p>
<pre><code><code><span style="color: #0000BB">$stmt&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #DD0000">"SELECT&nbsp;fname,&nbsp;lname,&nbsp;email&nbsp;FROM&nbsp;register&nbsp;WHERE&nbsp;email&nbsp;=?"</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">([</span><span style="color: #0000BB">$login_session</span><span style="color: #007700">]);<br></span><span style="color: #0000BB">$row&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetch</span><span style="color: #007700">();<br>if(</span><span style="color: #0000BB">$row</span><span style="color: #007700">){<br>&nbsp;&nbsp;&nbsp;&nbsp;die(</span><span style="color: #DD0000">"that&nbsp;username&nbsp;could&nbsp;not&nbsp;be&nbsp;found!"</span><span style="color: #007700">);<br>}<br></span><span style="color: #0000BB">$dbfname&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">"fname"</span><span style="color: #007700">];<br></span><span style="color: #0000BB">$dblname&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">"lname"</span><span style="color: #007700">];<br></span><span style="color: #0000BB">$dbemail&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">"email"</span><span style="color: #007700">];</span><span style="color: #0000BB"></span></code></code></pre>              </div>
            </li>
 
            <li class="comment" id="comment-173">
              <div class="comment-author">
              	Pablo, 14.02.17 00:30              </div>
              <div class="comment-body" style="overflow:hidden"><p>Thank you! Great job. You helped me to understand better what I was just assuming as best practice.</p></div>
            </li>
 
            <li class="comment" id="comment-172">
              <div class="comment-author">
              	Andy, 08.02.17 16:56              </div>
              <div class="comment-body" style="overflow:hidden"><p>How can I use PDO for this kind of statement:</p>
<pre><code><code><span style="color: #0000BB">$sql1&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"INSERT&nbsp;INTO&nbsp;dates&nbsp;(d_insertdate,&nbsp;d_date,&nbsp;d_time,&nbsp;d_name"</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$sql2&nbsp;</span><span style="color: #007700">=&nbsp;&nbsp;</span><span style="color: #DD0000">")&nbsp;VALUES&nbsp;(SYSDATE(),'"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$d_date&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"',&nbsp;'"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$d_time&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"',&nbsp;'"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$d_name&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"'"</span><span style="color: #007700">;<br><br>if&nbsp;(</span><span style="color: #0000BB">strlen</span><span style="color: #007700">(</span><span style="color: #0000BB">$d_admission</span><span style="color: #007700">)&nbsp;&gt;&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">)&nbsp;{</span><span style="color: #0000BB">$sql1&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$sql1&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">",&nbsp;d_admission"</span><span style="color: #007700">;&nbsp;</span><span style="color: #0000BB">$sql2&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$sql2&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">",&nbsp;'</span><span style="color: #0000BB">$d_admission</span><span style="color: #DD0000">'"</span><span style="color: #007700">;}<br>if&nbsp;(</span><span style="color: #0000BB">strlen</span><span style="color: #007700">(</span><span style="color: #0000BB">$d_artists</span><span style="color: #007700">)&nbsp;&gt;&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">)&nbsp;&nbsp;&nbsp;{</span><span style="color: #0000BB">$sql1&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$sql1&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">",&nbsp;d_artists"</span><span style="color: #007700">;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$sql2&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$sql2&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">",&nbsp;'</span><span style="color: #0000BB">$d_artists</span><span style="color: #DD0000">'"</span><span style="color: #007700">;}<br>if&nbsp;(</span><span style="color: #0000BB">strlen</span><span style="color: #007700">(</span><span style="color: #0000BB">$d_infotext</span><span style="color: #007700">)&nbsp;&gt;&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">)&nbsp;&nbsp;{</span><span style="color: #0000BB">$sql1&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$sql1&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">",&nbsp;d_infotext"</span><span style="color: #007700">;&nbsp;&nbsp;</span><span style="color: #0000BB">$sql2&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$sql2&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">",&nbsp;'</span><span style="color: #0000BB">$d_infotext</span><span style="color: #DD0000">'"</span><span style="color: #007700">;}</span><span style="color: #0000BB"></span></code></code></pre>
<p>Thx!</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Andy!</p>
<p>Thank you for a real good question.</p>
<p>For PDO there is no simple solution. But it can be done with a code like this</p>
<pre><code><code><span style="color: #0000BB">$sql&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"INSERT&nbsp;INTO&nbsp;dates&nbsp;(d_insertdate,&nbsp;d_date,&nbsp;d_time,&nbsp;d_name"</span><span style="color: #007700">;<br><br></span><span style="color: #0000BB">$parameters&nbsp;</span><span style="color: #007700">=&nbsp;[</span><span style="color: #0000BB">$d_date</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$d_time</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$d_name</span><span style="color: #007700">];<br><br>if&nbsp;(</span><span style="color: #0000BB">strlen</span><span style="color: #007700">(</span><span style="color: #0000BB">$d_admission</span><span style="color: #007700">)&nbsp;&gt;&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">)&nbsp;{</span><span style="color: #0000BB">$sql&nbsp;</span><span style="color: #007700">.=&nbsp;</span><span style="color: #DD0000">",&nbsp;d_admission"</span><span style="color: #007700">;&nbsp;</span><span style="color: #0000BB">$parameters</span><span style="color: #007700">[]&nbsp;=&nbsp;</span><span style="color: #0000BB">$d_admission</span><span style="color: #007700">;}<br>if&nbsp;(</span><span style="color: #0000BB">strlen</span><span style="color: #007700">(</span><span style="color: #0000BB">$d_artists</span><span style="color: #007700">)&nbsp;&gt;&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">)&nbsp;&nbsp;&nbsp;{</span><span style="color: #0000BB">$sql&nbsp;</span><span style="color: #007700">.=&nbsp;</span><span style="color: #DD0000">",&nbsp;d_artists"</span><span style="color: #007700">;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$parameters</span><span style="color: #007700">[]&nbsp;=&nbsp;</span><span style="color: #0000BB">$d_artists</span><span style="color: #007700">;}<br>if&nbsp;(</span><span style="color: #0000BB">strlen</span><span style="color: #007700">(</span><span style="color: #0000BB">$d_infotext</span><span style="color: #007700">)&nbsp;&gt;&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">)&nbsp;&nbsp;{</span><span style="color: #0000BB">$sql&nbsp;</span><span style="color: #007700">.=&nbsp;</span><span style="color: #DD0000">",&nbsp;d_infotext"</span><span style="color: #007700">;&nbsp;&nbsp;</span><span style="color: #0000BB">$parameters</span><span style="color: #007700">[]&nbsp;=&nbsp;</span><span style="color: #0000BB">$d_infotext</span><span style="color: #007700">;}<br><br></span><span style="color: #0000BB">$sql&nbsp;</span><span style="color: #007700">.=&nbsp;</span><span style="color: #DD0000">")&nbsp;VALUES&nbsp;(SYSDATE()"</span><span style="color: #007700">.</span><span style="color: #0000BB">str_repeat</span><span style="color: #007700">(</span><span style="color: #DD0000">",&nbsp;?"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">count</span><span style="color: #007700">(</span><span style="color: #0000BB">$parameters</span><span style="color: #007700">)).</span><span style="color: #DD0000">")"</span><span style="color: #007700">;<br><br></span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #0000BB">$sql</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">(</span><span style="color: #0000BB">$parameters</span><span style="color: #007700">);</span><span style="color: #0000BB"></span></code></code></pre>
<p>Here we are using just a single $sql variable which is getting field names based on your conditions.
Also, we are adding all our variables into <code>$parameters</code> array.</p>
<p>Finally, we are adding VALUES part to the query, creating as many <code>?</code> marks in the query as many items in the <code>$parameters</code> array.<br>
And all we need now is to prepare a query and execute it with parameters.</p>
<p>Feel free to ask if you have any further questions!</p>              </div>
            </li>
 
            <li class="comment" id="comment-169">
              <div class="comment-author">
              	raNor, 03.02.17 01:25              </div>
              <div class="comment-body" style="overflow:hidden"><p>Thanks a lot for this. As a beginner with PDO this taught me a lot.</p>
<p>I will definitely share your work with my classmates.</p>
<p>Cheers,</p></div>
            </li>
 
            <li class="comment" id="comment-167">
              <div class="comment-author">
              	Steve R, 28.01.17 12:19              </div>
              <div class="comment-body" style="overflow:hidden"><p>Thank you for this extraordinary work. I found your concise, well formed presentation of material an easy read and the explanations, examples and insights on technique to be extremely helpful. My gratitude to you for your work on and in, presenting this document.</p></div>
            </li>
 
            <li class="comment" id="comment-166">
              <div class="comment-author">
              	Greg, 26.01.17 04:12              </div>
              <div class="comment-body" style="overflow:hidden"><p>Lots of useful details on PDO! I use wizzyweb as it automates the code creation for data entry and reports, even prepared statements for safer code.</p></div>
            </li>
 
            <li class="comment" id="comment-162">
              <div class="comment-author">
              	Albert221, 11.01.17 01:10              </div>
              <div class="comment-body" style="overflow:hidden"><p>Hello!</p>
<p>I was at the beginning of writing a complex tutorial on how to use PDO in polish, because there's not even one <strong>good</strong> tutorial about it and while I was researching for some resources other than PHP manual I encountered your The only proper PDO tutorial and I got an idea to translate it into polish, of course give you a proper credit and publish it on my blog (<a href="http://nastoletni.pl/">http://nastoletni.pl</a>).</p>
<p>I'd be very grateful and I think polish beginners would be really grateful too for such a quality tutorial in such an important and trivial thing which is connecting to database in PHP.</p>
<p>Don't mind sending an email if you prefer it.</p>
<p>Best regards,
Albert Wolszon</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Albert! </p>
<p>Thank you for giving this article such a credit!
That would be a honor for me if you translate it to your native language. Surely, I am giving you the permission to translate.<br>
Please send me a link when it will be done!</p>
<p>Also, feel free to ask for clarifications, whenever you find it necessary.</p>              </div>
            </li>
 
            <li class="comment" id="comment-161">
              <div class="comment-author">
              	Kalule, 08.01.17 10:53              </div>
              <div class="comment-body" style="overflow:hidden"><p>Thanks for the the articles. Very educative even for experienced programmers. Keep up the good work bro.</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Kalule!</p>
<p>Thanks a lot for your feedback!
May I ask, what you find especially interesting in this article? and also, may be there are some parts that are not very clear or detailed? Please share your opinion.</p>              </div>
            </li>
 
            <li class="comment" id="comment-158">
              <div class="comment-author">
              	Danilcha, 04.01.17 05:29              </div>
              <div class="comment-body" style="overflow:hidden"><p>In this example:
$stmt = $pdo-&gt;prepare("DELETE FROM goods WHERE category = ?");
$stmt-&gt;execute([$cat]);
$deleted = $stmt-&gt;fetchColumn();</p>
<p>Shouldn't it be rowCount instead of fetchColumn?</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Danilcha!</p>
<p>Sure, that's my fault. Fixed.
Thanks for pointing out!</p>              </div>
            </li>
 
            <li class="comment" id="comment-157">
              <div class="comment-author">
              	Viktor, 03.01.17 17:42              </div>
              <div class="comment-body" style="overflow:hidden"><p>Hi,</p>
<p>You seem to be very a skilled PHP developer, could you link me a good PHP tutorial so I can start learning the language the right way? Right now I have a website that I wrote from scratch using HTML, CSS of course and a bit of copy-pasted, slightly edited JS. The only PHP I'm using are include statements so that my pages don't become too hard to maintain. I'd like to be able to load images, table content and text from a database, dynamically creating a page the same way it's also done on forums and webshops. I understand that PHP 7 is relatively new so most of the tutorials out there are written for PHP 5.6 or older. Is this a problem or is the conversion to 7 easy?</p>
<p>Thanks,</p>
<p>Viktor</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Viktor!
Thank you for the good question.</p>
<p>The best resources to learn Php are <a href="http://www.phptherightway.com/">http://www.phptherightway.com/</a> and <a href="http://www.laracasts.com/">http://www.laracasts.com/</a></p>
<p>As of the version, just don't worry: php7 is 99.9% the same as 5.6.</p>
<p>Feel free to ask other questions!</p>              </div>
            </li>
 
            <li class="comment" id="comment-156">
              <div class="comment-author">
              	Tyler, 02.01.17 09:39              </div>
              <div class="comment-body" style="overflow:hidden"><p>Just a note, if you are using an IN clause, and you need to -&gt;execute more values (besides those in the IN clause), this seems like a clean way to do it:</p>
<pre><code><code><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">(</span><span style="color: #0000BB">array_merge</span><span style="color: #007700">(<br>&nbsp;&nbsp;&nbsp;&nbsp;array&nbsp;(</span><span style="color: #0000BB">$value1</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$value2</span><span style="color: #007700">),&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">array_merge&nbsp;</span><span style="color: #007700">(</span><span style="color: #0000BB">$IN_CLAUSE_ARRAY</span><span style="color: #007700">,&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;array&nbsp;(</span><span style="color: #0000BB">$another_value</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$another_value</span><span style="color: #007700">))));</span><span style="color: #0000BB"></span></code></code></pre></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Tyler!</p>
<p>Thank you for the suggestion!</p>
<p>Indeed, last time I've answered the similar question on SO, I tought I should add such an example but got busy and forgot it. </p>
<p>Yet I think that you made your example a bit overcomplicated. You need only one <code>array_merge()</code> call:</p>
<pre><code><code><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">(</span><span style="color: #0000BB">array_merge</span><span style="color: #007700">(<br>&nbsp;&nbsp;&nbsp;&nbsp;array(</span><span style="color: #0000BB">$value1</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$value2</span><span style="color: #007700">),</span><span style="color: #0000BB">$IN_CLAUSE_ARRAY</span><span style="color: #007700">,&nbsp;array&nbsp;(</span><span style="color: #0000BB">$another1</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$another2</span><span style="color: #007700">)));</span><span style="color: #0000BB"></span></code></code></pre>
<p>Please check the updated section: <a href="https://phpdelusions.net/pdo#in">https://phpdelusions.net/pdo#in</a></p>              </div>
            </li>
 
            <li class="comment" id="comment-154">
              <div class="comment-author">
              	M, 31.12.16 05:39              </div>
              <div class="comment-body" style="overflow:hidden"><p>Question(s) regarding "Mysqlnd and buffered queries. Huge datasets.".</p>
<p>With the mysqlnd driver, what does that mean for fetch vs fetchall?</p>
<ul>
<li>Will the database be "hit" multiple times using fetch and only once using fetchall?</li>
</ul>
<p>Thanks.</p></div>
            </li>
 
            <li class="comment" id="comment-153">
              <div class="comment-author">
              	Joe, 26.12.16 22:49              </div>
              <div class="comment-body" style="overflow:hidden"><p>Hi,
If I wanted to save a single row from my database as a variable for later use, would this be the correct way to do it ?</p>
<pre><code><code><span style="color: #0000BB">$stmt&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #DD0000">"SELECT&nbsp;count&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;punch&nbsp;WHERE&nbsp;id=1&nbsp;LIMIT&nbsp;1"</span><span style="color: #007700">);&nbsp;<br></span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">();&nbsp;<br></span><span style="color: #0000BB">$row&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetch</span><span style="color: #007700">();<br></span><span style="color: #0000BB">$counter&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">'count'</span><span style="color: #007700">];<br>echo&nbsp;</span><span style="color: #0000BB">$counter</span><span style="color: #007700">;</span><span style="color: #0000BB"></span></code></code></pre>
<p>Thanks :)</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hi Joe!</p>
<p>You just have to read this tutorial a <a href="https://phpdelusions.net/pdo#fetchcolumn">little further</a> ;)</p>
<p>Depends on whether you're using a variable in your query or not, there will be either one line or three lines, not five. Just check the code by the link and choose the variant that suits you best.</p>              </div>
            </li>
 
            <li class="comment" id="comment-151">
              <div class="comment-author">
              	Joe, 26.12.16 20:46              </div>
              <div class="comment-body" style="overflow:hidden"><p>Hi, I am following your code, however I am getting the following error.</p>
<blockquote>
<p>Parse error: syntax error, unexpected '[' in connect.php on line 9</p>
</blockquote></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Joe!</p>
<p>This one is very easy to fix. 5 years ago a new syntax for arrays was introduced in PHP - square braces instead of <code>array()</code>. You can change your code as follows. But better consider upgrading your PHP to a more recent version</p>
<pre><code><code><span style="color: #0000BB">$host&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'127.0.0.1'</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$db&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'test'</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$user&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'root'</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$pass&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">''</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$charset&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'utf8'</span><span style="color: #007700">;<br><br></span><span style="color: #0000BB">$dsn&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"mysql:host=</span><span style="color: #0000BB">$host</span><span style="color: #DD0000">;dbname=</span><span style="color: #0000BB">$db</span><span style="color: #DD0000">;charset=</span><span style="color: #0000BB">$charset</span><span style="color: #DD0000">"</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$opt&nbsp;</span><span style="color: #007700">=&nbsp;array(<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">ATTR_ERRMODE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">ERRMODE_EXCEPTION</span><span style="color: #007700">,<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">ATTR_DEFAULT_FETCH_MODE&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">FETCH_ASSOC</span><span style="color: #007700">,<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">ATTR_EMULATE_PREPARES&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">,<br>);<br></span><span style="color: #0000BB">$pdo&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">(</span><span style="color: #0000BB">$dsn</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$user</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$pass</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$opt</span><span style="color: #007700">);</span><span style="color: #0000BB"></span></code></code></pre>
<p>Hope you get the idea</p>              </div>
            </li>
 
            <li class="comment" id="comment-147">
              <div class="comment-author">
              	HashHashPHPNinjaCat, 21.12.16 03:03              </div>
              <div class="comment-body" style="overflow:hidden"><p>Hi everyone!</p>
<p>If you you wish to be able to full Unicode in MySQL database, I would read here on how to do that utf8mb4</p>
<p>Make your code appear like this:</p>
<pre><code><code><span style="color: #0000BB">$host&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'127.0.0.1'</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$db&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'test'</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$user&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'root'</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$pass&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">''</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$charset&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'utf8mb4'</span><span style="color: #007700">;<br><br></span><span style="color: #0000BB">$dsn&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"mysql:host=</span><span style="color: #0000BB">$host</span><span style="color: #DD0000">;dbname=</span><span style="color: #0000BB">$db</span><span style="color: #DD0000">;charset=</span><span style="color: #0000BB">$charset</span><span style="color: #DD0000">"</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$opt&nbsp;</span><span style="color: #007700">=&nbsp;[<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">ATTR_ERRMODE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">ERRMODE_EXCEPTION</span><span style="color: #007700">,<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">ATTR_DEFAULT_FETCH_MODE&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">FETCH_ASSOC</span><span style="color: #007700">,<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">ATTR_EMULATE_PREPARES&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">,<br>];<br></span><span style="color: #0000BB">$pdo&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">(</span><span style="color: #0000BB">$dsn</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$user</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$pass</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$opt</span><span style="color: #007700">);</span><span style="color: #0000BB"></span></code></code></pre>
<p>Notice the "utf8mb4" instead of "utf8". &#128570;</p>
<p>Then you will be able to store these into your database.</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello PHP Ninja Cat!</p>
<p>Thank you for your suggestion!</p>              </div>
            </li>
 
            <li class="comment" id="comment-142">
              <div class="comment-author">
              	Ian, 12.12.16 22:26              </div>
              <div class="comment-body" style="overflow:hidden"><p>[ Thank you for your reply dated 12 Dec 16]
Hello again.
After using the code above:-</p>
<pre><code><code><span style="color: #0000BB">$host&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'127.0.0.1'</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$db&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'test'</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$user&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'root'</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$pass&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">''</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$charset&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'utf8'</span><span style="color: #007700">;<br><br></span><span style="color: #0000BB">$dsn&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"mysql:host=</span><span style="color: #0000BB">$host</span><span style="color: #DD0000">;dbname=</span><span style="color: #0000BB">$db</span><span style="color: #DD0000">;charset=</span><span style="color: #0000BB">$charset</span><span style="color: #DD0000">"</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$opt&nbsp;</span><span style="color: #007700">=&nbsp;[<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">ATTR_ERRMODE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">ERRMODE_EXCEPTION</span><span style="color: #007700">,<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">ATTR_DEFAULT_FETCH_MODE&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">FETCH_ASSOC</span><span style="color: #007700">,<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">ATTR_EMULATE_PREPARES&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">,<br>];<br></span><span style="color: #0000BB">$pdo&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">(</span><span style="color: #0000BB">$dsn</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$user</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$pass</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$opt</span><span style="color: #007700">);</span><span style="color: #0000BB"></span></code></code></pre>
<p>and inserting the server ip address, my database user name,
password, database name.  I'm finding it don't work.  Am I going wrong?</p>
<p>Would you write a sample code which will, Connect and open the database, create a table and finally insert data and close?  Thank you.</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Ian!</p>
<p>Well, this this is the exact code that should work, given you provides the correct database credentials. To avoid a confusion, please keep in mind the following:</p>
<ul>
<li>when something doesn't work, always provide the actual outcome - the error message, the information shown, etc. You know it's hard to tell anything if you can't see the actual result</li>
<li>this code have to be used with PDO only. whatever else functions like mysql_query or mysqli_query won't work with it.</li>
<li>Taken by itself, this very code is not supposed to "work". It just connects to a database, that's all. What is your expectations for this code, how it's supposed to work?</li>
</ul>              </div>
            </li>
 
            <li class="comment" id="comment-141">
              <div class="comment-author">
              	Ian, 12.12.16 02:07              </div>
              <div class="comment-body" style="overflow:hidden"><p>Hello.
Just a quick query, I'm currently teaching myself php, and started looking at database. I'd just like to ask, how do I insert using mysqli as the data is been displayed on the screen only, and not been inserted into the database?   Secondly is pdo better, if so, how do I get started with it?</p>
<p>Thank You</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Ian!</p>
<p>Thank you for your questions.</p>
<p>For the first question it's hard to tell, without a code. All I can tell is that you have to use a prepared statement for your query because it helps you to avoid many problems.</p>
<p>As of the PDO - you just landed on the exact page you need: this is a very good PDO tutorial. Feel free to ask any question you have.</p>              </div>
            </li>
 
            <li class="comment" id="comment-139">
              <div class="comment-author">
              	Hannes, 09.12.16 09:58              </div>
              <div class="comment-body" style="overflow:hidden"><p>I really like your page and whole blog :) everybody should use code like you explain. If you ever release a book i'll buy it :)</p></div>
            </li>
 
            <li class="comment" id="comment-138">
              <div class="comment-author">
              	Sam Judge, 07.12.16 21:57              </div>
              <div class="comment-body" style="overflow:hidden"><p>Oh wow didn't know about the trailing comma in the arrays, learn something new every day :D Great tutorial, very comprehensive and useful !</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>You're welcome!</p>              </div>
            </li>
 
            <li class="comment" id="comment-137">
              <div class="comment-author">
              	Sam Judge, 07.12.16 12:47              </div>
              <div class="comment-body" style="overflow:hidden"><p>You have an error in one of your first snippets : </p>
<pre><code><code><span style="color: #0000BB">$opt&nbsp;</span><span style="color: #007700">=&nbsp;[<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">ATTR_ERRMODE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">ERRMODE_EXCEPTION</span><span style="color: #007700">,<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">ATTR_DEFAULT_FETCH_MODE&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">FETCH_ASSOC</span><span style="color: #007700">,<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">ATTR_EMULATE_PREPARES&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">,<br>];</span><span style="color: #0000BB"></span></code></code></pre>
<p>You have a comma after your last key-value pair! I'm sure that's not right :)</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Sam!</p>
<p>Thank you for taking care, but there is no error: )<br>
Unlike JS, <a href="http://php.net/manual/en/language.types.array.php">in PHP it's pretty legitimate</a> and hugely useful too, allowing an uniform syntax for all array members.</p>              </div>
            </li>
 
            <li class="comment" id="comment-136">
              <div class="comment-author">
              	grnadpa, 05.12.16 04:20              </div>
              <div class="comment-body" style="overflow:hidden"><p>in the try-catch you allow, the </p>
<pre><code><code><span style="color: #0000BB"></span><span style="color: #007700">try&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #DD0000">"INSERT&nbsp;INTO&nbsp;users&nbsp;VALUES&nbsp;(NULL,?,?,?,?)"</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">(</span><span style="color: #0000BB">$data</span><span style="color: #007700">);<br>}&nbsp;catch&nbsp;(</span><span style="color: #0000BB">PDOException&nbsp;$e</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">$e</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getCode</span><span style="color: #007700">()&nbsp;==&nbsp;</span><span style="color: #0000BB">1062</span><span style="color: #007700">)&nbsp;{&nbsp;&nbsp;</span><span style="color: #0000BB"></span></code></code></pre>
<p>did not work for me as the value was 23000 or some such on a duplicate. What did work for me was </p>
<pre><code><code><span style="color: #0000BB"></span><span style="color: #007700">if&nbsp;(</span><span style="color: #0000BB">$e</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">errorInfo</span><span style="color: #007700">[</span><span style="color: #0000BB">1</span><span style="color: #007700">]&nbsp;==&nbsp;</span><span style="color: #0000BB">1062</span><span style="color: #007700">)&nbsp;{</span><span style="color: #0000BB"></span></code></code></pre>
<p>I'm running on a dell Inspiron 15 laptop under windows 10 using Chrome Version 54.0.2840.99 . PHP version: 5.6.21 MySQL 5.7</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Thank you for the report! </p>
<p>Although it's just to illustrate the handling process, I have to dig into these codes deeper. I had the same issue before but no time to investigate and develop the universal solution. Will add to my TODO list.</p>              </div>
            </li>
 
            <li class="comment" id="comment-133">
              <div class="comment-author">
              	Ian Shepherd, 23.11.16 19:05              </div>
              <div class="comment-body" style="overflow:hidden"><p>This is a great article, and I have bookmarked the site for future use. Having seen your comment about inviting corrections to your English (which is excellent, by the way), I have one that will improve readability in this article: in several places, you say "one have to", which should be "one has to". The verb "to have" is conjugated like so: I have; you (singular) have; he/she/it/one has; we have; you (plural) have; they have. Hope this helps :)</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Ian!</p>
<p>Thank you for your kind words and a suggestion!
Been busy recently, but finally got time to fix that.</p>              </div>
            </li>
 
            <li class="comment" id="comment-132">
              <div class="comment-author">
              	My name, 19.11.16 15:55              </div>
              <div class="comment-body" style="overflow:hidden"><p>That code is vulnerable to sql injection.
you obviously havent tested it thoroughly.</p></div>
            </li>
 
            <li class="comment" id="comment-130">
              <div class="comment-author">
              	Alan Cameron, 24.10.16 22:21              </div>
              <div class="comment-body" style="overflow:hidden"><p>I would like more on how to INSERT INTO  a MySQL database.
I am having trouble understanding some code I have gathered from the internet and the insert function of the DB.php after assembling the data keys and values as fields and placeholders calls the query function of the DB.php to do the insert as a Query. It then checks to see if an error occurred using</p>
<pre><code><code><span style="color: #0000BB"></span><span style="color: #007700">if&nbsp;(!</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #0000BB">$sql</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$fields</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">error</span><span style="color: #007700">())<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">true</span><span style="color: #007700">;<br>}</span><span style="color: #0000BB"></span></code></code></pre>
<p>This is returning without any error but no data is inserted.
What is the correct way using PDO to check for successful completion of the insert?</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Alan!</p>
<p>Thank you for the good question.
Although the example you posted is not a genuine PDO (there is no error() method), and thus I cannot comment on it, I can answer the question regarding error handling in general.</p>
<p>Most of time, you don't have to check for the success. Just write your code out of the assumption that everything goes well. So in your case you can just return true, unconditionally.</p>
<p>As of the possible failure, you don't have to write any dedicated handling code either.
Let me explain. You see, an error message like "Sorry insert failed" exists only in schoolbooks. While for the real life sites it is agreed upon, that on any unexpected error your program should just halt. Given PHP can halt on error by itself, you don't have to write any handling code by hand. However, this halting process consists of several steps. I am still in the process of writing a whole article on the matter but in short:</p>
<ul>
<li>on a live site, a complete error message should go into error log. Just to let you know what went wrong.</li>
<li>while in the browser a generic error page have to be shown.</li>
</ul>
<p>Both actions (logging and showing an excuse page) can be set up in a centralized way, written only once, somewhere else in your code. Means for the moment you can keep your code as is, while by the time it goes live, you will be able to add whatever centralized error handling code you wish.</p>
<p>To let PDO halt on errors, just set it in exception mode is it's shown in the article above, and avoid catching exceptions right in place. </p>
<p>Please feel free to ask if something is still unclear to you or you have some particular scenario in mind you have to handle.</p>              </div>
            </li>
 
            <li class="comment" id="comment-128">
              <div class="comment-author">
              	Sameer sakhare, 07.10.16 14:55              </div>
              <div class="comment-body" style="overflow:hidden"><p>Thanks for the reply and the solution.</p></div>
            </li>
 
            <li class="comment" id="comment-127">
              <div class="comment-author">
              	craz-ola, 06.10.16 06:24              </div>
              <div class="comment-body" style="overflow:hidden"><p>I really don't see the benefit of PDO. I've written almost 100 e-stores from the ground up with all SQL flavors. This just seems like a big headache and annoying. It's easy to prepare SQL statements and send them to a server. I personally don't think 'oh wow its gonna help my queries so much' ... I usually output the query in text to test it in a shell window.... and PDO is the type of thing that causes sites to crash , be slow, and be dumb.. because the developer put too much faith into it..! it just makes it harder to debug later....</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>PDO doesn't cause sites to crash or be slow.
You confused it with something else.</p>              </div>
            </li>
 
            <li class="comment" id="comment-126">
              <div class="comment-author">
              	robot, 05.10.16 18:40              </div>
              <div class="comment-body" style="overflow:hidden"><p>pdo o mysqli?</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello robot! :)</p>
<p>Here is an article for you,
<a href="https://phpdelusions.net/pdo/mysqli_comparison">https://phpdelusions.net/pdo/mysqli_comparison</a></p>              </div>
            </li>
 
            <li class="comment" id="comment-125">
              <div class="comment-author">
              	Ionut, 05.10.16 10:19              </div>
              <div class="comment-body" style="overflow:hidden"><p>Interesting and logical points of view on this site, I like it. </p>
<p>I have a question regarding exception handling though: ok, it makes sense to let exceptions bubble up the call stack and use an application-wide handler, but what do I do if I need to show an error message in a certain place on the page? </p>
<p>For instance, I have a page that displays a menu at the top, and underneath that menu is the place where I want success/error messages to appear. If the user tries to perform an operation in that page, and the operation fails because of the db, how can I display an error message in the proper place on the page if I use a generic exception handler?</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Ionut!</p>
<p>Thank you for a very good question.</p>
<p>Speaking of database errors, you don't actually show error messages for them.
For the success message it's all right;
For the validation errors it's all right;
But for the system errors it is not. </p>
<p>For such a system-wide error like a database failure (or whatever else PHP error), it's better to show a static 500 error message. Because if your database failed, then most likely you won't get your page properly anyway - there are a lot of other queries that won't fire too. Just look at all these big boys - they don't show you anything like that on page reload.</p>
<p>The only case when such an error message can be shown is AJAX call. But again, for a server it's all the same: on failure it have to send an error HTTP status code and a static error page. Then either the latter will be shown (if requested directly) or the AJAX handler will consider the response status code (which is not 200) and show an error message. </p>
<p>If you still have any doubts, please provide a particular error example you are thinking of. It will make my answer more focused.</p>              </div>
            </li>
 
            <li class="comment" id="comment-124">
              <div class="comment-author">
              	Sameer sakhare, 04.10.16 22:47              </div>
              <div class="comment-body" style="overflow:hidden"><p>I was waiting for my comment to be approved by moderator as it has link of image file : explaining my Question in detail.</p>
<p>I really need answer for the question, can you please look into it.</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Sorry, but there was no comment with an image. Can you please try to re-post it?
Or you can reply to the notification email directly, with your image attached.</p>              </div>
            </li>
 
            <li class="comment" id="comment-123">
              <div class="comment-author">
              	Jouni "rautamiekka" J?rvinen, 04.10.16 18:05              </div>
              <div class="comment-body" style="overflow:hidden"><p>"if you need to know how many rows in the table, use SELECT COUNT(*) query."</p>
<p>Partially false. First, don't take every column into the counting, it's worthless wasting. Second, make use of indexes, especially the primary key (or closest unique key of same purpose if no primary exists) like this: </p>
<pre><code><code><span style="color: #0000BB">SELECT&nbsp;COUNT</span><span style="color: #007700">(`</span><span style="color: #DD0000">primarykeycolumn</span><span style="color: #007700">`)&nbsp;</span><span style="color: #0000BB">FROM&nbsp;</span><span style="color: #007700">`</span><span style="color: #DD0000">table</span><span style="color: #007700">`&nbsp;USE&nbsp;</span><span style="color: #0000BB">INDEX&nbsp;</span><span style="color: #007700">(`</span><span style="color: #DD0000">PRIMARY</span><span style="color: #007700">`)</span><span style="color: #0000BB"></span></code></code></pre></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Joni!</p>
<p>Thank you for your contribution.
Unfortunately, both your statements are not true.</p>
<p>The first one is just irrelevant to the question. count(*) has nothing to do with selecting columns. When counting, your database actually doesn't select anything, it just counts.</p>
<p>The second statement is wrong too, just because your database is smart enough to pick up the appropriate index by itself. You can test it yourself, by running query</p>
<pre><code><code><span style="color: #0000BB">EXPLAIN&nbsp;SELECT&nbsp;count</span><span style="color: #007700">(*)&nbsp;</span><span style="color: #0000BB">FROM&nbsp;table&nbsp;</span></code></code></pre>
<p>and checking the KEY section. There will be a key, if you have one defined in your table.</p>
<p>Hope it is all clear now :)</p>              </div>
            </li>
 
            <li class="comment" id="comment-120">
              <div class="comment-author">
              	Stefan, 03.10.16 06:28              </div>
              <div class="comment-body" style="overflow:hidden"><p>You can't seriously call this a "proper PDO tutorial" when you don't ever say what "PDO" means, not even once. I had to google it to find out that it means "PHP Data Objects", which doesn't appear anywhere on this page (except now in my comment).</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Funny, but you are right!</p>
<p>Dunno what practical use you can make from knowing that acronym meaning, or whether "PHP Data Objects" makes any better sense for you, but indeed you are right - I didn't bother to put it here. I will fix it, special for you!</p>
<p>I am glad it was the only factual error you found :)</p>              </div>
            </li>
 
            <li class="comment" id="comment-119">
              <div class="comment-author">
              	Sameer sakhare, 02.10.16 17:23              </div>
              <div class="comment-body" style="overflow:hidden"><p>Your post covers every thing about PDO and its execution, but i have following doubts:</p>
<ol>
<li>What about sub-queries in where clause</li>
</ol>
<p>eg : </p>
<pre><code><code><span style="color: #0000BB">Select&nbsp;</span><span style="color: #007700">*&nbsp;</span><span style="color: #0000BB">from&nbsp;tblUser&nbsp;Where&nbsp;nUserTypeID</span><span style="color: #007700">=(&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">SELECT&nbsp;nTypeID&nbsp;from&nbsp;tblTypeMaster&nbsp;where&nbsp;vTypeName&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'admin'</span><span style="color: #007700">)</span><span style="color: #0000BB"></span></code></code></pre>
<p>sorry if query is not well formated</p>
<ol start="2">
<li>What about JOINS</li>
</ol></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>The kind of SQL query is irrelevant to PDO: you can run any kind of query with PDO. You can run joins, sub-queries, stored procedures; set variables - whatever. PDO has nothing to do with your SQL - it will just relay it to database server.</p>
<p>Hope it's clear now.</p>              </div>
            </li>
 
            <li class="comment" id="comment-118">
              <div class="comment-author">
              	Leslie, 27.09.16 15:29              </div>
              <div class="comment-body" style="overflow:hidden"><p>You have a typo in the INSERT/UPDATE example:</p>
<pre><code><code><span style="color: #0000BB">$values</span><span style="color: #007700">[</span><span style="color: #0000BB">$field</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$source</span><span style="color: #007700">[</span><span style="color: #0000BB">$field</span><span style="color: #007700">];</span><span style="color: #0000BB"></span></code></code></pre>
<p>should be</p>
<pre><code><code><span style="color: #0000BB">$values</span><span style="color: #007700">[</span><span style="color: #0000BB">$field</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$data</span><span style="color: #007700">[</span><span style="color: #0000BB">$field</span><span style="color: #007700">];</span><span style="color: #0000BB"></span></code></code></pre></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Thanks a lot!
Fixed.</p>              </div>
            </li>
 
            <li class="comment" id="comment-115">
              <div class="comment-author">
              	Danny, 17.09.16 11:42              </div>
              <div class="comment-body" style="overflow:hidden"><p>I am not a robot &gt;.&gt;</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Neither I am :)</p>              </div>
            </li>
 
            <li class="comment" id="comment-114">
              <div class="comment-author">
              	Danny, 17.09.16 11:41              </div>
              <div class="comment-body" style="overflow:hidden"><p>Hello</p></div>
            </li>
 
            <li class="comment" id="comment-111">
              <div class="comment-author">
              	Bob, 24.08.16 14:23              </div>
              <div class="comment-body" style="overflow:hidden"><p>You say "This is the main and the only important reason why you were deprived from your beloved mysql_query() function and thrown into the harsh world of Data Objects: PDO has prepared statements support out of the box"</p>
<p>But $mysqli-&gt;prepare supports prepared statements. So prepared statements do not seem to be a reason to use PDO instead of mysqli.</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Thank you for catching that. Indeed the phrasing is not that clear. However, mysqli is not mentioned not implied here. This article is not about mysqli vs PDO comparison. It's solely about PDO, and it is expected that the reader is interested in PDO and this is why it mentioned here. </p>
<p>If you're looking for the article explaining why one should prefer PDO over mysqli, here is one: <a href="https://phpdelusions.net/pdo/mysqli_comparison">https://phpdelusions.net/pdo/mysqli_comparison</a></p>
<p>Hope it is clear now.</p>              </div>
            </li>
 
            <li class="comment" id="comment-110">
              <div class="comment-author">
              	Will, 24.08.16 14:19              </div>
              <div class="comment-body" style="overflow:hidden"><p>As requested, a correction to the last paragraph on your landing page. You can delete this comment after using it.</p>
<p>Text with improved grammar:
Disclaimer: I am not a native English speaker and have never even attended an English class, so there are tons of mistakes in the text for sure - I beg your pardon for them. Please, feel free to leave comments with corrections.</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Thanks a lot! Corrected.</p>              </div>
            </li>
 
            <li class="comment" id="comment-109">
              <div class="comment-author">
              	George Butter, 22.08.16 06:07              </div>
              <div class="comment-body" style="overflow:hidden"><p>This is the best PDO tutorial I have found yet and I have SCOURED the internet. Your explanations are so much more logical than anyone else's and you have covered so much. Thank You.</p></div>
            </li>
 
            <li class="comment" id="comment-107">
              <div class="comment-author">
              	Tyler, 07.08.16 00:54              </div>
              <div class="comment-body" style="overflow:hidden"><p>If one should never use the rowCount() to count rows in database, what is the best way to handle pagination?</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello Tyler!</p>
<p>Thank you for the good question. Pagination is exactly the case when one should never ever use the <code>rowCount()</code>.</p>
<p>By using this function you will ask a database to send into your PHP script all the rows found. It is highly inefficient and even may lead your server to failure. </p>
<p>Instead, just like it is said in the article, you have to ask a database to count the number of rows, by sending a query </p>
<pre><code><code><span style="color: #0000BB">SELECT&nbsp;count</span><span style="color: #007700">(*)&nbsp;</span><span style="color: #0000BB">FROM&nbsp;</span><span style="color: #007700">...</span><span style="color: #0000BB"></span></code></code></pre>
<p>and then reading that single result. </p>
<p>Feel free to ask if you have any further questions!</p>              </div>
            </li>
 
            <li class="comment" id="comment-104">
              <div class="comment-author">
              	jamsden, 03.08.16 05:14              </div>
              <div class="comment-body" style="overflow:hidden"><p>This site has taught me more than 100 others. Thanks for the clear explanation of these confusing points.</p>
<p>One comment, it might be helpful to absolute beginners like myself, if you showed both email and status in your placeholders example. It was a little confusing for me to make the leap from SQL to named placeholder substitution.</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hi there!</p>
<p>Thank you a lot for the kind words, and - especially - for the suggestion. Indeed it was a stupid for me to omit status in the examples. Fixed now!</p>
<p>You're welcome to share any other suggestions or confusions - it will help me to make the site better for other people!</p>              </div>
            </li>
 
            <li class="comment" id="comment-103">
              <div class="comment-author">
              	Merlin, 30.07.16 19:49              </div>
              <div class="comment-body" style="overflow:hidden"><p>Merlin rolls a +8 fireball against the robot.</p></div>
            </li>
 
            <li class="comment" id="comment-101">
              <div class="comment-author">
              	robot, 26.07.16 22:02              </div>
              <div class="comment-body" style="overflow:hidden"><p>iRobot</p></div>
            </li>
 
            <li class="comment" id="comment-98">
              <div class="comment-author">
              	Cliff, 01.07.16 04:17              </div>
              <div class="comment-body" style="overflow:hidden"><p>I have tried everything to get a piece of code to work. Can I pay you to give me a solution that works, as well as review other pieces of code I have written. If you reply to my email I will send the code. Unfortunately the time I have spent trying to learn this stuff has been sucking up all my time when I should be doing other things that make money.</p></div>
            </li>
 
            <li class="comment" id="comment-95">
              <div class="comment-author">
              	Bell, 26.06.16 17:19              </div>
              <div class="comment-body" style="overflow:hidden"><p>"Recently all PHP extensions that work with mysql database were updated based on a low-level library called mysqlnd, which replaced old libmysql client"</p>
<p>This means PHP 5.3+. The word "recently" should be replaced.</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Thank you for your suggestion.</p>
<p>I will try to re-phrase it, but the problem is that replacement is not permanent. There are distributions, where libmysql is used by default. Means one could still encounter with outdated setup. So, for the end user the change is still recent, in the meaning one cannot rely on mysqlnd for sure.</p>              </div>
            </li>
 
            <li class="comment" id="comment-94">
              <div class="comment-author">
              	gemozlobin, 25.06.16 12:56              </div>
              <div class="comment-body" style="overflow:hidden"><p>It did not work, beacause PDO::FETCH_UNIQUE does not work with PDO statement::setFetchMode, it affect only if use in fetchAll method :(</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Thank you for shring! </p>
<p>I will not delete your comments because it may help someone else. We all learn from our mistakes and sharing a mistake is as good as sharing an achievement. </p>
<p>I will add a clarification regarding setFetchMode() to the article.</p>
<p>Thank you for this finding again!</p>              </div>
            </li>
 
            <li class="comment" id="comment-93">
              <div class="comment-author">
              	gemozlobin, 25.06.16 12:42              </div>
              <div class="comment-body" style="overflow:hidden"><p>About previous comment
Sorry it was my mistake.
I use ORM over PDO and it did not work, but clean PDO is working.
You can delete this and my previous comment</p></div>
            </li>
 
            <li class="comment" id="comment-92">
              <div class="comment-author">
              	gemozlobin, 25.06.16 00:51              </div>
              <div class="comment-body" style="overflow:hidden"><p>Thanks for great job
But unfortunely PDO::FETCH_UNIQUE in mysql is not work as wrote in article. This options tell PDO return unique value not row indexed by key :(</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Such a use case (to get only unique values) would make a very little sense, as any database can return you unique values already.</p>
<p>Besides, all PDO fetch modes are irrelevant to database backend, working exactly the same way for all databases including mysql.</p>
<p>I tested this code many times and always get the result as shown in the example.</p>
<p>What is your setup? Do you have an unique value listed first in the field list in your query?</p>              </div>
            </li>
 
            <li class="comment" id="comment-87">
              <div class="comment-author">
              	Gerrit, 16.06.16 15:03              </div>
              <div class="comment-body" style="overflow:hidden"><p>Hi, thanks for the excellent article. It gives some really helpful advice even for a little advanced developer.</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Thank you for your kind feedback!
This kind of response helps to keep the thing going. Check back for updates!</p>              </div>
            </li>
 
            <li class="comment" id="comment-86">
              <div class="comment-author">
              	Julien, 06.06.16 22:28              </div>
              <div class="comment-body" style="overflow:hidden"><p>Great article. It convinced me to switch from mysqli to PDO.
There is just one detail that bother me, about the prepared statements and LIKE clauses. I may be wrong, but I'm pretty sure this don't work as intended:</p>
<pre><code><code><span style="color: #0000BB">$search2&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"%</span><span style="color: #0000BB">$search</span><span style="color: #DD0000">%"</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$stmt&nbsp;&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #DD0000">"SELECT&nbsp;*&nbsp;FROM&nbsp;table&nbsp;WHERE&nbsp;name&nbsp;LIKE&nbsp;?"</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">([</span><span style="color: #0000BB">$search2</span><span style="color: #007700">]);<br></span><span style="color: #0000BB">$data&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetchAll</span><span style="color: #007700">();</span><span style="color: #0000BB"></span></code></code></pre>
<p>PDO will escape the two extra '%' in $search2 as it will escape every other '%' that may have been already in $search.
It's the same thing for this:</p>
<pre><code><code><span style="color: #0000BB">$stmt&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #DD0000">"SHOW&nbsp;TABLES&nbsp;LIKE&nbsp;?"</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">([</span><span style="color: #DD0000">"%</span><span style="color: #0000BB">$name</span><span style="color: #DD0000">%"</span><span style="color: #007700">]);<br></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetchAll</span><span style="color: #007700">());</span><span style="color: #0000BB"></span></code></code></pre>
<p>A proper way to handle this might be: </p>
<pre><code><code><span style="color: #0000BB">$stmt&nbsp;&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #DD0000">"SELECT&nbsp;*&nbsp;FROM&nbsp;table&nbsp;WHERE&nbsp;name&nbsp;LIKE&nbsp;CONCAT('%',&nbsp;?,&nbsp;'%')"</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">([</span><span style="color: #0000BB">$search</span><span style="color: #007700">]);<br></span><span style="color: #0000BB">$data&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetchAll</span><span style="color: #007700">();</span><span style="color: #0000BB"></span></code></code></pre></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>This confusion is very easy to clear: pdo won't escape % symbol and has not a single reason to do so. Therefore all the above codes would work.</p>
<p>Your variant is perfectly legitimate too, but to me it's just too lengthy.</p>              </div>
            </li>
 
            <li class="comment" id="comment-83">
              <div class="comment-author">
              	test, 30.05.16 14:54              </div>
              <div class="comment-body" style="overflow:hidden"><p>This is a test to see if i am a robot works</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Passed, of course. There is no armor to break.</p>              </div>
            </li>
 
            <li class="comment" id="comment-82">
              <div class="comment-author">
              	AucT, 23.05.16 11:02              </div>
              <div class="comment-body" style="overflow:hidden"><p>I mean what do you think about using for simple task smth like <a href="http://stackoverflow.com/a/27826114/1767461">http://stackoverflow.com/a/27826114/1767461</a></p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Thank you for the suggestion.</p>
<p>There is a serious flaw in the answer by the link provided, as it doesn't sanitize the field names. </p>
<p>You may find a correct solution in this article, in the following section: <a href="https://phpdelusions.net/pdo#identifiers">https://phpdelusions.net/pdo#identifiers</a></p>
<p>Please ask if you find anything unclear or if you have any further questions.</p>              </div>
            </li>
 
            <li class="comment" id="comment-81">
              <div class="comment-author">
              	AucT, 23.05.16 10:54              </div>
              <div class="comment-body" style="overflow:hidden"><p>Hi!
I would like you to put some simple active record function, to update and insert assoc array</p></div>
            </li>
 
            <li class="comment" id="comment-79">
              <div class="comment-author">
              	wmm, 15.05.16 21:07              </div>
              <div class="comment-body" style="overflow:hidden"><p>sorry, i wasn't clear.  i was asking about what actually gets sent to mysql/maria (hereafter, myria).  your comment about the artificial query made me curious about what PDO actually sends.  i used wireshark to expose the conversation (WS is your friend :) and it appears the completely prepared query is sent to myria.  </p>
<p>so, now, i'm a bit more confused - can you illucidate?  (i'm really NOT trying to make a point here, it's just that inquiring minds need to know :)</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Got you.
It's ok with your confusion. I understand the feeling. You just need to put all the tiles together. Either way, I don't mind. </p>
<p>If you are using PDO with default settings, then emulation mode is used, when PDO is sending a regular SQL with all the values put i the query. It occurs when execute() method is called.</p>
<p>While with setting PDO::ATTR_EMULATE_PREPARES to FALSE, the behavior changes: PDO sends a query with placeholders, when prepare() is called. So my comment on the artificial query is only applicable to this mode. </p>
<p>If you are already turned emulation off and still observing SQL with data substituted - then it is something unusual.</p>              </div>
            </li>
 
            <li class="comment" id="comment-78">
              <div class="comment-author">
              	wmm, 14.05.16 00:52              </div>
              <div class="comment-body" style="overflow:hidden"><p>last question (promise) - you say that the query in mysql log is "an artificial query that has been created solely for logging purpose, but not a real one that has been executed" - exactly what is sent to mysql?</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Well, first of all please promise to ask more.
When asking, you are helping me to make this article better.</p>
<p>When in native mode (i.e. when emulation is turned off) the exact query with placeholders is sent. I.e. if you wrote</p>
<p>SELECT * FROM t WHERE id=?</p>
<p>then exactly the same query is sent to mysql and executed. This is how native prepared statements are intended to work. You may read my answer with explanation here: <a href="http://stackoverflow.com/a/8265319/285587">http://stackoverflow.com/a/8265319/285587</a></p>              </div>
            </li>
 
            <li class="comment" id="comment-77">
              <div class="comment-author">
              	wmm, 13.05.16 23:58              </div>
              <div class="comment-body" style="overflow:hidden"><p>thanks - in practice, never.  but i ran across this catch-22 behavior experimenting with PDO in phpsh quite by accident.  i thought there might be some way to recover, but, at the time, i had to exit phpsh then re-connect.</p></div>
            </li>
 
            <li class="comment" id="comment-76">
              <div class="comment-author">
              	wmm, 13.05.16 22:13              </div>
              <div class="comment-body" style="overflow:hidden"><p>i take it that, short of using buffered queries (or script exit), using PDO::query('SELECT something') will get you into a position where you can't recover, since there's no PDOStatement on which to do a fetch/fetchAll().  or did i miss something?   i assume the situation clears on script exit and/or connection loss.</p>
<p>tnx for the write up, both here and in SO - i refer to your thoughts frequently.</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Yes, you are right.
Everything that was associated with the connection (unfetched resultsets, prepared statements, transactions etc.) will be cleared up on the connection close (and PHP will close a connection on exit).</p>
<p>However, I am not quite getting your point, why would you run a query without assigning the result to a variable.</p>              </div>
            </li>
 
            <li class="comment" id="comment-75">
              <div class="comment-author">
              	Socrat, 11.05.16 10:48              </div>
              <div class="comment-body" style="overflow:hidden"><p>You have an error in text:
for all undefined properties <strong>get magic method will be called
if there is no </strong>get method in the class, then new property will be created</p>
<p>PDO doesn't execute <strong>get, instead it calls </strong>set to set values.
Cheers ;)</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Thanks a ton!
Fixed!</p>              </div>
            </li>
 
            <li class="comment" id="comment-73">
              <div class="comment-author">
              	Trevor, 30.04.16 20:57              </div>
              <div class="comment-body" style="overflow:hidden"><p>Thank you so much for this brilliant document. It really covers most of the things in an inspiring way.</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Thank you for your feedback!</p>
<p>If you have any questions, I'll be glad to answer, as answering questions lets me make the article more clear and useful.</p>              </div>
            </li>
 
            <li class="comment" id="comment-71">
              <div class="comment-author">
              	idk15, 26.04.16 06:45              </div>
              <div class="comment-body" style="overflow:hidden"><p>One other downside to unbuffered queries is you can't run any other queries until the current query has returned all of its results.  That's why it is more convenient for the user to have PHP retrieve all the rows of a dataset before iterating over them - doing so allows other queries to be run inside the while loop.</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Thanks a lot for the reminder. Surely it's a really important issue. Added it to the text.</p>              </div>
            </li>
 
            <li class="comment" id="comment-70">
              <div class="comment-author">
              	ydk2, 15.04.16 10:34              </div>
              <div class="comment-body" style="overflow:hidden"><p>Yes great and simple.</p></div>
            </li>
 
            <li class="comment" id="comment-69">
              <div class="comment-author">
              	brokenOval, 12.04.16 22:05              </div>
              <div class="comment-body" style="overflow:hidden"><p>Great article - love the gotchas at the end. I would love to see an addition dealing with the INSERT... ON DUPLICATE UPDATE procedure (which I'm currently exploring) and how the single statement would take x number of bound variables on the INSERT with additional variables if the UPDATE procedure is sent.</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hello!</p>
<p>I am in doubts whether to add on duplicate case or not, as it's not directly related to PDO. Either way the answer is sumple.</p>
<p>This kind of query has a neat feature exactly for your case. You can refer to an insert part value using values() function (which is different from regular values()):</p>
<p>Insert into t (foo, bar) values (?,?) On duplicate key update bar= values(bar);</p>
<p>So you have to bind your variables only once.
Hope you get the idea.</p>
<p>Either way feel free to ask any questions!</p>              </div>
            </li>
 
            <li class="comment" id="comment-67">
              <div class="comment-author">
              	len, 09.04.16 17:53              </div>
              <div class="comment-body" style="overflow:hidden"><p>This tutorial is a hackers wet dream. The statement
$pdo = new PDO($dsn, $user, $pass, $opt); </p>
<p>could possibly dump your complete login details (server, user, pw, etc) if there is any issue with connecting to the db (timeout or whatever). This info is contained in the exception.  I stopped reading after that statement, I don't care if it is mentioned later on, YOU SHOULD NEVER send that command naked. I know what you are going to say later on but what I wrote is 100% true and I tested it.</p>
<p>No wonder php has such a bad reputation.</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>PHP has its reputation due to users. Who is ignorant about most basic PHP settings. display_errors for instance. Which have to be turned OFF on a live site - a PROPER way for hiding error messages. </p>
<p>ALL messages, mind you, not only one you've accidentally became aware of.</p>              </div>
            </li>
 
            <li class="comment" id="comment-66">
              <div class="comment-author">
              	Salagir, 01.04.16 16:30              </div>
              <div class="comment-body" style="overflow:hidden"><p>Thanks for the great article! I've been modifiying my code already!</p>
<p>A few things:</p>
<blockquote>
<p>"but most of time it's all right and won't cause any problem. E.g."
There is no example after that.</p>
<p>$deleted = $stmt-&gt;fetchRow();
I didn't find this function in the manual. Are you thinking rowCount() ?</p>
<p>Although you can tell rowCount()
Font change for ")" stops too soon ;p</p>
</blockquote></div>
            </li>
 
            <li class="comment" id="comment-62">
              <div class="comment-author">
              	Geist, 10.03.16 04:51              </div>
              <div class="comment-body" style="overflow:hidden"><p>Hi, I'm kinda new to PDO and would like some advice. </p>
<p>Right now I have three different tables in three different &amp; separate databases (2 PGSQL, 1 MSSQL) that I have to INSERT into for user registration. This means I have 3 PDO connections, now all three INSERT are a bit different:</p>
<p>SQL 1: INSERT into user (Name, Password, Age)
SQL 2: INSERT into users ([LOGINNAME], [PASS], [OCCUPATION])
SQL 3: INSERT into users (Name, Address, Position)</p>
<p>Now what I want to do is to somehow rollback the INSERTs if one or more fails to insert, and commit only if all three can be inserted?
Can I rollback or commit outside of the try catch? or do I put all of them in one huge try catch block? or is there a better way that I can approach this?</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>Hi!</p>
<p>I am afraid I can't offer anything better.</p>
<p>It's impossible to have a proper transaction for the separate connections. If you commit outside of try catch, there could be an error during commit itself - yet you'll be unable to rollback. </p>
<p>But that's better than nothing - so, I think that you have to commit outside of try catch. You may also want to add another try catch to wrap commits, and try to recover successful inserts somehow.</p>              </div>
            </li>
 
            <li class="comment" id="comment-57">
              <div class="comment-author">
              	Redeemer Pace, 25.02.16 01:02              </div>
              <div class="comment-body" style="overflow:hidden"><p>Well done tutorial especially for who is new to PDO. </p>
<p>I use it as OOP mode on base class, way easier that way :P</p></div>
            </li>
 
            <li class="comment" id="comment-56">
              <div class="comment-author">
              	Bad Habit, 24.02.16 21:06              </div>
              <div class="comment-body" style="overflow:hidden"><p>Please tell about PDO::FETCH_CLASSTYPE, it comes handy when you store objects of different subclasses in a single table</p></div>
            </li>
 
            <li class="comment" id="comment-48">
              <div class="comment-author">
              	Krash, 29.01.16 19:44              </div>
              <div class="comment-body" style="overflow:hidden"><p>Not covered topic with inserting batches. E.g.
INSERT INTO MyTable (col) VALUES (1),(2),(3);
AND
INSERT INTO MyTable (col) VALUES (1),(2),(3),(4);
Is two separate prepared needed?
$q1 = $pdo-&gt;prepare("INSERT INTO MyTable (col) VALUES (?),(?),(?),(?)");
$q1 = $pdo-&gt;prepare("INSERT INTO MyTable (col) VALUES (?),(?),(?)");</p></div>
            </li>
 
            <li class="comment" id="comment-44">
              <div class="comment-author">
              	boogers, 25.01.16 09:27              </div>
              <div class="comment-body" style="overflow:hidden"><p>nice job ripping the design from SO</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>You meant bootstrap and PHP.NET? ;)</p>              </div>
            </li>
 
            <li class="comment" id="comment-42">
              <div class="comment-author">
              	Hugo, 20.01.16 16:13              </div>
              <div class="comment-body" style="overflow:hidden"><p>@Ry nothing wrong with doing so, if you actually handle the error. If you are just echo'ing out the error message, you are better off not catching anything at all, you will get more information that way. And you can then turn off display_errors in production.</p></div>
            </li>
 
            <li class="comment" id="comment-41">
              <div class="comment-author">
              	Ry, 14.12.15 02:08              </div>
              <div class="comment-body" style="overflow:hidden"><p>great article, but what's wrong with wrapping pdo code by try - catch? I thought it was the way one handles exceptions in PHP?</p></div>
              <div class="comment-reply" style="overflow:hidden">
                <h4>Reply:</h4><p>I completely rewrote this section. Hope now it's clear.</p>              </div>
            </li>
 
            <li class="comment" id="comment-39">
              <div class="comment-author">
              	David, 21.11.15 16:05              </div>
              <div class="comment-body" style="overflow:hidden"><p>Thank you</p></div>
            </li>
 
            <li class="comment" id="comment-38">
              <div class="comment-author">
              	Yaqoob, 16.11.15 17:57              </div>
              <div class="comment-body" style="overflow:hidden"><p>This article pretty much clarified the proper useage of PDO, but sometimes it got over my head. old habits from mysqli_*</p></div>
            </li>
 
            <li class="comment" id="comment-29">
              <div class="comment-author">
              	Sunny, 23.10.15 17:52              </div>
              <div class="comment-body" style="overflow:hidden"><p>I'm trying to go from old, raw mysql to abstraction. PDO looks like a good path. Thanks !</p></div>
            </li>
 
            <li class="comment" id="comment-28">
              <div class="comment-author">
              	Porky, 14.10.15 22:01              </div>
              <div class="comment-body" style="overflow:hidden"><p>I am robot</p></div>
            </li>
 
            <li class="comment" id="comment-20">
              <div class="comment-author">
              	mac ll, 29.09.15 04:28              </div>
              <div class="comment-body" style="overflow:hidden"><p>good</p></div>
            </li>
          </ul>
          
        </div>
      </div>
    </div>

    

    <div class="footer">
      <div class="container">
        <div class="col-xs-12 col-sm-2 col-md-2">
        </div>
        <div class="col-xs-12 col-sm-10 col-md-8">
            <a href="https://phpdelusions.net/about" class="footer-link">About</a>
             phpdelusions.net, 2021
        </div>
        <div class="col-xs-12 col-sm-12 col-md-2">
          <p></p>
        </div>
      </div>
    </div>
    <!-- Srcipts-->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-49337698-1', 'auto');
  ga('send', 'pageview');
  ga('send', '_trackPageview');
  
  document.addEventListener("click", function(){
    ga('send', 'event', 'View tracker', 'click');
  });
</script>
    <script src="./(The only proper) PDO tutorial - Treating PHP Delusions_files/jquery.min.js"></script>
    <script src="./(The only proper) PDO tutorial - Treating PHP Delusions_files/bootstrap.min.js"></script>
    <script src="./(The only proper) PDO tutorial - Treating PHP Delusions_files/custom.js"></script>
  

<input type="file" id="" name="file" style="display: none;"><div data-v-a4d9f4e4="" class="container_selected_area" style="cursor: url(&quot;chrome-extension://ijejnggjjphlenbhmjhhgcdpehhacaal/assets/images/cursor-imagen.svg&quot;) 9 9, crosshair;"><div data-v-a4d9f4e4="" class="area"></div></div></body></html>