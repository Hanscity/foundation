# Assembly



## 序言



- 汇编语言是数据结构，操作系统，微机原理的重要基础



-  我希望这一次的学习过程是循序渐进的，所以选择了 8086CPU。（不是头文字D的AE８６，哈哈）

  

- 这是 INTEL 系列的命名方式，发展过程是 8080，8086/8088，80186，80286，80386，Pentium，PentinumII。。。



###  8086CPU VS 80386CPU

####       80386 具备三种模式

- 实时模式（8086 不具备实现一个完善的多任务操作系统功能，简而言之，单任务的）

- 保护模式

- 虚拟模式：可以在保护模式和实时模式之间切换，在现代的 Windows 操作系统中，当你打开 DOS，本质上就是从保护模式切换到了实时模式。反之依然。。





### 为何选择 8086 来学习 ？



- 通过以上的对比，可以看出，8086 的环境，更为纯净核心，不会受到保护模式等干扰，适合学习



- 同时，作为承上启下的重要版本，基本拥有了所有内容



## 第一章 基础知识 



### 1.1 机器语言



- 机器语言简称 0，1 代码



- CPU 将 0，1 代码的集合转化为一系列的高低电频，使相关的电子器件受到驱动，进行计算



- 每一种微处理器（CPU），由于硬件设计和内部结构的不同，就需要不同的电平脉冲来控制，所有都有自己的一套机器指令集，也就是机器语言。





#### 8086CPU 完成运算 s = 768 + 12288 - 1280

```assembly
10111000000000000000000011

00000001000000000000110000

00101101000000000000000101
```

- 这样的代码，如果有错误，难以查找





### 1.2 汇编语言的产生

```mermaid
graph LR
    A(程序员)-->B[汇编指令]-->C{编译器}-->D[机器码]-->E[计算机]

```



#### 汇编代码和机器码是一一对应的

- 操作：寄存器 BX 的内容送到 AX 中
- 机器指令： 1000100111011000
- 汇编指令： mov,ax,bx





### 1.3 汇编语言的组成

1. 汇编指令：机器码的助记符，有对应的机器码
2. 伪指令：没有对应的机器码，有编译器执行，计算机并不执行
3. 其他符号：如 +、-、*、/ 等，由编译器识别，没有对应的机器码



### 1.4 存储器

- 存储器俗称内存
- 指令和数据在存储器中存放
- 首先是了解 CPU 是如何从内存中读取消息，以及想内存中写入消息的 



### 1.5 指令和数据

- 指令和数据是应用上的概念。在内存和磁盘上，指令和数据没有任何区别，都是二进制数据
- 什么时候看作指令，什么时候看作数据呢？这有关于指令段和数据段的指定规则哈，具体操作往下。



### 1.6 存储单元

- 一般微型存储器（内存）的存储单位是 Byte(字节)
- 1Byte = 8bit ; 1KB = 1024B; 1MB = 1024 KB; 1GB = 1024MB; 1TB = 1024GB;
- 电子计算机最小的信息单位是 bit(比特),也就是一个二进制位



### 1.7 CPU 对存储器的读写

- 存储单元的地址（地址信息）
- 器件的选择，读或写的命令（控制信息）
- 读或写的数据（数据信息）



#### 总线

- 计算机中专门有连接 CPU 和其他芯片的导线，通常称为总线。总线从逻辑上分为 3 类，地址总线，控制总线，数据总线

  

### 1.8 地址总线

- CPU 是通过地址总线来指定存储器单元的。举例说明：80386 CPU的地址总线的宽度为 32 位，那么最大的内存寻址为
  2 的 32次方个内存单元

  ```
  2 * 2 * 1024 * 1024 * 1024 Byte=  4GB 
  ```



### 1.9 数据总线

- 8086 有 16 根数据线，可以一次传送 16 位数据，例如可以一次传送 89D8H

  ```
  1000 1001 1101 1000
  ```

  

  

### 1.10 控制总线

- 控制总线在这里是一个总称，控制总线的宽度决定了 CPU 对外部器件的控制能力。例如：对内存的读写



### 1.11 内存地址空间（概述）

- 地址宽度为 10，可以寻址 1024 个内存单元，这 1024 个可寻到的内存单元就构成了 CPU 的内存地址空间



### 1.12 主板

- 主板上有核心器件和一些主要器件，这些器件通过总线相连。这些器件有 CPU、存储器、外围芯片组、

  扩展插槽等。扩展插槽上一般有 RAM 内存条和各类接口卡。



### 1.13 接口卡

- CPU 通过总线向接口卡发送命令，接口卡根据 CPU 的命令控制外设进行工作



### 1.14 各类存储器芯片

#### 读写属性

-  RAM（Random Memory，随机存储器）
- ROM （Read Only Memory，只读存储器）



#### 功能和连接

- 主板上的 RAM
- ROM（BIOS（Basic Input/Output System））
- 接口卡上的 RAM （显存）



### 1.15 内存地址空间

- 基于一个计算机硬件系统编程的时候，必须知道这个系统中的内存地址空间的分配情况。
- 8086 的内存地址空间的分配情况如下
  1. 00000～9FFFF ： 主存储器地址空间 （RAM）
  2. A0000～BFFFF ：显存地址空间
  3. C0000～FFFFF ： 各类 ROM 地址空间





## 第二章 寄存器



- 内部总线实现了 CPU 内部各个器件之间的联系，外部总线实现 CPU 和主板上其他器件的联系。在 CPU 中：
  * 运算器进行信息处理
  * 寄存器进行信息存储
  * 控制器控制各种器件进行工作
  * 内部总线连接各种器件，在它们之间进行数据的传送
- 对于一个汇编程序员来说，CPU 中的主要部件是寄存器。通过改变寄存器中的内容来实现对 CPU 的控制。
- 8086 有 14 个寄存器，分别是： AX, BX, CX, DX, SI, DI, SP, BP, IP, CS, SS, DS, ES, PSW



### 2.1 通用寄存器

- AX, BX, CX, DX 这四个寄存器通常用来存放一般性的数据，被称为 通用寄存器

- 8086CPU 的所有寄存器都是 16 位的

- 8086CPU 的上一代 CPU 中的寄存器都是 8 位，为了保证兼容，AX, BX, CX, DX  可分为两个独立使用的 8 位

  寄存器来用

  ```Assembly
  AX                0100 1110  0010 0000                        4E20H         
  
  AH                0100 1110                                    4EH
  
  AL                0010 0000                                    20H
  ```

  

### 2.2 字在寄存器中的存储

-  处于兼容性的考虑，8086CPU 可以一次处理两种尺寸的数据，字节（byte），字（word,有两个字节组成）
- 高位字节放在 AH 中，低位字节放在 AL 中



### 2.3 几条汇编指令

- 结果为：ax=044CH, bx=8226H

| 程序段中的指令 | 执行后 AX 中的数据 | 执行后 BX 中的数据 |
| -------------- | ------------------ | ------------------ |
| 初始化         | 0000H              | 0000H              |
| mov ax,4E20H   | 4E20H              | 0000H              |
| add ax,1406H   | 0000H              | 0000H              |
| mov bx,2000H   | 0000H              | 0000H              |
| add ax,bx      | 0000H              | 0000H              |
| mov bx,ax      | 0000H              | 0000H              |
| add ax,bx      | 0000H              | 0000H              |





### 2.4 物理地址

- 每一个内存单元在这个空间中都有唯一的地址，这个唯一的地址称为物理地址



### 2.5 16 位结构的 CPU

- 运算器一次最多可以处理 16 位的数据
- 寄存器的最大宽度为 16 位
- 寄存器和运算器之间的通路为 16 位



### 2.6 8086CPU 给出物理地址的方法

- 8086CPU 地址总线的宽度为 20 位，寻址能力 1MB
  
    ```
    1024*1024*byte = 1MB
    ```

  
  
- 物理地址 = 段地址*16 + 偏移地址
![8086CPU 相关部件的逻辑结构](https://github.com/Hanscity/foundation/blob/master/picture/assembly_wangshuang/2-6-001.jpg)




